var __spreadArrays,__assign,WSB;(function(n){function t(){if(SearchAppWrapper.CortanaApp.hostingEnvironment==4)return 7;if(!n.isMiniSerpEnabled())return 0;var t=7;return n.config.allowAnswersToAutoOpenMiniSerp||(t&=-2),n.config.allowDNavToAutoOpenMiniSerp||(t&=-3),n.config.allowWebToAutoOpenMiniSerp||(t&=-5),t}var i=["::{679F85CB-0220-4080-B29B-5540CC05AAB6}","::{20D04FE0-3AEA-1069-A2D8-08002B30309D}"],r=function(){function r(){this.refreshEntrypointApp()}return r.prototype.refreshEntrypointApp=function(){this.EntryPointApp=SearchAppWrapper.CortanaApp.hostingEnvironment==3?1:n.config.forceSettingsAppExperience?3:SearchAppWrapper.CortanaApp.hostingEnvironment==5||n.config.forceSantoriniExperience?4:SearchAppWrapper.CortanaApp.hostingEnvironment==4?2:0},r.prototype.clearDefaults=function(){this.QfMode=0;this.PreviewPaneAvailable=!1;this.MiniSERPMode=0;this.AlwaysWide=!1;this.SearchBoxOnTop=!0;this.AllowKeyboardNavCycling=!0;this.AllowKeyboardNavOffCanvas=!1;this.ScopesAvailable=!1;this.FlatListWithoutGroups=!1;this.MaxSuggestionsWhenFlatList=0;this.SearchHomeAvailable=undefined;this.FirstSuggestionSelectedByDefault=!0;this.AllowProtocolSyntheticSuggestions=!0;this.PanelCanResize=!1},r.prototype.getAlwaysWideAndPrevewPaneAvailable=function(){var u=SearchAppWrapper.CortanaApp.textScaleFactor>1.25,t;try{t=SearchAppWrapper.CortanaApp.isWideSearch}catch(e){}var i=t!==!1&&!!n.Host.getFeatureDWORD("WideAtStartupDelta").featureValue,r=(i||n.config.alwaysWideBeforeRS5)&&!u,f=r||n.PreviewPane&&!i&&t!==!1;return[r,f]},r.prototype.OnAppVisible=function(){var r;this.clearDefaults();this.refreshEntrypointApp();n.isFileExplorerCurrentPathThisPcOrQuickAccess=!1;switch(this.EntryPointApp){case 1:r=n.safeExecute(function(){return SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentLocation},"fileExplorerSuggestionPage.currentLocation");r&&!r.startsWith("::")?this.QfMode=5:n.config.wsbInControlPanel&&r&&r.startsWith("::{26EE0668-A00A-44D7-9371-BEB064C98683}")?this.QfMode=9:n.contains(i,r)?(n.isFileExplorerCurrentPathThisPcOrQuickAccess=!0,this.QfMode=5):this.QfMode=999999;this.AllowKeyboardNavOffCanvas=!0;this.FlatListWithoutGroups=!0;this.MaxSuggestionsWhenFlatList=10;this.FirstSuggestionSelectedByDefault=!1;this.AllowProtocolSyntheticSuggestions=!1;this.PanelCanResize=!0;break;case 3:this.QfMode=7;this.FlatListWithoutGroups=!0;this.MaxSuggestionsWhenFlatList=10;this.AllowProtocolSyntheticSuggestions=!1;break;case 4:this.QfMode=8;this.FirstSuggestionSelectedByDefault=!1;break;case 2:var e=this.getAlwaysWideAndPrevewPaneAvailable(),u=e[0],f=e[1];this.QfMode=6;this.PreviewPaneAvailable=u||f;this.MiniSERPMode=this.PreviewPaneAvailable?t():0;this.AlwaysWide=u;this.ScopesAvailable=!1;this.SearchBoxOnTop=!1;this.SearchHomeAvailable=n.config.searchHomeSupported;break;case 0:default:var o=this.getAlwaysWideAndPrevewPaneAvailable(),u=o[0],f=o[1];this.QfMode=u?1:f?0:4;this.PreviewPaneAvailable=u||f;this.MiniSERPMode=this.PreviewPaneAvailable?t():0;this.AlwaysWide=u;this.ScopesAvailable=u?n.config.scopesOrderBeginAlwaysWide.length>0:n.config.scopesOrderBegin.length>0;this.SearchBoxOnTop=!1;this.SearchHomeAvailable=n.config.searchHomeSupported}},r}();n.RuntimeConfiguration=r})(WSB||(WSB={})),function(n){var t;(function(n){var t,i,r,u,f,e;(function(n){n.User="SRCHHPGUSR"})(t=n.CookieNames||(n.CookieNames={})),function(n){n.AutoSuggest="AS"}(i=n.CrumbNames||(n.CrumbNames={})),function(n){n.CursorPosition="cp";n.ConversationId="cvid";n.SuggestionCount="sc";n.PartialQuery="pq";n.SuggestionPosition="sp";n.SuggestionType="qs";n.PreviewPaneSuggestionType="qsc";n.SkipValue="sk";n.PreviewPaneSkipValue="skc";n.Ghosting="ghc";n.Css="css";n.Count="count";n.DataSet="ds";n.SessionId="sid";n.TimeStamp="qt";n.Query="q";n.ImpressionGuid="ig";n.QFQuery="qry";n.BaseQuery="bq";n.FormCode="form";n.HashedMuid="nclid";n.RequestElToken="elvr";n.ElTokenValue="elv";n.AppId="appid";n.History="history";n.NoHistory="nohs";n.ApiTextDecoration="textdecorations";n.ClientId="clientid";n.Market="mkt";n.Scope="scope";n.CountryCode="cc";n.HomeGeographicRegion="hgr";n.SetLang="setlang";n.ZeroInputSerp="zis";n.Host="host";n.CortanaVersion="version";n.QfMode="qfm"}(r=n.QueryParams||(n.QueryParams={})),function(n){n.ImpressionGuid="X-MSEdge-IG"}(u=n.Headers||(n.Headers={})),function(n){n.HitHighlighting="h";n.PopularNow="p";n.Local="l";n.Answers="a"}(f=n.Options||(n.Options={})),function(n){n.Id="id";n.Query="query";n.Url="url";n.Navigation="nav";n.Type="stype";n.Autocomplete="hc";n.InstData="h";n.AriaLabel="aria-label"}(e=n.SuggestionAttributes||(n.SuggestionAttributes={}))})(t=n.Service||(n.Service={}))}(WSB||(WSB={})),function(n){function gt(t,i){if(i){var r=d.exec(t);return r&&n.TopLevelDomains[r[1].toLowerCase()]==1}return d.test(t)}function ni(n){return bt.test(n)}function ti(t){for(var i,u=t.substr(1).split("%").map(function(n){return parseInt(n,16)}),r=0;r<u.length;++r)if((i=[u[r],u[r+1]||0,u[r+2]||0,u[r+3]||0],i[0]>=240&&++r&&i[3]<128)||i[0]>=224&&++r&&i[2]<128||i[0]>=192&&++r&&i[1]<128||i[0]<192&&i[0]>=128||i[0]<32||n.contains(nt,i[0]))return!1;return!0}function ii(n){return n.replace(/%25/g,"%2525").replace(/%([^0-9a-fA-F])/g,"%25$1").replace(/%([^0-9a-fA-F])/g,"%25$1").replace(/%(.[^0-9a-fA-F])/g,"%25$1").replace(/%(.[^0-9a-fA-F])/g,"%25$1").replace(/%(.)?$/g,"%25$1").match(/[^%]+|(?:%..)*/g).map(function(n){return n.startsWith("%")&&!ti(n)?n.replace(/%/g,"%25"):n}).join("")}function s(t){var i=t;return t.includes("%")&&(t=n.safeExecute(function(){return ii(t)},"sanitizeUrlEncodings",i,i)),n.safeExecute(function(){return decodeURI(t)},"safeDecodeURI",i,i)}function u(n,t){var r,u,i;if(!n)return null;if(n=n.trim(),n.includes("%")&&h(n))if(n.includes("?")){var e=/([^?]*)(.*)/.exec(n),f=e[1],o=e[2];f=s(f);n=f+o}else n=s(n);return(r=yt.exec(n),!r)?null:(u=r[0].length,t&&u<n.length)?null:(i={length:u,type:0,protocol:r[1]||"",auth:r[2]||"",hostname:r[3]||"",port:r[4]||"",path:r[5]||"",parameters:r[6]||"",unparsedSegment:n.substr(u)},i.auth&&!i.auth.includes(":")&&!i.protocol&&!i.port&&!i.path&&!i.parameters)?null:i.protocol||i.path&&i.path.endsWith("/")?i:pt.test(i.hostname)||gt(i.hostname,t)||y.test(i.hostname)||w.test(i.hostname)?i:(i.type=i.path&&!ni(i.path)?1:2,i)}function ri(n,t){var r=new RegExp("[?&]{1}"+t+"=([^&]+)([\\/\\\\][^?#]*)?([?#].*)?"),i=n.match(r);return i?i[1]:null}function oi(n){return fi.some(function(t){return n.startsWith(t)})||ui.test(n)||n.toLocaleLowerCase().includes(ei)}function si(n,t,i){var e=0,o=0,s=0,r;(t.startsWith("read:")||t.startsWith("ftp:"))&&(t=t.replace(f,""));r=u(t,!0);r&&r.type==0&&(e=hi(i,r),o=ci(i,t,r),s=li(i,r));n.protocolMatchLength=e;n.domainMatchLength=o;n.pathMatchLength=s}function hi(n,t){var i=f.exec(n),r=i?i[1]:n.trim();return t.protocol.startsWith(r)?r.length:0}function ci(t,i,r){var u,f,o,e,s;return y.test(r.hostname)||w.test(r.hostname)?r.hostname.startsWith(t)||i.startsWith(t)?t.length:0:(u=r.hostname.split("."),u.length==1?f=HitHighlightingParser.addMarkers(u[0],t):(u=u.length>2&&n.SecondLevelDomains[u[u.length-2]]?u.splice(0,u.length-2):u.splice(0,u.length-1),o=u.join("."),f=HitHighlightingParser.addMarkers(o,t)),e=f.indexOf(HitHighlightingParser.startMarker),e==-1)?0:t.includes(".")?(t.endsWith("/")&&(t=t.substr(0,t.length-1)),r.hostname.includes(t)?t.length:0):(s=f.indexOf(HitHighlightingParser.endMarker),s-e-1)}function li(n,t){var i,r,u;return t.path?(i=HitHighlightingParser.addMarkers(t.path,n),r=i.indexOf(HitHighlightingParser.startMarker),r==-1)?0:(u=i.indexOf(HitHighlightingParser.endMarker),u-r-1):0}function ai(n){return n=it(n,!1),wt.test(n)}function tt(n){return f.test(n)}function vi(n){return l.test(n)}function h(n){return at.test(n)}function yi(n){return tt(n)&&!h(n)}function pi(n){var t;return t=typeof n=="string"?n:c(n,!0),t=bi(t),t.trim().replace(/^ht+p(s)?[:;]+[\\\/]*|^\/*/ig,function(n,t){return t?"https://":"http://"})}function it(n,t){return t?n.includes("/")||(n=n.replace(/\\/g,"/")):n.startsWith("//")||n.includes("\\")||(n=n.replace(/\//g,"\\")),n}function wi(n){return n=it(n,!0).replace(/\/+/g,"/"),(n.startsWith("/")?"file:/":"file:///")+n}function bi(n){if(!n||!n.includes("\\"))return n;var i=n.includes("?")?n.indexOf("?"):n.length,r=n.includes("#")?n.indexOf("#"):n.length,t=Math.min(i,r),u=n.substring(0,t),f=n.substr(t);return u.replace(/\\/g,"/")+f}function c(n,t){var i=n.protocol?n.protocol:"";return i+=!t&&n.auth?n.auth:"",i+=n.hostname,i+=n.port?n.port:"",i+=n.path?n.path:"",i+=n.parameters?n.parameters:"",i+(n.unparsedSegment?n.unparsedSegment:"")}function i(n,t){var i=n,r,f,e;return t&1&&(r=rt.exec(i),r&&(i=r[1])),t&2&&(r=ut.exec(i),r&&(i=r[1])),t&4&&(r=ft.exec(i),r&&(i=r[1])),t&8&&(r=l.exec(i),r&&(i=r[1])),t&16&&(r=ki.exec(i),r&&(i=r[1])),t&32&&(f=u(i,!1),f&&(f.protocol=f.protocol.toLocaleLowerCase(),f.hostname=f.hostname.toLocaleLowerCase(),e=c(f),i=i.replace(/^(\s*)(?:[^\s]*)(\s*)$/g,"$1"+e+"$2"))),t&64&&(i=s(i)),i}function di(n){return l.test(n)}function e(n){return ut.test(n)?1:rt.test(n)?2:ft.test(n)?3:0}function gi(n,t,r){var f,u,o,s,e;return t?t=="/"?n:(f=i(t,7),f!=t)?n:(u=i(n,r?7:6),!u)?n:(o=t.toLowerCase(),"https".startsWith(o)&&!u.startsWith(t))?n:(s=i(f,8),s!=f)?u:(e=i(u,8),!e)?u:"www".startsWith(o)&&!e.startsWith(t)?u:e:i(n,r?15:14)||n}function nr(n,t){var i=e(t);switch(e(n)){case 1:return i!=2;case 2:return i!=1;case 3:case 0:return!0}}function tr(t,r,u){if(i(r,127)!=i(u,127))return!1;var f=e(t.originalQuery);return n.contains([1,2],f)&&!nr(r,u)?!1:!0}function ot(n){var t=u(n,!0),i;return t?(i=st(t),i?t.path.toLocaleLowerCase():null):null}function st(n){var t=n.hostname.split(".");return n.hostname&&t.length>1?t[t.length-1]=="com"&&et.some(function(n){return t[t.length-2]==n}):!0}function ir(t){if(t=="https://www.bing.com/?form=EDGSTP&pc=MESP"||t=="https://www.bing.com/?form=EDGSTP&pc=MESPB")return!0;var i=ot(t);return!!i&&n.contains(n.WebSearchPaths,i)}function rr(n){var t=u(n.replace(/^ftp:/g,"http:"),!0);return(t?t.hostname:null)||""}function ur(t){var r=t.queryToFetch.toLocaleLowerCase(),f,u;return r?(f=["/","ht","htt","http","https","ww","www"],u=i(r,15),!u||n.contains(f,r)||u!=r&&"www".startsWith(i(r,7))):!1}function fr(n){var t,i;return lt.test(n)||f.test(n)?!0:(t=n.replace(kt,"/"),dt.test(t)?t=t.replace(g,"."):t.includes(".")&&(t=t.replace(g,"")),i=u(t,!0),i&&i.type==0)}function er(t,i,r,u,f){var o,e;if(!t||!i||!r)return"";o=encodeURIComponent(i);e={triggeringMode:"Explicit",intent:r};u&&(e.entityId=u);var h=JSON.stringify(e),c=encodeURIComponent(h),l=f||t.bfbfrmcde,s=n.formatString(t.bfbSearchUrl,[o,c,l]);return _G&&_G.IG?s+"&cvid="+encodeURIComponent(_G.IG):s}function or(n){return n.replace(/[;,/?:@&=+$ ]/g,function(n){return"%"+n.charCodeAt(0).toString(16)})}var r="\\-\\s\\[\\]\\/\\\\!@#$%^&*()+={}:;~`\"'|<,>.。?",ht="(?:[^"+r+"]-*)*[^"+r+"](?:-*[^"+r+"])*",a="(?:[^"+r+"]-*)*[^"+r+"0-9](?:-*[^"+r+"])*",ct="(?:(?:"+ht+"[.。])*"+a+")[.。]?",v="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])",o="(?:(?:"+v+"\\.){3}"+v+")",y=new RegExp("^"+o+"$"),t="(?:[0-9a-fA-F]{1,4})",p="(?::(?:(?::"+t+"){1,7}|:)|(?:"+t+":){1,7}:|(?:"+t+":){7}"+t+"|(?:"+t+":){1,6}(?::"+t+"){1}|(?:"+t+":){1,5}(?::"+t+"){2}|(?:"+t+":){1,4}(?::"+t+"){3}|(?:"+t+":){1,3}(?::"+t+"){4}|(?:"+t+":){1,2}(?::"+t+"){5}|(?:"+t+":){1,1}(?::"+t+"){6}|fe80:(?::"+t+"){0,4}%[0-9]+|::ffff:"+o+"|)",w=new RegExp("^\\["+p+"\\]$","i"),b="ht+ps?[:;]+[\\\\/]*",lt=new RegExp(b,"i"),k=b+"|/+",at=new RegExp("^("+k+")","i"),vt=ct+"|"+o+"|\\["+p+"\\]",yt=new RegExp("^("+k+")?([^/@#?]*@)?("+vt+")(:(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{1,4}|[1-9][0-9]{0,3}))?([\\/\\\\][^?#]*)?([?#].*)?","i"),pt=/^localhost[.。]?$/,d=new RegExp("[.。]("+a+")[.。]?$","i"),wt=/((^[\\]{2}).+)|(^[a-z]:\\.*)/i,f=/^([a-z0-9\-]+):/i,bt=/\s/,g=/\s+/g,kt=/\s+\/(?!\/)/g,dt=/([^\/]|^)\/(?!\/)/,nt,et;n.WebSearchPaths=["/search","/entityexplore"];nt=[33,39,40,41,42,91,93];n.tryParseUrl=u;n.getQueryStringParam=ri;var ui=/file:\/\/\/[^:\/]+:\/[^\/]+\/[^\/]+\/AppData\//i,fi=["ms-appx:","ms-appx-web:","ms-browser-extension:",],ei="microsoft.microsoftedge_8wekyb3d8bbwe";n.isJunkUrl=oi;n.computeUrlMatchLengths=si;n.isUncOrLocalPath=ai;n.startsWithProtocol=tt;n.startsWithWww=vi;n.isHttpProtocol=h;n.isNonHttpProtocol=yi;n.cleanAndFixUrlProtocol=pi;n.cleanAndFixUncOrLocalPath=wi;n.parsedUrlToString=c;var rt=/^ht+ps:\/*(.*)/i,ut=/^ht+p:\/*(.*)/i,ft=/^\/{2,}(.*)/,l=/^www\.(.*)/i,ki=/^(.*[^:\/])\/+$/;n.normalizeUrl=i;n.hasWww=di;n.getProtocol=e;n.prettyPrintUrl=gi;n.isDuplicateUrl=tr;et=["bing","staging-bing-int","working-bing-int","bing-int","bing-exp","binginternal"];n.tryGetBingPathLC=ot;n.isBingHost=st;n.isBingSearchUrl=ir;n.getDomain=rr;n.isEmptyUrlPrefix=ur;n.queryLooksLikeUrl=fr;n.buildBfbSearchUrl=er;n.encodeURIComponentForWindowsProtocol=or}(WSB||(WSB={})),function(n){var t,i;(function(n){function t(t,i,r,u,f,e){var o={T:n.QFPERFPING_EVENT_NAME,ST:r,CVID:u,OFFSETS:i,STATE:f,V:n.QFPERFPING_VERSION,RFC:e};return{ImpressionGuid:t,EventType:n.CLIENTINST_EVENT_TYPE,Data:o}}n.CLIENTINST_EVENT_TYPE="ClientInst";n.QFPERFPING_EVENT_NAME="QFPerfPing";n.CLICK_EVENT_TYPE="Click";n.QFPERFPING_VERSION="2";n.QFPERFPING_INVALID_MEASURE=-2;n.INVALID_SEQUENCE_NUMBER=-2;n.KVALUE_SUGGESTIONS_START=1e3;n.KVALUE_SUFFIX_START=1;n.KVALUE_NON_SUGGESTIONS_START=100;n.DEFAULT_APP_NAMESPACE="SmartSearch";n.DEFAULT_SERVICE_NAME="AutoSuggest";n.createPerfPingEvent=t})(t=n.InstrumentationCommon||(n.InstrumentationCommon={}));i=function(){function n(n,t,i){this._kValue=n;this._qsCode=t;this._handOffType=i;this._properties={}}return n.createInstrumentedItem=function(t,i){return new n(n.generateKValue(t),i)},n.createInstrumentedItemHandOffOverride=function(t,i,r){return new n(n.generateKValue(t),i,r)},n.createInstrumentedItemForReformulation=function(t,i){return new n(n.generateKValue(t),i,998)},n.createInstrumentedItemNoHandOff=function(t,i){return new n(n.generateKValue(t),i,999)},n.getNonSuggestionInstrumentedItem=function(t,i,r){if(!i[t])throw new Error(t+" not found in kvalues map");return new n(i[t],t,r)},n.prototype.getKValue=function(){return this._kValue},n.prototype.getAppNS=function(){return n.AppNS},n.prototype.getLayoutKValue=function(){return this._kValue+"."+n.Suffix},n.prototype.getHValue=function(){return"ID="+n.AppNS+","+this.getLayoutKValue()},n.prototype.getHandoffType=function(){return this._handOffType},n.prototype.getQsCode=function(){return this._qsCode},n.prototype.setProperty=function(n,t){this._properties[n]=t},n.prototype.getProperties=function(){return Object.keys(this._properties).length>0?this._properties:undefined},n.resetKValues=function(n){delete this._keystrokesKValues[n]},n.generateKValue=function(n){var r=n,i=this._keystrokesKValues[r];return i>0||(i=t.KVALUE_SUGGESTIONS_START),this._keystrokesKValues[r]=++i,i},n.AppNS=t.DEFAULT_APP_NAMESPACE,n.Suffix=t.KVALUE_SUFFIX_START,n._keystrokesKValues={},n}();n.InstrumentedItem=i}(WSB||(WSB={}));__spreadArrays=this&&this.__spreadArrays||function(){for(var i=0,n=0,r=arguments.length;n<r;n++)i+=arguments[n].length;for(var u=Array(i),f=0,n=0;n<r;n++)for(var e=arguments[n],t=0,o=e.length;t<o;t++,f++)u[f]=e[t];return u},function(n){function vt(){return matchMedia("screen and (-ms-high-contrast)").matches}function yt(){return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isOffline)?!1:navigator.onLine}function c(n){return n?n.replace(ot,"$1").replace(st,"$1 "):n}function pt(n){return n?n.replace(/[-{}]/g,"").toLowerCase():null}function wt(n){return!n||Object.keys(n).length===0}function bt(n){return n.canFail}function l(n,t,i,r){var u,e;n&&(n=n.slice(0,t)+f+n.slice(t,n.length));u=i(n);u&&(e=u.indexOf(f),t=e!=-1?e:t,u=u.replace(f,""));r(u,t)}function kt(n){if(!n)return SharedLogHelper.LogError("getInputType",null,new Error("event object is missing")),0;switch(n.pointerType){case"mouse":return 2;case"touch":return 3;case"pen":return 4;default:return 1}}function a(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];i.forEach(function(t){return delete n.enabledDataSources[t]})}function v(i,r){if(!i||!r)return!1;var u=!n.config.bingFetchEnabledRegions||n.config.bingFetchEnabledRegions.length==0||t(n.config.bingFetchEnabledRegions,i.toLowerCase()),f=r.split("-")[0],e=!n.config.bingFetchEnabledLang||n.config.bingFetchEnabledLang.length==0||t(n.config.bingFetchEnabledLang,f.toLowerCase());return u&&e}function dt(i,r){if(!i||!r)return!1;var u=!n.config.miniSerpEnabledRegions||n.config.miniSerpEnabledRegions.length==0||t(n.config.miniSerpEnabledRegions,i.toLowerCase()),f=r.split("-")[0],e=!n.config.miniSerpEnabledLang||n.config.miniSerpEnabledLang.length==0||t(n.config.miniSerpEnabledLang,f.toLowerCase());return u&&e}function gt(t,i,r){var u=t.queryToFetch&&t.queryToFetch.length<n.config.minQueryLengthForWebProvider||!v(i,r);return u&&a(t,"Web"),u}function y(t){if(t){t=n.normalizeUrl(t,15);for(var i=1;i<t.length-1;++i)if(ct.includes(t[i]))return!0}return!1}function ni(t,i,r){var u,f;return r||(r=0),l(t,i,function(n){return c(n)},function(n,t){u=n;f=t}),u&&(n.config&&n.config.doNotRemoveSpaceAfterIn&&u.toLocaleLowerCase().endsWith(" in ")||(u=u.trim()),f=Math.min(f,u.length)),{originalQuery:t,originalCursorPosition:i,queryToFetch:u,cursorPosition:f,enabledDataSources:{},equals:function(n){return(u?u.toLowerCase():u)==(n.queryToFetch?n.queryToFetch.toLowerCase():n.queryToFetch)&&r==n.topHitRestriction},isMultiWord:y(u),getCacheKey:function(){return u},topHitRestriction:r}}function p(i,r){return r&&!r.enabledDataSources[i]?!1:t(n.config.enabledDataSources,i)}function w(i,r,u,f){var e=f.enabledDataSources[i];return e?e.suggestionIsEnabled&&!e.suggestionIsEnabled(r,u)?!1:t(n.config.enabledDataSources,i):!1}function t(n,t){return n.indexOf(t)!=-1}function ti(n,t){var i=n.indexOf(t);return i!=-1?(n.splice(i,1),!0):!1}function ii(n,t){var i=n.findIndex(t);return i!=-1?n.splice(i,1)[0]:null}function ri(n,t,i){if(t<100)for(var r=n.length-1;n.length>t&&r>=0;--r)i(n[r])&&n.splice(r,1)}function ui(n,i){return n.filter(function(n){return!t(i,n)})}function fi(n,t){if(n.length!=t.length)return!1;for(var i=0;i<n.length;++i)if(n[i]!=t[i])return!1;return!0}function ei(n,t){if(n===t)return!0;if(!n||!t||Object.keys(n).length!=Object.keys(t).length)return!1;for(var i in n)if(n[i]!=t[i])return!1;return!0}function b(){return n.getCurrentDate().getTime()}function r(n){var t=Math.abs(Math.floor(n));return(t<10?"0":"")+t}function oi(){var t=n.getCurrentDate(),i=-t.getTimezoneOffset(),u=i>=0?"+":"-";return t.getFullYear()+"-"+r(t.getMonth()+1)+"-"+r(t.getDate())+"T"+r(t.getHours())+":"+r(t.getMinutes())+":"+r(t.getSeconds())+"."+r(t.getMilliseconds())+u+r(i/60)+":"+r(i%60)}function si(n,t){return n?n.replace(ht,function(n,i){return t[i]}):n}function hi(n){var t=n?n.number:null,i=n?n.name:null;return t==-2147023673||i=="Canceled"}function u(n,t,i,r,u,f){try{return n()}catch(e){return f||SharedLogHelper.LogError(t,r,e),u&&u(e),i}}function o(n,t,i,r,f,e){return sb_st(function(){return u(n,i,null,r,f,e)},t)}function ci(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];u(function(){return sj_evt.fire.apply(sj_evt,__spreadArrays([n],i))},n)}function li(n,t){o(t,1,n)}function s(n,t){var i=[],r=!0,u=function(){for(var u=[],n=0;n<arguments.length;n++)u[n]=arguments[n];r?i.push(u):t.apply(null,u)};n(u);r=!1;i.forEach(function(n){return t.apply(null,n)})}function ai(n,t,i){e=n&&it()!="ms-appx-web:";k=e&&v(t,i);d=e&&dt(t,i)}function vi(){return e}function yi(){return k}function pi(){return d}function ki(n){return t(wi,n)}function di(n){return t(tt,n)}function gi(n){return t(g,n)}function nr(n){return t(nt,n)}function tr(n){return t(bi,n)}function ir(n,t){return n==121&&t||n==93}function rr(n,t){return n==8||n==46||n==88&&t.ctrlKey}function it(){return _w.location.protocol}function ur(){return _w.location.host}function fr(){return _w.location.pathname}function er(){var n=_d.activeElement;return!n||n.id.endsWith("sb_form_q")?_d.body:n}function rt(t){return t&&+t!=n.WindowsApiDefaultDate&&t.getTime&&!isNaN(t.getTime())&&t.getFullYear()!=1600}function ut(t){if(!rt(t))return null;var i=t.getTime(),r=b();return Math.abs(r-i)/n.DayToMs}function or(n){var t=ut(n);return t!==null&&t>14}function sr(n){return n==="i"?13:n==="v"?14:0}function hr(n){return encodeURIComponent(n).replace(/[!'()*]/g,escape).replace(/%20/g,"+")}var f=String.fromCharCode(57346),ot=new RegExp("^\\s*("+f+")?\\s*"),st=new RegExp("\\s*("+f+")?\\s+","g"),ht=/{([0-9]+)}/g,ct=" -_/\\",lt=-2147215328,at=-2147023673,h,ft,i,et;n.DayToMs=864e5;n.HourToMs=36e5;n.MinuteToMs=6e4;n.DebugSourceName="WindowsSearchBox";SharedLogHelper.RegisterErrorFilter(function(n){var t=n?n.number:null,i=n?n.name:null;return t===at||t===lt||i==="Canceled"});n.isHighContrastEnabled=vt;n.isBrowserOnline=yt;n.cleanQuery=c;n.cleanGuid=pt;n.isEmpty=wt;n.canIconFail=bt;n.mantainCursorPositionIn=l;n.getInputType=kt;n.disableDataSources=a;n.disableWebDataSourceIfNeeded=gt;n.isMultiWord=y;n.baseParseQuery=ni;n.isDataSourceEnabled=p;n.isSuggestionTypeEnabled=w;n.contains=t;n.tryRemove=ti;n.removeFirstWhere=ii;n.trimList=ri;n.except=ui;n.sequenceEqual=fi;n.objEquals=ei;n.log=function(){};n.getCurrentDate=function(){return new Date};n.getCurrentTime=b;n.getDateWithTimezone=oi;n.fetchWrapper=function(n,t,i){return i()};n.formatString=si;n.isCancellation=hi;n.safeExecute=u;n.safeSetTimeout=o;n.safeFireEvent=ci;n.invokeAsynchronously=li;n.ensureCallbackIsAsync=s;var e=!0,k=!0,d=!0;n.refreshBingEnabledCache=ai;n.isBingEnabled=vi;n.isWebProviderEnabled=yi;n.isMiniSerpEnabled=pi;var wi=[3,16,17,18,19,20,144,145,],g=[38,203,211,],nt=[40,204,212,],tt=g.concat(nt),bi=tt.concat(37,39,36,35);n.isFunctionalKey=ki;n.isUpOrDownKey=di;n.isUpKey=gi;n.isDownKey=nr;n.isMovingCursorKey=tr;n.isContextMenuKey=ir;n.isDeletionKey=rr;n.getWindowProtocol=it;n.getWindowHost=ur;n.getWindowPath=fr;n.getCurrentActiveElement=er;n.WindowsApiDefaultDate=-116444736e5;n.isValidDate=rt;n.getTimeDiffInDays=ut;n.olderThan2Weeks=or;n.verticalToHandoffType=sr;h=function(){function n(){this._cancellations={};this._lastId=0}return n.prototype.register=function(n,t,i){var r=++this._lastId;return this._cancellations[r]={action:n,skipOnDismissAndLaunch:t,where:i},r},n.prototype.unregister=function(n){delete this._cancellations[n]},n.prototype.cancelAll=function(n){var t=function(t){var r=i._cancellations[t];r.skipOnDismissAndLaunch&&n||u(function(){return r.action()},r.where)},i=this;for(var r in this._cancellations)t(r);this._cancellations={}},n}();n.CancellationManager=h;ft=function(){function n(){}return n.prototype.getItem=function(n){try{return _w.localStorage?_w.localStorage.getItem(n):undefined}catch(t){return SharedLogHelper.LogError("localStorage",t,new Error("getItem")),undefined}},n.prototype.setItem=function(n,t){try{_w.localStorage&&_w.localStorage.setItem(n,t)}catch(i){SharedLogHelper.LogError("localStorage",i,new Error("setItem"))}},n.prototype.removeItem=function(n){try{return _w.localStorage.removeItem(n)}catch(t){SharedLogHelper.LogError("localStorage",t,new Error("removeItem"))}},n}();n.LightweightStorage=ft;i=function(){function n(){}return n.resetSequenceNumber=function(){this._sequenceNumber=0},n.getSequenceNumber=function(){return this._sequenceNumber},n.incrementSequenceNumber=function(){this._sequenceNumber++},n._sequenceNumber=0,n}();n.SequenceNumberManager=i;et=function(){function t(t,i,r,u,f){var e=this;this._suggestionsParsers=t;this._rootViewModel=i;this._suggestionsRenderingManager=r;this._webProviders=u;this._otherProviders=f;n.config.cancellationEnabled&&(this._cancellationManager=new h);n.Host.bindShown(function(){e._lastQuery=null;e._currentQuery=null;e._isPaneDismissed=!1});n.Host.bindDismissed(function(){e.clearFetchTimer();e.finishPreviousQuery(!0);e.finalizeKeystroke(!0);e._isPaneDismissed=!0;e._rootViewModel.onDismiss()});n.Host.bindQueryChangedOrInitialized(function(t,i){return e.onQueryChanged(t,n.config.d,i)});n.Host.bindOnSubmit(function(n,t,i){return e.onSubmit(n,t,i)});n.Host.initializeEvents();sj_be(_d.body,"dragstart",function(n){return n.preventDefault(),n.stopPropagation(),!1});sj_b.addEventListener("click",function(n){n.shiftKey&&sj_pd(n)})}return t.prototype.clearFetchTimer=function(){this._fetchTimer&&(sb_ct(this._fetchTimer),this._fetchTimer=null)},t.prototype.finishPreviousQuery=function(n){this.cancelPreviousQuery(n);this._suggestionsRenderingManager.resetTimers()},t.prototype.finalizeKeystroke=function(t){var r=i.getSequenceNumber();r>0&&n.InstrumentationHelper.finalizeKeystrokeLog(r);t||i.incrementSequenceNumber()},t.prototype.onQueryChanged=function(n,t,r){var u=this;if(this._currentQuery=n,!r&&this._lastQuery&&this._lastQuery.equals(this._currentQuery))this._rootViewModel.onQueryChanged(this._currentQuery,i.getSequenceNumber());else this.clearFetchTimer(),this._completedDataSources={},(this._lastQuery||r)&&this.cancelPreviousQuery(!1),this.logQueryChange(r,!1),t<=0||this._currentQuery.isSearchHomeZI?this.fetchForQueryChange(r):this._fetchTimer=o(function(){u._fetchTimer=null;u.fetchForQueryChange(r)},t,"fetchTimer"),this._lastQuery=this._currentQuery},t.prototype.logQueryChange=function(t,r){var f=t?this._currentQuery:n.Host.getQuery(),u;f.equals(this._currentQuery)&&((this._lastQuery||t)&&this.finishPreviousQuery(r),this.finalizeKeystroke(!1),u=i.getSequenceNumber(),n.InstrumentationHelper.instrumentQueryChangedRequest(u,this._currentQuery))},t.prototype.onSubmit=function(t,r,u){this._fetchTimer&&(this._currentQuery||(this._currentQuery=n.Host.getQuery()),this.logQueryChange(!1,!0),this.fetchForQueryChange(!1));this._rootViewModel.submit(t,r,i.getSequenceNumber(),u,this._isPaneDismissed)},t.prototype.cancelPreviousQuery=function(n){this._cancellationManager&&this._cancellationManager.cancelAll(n)},t.prototype.fetchForQueryChange=function(t){var r=this,f,u,o,h;if(this.clearFetchTimer(),f=t?this._currentQuery:n.Host.getQuery(),f.equals(this._currentQuery)){if(u=i.getSequenceNumber(),o=!n.config.enabledDataSources.some(function(n){return p(n,r._currentQuery)}),o)this._rootViewModel.onQueryChanged(this._currentQuery,u);if(h=!1,this._suggestionsRenderingManager.initiateSequenceNumber(u,this._currentQuery,function(){return h=!0}),!o){var e=function(){return!r._isPaneDismissed&&(n.config.d>0?f.equals(r._currentQuery):u==i.getSequenceNumber())&&!h},c=(new Date).getTime(),l=function(n,t,i,o,s,h){return r.onResponseReceived(f,u,n,t,i,e,o,s,c,h)},a=function(t){n.InstrumentationHelper.instrumentFetchesBegin(u);n.config.enabledDataSources.forEach(function(t){n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark(t+".Fetch")});n.fetchWrapper(f,e,function(){r._webProviders.forEach(function(n){r.fetchWeb(f,n,u,t,e)});r._otherProviders.forEach(function(n){r.fetch(f,n,u,t,e)})});n.InstrumentationHelper.instrumentFetchesEnd(u);r._rootViewModel.onQueryChanged(r._currentQuery,u)};s(a,l)}}},t.prototype.fetchWeb=function(t,i,r,f,e){var c=this,s=n.Service.QueryParams,o=n.Host.getCustomUrlParameters(t),h;n.Host.shouldRequestEltoken()&&(o[s.RequestElToken]="1");o[s.CursorPosition]=t.cursorPosition.toString();o[s.ConversationId]=n.Host.getConversationId();o[s.ImpressionGuid]=n.InstrumentationHelper.getImpressionGuid(r);h=n.Host.getCustomHeaders(t);u(function(){return i.fetch(t,f,r,c._cancellationManager,e,o,h)},"fetch "+i.getName())},t.prototype.fetch=function(n,t,i,r,f){var e=this;u(function(){return t.fetch(n,r,i,e._cancellationManager,f)},"fetch "+t.getName())},t.prototype.onResponseReceived=function(t,i,r,u,f,e,o,h,c,l){var a=this,v,y;if(e()){if(this._completedDataSources[r]){SharedLogHelper.LogError("onResponseReceived",r,new Error("Data source already completed"));return}n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark(r+".Fetch");this._completedDataSources[r]=!l;n.InstrumentationHelper.instrumentResponseReceived(i,r,f,o,h,l);v=function(r,u,o){if(n.InstrumentationHelper.instrumentDataSourceParsed(i,r),e())a.onSuggestionsParsed(t,i,r,f,u,o,l)};y=function(n){var f=a._suggestionsParsers[r];f?f.parse(t,i,r,u,e,n,a._cancellationManager):(SharedLogHelper.LogError("onResponseReceived",r,new Error("No parser for data source")),n(r,[],null))};s(y,v)}},t.prototype.onSuggestionsParsed=function(t,i,r,u,f,e,o){f=f.filter(function(n){return w(r,n.type,n.handoffType,t)});n.InstrumentationHelper.instrumentDataSource(i,r,f,e);this._rootViewModel.onSuggestionsParsed(t,i,r,u,f,e);this._suggestionsRenderingManager.queueSuggestions(i,r,f,e,o)},t}();n.Core=et;n.encodeQueryParameter=hr}(WSB||(WSB={})),function(n){function wt(t){return n.contains(at,t)}function bt(t){return n.contains(vt,t)}function kt(t){return n.contains(d,t)}function dt(t){return n.contains(yt,t)}function gt(t){return n.contains(pt,t)}function e(t){return{dataSource:"ODC",requirements:[1,2],conditionalRequirements:function(){var t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return n.isCloudSearchEnabledCache&&(t==2||t==4)},suggestionIsEnabled:t?function(n){return n==t}:undefined}}function g(){return n.isDataSourceEnabled("SSUE",null)}function nt(t){var r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType(),i=!n.config.userProfileButtonEnabled||r==t;switch(t){case 2:return i&&n.isSubstrateOutlookAccountConnected;case 1:return i&&n.isSubstrateO365AccountConnected;case 4:return i&&n.isSubstrateO365AccountConnected&&n.isSubstrateOutlookAccountConnected;default:return!1}}function ni(t){var i=SearchAppWrapper.CortanaApp.authenticationManager.getAllSearchWebAccountsAsync,r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return i?!0:r==t}function ti(){return{dataSource:"ANA",groupType:t.AnaheimData,requirements:[1],conditionalRequirements:function(){return n.config.enableAnaheimData},suggestionIsEnabled:function(n){return n=="ANAH"}}}function r(n,t,i,r){return o(n,undefined,t,i,r)}function o(t,i,r,u,f){return{dataSource:t,groupType:i,requirements:[1],conditionalRequirements:function(t){return n.isCloudSearchEnabledCache&&(!f||f())&&(u||t&&t.queryToFetch&&t.queryToFetch.length>=n.config.minLengthFor3SonL1)&&ni(r)&&nt(r)}}}function a(t){return{dataSource:"MSBC",requirements:[1,2],conditionalRequirements:function(i){var r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return n.isCloudSearchEnabledCache&&(t||i&&i.queryToFetch&&i.queryToFetch.length>=n.config.msbClientQfMinQueryLength)&&(r==1||r==4)&&typeof n.isTenantMsbEnabled=="function"&&n.isTenantMsbEnabled()}}}function v(t){return{dataSource:"MSBS",requirements:[1,2],conditionalRequirements:function(i){var r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return n.isCloudSearchEnabledCache&&(t||i&&i.queryToFetch&&i.queryToFetch.length>=n.config.msbServerQfMinQueryLength)&&(r==1||r==4)&&typeof n.isTenantMsbEnabled=="function"&&n.isTenantMsbEnabled()}}}function s(){var t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return!n.isCloudSearchEnabledCache||t==3||t==0||!g()?!1:!nt(t)}function tt(){var t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return t==2||t==4}function it(t){return t.isSearchHomeZI&&(n.isDataSourceEnabled("SSUE",t)||n.isDataSourceEnabled("SREE",t))}function ii(t,i){return i.siteTitle&&(t.isSearchHomeZI||n.config.nicerCloudFiles&&n.isMsftAccountConnected)}function ri(){n.ScopeConfig[i.All].getEmptyZIMessages=function(){return u(i.All,n.config.useNewEmptyQueryMessages?"EmptyAllMessage":"EmptyScopeMessage",n.isBingEnabled()?"EmptyAllSubMessage":"EmptyAllSubMessageNoWeb",ut(!0))};n.RuntimeConfig.QfMode==6?(n.ScopeConfig[i.All].icon={type:1,content:"&#xE721"},n.ScopeConfig[i.All].getEmptyZIMessages=function(){return u(i.Web,"EmptyLockscreenMessage","EmptyLockscreenSubMessage")}):n.RuntimeConfig.QfMode==8?(n.ScopeConfig[i.All_Santorini].icon=n.getSearchSuggestionIcon(),n.ScopeConfig[i.All_Santorini].enabledDataSourcesForZeroInput=[{dataSource:"QSCH",groupType:t.QuickSearch,suggestionGroupToggler:l(t.QuickSearch)},{dataSource:"MPP"},{dataSource:"MST"},{dataSource:"MFF"},{dataSource:"MRS"},{dataSource:"MRU"},],n.ScopeConfig[i.All_Santorini].staticGroupOrderForZeroInput=function(){return[t.SearchSuggestions,t.Settings,t.Documents,t.Apps,t.QuickSearch,t.VisualSearch]}):n.RuntimeConfig.SearchHomeAvailable==1?(n.ScopeConfig[i.All].icon=n.getSearchSuggestionIcon(),n.ScopeConfig[i.All].enabledDataSourcesForZeroInput=[{dataSource:"TOPP",groupType:t.TopApps,suggestionGroupToggler:l(t.TopApps),conditionalRequirements:function(){return!(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isWWEVisibleSinglePane())&&!(n.enableProngWeather(n.getCurrentLanguage())&&!n.config.prong1TopApps)}},{dataSource:"MSNW",groupType:n.config.prong1&&n.isConsumerWindowsSKU()&&n.RuntimeConfig.AlwaysWide&&n.config.weatherTileMarkets[n.getCurrentLanguage()]?t.MSNWeather:t.TopApps,suggestionGroupToggler:l(t.MSNWeather),conditionalRequirements:function(){return(n.config.prong1?n.enableProngWeather(n.getCurrentLanguage())&&n.isConsumerWindowsSKU():n.shouldEnableWeatherTile(n.getCurrentLanguage()))&&n.isWeatherTileVisible(f)&&!(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isWWEVisibleSinglePane())}},{dataSource:"WWE",groupType:t.WelcomeExperience,conditionalRequirements:function(){if(n.cohortProfileManager!==null&&n.cohortProfileManager!==void 0)return n.cohortProfileManager.isWWEVisible()}},{dataSource:"QSCH",groupType:t.QuickSearch,suggestionGroupToggler:l(t.QuickSearch),conditionalRequirements:function(){return n.canShowQuickSearch(f)}},{dataSource:"MSNN",groupType:t.MSNNews,suggestionGroupToggler:l(t.MSNNews),conditionalRequirements:function(){return n.config.msnNewsSearch&&n.shouldEnableMSNNewsSearches(n.getCurrentLanguage())&&n.canShowMSNNewsTab(f)}},{dataSource:"BIMG",groupType:t.BingDailyImage,conditionalRequirements:function(){return n.canShowBingDailyImage(f)}},{dataSource:"MRU",groupType:t.MRUHistory,conditionalRequirements:function(){return n.enableMRUSearchHome()}},{dataSource:"MPP",groupType:t.MRUHistory,conditionalRequirements:function(){return n.enableMRUSearchHome()}},{dataSource:"MST",groupType:t.MRUHistory,conditionalRequirements:function(){return n.enableMRUSearchHome()}},{dataSource:"MFF",suggestionIsEnabled:function(){return!0},groupType:t.MRUHistory,conditionalRequirements:function(){return n.enableMRUSearchHome()}},o("SSUE",t.RecommendedDocs,1,!0,function(){return n.config.enableSsueOnZeroInput&&n.isMsftAccountConnected}),o("SREE",t.RecommendedDocs,1,!0,function(){return n.isMsftAccountConnected}),o("SMP",t.MeetingPrep,1,!0,function(){return n.isMsftAccountConnected})],n.ScopeConfig[i.All].staticGroupOrderForZeroInput=function(){return[t.TopApps,t.MSNWeather,t.MRUHistory,t.WelcomeExperience,t.BingDailyImage,t.MSNNews,t.RecommendedDocs,t.QuickSearch,t.MeetingPrep,t.Upsell,t.PromoBanner,t.VisualSearch,]},n.config.enableEdgeUpsellSHTop&&(n.ScopeConfig[i.All].staticGroupOrderForZeroInput=function(){return[t.Upsell,t.PromoBanner,t.TopApps,t.MSNWeather,t.MRUHistory,t.WelcomeExperience,t.BingDailyImage,t.MSNNews,t.RecommendedDocs,t.QuickSearch,t.MeetingPrep,t.VisualSearch,]}),n.config.prong1&&n.RuntimeConfig.AlwaysWide&&n.config.weatherTileMarkets[n.getCurrentLanguage()]&&(n.ScopeConfig[i.All].staticGroupOrderForZeroInput=function(){return[t.MSNWeather,t.MSNNews,t.WelcomeExperience,t.TopApps,t.MRUHistory,t.BingDailyImage,t.RecommendedDocs,t.QuickSearch,t.MeetingPrep,t.Upsell,t.PromoBanner,t.VisualSearch,]}),n.config.prong1Right&&n.RuntimeConfig.AlwaysWide&&n.config.weatherTileMarkets[n.getCurrentLanguage()]&&(n.ScopeConfig[i.All].staticGroupOrderForZeroInput=function(){return[t.TopApps,t.MRUHistory,t.MSNWeather,t.MSNNews,t.WelcomeExperience,t.BingDailyImage,t.RecommendedDocs,t.QuickSearch,t.MeetingPrep,t.Upsell,t.PromoBanner,t.VisualSearch,]})):n.ScopeConfig[i.All].enabledDataSourcesForZeroInput=[]}function rt(){n.ScopeConfig={};n.ScopeConfig[i.All_FileExplorer]={icon:null,prefixesLocString:null,enabledDataSources:[{dataSource:"FEH"},{dataSource:"IFF"},{dataSource:"MDOC",conditionalRequirements:function(){return n.config.useL2ProvidersInFileExplorer}},{dataSource:"MPHO",conditionalRequirements:function(){return n.config.useL2ProvidersInFileExplorer}},{dataSource:"MVID",conditionalRequirements:function(){return n.config.useL2ProvidersInFileExplorer}},{dataSource:"ODC",requirements:[1,2],conditionalRequirements:function(){return n.config.cloudSearchInFileExplorer&&(n.isFileExplorerCurrentPathThisPcOrQuickAccess||!!SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootAccount)}},{dataSource:"SSUE",requirements:[1,2],conditionalRequirements:function(){return n.config.cloudSearchInFileExplorer&&(n.isFileExplorerCurrentPathThisPcOrQuickAccess||!!SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootAccount)}},{dataSource:"SSEE",requirements:[1,2],conditionalRequirements:function(){return n.config.cloudSearchInFileExplorer&&(n.isFileExplorerCurrentPathThisPcOrQuickAccess||!!SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootAccount)}},],enabledDataSourcesForZeroInput:[{dataSource:"FEH"},],getEmptyZIMessages:null};n.ScopeConfig[i.All_Lockscreen]={icon:null,prefixesLocString:null,enabledDataSources:[{dataSource:"Web",requirements:[1,2]},],enabledDataSourcesForZeroInput:[{dataSource:"LSQS"}],webSyntheticEnabled:function(t){return t.queryToFetch&&n.isBingEnabled()},getEmptyZIMessages:null};n.ScopeConfig[i.All_SettingsApp]={icon:null,prefixesLocString:null,enabledDataSources:[{dataSource:"ST"},{dataSource:"MST"},],enabledDataSourcesForZeroInput:[],getEmptyZIMessages:null};n.ScopeConfig[i.All_ControlPanel]={icon:{content:"&#xE713",type:2},prefixesLocString:"ScopeSettings",enabledDataSources:[{dataSource:"Web",suggestionIsEnabled:function(){return!1},requirements:[1,2]},{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MST"},{dataSource:"ST"},{dataSource:"QS",requirements:[1,2]}],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MST"},],getEmptyZIMessages:null};n.ScopeConfig[i.All_Santorini]={icon:{content:"&#xE782",type:2,needsAccentColor:!0},prefixesLocString:"ScopeAll",enabledDataSources:[{dataSource:"PP"},{dataSource:"ST"},{dataSource:"FL"},{dataSource:"IFF"},{dataSource:"MRU"},{dataSource:"MPP"},{dataSource:"MST"},{dataSource:"MFF"},{dataSource:"Web",requirements:[1,2]},{dataSource:"OSTMA",requirements:[1,2]},{dataSource:"QS",requirements:[1,2]},e(),r("SSUE",1,!1),],enabledDataSourcesForZeroInput:[],webSyntheticEnabled:function(t){return t.queryToFetch&&n.isBingEnabled()},getEmptyZIMessages:null,showUpsellOnSuggestionsList:n.config.accountVerificationInAllScope?function(){return s()}:undefined};n.ScopeConfig[i.All]={icon:{content:"&#xE782",type:2,needsAccentColor:!0},prefixesLocString:"ScopeAll",enabledDataSources:[{dataSource:"PP"},{dataSource:"ST"},{dataSource:"FL"},{dataSource:"LM"},{dataSource:"IFF"},{dataSource:"LDIC"},{dataSource:"CG"},{dataSource:"MRU"},{dataSource:"MPP"},{dataSource:"MST"},{dataSource:"MFF"},{dataSource:"MRS",requirements:[1,2]},{dataSource:"Web",requirements:[1,2]},{dataSource:"OSTMA",requirements:[1,2]},{dataSource:"QS",requirements:[1,2]},ti(),r("SSUE",1,!1),a(!1),v(!1)],enabledDataSourcesForZeroInput:[],webSyntheticEnabled:function(t){return t.queryToFetch&&n.isBingEnabled()},getEmptyZIMessages:null,showUpsellOnSuggestionsList:n.config.accountVerificationInAllScope||n.config.msbAccountVerificationInSearchHome?function(){return s()}:undefined};n.ScopeConfig[i.Apps]={icon:{content:"&#xEB3B",type:2},prefixesLocString:"ScopeApps",enabledDataSources:[{dataSource:"Web",suggestionIsEnabled:function(){return!1},requirements:[1,2]},{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MPP"},{dataSource:"PP",suggestionIsEnabled:function(n){return n=="PP"}},{dataSource:"OSTMA",requirements:[1,2]},{dataSource:"IBA"},],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"TOPP",conditionalRequirements:function(n){return n.isSearchHomeZI}},{dataSource:"MPP"},n.contains(n.config.enabledDataSources,"LRA")?{dataSource:"LRA"}:{dataSource:"PP",suggestionIsEnabled:function(n){return n=="PP"}}],staticGroupOrderForZeroInput:function(n){return n.isSearchHomeZI?[t.TopApps,t.Apps]:undefined},getEmptyZIMessages:function(){return u(i.Apps,n.config.useNewEmptyQueryMessages?"EmptyScopeMessageNew":"EmptyScopeMessage","EmptyScopeSubMessage","EmptyScopeSearchLocation_PC")}};n.ScopeConfig[i.Settings]={icon:{content:"&#xE713",type:2},prefixesLocString:"ScopeSettings",enabledDataSources:[{dataSource:"Web",suggestionIsEnabled:function(){return!1},requirements:[1,2]},{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MST"},{dataSource:"ST"},{dataSource:"QS",requirements:[1,2]}],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MST"},],getEmptyZIMessages:function(){return u(i.Settings,n.config.useNewEmptyQueryMessages?"EmptyScopeMessageNew":"EmptyScopeMessage","EmptySettingsSubMessage")}};n.ScopeConfig[i.Photos]={icon:{content:"&#xEB9F",type:2},prefixesLocString:"ScopePhotos",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="LI"}},{dataSource:"MPHO",suggestionIsEnabled:function(n){return n=="LI"}},e("LI"),],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="LI"}},],getEmptyZIMessages:function(){return c(i.Photos,!0)}};n.ScopeConfig[i.Videos]={icon:{content:"&#xE714",type:1},prefixesLocString:"ScopeVideos",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="LV"}},{dataSource:"MVID",suggestionIsEnabled:function(n){return n=="LV"}},e("LV"),],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="LV"}},],getEmptyZIMessages:function(){return c(i.Videos,!0)}};n.ScopeConfig[i.Music]={icon:{content:"&#xE8D6",type:2},prefixesLocString:"ScopeMusic",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="MU"}},{dataSource:"MMUS",suggestionIsEnabled:function(n){return n=="MU"}},e("MU"),],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="MU"}},],getEmptyZIMessages:function(){return c(i.Music,!1)}};n.ScopeConfig[i.Documents]={icon:{content:"&#xE7C3",type:2},prefixesLocString:"ScopeDocuments",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="FL"}},{dataSource:"MDOC",suggestionIsEnabled:function(n){return n=="FL"}},{dataSource:"MPHO",suggestionIsEnabled:function(n){return n=="FL"},conditionalRequirements:function(n){return!n||!n.taskFrame}},{dataSource:"MVID",suggestionIsEnabled:function(n){return n=="FL"},conditionalRequirements:function(n){return!n||!n.taskFrame}},{dataSource:"MPVD",suggestionIsEnabled:function(n){return n=="FL"},conditionalRequirements:function(t){return n.config.mergeQueries&&(!t||!t.taskFrame)}},e("FL"),{dataSource:"PP",suggestionIsEnabled:function(n){return n=="LDOC"}},r("SSUE",1,!0),r("SSEE",1,!0),],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="FL"}},o("SSUE",t.RecommendedDocs,1,!0,function(){return n.config.enableSsueOnZeroInput&&n.config.cloudDocsOnZiL2&&n.isMsftAccountConnected}),o("SREE",t.RecommendedDocs,1,!0,function(){return n.config.cloudDocsOnZiL2&&n.isMsftAccountConnected}),],showUpsellOnSuggestionsList:function(){return s()},getEmptyZIMessages:function(){return c(i.Documents,!1)}};n.ScopeConfig[i.Folders]={icon:{content:"&#xE838",type:2},prefixesLocString:"ScopeFolders",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="FD"}},{dataSource:"MFOL",suggestionIsEnabled:function(n){return n=="FD"}},{dataSource:"LDIC"},e("FD"),],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(){return!1}},{dataSource:"MFF",suggestionIsEnabled:function(n){return n=="FD"}},],getEmptyZIMessages:function(){return c(i.Folders,!1)}};n.ScopeConfig[i.Web]={icon:{content:"&#xE774",type:1},prefixesLocString:"ScopeWeb",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:function(n,t){return t==1}},{dataSource:"Web",suggestionIsEnabled:function(t,i){return n.contains([0,13,14,10,5,1],i)},requirements:[1,2]},{dataSource:"PP",suggestionIsEnabled:function(n,t){return t==1}},a(!0),v(!0)],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:function(n,t){return t==1}},{dataSource:"Web",requirements:[1,2],conditionalRequirements:function(){return tt()}},],webSyntheticEnabled:function(t){return t.queryToFetch&&n.isBingEnabled()},getEmptyZIMessages:function(){return u(i.Web,n.config.useNewEmptyQueryMessages?"EmptyWebMessage":"EmptyScopeMessageWeb","EmptyWebSubMessage")}};n.ScopeConfig[i.PathCompletion]={icon:{content:"&#xE782",type:2,needsAccentColor:!0},scopeNameLocString:n.config.pathCompletionReplacesAll?"PathCompletionScopeName":null,prefixesLocString:null,enabledDataSources:[{dataSource:"PT"},{dataSource:"CG"},],enabledDataSourcesForZeroInput:[],getEmptyZIMessages:null};n.ScopeConfig[i.Emails]={icon:{content:"&#xE715",type:2},prefixesLocString:"ScopeEmails",enabledDataSources:[r("SSEE",1,!0),r("SSEC",2,!0),],enabledDataSourcesForZeroInput:[],showUpsellOnSuggestionsList:function(){return s()},getEmptyZIMessages:function(){return u(i.Emails,n.config.useNewEmptyQueryMessages?"EmptyScopeMessageNew":"EmptyScopeMessage","EmptyEmailSubMessage")}};n.ScopeConfig[i.People]={icon:{content:"&#xE716",type:2},prefixesLocString:"ScopePeople",enabledDataSources:[r("SSUE",1,!0,function(){return!(typeof n.isTenantMsbEnabled=="function"&&n.isTenantMsbEnabled())}),r("SSUC",2,!0),a(!0),v(!0)],enabledDataSourcesForZeroInput:[r("SSUE",1,!0,function(){return!(typeof n.isTenantMsbEnabled=="function"&&n.isTenantMsbEnabled())}),r("SSUC",2,!0),],showUpsellOnSuggestionsList:function(){return s()},getEmptyZIMessages:function(){return u(i.People,n.config.useNewEmptyQueryMessages?"EmptyScopeMessageNew":"EmptyScopeMessage","EmptyPeopleSubMessage")}};for(var f in n.ScopeConfig)n.ScopeConfig[f].enabledDataSources=n.ScopeConfig[f].enabledDataSources.filter(function(t){return n.contains(n.config.enabledDataSources,t.dataSource)}),n.ScopeConfig[f].enabledDataSourcesForZeroInput=n.ScopeConfig[f].enabledDataSourcesForZeroInput.filter(function(t){return n.contains(n.config.enabledDataSources,t.dataSource)})}function ui(){h=null}function ut(t){var u=n.Host.getConnectedAccountInfo(0),f=n.Host.getConnectedAccountInfo(1),i=!!(u||f),r=t&&n.isBingEnabled();return i&&r?"EmptyScopeSearchLocation_PCCloudAndWeb":i?"EmptyScopeSearchLocation_PCAndCloud":r?"EmptyScopeSearchLocation_PCAndWeb":"EmptyScopeSearchLocation_PC"}function c(t,i){return u(t,n.config.useNewEmptyQueryMessages?"EmptyScopeMessageNew":"EmptyScopeMessage","EmptyScopeSubMessage",ut(i))}function u(t,i,r,u){var f=ft(n.ScopeConfig[t]).toLocaleLowerCase(),e=u?n.Host.getLocString(u):"",o=n.Host.getLocString(i,f,e),s=n.config.useNewEmptyQueryMessages||n.RuntimeConfig.QfMode==6?n.Host.getLocString(r,f,e):"";return[o,s]}function fi(){var u=function(n){return HitHighlightingParser.removeDiacritics(n.toLocaleLowerCase().trim())},t,r;if(h={},n.RuntimeConfig.ScopesAvailable){t=function(t){var f=parseInt(t),r=n.ScopeConfig[f],e,o;f!=i.All&&y(f,r)&&(!r.prefixes&&r.prefixesLocString&&(e=n.Host.getLocString(r.prefixesLocString),o=n.Host.getEnUsLocString(r.prefixesLocString),r.prefixes=et(e,o)),r.prefixes&&r.prefixes.forEach(function(n){return h[u(n)]=f}))};for(r in n.ScopeConfig)t(r)}}function ft(t){if(t.scopeNameLocString)return n.Host.getLocString(t.scopeNameLocString);if(t.prefixes)return t.prefixes[0].trim();if(t.prefixesLocString){var i=et(n.Host.getLocString(t.prefixesLocString));return i[0].trim()}return""}function et(n,t){var i=n;return t&&(i+=","+t),i.search(k)>-1&&(i=i.replace(k,",")),i.split(",")}function y(t,r){var u,o,f,e,s;if(!n.contains(n.config.enabledScopes,i[t])||t==i.Web&&!n.isBingEnabled())return!1;if(r.showUpsellOnSuggestionsList&&r.showUpsellOnSuggestionsList())return!0;for(u=n.config.enabledDataSources.filter(function(n){return n!="MRU"}),n.isBingEnabled()&&t!=i.Web&&(u=u.filter(function(n){return n!="Web"})),o=function(n){ht(n,null)||(u=u.filter(function(t){return t!=n.dataSource}))},f=0,e=r.enabledDataSources;f<e.length;f++)s=e[f],o(s);return r.enabledDataSources.some(function(t){return n.contains(u,t.dataSource)})?!0:!1}function ot(t){switch(n.RuntimeConfig.QfMode){case 5:return n.ScopeConfig[i.All_FileExplorer];case 6:return n.ScopeConfig[i.All_Lockscreen];case 7:return n.ScopeConfig[i.All_SettingsApp];case 9:return n.ScopeConfig[i.All_ControlPanel];case 8:return n.ScopeConfig[i.All_Santorini];default:return n.ScopeConfig[w(t)]}}function ei(t,r,u,f,e){var h,c,p,l,a,v,s,y;e||(e={});var b=e.topHitRestriction,k=e.forceGroupOnTop,d=e.fromSearchHome,g=e.fromSuggestionType,nt=e.inorganic,tt=e.serpURLParams,o=n.baseParseQuery(t,r,b);if(o.fullPartialQuery=o.queryToFetch,o.scope=SearchAppWrapper.CortanaApp.hostingEnvironment==5||n.config.forceSantoriniExperience?i.All_Santorini:i.All,o.forceGroupOnTop=k,o.fromSuggestionType=g,o.fromSearchHome=d,o.inorganic=nt,o.serpURLParams=tt,hi(o,f))o.taskFrame=f,o.isFormulatedQuery=!0,h=n.ScopeConfig[w(o)];else{for(o.fullPartialQuery&&(oi(o),u&&o.scope!=u.scope&&(o.isFormulatedQuery=!0)),o.isSearchHomeZI=!o.queryToFetch&&(n.RuntimeConfig.SearchHomeAvailable==1||n.RuntimeConfig.SearchHomeAvailable==2&&o.scope!=i.All),(o.scope==i.All||o.scope==i.Web)&&(c=n.tryParseUrl(o.queryToFetch,!0),c&&c.type==0?(o.isProtocol=!0,o.fixedUrl=n.cleanAndFixUrlProtocol(c)):st.test(o.queryToFetch)&&(o.isProtocol=!0,o.fixedUrl=n.cleanAndFixUrlProtocol(o.queryToFetch))),h=ot(o),p=o.queryToFetch?h.enabledDataSources:h.enabledDataSourcesForZeroInput,o.availableDataSources={},l=0,a=p;l<a.length;l++)s=a[l],n.contains(n.config.enabledDataSources,s.dataSource)&&(o.availableDataSources[s.dataSource]=s);o.enabledDataSources={};for(v in o.availableDataSources)s=o.availableDataSources[v],s.suggestionGroupToggler&&s.suggestionGroupToggler.isHidden()||(o.enabledDataSources[v]=s);y=o.queryToFetch?h.staticGroupOrder:h.staticGroupOrderForZeroInput;y&&(o.staticGroupOrder=y(o))}return si(o,h),o.showProgressBar=n.isL2(o)&&n.config.dataSourcesWithProgressBar.some(function(n){return!!o.enabledDataSources[n]}),o.equals=function(n){return(o.queryToFetch?o.queryToFetch.toLowerCase():o.queryToFetch)==(n.queryToFetch?n.queryToFetch.toLowerCase():n.queryToFetch)&&n.scope==o.scope&&(n.taskFrame?n.taskFrame.raw:"")==(o.taskFrame?o.taskFrame.raw:"")&&n.topHitRestriction==o.topHitRestriction},o.getCacheKey=function(){return o.cursorPosition+o.queryToFetch.toLocaleLowerCase()+o.scope+n.regionCache},o}function oi(t){var f,s,e,r,o;if(n.RuntimeConfig.ScopesAvailable){if(f=n.isDataSourceEnabled("PT",null),s=f&&p.test(t.fullPartialQuery),s){t.canBePathCompletion=!0;t.scope=i.PathCompletion;return}if(e=HitHighlightingParser.removeDiacritics(t.originalQuery),r=e.match(/^(([^:：]+)[:：]\s*)(.*)/)||n.config.forwardSlashScopes&&e.match(/(\/(\w+)\s*)(.*)/),r){var c=r[1],u=r[2],l=r[3];(u=u.toLocaleLowerCase(),o=u.trim(),n.contains(Object.keys(h),o))&&(t.queryToFetch=l,t.cursorPosition=Math.max(0,t.originalCursorPosition-c.length),n.mantainCursorPositionIn(t.queryToFetch,t.cursorPosition,n.cleanQuery,function(n,i){t.queryToFetch=n;t.cursorPosition=i}),t.scope=h[o],t.scopePrefix=u,t.isMultiWord=n.isMultiWord(t.queryToFetch),t.canBePathCompletion=f&&p.test(t.queryToFetch))}}}function ht(t,i){for(var f,r=0,u=t.requirements||[];r<u.length;r++){f=u[r];switch(f){case 1:if(n.config.disableOfflineRequest&&!n.isBrowserOnline())return!1;break;case 2:if(!n.isBingEnabled())return!1}}return t.conditionalRequirements&&!t.conditionalRequirements(i)?!1:!0}function si(t,r){var h=n.RuntimeConfig.QfMode==5&&t.fullPartialQuery.search(":")>=0,s,u,f,e,o;if(h){t.enabledDataSources={};return}for(n.disableWebDataSourceIfNeeded(t,n.Host.getRegion(),n.Host.getLanguage()),s=t.queryToFetch?r.enabledDataSources:r.enabledDataSourcesForZeroInput,u=0,f=s;u<f.length;u++)e=f[u],ht(e,t)||n.disableDataSources(t,e.dataSource);t.queryToFetch||(o=SearchAppWrapper.CortanaApp.queryFormulationView.searchHistory,o&&o.isDeviceHistoryEnabled||n.disableDataSources(t,"PP","LRA","FL","LM","IFF"));n.TweakSearch&&n.TweakSearch.disableDataSourcesBasedOnTweakSearch(t);n.config.searchServiceDisabled&&n.disableDataSources(t,"IFF","IBA");it(t)&&(n.config.cloudDocsOnTheLeft&&t.scope==i.All?n.disableDataSources(t,"MRU","MPP","MST","MFF"):n.disableDataSources(t,"QSCH"))}function hi(t,i){var r,s,e,u,o,f;if(i&&(r=i.scope,s=n.ScopeConfig[i.scope],y(r,n.ScopeConfig[r])&&(e=n.ScopeConfig[r].enabledDataSources.filter(function(n){return vi(n.dataSource,i)}),e.length>0))){for(u=0,o=e;u<o.length;u++)f=o[u],n.contains(n.config.enabledDataSources,f.dataSource)&&(t.enabledDataSources[f.dataSource]=f);return s}return null}function ci(t){var r=n.safeExecute(function(){return JSON.parse(t)},"parseTaskFrame"),u;return r&&(u=li(r),u!=i.All)?{raw:t,parsed:r,scope:u}:null}function li(n){switch(n.Uri){case ct:var r=n,t=r.FileType;if(t&&t.Value){if(t.Value=="Picture")return i.Photos;if(t.Value=="Video")return i.Videos}return i.Documents;case lt:return i.Emails}return i.All}function w(n){return n?n.taskFrame?n.taskFrame.scope:n.scope:undefined}function ai(n){var e,t,o,s,h,u,c,r,f,l;if(n.taskFrame&&(e=n.taskFrame.parsed,e))if(n.taskFrame.scope==i.Emails){if(t=e,o=t.Subject,o&&o.Value)return o.Value;if(r=t.Body,r&&r.Value)return r.Value;if(s=t.From&&t.From.length>0?t.From[0]:null,s&&s.Value)return s.Value;if(h=t.To&&t.To.length>0?t.To[0]:null,h&&h.Value)return h.Value}else{if(u=e,c=u.Title,c&&c.Value)return c.Value;if(r=u.Body,r&&r.Value)return r.Value;if(f=u.People,f&&f[0]&&f[0].Value)return f[0].Value;if(l=u.Place,l&&l.Value)return l.Value}return n.queryToFetch}function vi(n,t){if(t.scope==i.Emails)return n=="SSEC"||n=="SSEE";var u=t.parsed,r=u.FileSource?u.FileSource.Value:null;switch(n){case"MPVD":case"MDOC":case"MPHO":case"MVID":return r!="onedrive"&&r!="sharepoint";case"SSEE":return r!="thispc"&&r!="onedrive";default:return!1}}function yi(n){f=n}function l(t){var i=""+t,r=function(){var n=f.getItem(b)||"";return n.split(",")},u=function(n){var t=n.join(",");f.setItem(b,t)};return{isHidden:n.config.enableSearchHomeCustomization?function(){return n.safeExecute(function(){return r().some(function(n){return n==i})},"GroupToggler.isHidden")}:function(){return!1},toggle:function(t){n.safeExecute(function(){var n=r(),f;t&&n.every(function(n){return n!=i})?(n.push(i),u(n)):t||(f=n.findIndex(function(n){return n==i}),f>-1&&(n.splice(f,1),u(n)))},"GroupToggler.toggle")}}}var i,t,h,st,p,ct,lt,f,b;(function(n){n[n.All=0]="All";n[n.Apps=1]="Apps";n[n.Settings=2]="Settings";n[n.Photos=3]="Photos";n[n.Videos=4]="Videos";n[n.Music=5]="Music";n[n.Documents=6]="Documents";n[n.Folders=7]="Folders";n[n.Web=8]="Web";n[n.PathCompletion=9]="PathCompletion";n[n.Emails=10]="Emails";n[n.People=11]="People";n[n.All_FileExplorer=1e3]="All_FileExplorer";n[n.All_Lockscreen=1001]="All_Lockscreen";n[n.All_SettingsApp=1002]="All_SettingsApp";n[n.All_ControlPanel=1003]="All_ControlPanel";n[n.All_Santorini=1004]="All_Santorini"})(i=n.Scope||(n.Scope={})),function(n){n[n.Apps=0]="Apps";n[n.Settings=1]="Settings";n[n.Cortana=2]="Cortana";n[n.Command=3]="Command";n[n.Photos=4]="Photos";n[n.Videos=5]="Videos";n[n.Music=6]="Music";n[n.Documents=7]="Documents";n[n.Folders=8]="Folders";n[n.Emails=9]="Emails";n[n.Store=10]="Store";n[n.SearchSuggestions=11]="SearchSuggestions";n[n.PathCompletion=12]="PathCompletion";n[n._PowerBi=13]="_PowerBi";n[n.JumpListTasks=14]="JumpListTasks";n[n.JumpListPinned=15]="JumpListPinned";n[n.JumpListRecent=16]="JumpListRecent";n[n.JumpListFrequent=17]="JumpListFrequent";n[n.JumpListCustom=18]="JumpListCustom";n[n._JumpListActivityFeed=19]="_JumpListActivityFeed";n[n.People=20]="People";n[n._EdgeHistory=21]="_EdgeHistory";n[n.LocalPlaces=22]="LocalPlaces";n[n.Bookmarks=25]="Bookmarks";n[n.Related=26]="Related";n[n.Websites=27]="Websites";n[n.Contact=28]="Contact";n[n.JumpListSynthetic=29]="JumpListSynthetic";n[n.JumpListActions=30]="JumpListActions";n[n._StartMenu=31]="_StartMenu";n[n.LocalSearchHistory=32]="LocalSearchHistory";n[n.JumpListSettingsFaq=33]="JumpListSettingsFaq";n[n.JumpListSettingsRelatedSettings=34]="JumpListSettingsRelatedSettings";n[n.ActivityFeedSuggestions=35]="ActivityFeedSuggestions";n[n.TopApps=36]="TopApps";n[n.QuickSearch=37]="QuickSearch";n[n.LockscreenQuickSearch=38]="LockscreenQuickSearch";n[n.WelcomeExperience=39]="WelcomeExperience";n[n.Upsell=40]="Upsell";n[n.MSNNews=42]="MSNNews";n[n.MRUHistory=43]="MRUHistory";n[n.PromoBanner=44]="PromoBanner";n[n.VisualSearch=45]="VisualSearch";n[n.BingDailyImage=46]="BingDailyImage";n[n.MSNWeather=47]="MSNWeather";n[n.MeetingPrep=48]="MeetingPrep";n[n.AnaheimData=49]="AnaheimData";n[n.RecommendedDocs=50]="RecommendedDocs";n[n.GroupHeader=104]="GroupHeader"}(t=n.GroupType||(n.GroupType={}));var k=/،/g,at=["PP","QP","IBA","TOPL"],vt=["ST","QS","SSTS"],d=["LI","LV","MU"],yt=["FL","LDOC","FD"].concat(d),pt=[i.Documents,i.Folders,i.Photos,i.Videos,i.Music];n.isApp=wt;n.isSetting=bt;n.isMedia=kt;n.isFileOrFolder=dt;n.isFileOrFolderScope=gt;n.substrateProvidersEnabled=g;n.searchHistoryAllowed=tt;n.isRecommendedDocsGroupEnabled=it;n.nicerCloudFilesEnabled=ii;n.setZeroInputDataSourcesForL1=ri;n.populateScopeConfig=rt;rt();n.cleanScopePrefixes=ui;n.initScopePrefixes=fi;n.getScopeDisplayName=ft;n.isScopeEnabled=y;n.getScopeConfig=ot;st=/^ht+ps?[;:]+|^www[.。]|^\/+/;p=/^[a-z]:\\|^%[^%]+%\\|^\\/i;n.parseQuery=ei;n.parseTaskFrame=ci;ct="action://FindMyStuff/FindDocument";lt="action://FindMyStuff/FindMessage";n.getEffectiveScope=w;n.getEffectiveQuery=ai;b="HiddenSuggestionGroups";n.initQueryParser=yi}(WSB||(WSB={})),function(n){function wt(n,t){return n.type==t.type&&n.source==t.source}function kt(n){switch(n){case"PP":return"Apps";case"ST":return"Settings";case"FL":return"Files";case"LM":return"Media";default:return null}}function dt(n){switch(n){case"FL":case"LM":case"IFF":case"MFF":case"PT":case"CG":case"MPVD":case"MDOC":case"MFOL":case"MPHO":case"MVID":case"MMUS":case"FEH":case"LDIC":return!0;case"OSTMA":case"QS":case"MSNW":case"BIMG":case"PP":case"LRA":case"ST":case"MPP":case"MST":case"IBA":case"THST":case"TOPP":case"QSCH":case"LSQS":case"WWE":case"MSNN":return!1}throw new Error("New local data source "+n+" needs to be explicity classified as potentially containing PII or not");}function gt(n){var t=e(n);return n.deviceItem&&n.handoffType==2?t+"\t"+n.deviceItem.id:t+"\t"+n.query}function y(n){switch(n.type){case"BKS":case"ML":case"MB":case"OS":case"RI":case"HS":case"MBKS":case"MBLD":case"MQNA":return!0}switch(n.handoffType){case 1:case 17:case 13:case 16:case 0:case 11:case 14:return!0}return!1}function ni(n){switch(n){case"MFF":case"FL":case"LM":case"IFF":case"MPVD":case"MDOC":case"MPHO":case"MVID":case"MMUS":case"MFOL":return!0;default:return!1}}function ti(t,i){if(!n.IndexerQueryGenerator)return!1;if(n.RuntimeConfig.QfMode==5)return!0;switch(t){case"IBA":case"MPVD":case"MDOC":case"MPHO":case"MVID":case"MMUS":case"MFOL":return!0;case"IFF":return g(i)||!n.config.minLengthForIBAonL1||i.queryToFetch.length>=n.config.minLengthForIBAonL1;default:return!1}}function ii(n){return n.kind=="Modern Setting"}function ri(t){return n.isApp(t.type)?t.deviceItem:null}function ui(n){return!!n.suggestions}function fi(n){return n.deviceItem}function ei(n){return n.type=="CG"?n.deviceItem:null}function oi(t){return n.isApp(t.type)||n.isSetting(t.type)||n.isFileOrFolder(t.type)}function e(t){if(typeof t.staticGroupType=="number")return t.staticGroupType;if(n.RuntimeConfig.QfMode==8&&y(t))return n.GroupType.SearchSuggestions;switch(t.type){case"TOPL":return n.GroupType.TopApps}if(n.isApp(t.type))return n.GroupType.Apps;if(o(t))return t.groupType;if(n.isSetting(t.type))return n.GroupType.Settings;switch(t.type){case"CG":return n.GroupType.Command;case"PT":return n.GroupType.PathCompletion;case"LI":return n.GroupType.Photos;case"LV":return n.GroupType.Videos;case"MU":return n.GroupType.Music;case"JL":case"FL":case"LDOC":case"SDFE":return n.GroupType.Documents;case"FD":return n.GroupType.Folders;case"OLE":case"OWA":return n.GroupType.Emails;case"PPL":case"MPPL":case"MGRP":return n.GroupType.People;case"BKS":case"MBKS":case"MQNA":case"MBLD":return n.GroupType.Bookmarks;case"ELA":return n.GroupType.LocalPlaces;case"NEWS":return n.GroupType.MSNNews;case"WEA":return n.GroupType.MSNWeather;case"ANAF":case"ANAH":case"ANAT":case"ANAR":return n.GroupType.AnaheimData;case"FEH":return n.GroupType.LocalSearchHistory;case"SNSC":case"SNSP":case"SNST":return n.GroupType.VisualSearch;case"RSSG":case"QSSG":return n.GroupType.QuickSearch;case"LSQS":return n.GroupType.LockscreenQuickSearch;case"MPJM":case"MPRC":return n.GroupType.MeetingPrep;default:switch(t.handoffType){case 3:return n.GroupType.Store;case 5:case 4:return n.GroupType.Cortana;case 10:return t.htmlContent?n.GroupType.SearchSuggestions:n.GroupType.Cortana;case 0:case 13:case 14:return n.GroupType.SearchSuggestions;case 1:return n.GroupType.Websites}throw new Error("Unexpected handoff type: "+t.handoffType);}}function si(n){return!n.isAnswer&&(n.handoffType==0||n.handoffType==11)&&n.type!="QSSG"}function p(t){switch(t){case n.GroupType.JumpListTasks:case n.GroupType.JumpListPinned:case n.GroupType.JumpListRecent:case n.GroupType.JumpListFrequent:case n.GroupType.JumpListCustom:return!0;default:return!1}}function hi(t){var i=t.type;return p(i)||i==n.GroupType.Related||i==n.GroupType.Contact}function o(n){return!!n.parent}function ci(n){return n.type=="JL"}function w(t){switch(t){case n.GroupType.Apps:case n.GroupType.Store:return n.Scope.Apps;case n.GroupType.Settings:return n.Scope.Settings;case n.GroupType.Documents:return n.Scope.Documents;case n.GroupType.Folders:return n.Scope.Folders;case n.GroupType.Photos:return n.Scope.Photos;case n.GroupType.Videos:return n.Scope.Videos;case n.GroupType.Music:return n.Scope.Music;case n.GroupType.LocalPlaces:case n.GroupType.SearchSuggestions:case n.GroupType.Websites:case n.GroupType.Bookmarks:return n.Scope.Web;case n.GroupType.Emails:return n.Scope.Emails;case n.GroupType.People:return n.Scope.People}return n.Scope.All}function li(t){switch(t){case 0:case 7:case 8:return 32;case 1:return n.RuntimeConfig.QfMode==8?32:16;case 2:return n.IconSize_GridLayout_Scaled;case 3:return 24;case 4:return 64;case 5:return 200}}function ai(n,t,i){if(n&&n.type==0&&tt(t)){var u=function(t){n.ratio=t.height==t.width?1:t.height>t.width?3:2;i()},r=new Image;r.src=n.content;r.onload=function(){return u({height:r.height,width:r.width})}}else i()}function t(){var t=n.uiLanguageCache.toLocaleLowerCase();return b[t]||t}function k(n,t,i,r,u,f,e,o,s,h,c,l,a){var v={text:t,getIcon:i,icon:r,type:u,query:f,ciMatchedQuery:null,id:c,click:l,handoffType:o,instItem:e,isAnswer:!1,htmlContent:null,classNames:[],selected:!1,featureStore:undefined,sequenceNumber:s,getMruData:function(){return null},template:0,mayContainPII:h,features:[],previewPaneType:undefined};return v.previewPaneType=rr(n,v,a),v}function vi(n,t,i,r,u,f,e,o,s){n.subItems==null&&(n.subItems=[]);var c=n.id,h={id:t,sequenceNumber:n.sequenceNumber,selected:!1,text:i,itemView:r,props:u,onSelected:o,click:s,disabled:e,instItem:f,suggestionId:c};return n.subItems.push(h),h}function yi(t,i,r,u,f,e,o,s){var h=n.InstrumentationHelper.getInstrumentedSyntheticSuggestion(i,r),l,c;return h?h:(l=t.scope,h=k(t,null,null,u,r,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(r,a.KValues),f,i,!1,r),h.notAResult=!0,h.primaryMetadata=e,o&&(h.additionalInfoText=" - "+h.primaryMetadata),c=function(n){h.query=n.queryToFetch;h.text=HitHighlightingParser.addMarkers(n.queryToFetch);h.narratorText=d(h);h.click=function(){return s(h,n)}},c(t),h.updateFromQuery=function(n){return!n.isProtocol&&n.scope==l&&n.queryToFetch?(c(n),!0):!1},n.InstrumentationHelper.instrumentSyntheticSuggestion(i,h),h)}function d(n,t){var i,r,u;return n.htmlContent?null:(i=[n.text],r=n.dateShort,r&&i.push(r),t?i.push(t):(n.primaryMetadata&&(i.push(n.primaryMetadata),u=n.department,u&&i.push(u)),n.template==1&&n.secondaryMetadata&&i.push(n.secondaryMetadata)),HitHighlightingParser.removeMarkers(i.join(", ")))}function g(t){return t.scope!=n.Scope.All||!!t.taskFrame}function nt(t){return typeof t=="string"?t=="LI"||t=="LV":t==n.GroupType.Photos||t==n.GroupType.Videos}function tt(n){return nt(n)||ut(n)}function pi(t){return!n.config.disableMediaGridLayout&&!n.RuntimeConfig.AlwaysWide&&nt(t)}function wi(t,i){var f,u,e,r;if(!t||!n.RuntimeConfig.ScopesAvailable)return null;if(i.scope==n.Scope.All){if(f=[],t.ISUPN&&t.ISUPG)if(u=t.ISUPN.split("\t"),e=t.ISUPG.split("\t"),u.length==e.length)for(r=0;r<u.length;r++)f.push(e[r]+"\t"+u[r]);else SharedLogHelper.LogError("parseWebSuppressionSignals",null,new Error("parsedNames.length != parsedGroups.length"));return{fullySuppressedGroups:t.FSUP?t.FSUP.split("\t"):null,partiallySuppressedGroups:t.PSUP?t.PSUP.split("\t"):null,suppressedSuggestions:f}}return null}function bi(t){return i||(i=_d.createElement("span")),n.safeExecute(function(){return i.innerHTML=t,i.innerText},t,"decodeHtml")}function ki(n,t){return{matchType:n,matchedText:t}}function h(n){return n.replace(it,"\\$&")}function di(n,t){if(t){var u=n.includes(HitHighlightingParser.startMarker),e=u?n:HitHighlightingParser.addMarkers(n,t),f=HitHighlightingParser.split(e).find(function(n){return n.highlighted});if(f){var r=u?HitHighlightingParser.removeMarkers(n):n,o=new RegExp("((?:\\\\[^\\\\]+)?\\\\[^\\\\]+)?\\\\"+h(f.text)+".*","i"),i=o.exec(r);if(i&&i[0])return{matchType:s.Location,matchedText:r.startsWith(i[0])?r:String.fromCharCode(8230)+i[0]}}}return null}function gi(n,t){if(t){var r=n.includes(HitHighlightingParser.startMarker),o=r?n:HitHighlightingParser.addMarkers(n,t),u=HitHighlightingParser.split(o).find(function(n){return n.highlighted});if(u){var f=r?HitHighlightingParser.removeMarkers(n):n,c=new RegExp("(?:\\S+\\s){0,3}\\b"+h(u.text)+"\\S*(?:\\s\\S+){0,5}","i"),i=c.exec(f),e=void 0;return i&&i[0]&&(e={matchType:s.Content,matchedText:i[0]}),[f,e]}}return[null,null]}function nr(n,t){return n&&t&&HitHighlightingParser.addMarkers(n,t).includes(HitHighlightingParser.startMarker)}function tr(t){return t==n.Scope.Emails}function ir(n){if(o(n))return!1;switch(n.handoffType){case 0:case 13:case 14:case 5:case 10:case 4:return n.type!="QSSG";case 3:return n.type=="STS";case 2:return n.type=="SDFE";case 8:case 12:return n.type=="OWA";default:return!1}}function rr(t,i,r){var u=undefined,f;if(!n.RuntimeConfig.PreviewPaneAvailable||t.isSearchHomeZI)return u;if(f=function(){return n.isBingEnabled()&&n.contains([0,13,14],i.handoffType)&&!i.htmlContent?1:u},r)return f();switch(e(i)){case n.GroupType.Store:return n.RuntimeConfig.AlwaysWide&&i.type!="STS"?2:u;case n.GroupType.AnaheimData:case n.GroupType.Apps:case n.GroupType.Cortana:case n.GroupType.Command:case n.GroupType.Documents:case n.GroupType.Folders:case n.GroupType.Music:case n.GroupType.PathCompletion:case n.GroupType.Emails:case n.GroupType.Photos:case n.GroupType.Settings:case n.GroupType.Videos:return n.RuntimeConfig.AlwaysWide?2:u;case n.GroupType.People:return i.handoffType==0?1:i.handoffType==1?u:i.handoffType==17?3:n.RuntimeConfig.AlwaysWide?2:u;case n.GroupType.Bookmarks:return i.handoffType==17?3:f();case n.GroupType.Websites:return n.isBingEnabled()&&i.type!="LURL"?1:u;default:return f()}}function ur(n,t,i){var r=i.previewPaneType,u,f;return r?(u=t.previewPaneType,f=r==1&&u==1,t.query.toLocaleLowerCase()==i.query.toLocaleLowerCase()&&(!f&&r==u||f&&t.handoffType==i.handoffType)):!1}function fr(n){return n==null}function er(t,i){return t==n.GroupType.Documents&&n.isSubstrateO365AccountConnected||n.isFileOrFolderScope(w(t))&&n.isDataSourceEnabled("ODC",i)}function or(t){switch(t){case 2:return"OneDrive";case 3:return n.Host.getLocString("OneDriveForBusiness");case 4:return"SharePoint";case 1:return n.Host.getLocString("ThisPC");case 5:return n.Host.getLocString("MsbPeopleGroups");case 6:return n.Host.getLocString("MsbPeopleContacts")}return null}function sr(n){if(ft())switch(n){case 37:return 39;case 39:return 37}return n}function hr(){return{content:"&#xE721",type:2}}function cr(t){return n.Host.getLocString(t?"SeeWorkAndWebResults":"SeeWebResults")}function lr(t){return n.isDataSourceEnabled("MSBC",t)||n.isDataSourceEnabled("MSBS",t)}function ut(n){return n=="PPL"||n=="MPPL"||n=="MGRP"}function ar(n){return n=="MBKS"||n=="MBLD"||n=="MQNA"}function vr(n){return n=="MPPL"||n=="MGRP"||n=="MBKS"||n=="MQNA"||n=="MBLD"}function yr(n,t){var i="b_hide";n&&(t?n.classList.remove(i):n.classList.add(i))}function ft(){return ThresholdUtilities.isRightToLeftLanguage(n.uiLanguageCache)}function pr(){r={}}function et(t){var i=r[t],u;return typeof i=="undefined"&&(u=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch,u.getFolderPathFromKnownFolderIdGuid?(i=n.safeExecute(function(){return u.getFolderPathFromKnownFolderIdGuid(t)},"getPathFromFolderID","",t),i=i.toLocaleLowerCase()):i="",r[t]=i),i}function wr(){u={}}function br(n){var t,i;return n.startsWith("{")?(t=u[n],t||(i=n.match(ot),t=i?et(i[1])+i[2]:n,u[n]=t),t):n}function kr(n){return n.startsWith("file:")&&(n=n.slice(5)),n.replace(/\//g,"\\")}function dr(t){return n.config.enforceOriginalOrderForTypes[t.type]||n.config.enforceOriginalOrderForTypes[t.type+"|"+t.handoffType]}function gr(n){return n==1?"https://substrate.office.com":"https://substrate.office.com/SubstrateSearch-Internal.ReadWrite"}function nu(n){return n==1?"https://www.bing.com/cortana":"service::cortana.bing.com::mbi_ssl"}function tu(t){return n.TweakSearch&&n.TweakSearch.isTweakSearchEnabled()?n.config[t]:undefined}function iu(){return n.config.skipSelectedScope&&n.RuntimeConfig.AlwaysWide}function st(){return n.RuntimeConfig.PreviewPaneAvailable&&n.RuntimeConfig.QfMode!=0&&n.canShowUpsell&&!(ct()&&SearchAppWrapper.CortanaApp.height<=550)&&!l(t())}function ru(){return n.config.forceEdgeUpsell||f()}function uu(t){return(n.config.supportedQuickAnswersMarkets[t]||n.config.quickAnswerIcon||n.config.quickAnswerWeb)&&n.RuntimeConfig.PreviewPaneAvailable&&n.RuntimeConfig.QfMode!=0&&n.isBingEnabled()&&n.isBrowserOnline()&&SearchAppWrapper.CortanaApp.textScaleFactor<1.25||n.RuntimeConfig.QfMode==8}function ht(t){return n.RuntimeConfig.PreviewPaneAvailable&&n.RuntimeConfig.QfMode===1&&n.config.msnNewsSearch&&n.config.supportedMSNSearchMarkets[t.toLowerCase()]&&n.isBingEnabled()&&n.isBrowserOnline()&&f()}function ct(){return n.config.enableEdgeUpsellSHTransitionIcon}function fu(){return n.config.enableAnaheimUpsellResetDefault3}function eu(){if(!n.config.enableSnipSearchV2)return!1;var t="CN";return!n.revIpRegionCache||n.revIpRegionCache==t||n.regionCache==t?!1:n.isBingEnabled()?n.RuntimeConfig.QfMode==6?!1:st()?!1:n.Host.isBitmapInClipboardSupported():!1}function ou(t){return n.config.liveTiles&&n.config.liveTiles.weather&&n.RuntimeConfig.PreviewPaneAvailable&&n.RuntimeConfig.QfMode===1&&n.config.weatherTileMarkets[t.toLowerCase()]&&n.isBrowserOnline()}function su(t){return n.config.removableWeatherTile&&!n.config.skipRemoveWTCheck?t.getItem(n.WeatherTileRemoved)!="1":!0}function hu(i){var r=t();return(n.isMiniSerpEnabled()||n.config.quickSearchToMsnMarkets[r])&&!(l(r)||ht(r)&&vt(i)||(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isWWEVisible())||(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isWWEVisibleSinglePane())||i.getItem("MRUNoItemsAvailable")!="1"&&lt(i))}function lt(i){return n.RuntimeConfig.QfMode===1&&n.isBrowserOnline()&&n.isBingEnabled()&&n.config.enableBingImage&&SearchAppWrapper.CortanaApp.height>=600&&i.getItem("BingImageDismissed")!="1"&&!(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isWWEVisible())&&SearchAppWrapper.CortanaApp.textScaleFactor<=1&&SearchAppWrapper.CortanaApp.width>=v&&t()=="en-us"}function f(){var t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return n.config.skipWinVersionCheck||(t==2||t==3)&&[4,27,].indexOf(n.osSKUCache)==-1&&!n.isSubstrateO365AccountConnected}function vt(t){var i=t.getItem(n.currentTabStorageKey);return i&&i!=at.News?!1:!0}function yt(n,t,i){var u,f,r;if(typeof n!="object"||n==null)return n;if(n instanceof Date)return u=new Date,u.setTime(n.getTime()),u;f=Array.isArray(n)?[]:{};for(r in n)(!t||t.indexOf(r)<0)&&(f[r]=i&&i.indexOf(r)>=0?n[r]:yt(n[r],t,i));return f}function c(n,t){var i,u,r;if(n===t||typeof n=="function"&&typeof t=="function")return!0;if(typeof n!="object"||n===null||typeof t!="object"||t===null||(i=Object.keys(n),u=Object.keys(t),i.length!==u.length))return!1;for(r=0;r<i.length;r++)if(!Object.hasOwnProperty.call(t,i[r])||!c(n[i[r]],t[i[r]]))return!1;return!0}function cu(t,i,r){return n.config.pureRender?!c(t.props,i)||!c(t.state,r):!0}function lu(){return n.config.mruSearchHome&&!((n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isWWEVisible())||n.RuntimeConfig.QfMode==8||n.config.enableSearchHomeCustomization)}function l(t){return n.config.prong1&&n.RuntimeConfig.AlwaysWide&&f()&&n.config.weatherTileMarkets[t.toLowerCase()]}function au(t,i,r,u){return n.Promise.safeChainWithGlobalCaching("getIconUrlSuggestion",function(){return ThresholdUtilities.createPromise(function(f){var o=SearchAppWrapper.CortanaApp.createStringMap(),s=SearchAppWrapper.CortanaApp.createStringMap(),e=pt(t,i,r,u);n.Promise.safeChain("fetchIconUrl",function(){return SearchAppWrapper.CortanaApp.makeHttpRequestAsync(0,e,o,"",s)},function(t){if(t.statusCode!==200){f(null);return}n.Promise.safeChain("readIconResponse",function(){return t.readAsStreamAsync()},f,function(){return f(null)},null,null,1)},function(){return f(null)},null,e,1)})},function(){return t+"_icon"},function(t){return t?n.toIcon(t,"convertResponseToIcon"):{type:0,content:n.getEdgeFallbackIcon()}},null,null,t,1)}function pt(t,i,r,u){i===void 0&&(i=32);r===void 0&&(r=32);u===void 0&&(u=1.5);var f=n.getDomain(t).replace("www.",""),e=n.generateKeyFromDomain(f);return n.getWindowProtocol()+"//"+n.getWindowHost()+"/th?id=ODF."+e+"&pid=Api&w="+i+"&h="+r+"&dpr="+u}var a,bt,v,b,i,s,it,rt,r,u,ot,at;n.sameGroup=wt,function(t){t.KValues=function(){var n={};return n.GPT=108,n.GT=109,n.GW=110,n.SW=114,n.PWL=115,n.STS=116,n.SBI=117,n.SBV=118,n.SDSC=119,n.SDIO=120,n.IMIO=121,n.COFA=122,n.COOA=124,n.SDFE=126,n.OWA=128,n.OMSS=129,n.OMIO=130,n.OMTS=131,n.OMLS=132,n.OMAC=133,n.OMVA=135,n.SSTS=136,n.AFOT=137,n.SNSC=138,n.RWBD=139,n.RWBN=140,n.EUP=142,n.RWBG=145,n.QSCH=146,n.MSNN=147,n.SKU=148,n.SNSP=149,n.SNST=150,n.BIMG=151,n.APPA=152,n.OMZI=153,n.FB=154,n.MSBA=155,n.ANA=156,n.APB=157,n.MMB=158,n.OMB=159,n.LMB=160,n}();t.HandoffsForNonSuggestions=function(){var n={};return n.GPT=2,n.GT=3,n.GW=0,n.SDSC=2,n.SDIO=2,n.IMIO=2,n.COFA=2,n.COOA=2,n.MSNN=20,n.SNSP=19,n.SNST=19,n.APPA=997,n.OMZI=997,n.FB=997,n.MSBA=2,n.APB=997,n.MMB=997,n.OMB=997,n.LMB=997,n}();t.GroupsForNonSuggestions=function(){var t={};return t.GPT=n.GroupType.GroupHeader,t.GT=n.GroupType.GroupHeader,t.GW=n.GroupType.GroupHeader,t.SDSC=n.GroupType.Settings,t.SDIO=n.GroupType.Settings,t.IMIO=n.GroupType.Settings,t.COFA=n.GroupType.Settings,t.COOA=n.GroupType.Settings,t.SNSP=n.GroupType.VisualSearch,t.SNST=n.GroupType.VisualSearch,t.MSBA=n.GroupType.Upsell,t}()}(a=n.SyntheticQSCodesMaps||(n.SyntheticQSCodesMaps={})),function(n){n[n.Open=1]="Open";n[n.RunAs=2]="RunAs";n[n.RunAsUser=3]="RunAsUser";n[n.OpenInBrowser=4]="OpenInBrowser";n[n.OpenFileLocation=5]="OpenFileLocation";n[n.OpenContaining=6]="OpenContaining";n[n.TabletMode_OpenNewWindow=7]="TabletMode_OpenNewWindow";n[n.PinToStartScreen=8]="PinToStartScreen";n[n.StartUnpin=9]="StartUnpin";n[n.TaskbarUnpin=10]="TaskbarUnpin";n[n.StartPin=11]="StartPin";n[n.TaskbarPin=12]="TaskbarPin";n[n.Manage=13]="Manage";n[n.ConnectNetworkDrive=14]="ConnectNetworkDrive";n[n.DisconnectNetworkDrive=15]="DisconnectNetworkDrive";n[n.Uninstall=16]="Uninstall";n[n["Tile.Uninstall"]=17]="Tile.Uninstall";n[n.ItemProperties=18]="ItemProperties";n[n.Settings=19]="Settings";n[n.Review=20]="Review";n[n.Share=21]="Share";n[n.S_Open=1e3]="S_Open";n[n.S_Install=1001]="S_Install";n[n.S_CopyFullPath=1002]="S_CopyFullPath";n[n.S_SendEmail=1003]="S_SendEmail";n[n.S_SendInstantMessage=1004]="S_SendInstantMessage";n[n.S_CopyPersonDetails=1005]="S_CopyPersonDetails";n[n.S_OpenFileLocationInBrowser=1006]="S_OpenFileLocationInBrowser";n[n.S_OpenInOutlookWeb=1007]="S_OpenInOutlookWeb";n[n.S_LaunchOutlookNative=1008]="S_LaunchOutlookNative";n[n.S_OpenInBrowser=1009]="S_OpenInBrowser"}(bt=n.JumplistActionItemType||(n.JumplistActionItemType={}));n.providerFailureLogName=kt;n.localDataSourceMayContainPII=dt;n.getSuggestionKey=gt;n.MRUDatabaseName="mruWithIndex";v=784;n.isSantoriniWeb=y;n.isFileOrFolderLocalDataSource=ni;n.supportsShortcuts=ti;n.isModernSetting=ii;n.getAppItem=ri;n.isGroup=ui;n.getItemWithFileMetadata=fi;n.getCommandLineItem=ei;n.isMRUHistoryGroupType=oi;n.getGroupType=e;n.isWebSuggestion=si;n.isJumpListGroup=p;n.isTopHitChildGroup=hi;n.isChildSuggestion=o;n.isJumpListSuggestion=ci;n.getScope=w;n.IconSize_GridLayout=92;n.IconSize_GridLayout_Medium=68;n.IconSize_GridLayout_Scaled=130;n.getImageSizeValue=li;n.populateImageRatio=ai;b={"zh-hans-cn":"zh-cn","zh-hans-sg":"zh-cn","zh-hant-hk":"zh-hk","zh-hant-tw":"zh-tw",ko:"ko-kr",ja:"ja-jp",nb:"nb-no"};n.getCurrentLanguage=t;n.createSuggestion=k;n.addSubItemToSuggestion=vi;n.getSyntheticSuggestion=yi;n.getNarratorText=d;n.isL2=g;n.iconIsThumbnail=tt;n.displayedInGridLayout=pi;n.parseWebSuppressionSignals=wi;n.decodeHtml=bi,function(n){n[n.Author=1]="Author";n[n.LastModifiedBy=2]="LastModifiedBy";n[n.Content=3]="Content";n[n.Tags=4]="Tags";n[n.Album=5]="Album";n[n.Artist=6]="Artist";n[n.Genre=7]="Genre";n[n.Location=8]="Location"}(s=n.MatchType||(n.MatchType={}));n.createMatch=ki;it=/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g;n.escapeRegex=h;n.tryGetLocationMatch=di;n.tryGetTextContentMatch=gi;n.matchesOnPropertyHH=nr;n.uses3lineTemplate=tr;n.hasReverseHighlighting=ir;n.isEquivalentForPreviewPanePurposes=ur;n.isNullOrUndefined=fr;rt=function(){function n(n,t,i){this.verb=n.verb;this.displayName=n.displayName;this.executeSync=n.executeSync?function(){return i(function(){return n.executeSync()})}:function(){return i(function(){return n.executeAsync()})};this.isDefault=n.isDefault;this.icon=t;this.getIcon=n.getIcon}return n}();n.DeviceItemVerbWrapper=rt;n.shouldSetThisPcGroupSource=er;n.getGroupSourceDisplayName=or;n.EdgeAppIds=["MSEdge","Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge"];n.AnaheimAppIds=["MSEdge"];n.SpartanAppId="Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge";n.InternetExplorerId="Microsoft.InternetExplorer.Default";n.getRtlAdjustedKey=sr;n.getSearchSuggestionIcon=hr;n.getWebSuggestionAnnotation=cr;n.msbEnabledForQuery=lr;n.isOnlineSuggestionPersonType=ut;n.isOnlineSuggestionMsbOtherTypes=ar;n.isMsbOnlineSuggestionType=vr;n.setVisibility=yr;n.isRtl=ft;n.FOLDERID_Profile="{5E6C858F-0E22-4760-9AFE-EA3317B67173}";n.FOLDERID_SkyDrive="{A52BBA46-E9E1-435f-B3D9-28DAA648C0F6}";n.FOLDERID_System="{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}";n.FOLDERID_SystemX86="{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}";r={};n.clearFolderCaches=pr;n.getKnownFolderPathLC=et;u={};n.clearPathExpansionCache=wr;ot=/^\{([a-z0-9-]{36})\}(.*)/i;n.resolveKnownFolderGUIDsInPath=br;n.indexerFilePathToRegularPath=kr;n.enforceOriginalOrder=dr;n.getSubstrateResourceOrScope=gr;n.getBingResourceOrScope=nu;n.getTweakedSetting=tu;n.shouldSkipSelectedScope=iu;n.canShowSearchHomeUpsell=st;n.canShowQFUpsell=ru;n.shouldEnableQuickSearches=uu;n.shouldEnableMSNNewsSearches=ht;n.shouldEnableEdgeUpsellSHTransitionIcon=ct;n.shouldEnableAnaheimResetDefault=fu;n.shouldEnableSnipSearch=eu;n.WeatherTileRemoved=n.config.prong1?"ProngWeatherTileRemoved":"WeatherTileRemoved";n.shouldEnableWeatherTile=ou;n.isWeatherTileVisible=su;n.canShowQuickSearch=hu;n.canShowBingDailyImage=lt;n.isConsumerWindowsSKU=f;n.currentTabStorageKey="currentTab";n.MeetingDismissedEndDateKey="MeetingDismissedStartDate",function(n){n.News="MSNNews";n.QuickSearches="QuickSearches"}(at=n.MSNNewsTabs||(n.MSNNewsTabs={}));n.canShowMSNNewsTab=vt;n.deepCopy=yt;n.shouldComponentUpdateOverload=cu;n.enableMRUSearchHome=lu;n.enableProngWeather=l;n.getFaviconUrlForRawUrl=au;n.getThumbnailServerUrl=pt}(WSB||(WSB={})),function(n){var t,i,r;(function(n){n.checking="checking";n.downloading="downloading";n.error="error";n.noUpdate="noupdate";n.obsolete="obsolete";n.updateReady="updateready"})(t||(t={}));i=[t.checking,t.downloading,t.error,t.noUpdate,t.obsolete,t.updateReady];r=function(){function r(n){n===void 0&&(n=Date.now);this.getNowTimestamp=n;this._appCacheEventIndex=1;this._superFreshEnabled=!1;this._appCache=_w.applicationCache;this.subscribeForEvents()}return r.prototype.instrumentSuperFreshUpdate=function(n){this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.SuperFreshUpdateData.T=this.getNowTimestamp();this._appCacheTimeline.SuperFreshUpdateData.S=n;this.sendAppCacheEvents()},r.prototype.registerSuperFresh=function(){this._superFreshEnabled=!0},r.prototype.subscribeForEvents=function(){var n=this;i.forEach(function(t,i){return sj_be(n._appCache,t,function(){return n.handleAppCacheEvent(t,i)})})},r.prototype.handleAppCacheEvent=function(n,i){n!=t.checking&&this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.AppCacheEvents[i]=this.getNowTimestamp();switch(n){case t.obsolete:SharedLogHelper.LogWarning("handleAppCacheEvent",null,"AppCache marked as obsolete and will be deleted");this.sendAppCacheEvents();break;case t.error:case t.noUpdate:this.sendAppCacheEvents();break;case t.updateReady:this._superFreshEnabled||this.sendAppCacheEvents()}},r.prototype.sendAppCacheEvents=function(){var f=_G.ServerIG,t,r,u,i;if(!f){SharedLogHelper.LogError("sendAppCacheEvents","Could not instrument as server IG not known",new Error("Could not instrument app cache event"));return}(t=this._appCacheTimeline,t)&&(r=t.AppCacheEvents,u=[{I:t.EventIndex,E:r,S:t.SuperFreshUpdateData,ABT:n.InstrumentationHelper.getConversationStartTimestamp()}],r[2]&&(u[0].OL=navigator.onLine),i=n.InstrumentationCommon.createPerfPingEvent(f,u,"AppCache",n.Host.getConversationId()),Log2.LogEvent(i.EventType,i.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,i.ImpressionGuid,null,null),this._appCacheTimeline=this.createAppCacheTimelineObject())},r.prototype.createAppCacheTimelineObject=function(){var n={EventIndex:this._appCacheEventIndex,AppCacheEvents:{},SuperFreshUpdateData:{T:undefined,S:undefined}};return this._appCacheEventIndex++,n},r}();n.AppCacheInstrumentationHelper=r}(WSB||(WSB={})),function(n){var t=["PP","ST","FL","LM"],i=function(){function i(){var n=this;ThresholdUtilities.getCortanaHeaders(function(t){t&&(n._windowsFlights=t["X-BM-WindowsFlights"])})}return i.prototype.logProfilerMarker=function(t,i,r,u,f){f||(f={});n.safeExecute(function(){t==1?SearchAppWrapper.CortanaApp.logMeasure("Bing_QF_"+r,i,"QF",JSON.stringify(f),u):SearchAppWrapper.CortanaApp.logVerboseTrace("Bing_QF_"+r,i,"QF",JSON.stringify(f),u)},"logProfilerMarker")},i.prototype.getEnrichedClientInfo=function(t){var u,o=typeof _G=="object"?_G:{},i={},r,f,e;return i.entryPoint=SearchAppWrapper.CortanaApp.entryPoint,i.previousExperience=SearchAppWrapper.CortanaApp.queryFormulationView.previousExperience,i.qfMode=""+n.RuntimeConfig.QfMode,i.isSearchHome=t.isSearchHomeZI?1:undefined,i.region=n.regionCache||undefined,i.lang=n.uiLanguageCache||undefined,i.DC=o.DA||undefined,i.isMobile=SearchAppWrapper.CortanaApp.isMobile?1:0,i.isXbox=navigator.userAgent.toLowerCase().includes("xbox one")?1:0,i.isHololens=navigator.userAgent.toLowerCase().includes("hololens")?1:0,i.windowsColor=n.Host.getWindowsTheme(),i.appColor=n.Host.getAppTheme(),r=n.Host.getFeatureDWORD("WideAtStartupDelta"),r.validFeature&&typeof r.featureValue=="number"&&(i.WideAtStartupDelta=r.featureValue),t.scope!=n.Scope.All&&(i.scope=n.Scope[t.scope]),t.fromSuggestionType&&(i.fromClick={sType:t.fromSuggestionType,searchHome:t.fromSearchHome?1:undefined}),f=SearchAppWrapper.CortanaApp.queryFormulationView.searchHistory,i.deviceHistoryEnabled=f&&f.isDeviceHistoryEnabled?1:0,e=(u=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())!==null&&u!==void 0?u:0,i.windowsAccount=e.toString(),n.isMsftAccountConnected&&(i.msftAccountConnected=1),n.isSubstrateO365AccountConnected&&(i.o365Connected=1),n.isSubstrateOutlookAccountConnected&&(i.outlookConnected=1),n.Host.hasFallbackHappened()&&(i.fallback=1),n.Host.isClientLocationAvailable()&&(i.clientLocationAvailable=1),n.Host.isInputPanelVisible()&&(i.isInputPaneVisible=1),SearchAppWrapper.CortanaApp.appsUseLightTheme===!1&&(i.darkMode=1),SearchAppWrapper.CortanaApp.colorPrevalenceEnabled&&(i.colorPrevalence=1),SearchAppWrapper.CortanaApp.isSearchBoxInTaskbar&&(i.searchBoxInTaskbar=1),SearchAppWrapper.CortanaApp.taskbarOrientation&&(i.taskbarOrientation=SearchAppWrapper.CortanaApp.taskbarOrientation),n.config.snrVersion&&(i.snrVersion=n.config.snrVersion),n.osSKUCache&&(i.osSKU=n.osSKUCache.toString()),i.ciVersion=n.ConstraintIndex.currentCIVersion,i.defaultBrowser=n.Host.getDefaultBrowser().toString(),this._windowsFlights&&(i.windowsFlights=this._windowsFlights),typeof n.getTenantMsbStatus=="function"&&(i.tenantMsbStatus=n.getTenantMsbStatus()),typeof BingAtWork!="undefined"&&(i.msbClientQfState=this.getMsbClientQfState()),i},i.prototype.getSuggestionsPageName=function(){return"Page.SmartSearch.AS.Suggestions"},i.prototype.getApplicationName=function(){return"SmartSearch"},i.prototype.getRankerModelId=function(){return n.config.mainRankerId},i.prototype.createNonSuggestionDataSourceObject=function(t,i){return{T:"D.Url",K:i.getKValue(),Val:t,Ho:n.SyntheticQSCodesMaps.HandoffsForNonSuggestions[t],Gr:n.SyntheticQSCodesMaps.GroupsForNonSuggestions[t],NR:1,Properties:i.getProperties()}},i.prototype.createDataSourceObject=function(t,i){var f=this,e=t.mayContainPII&&!n.TestHookUrlParameters,o=(i||t.instItem).getKValue(),s=i&&typeof i.getHandoffType()=="number"?i.getHandoffType():t.handoffType,h=i?i.getQsCode():t.type,r={T:"D.Url",K:o,Q:e?undefined:t.query,MQ:t.ciMatchedQuery?t.ciMatchedQuery:undefined,Val:h,Ho:s,Ans:t.isAnswer?1:undefined,Gr:n.getGroupType(t),HC:t.hc?1:undefined,RAF:t.useRaf?1:undefined,HS:t.fromHistory?1:undefined,F:t.features.length>0?t.features.join(","):undefined,AC:t.autoCompleteType?t.autoCompleteType:undefined,HCMS:t.highConfidenceMetaSuggestionScore,HCS:t.highConfidenceSuggestionScore,LM:t.suggestionLogMeta,Uri:t.actionUri,Src:t.source,Sg:t.segments,NR:t.notAResult?1:undefined},u;return t.deviceItem?r.DeviceSignals=n.safeExecute(function(){return f.buildDeviceItemDataSource(e,t)},"buildDeviceItemDataSource"):n.isJumpListSuggestion(t)&&(r.DeviceSignals=n.safeExecute(function(){return f.buildJumpListItemDataSource(t)},"buildJumpListItemDataSource")),n.TestHookUrlParameters&&(u=t,u.path&&(r.path=u.path),u.targetPathLC&&(r.targetPath=u.targetPathLC)),r.RankerSignals=this.buildRankerOutputDataSource(t),r},i.prototype.buildRankerOutputDataSource=function(n){if(!n.rankingScore&&!n.featureStore)return undefined;return{rankingScore:n.rankingScore,featureStore:n.featureStore,mruSuppressionScore:n.mruSuppressionScore,fbcScore:n.fbcScore,previewPaneScore:n.previewPaneScore}},i.prototype.buildJumpListItemDataSource=function(t){var r=t.jumpListItem,i={Rank:r.usagePoints||undefined,LAD:n.isValidDate(r.lastAccessed)?r.lastAccessed.toJSON():undefined};if(n.TestHookUrlParameters)i.path=r.path,i.description=t.tooltip;else if(!i.Rank&&!i.LAD)return undefined;return i},i.prototype.getPathCompletionItem=function(n){return n.type=="PT"?n.deviceItem:null},i.prototype.buildDeviceItemDataSource=function(t,i){var f=i.deviceItem,r={Rank:f.rankScore},u,o,s,e;if(f.propertyHits&&f.propertyHits.length>0&&(r.PHits=f.propertyHits.join(",")),t||(r.Id=f.id,r.DName!=i.query&&(r.DName=f.displayName)),n.TestHookUrlParameters&&(r.kind=f.kind),n.isSetting(i.type))return r.MDN=n.isModernSetting(f)?1:0,r;if(u=n.getAppItem(i),u)return r.LAD=n.isValidDate(u.lastAccessed)?u.lastAccessed.toJSON():undefined,r.AppLnch=u.totalLaunches,r.Args=u.launchArguments?1:0,r.MDN=u.isImmersive?1:0,r.Ext=u.extension,n.TestHookUrlParameters&&(r.CDT=n.isValidDate(u.createdDate)?u.createdDate.toJSON():undefined,r.LMD=n.isValidDate(u.lastModifiedDate)?u.lastModifiedDate.toJSON():undefined,r.launchArguments=u.launchArguments,r.filePath=u.filePath),r;if(o=n.getItemWithFileMetadata(i),o){if(r.Ext=o.extension,n.TestHookUrlParameters&&(r.itemTypeDisplayName=o.itemTypeDisplayName),s=n.getCommandLineItem(i),s)return n.TestHookUrlParameters&&(r.launchArguments=s.launchArguments,r.encodedPath=s.encodedPath),r;this.getPathCompletionItem(i)||(e=i.deviceItem,r.CDT=n.isValidDate(e.createdDate)?e.createdDate.toJSON():undefined,r.LMD=n.isValidDate(e.lastModifiedDate)?e.lastModifiedDate.toJSON():undefined,r.Ext=e.extension?e.extension:"")}return r},i.prototype.getMsbClientQfState=function(){var n=BingAtWork.msbDataContext;if(n){if(n.dataLoadFired)return"DataLoaded";if(n.readyFired)return"Ready"}return"NotReady"},i.prototype.logMasterPageImpression=function(t){n.safeExecute(function(){return ThresholdInst.LogPageImpression(t,null,t.enrichedClientInfo)},"logMasterImpressionForClient")},i.prototype.logDataSourceTimeout=function(i,r){var e,u,f,o;if(SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure)for(e=function(t){n.isDataSourceEnabled(t,r)&&!n.contains(i,t)&&n.safeExecute(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(n.providerFailureLogName(t),"NoReturnForTopHit")},"logProviderFailure")},u=0,f=t;u<f.length;u++)o=f[u],e(o)},i.prototype.onItemClick=function(){SearchAppWrapper.CortanaApp.queryFormulationView.resetConversationIdNextTimeQFIsShown&&SearchAppWrapper.CortanaApp.queryFormulationView.resetConversationIdNextTimeQFIsShown()},i}();n.WSBInstrumentationProvider=i}(WSB||(WSB={})),function(n){var t="/QF_KEYSTROKE_VIRTUAL_URL?",i="autosuggest",r=function(){function r(){}return r.init=function(t,i){r._keystrokesInstrumentationData={};r._instrumentationProvider=t;r._clientTelemetry=i;ClientInstConfig.queueDumpInterval=n.config.logQueueDumpInterval;_w.ClTrCo.SharedClickSuppressed=!0;n.Host.bindShown(function(n){return r._clientShownTimestamp=n});n.Host.bindConversationStart(function(){return r.onConversationStart()});r._conversationTimeline={RawImpressionGuid:"",ImpressionGuid:"",ConversationId:"",AppVisibleStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppVisibleFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppShownStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppShownFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE}},r.bindFinalizeKeystroke=function(n){r._finalizeKeystrokeHandlers.push(n)},r.bindKeystrokeTimelineUpdated=function(n){r._keystrokeTimelineUpdatedHandlers.push(n)},r.fireKeystrokeTimelineUpdatedHandlers=function(n){r._keystrokeTimelineUpdatedHandlers.forEach(function(t){return t(n)})},r.getImpressionGuid=function(n){var t=r._keystrokesInstrumentationData[n];if(t&&t.ImpressionGuid)return t.ImpressionGuid;throw"getImpressionGuid(): No IG for sequence "+n;},r.updateSuggestionsList=function(n,t){r._clientTelemetry&&r._clientTelemetry.updateSuggestionsList(n,t)},r.instrumentKeyDown=function(n){r._keyDownTimeStamp=n},r.instrumentFetchesBegin=function(t){r.safeInstrumentPerf(t,function(t){t.DataSourcesFetchBegin=r.getOffsettedNow();n.config.perfInstV2&&(t.DataProviderFetchStart=r.getOffsettedNow())},"instrumentFetchesBegin",null)},r.instrumentFetchesEnd=function(n){r.safeInstrumentPerf(n,function(n){n.DataSourcesFetchEnd=r.getOffsettedNow()},"instrumentFetchesEnd",null)},r.instrumentDataSourceParsed=function(n,t){r.safeInstrumentPerf(n,function(n){var i=r.getOffsettedNow();typeof n.ResponseParsed[t]!="number"?n.ResponseParsed[t]=i:(n.MultipleResponsesParsed[t]||(n.MultipleResponsesParsed[t]=[n.ResponseParsed[t]]),n.MultipleResponsesParsed[t].push(i))},"instrumentDataSourceParsed",t)},r.instrumentItemClickForPreviewPane=function(n,t,i,u,f,e,o,s,h){if(t.getHandoffType()!=999){var c=r.createBaseCustomGPingPayload(f,e);r.addPreviewPaneDataToGPingPayload(c,o,s,h);r.instrumentItemClickAndGPing(c,n,t,i,u,f)}},r.instrumentItemClickForContextMenu=function(n,t,i,u,f,e,o){if(t.getHandoffType()!=999){var s=r.createBaseCustomGPingPayload(f,e);r.addContextMenuDataToGPingPayload(s,o);r.instrumentItemClickAndGPing(s,n,t,i,u,f)}},r.instrumentItemClick=function(n,t,i,u,f,e){var o=t.getHandoffType(),s;o!=999&&(o==998||o==997?r.instrumentLayoutItemSelect(t,i):(s=r.createBaseCustomGPingPayload(f,e),r.instrumentItemClickAndGPing(s,n,t,i,u,f)))},r.instrumentItemClickAndGPing=function(t,i,u,f,e,o){r.sendCustomGPing(t,u.getHValue(),i);var h=r._keystrokesInstrumentationData[f],s=r._keystrokesInstrumentationData[f];s?(h.RenderingStarted||r.updatePageIG(f),_G.IG!=s.ImpressionGuid&&SharedLogHelper.LogError("instrumentItemClick","IG ("+s.ImpressionGuid+") for sequenceNumber "+f+" does not match the page IG ("+_G.IG+")",new Error("IG for sequence number does not match the currently rendered page's IG (_G.IG)")),r._clientTelemetry&&r._clientTelemetry.logItemClickedMeasure(s.ConversationId,s.RawImpressionGuid,u,o)):SharedLogHelper.LogError("instrumentItemClick","sequenceNumber: "+f+" ConversationID: "+n.Host.getConversationId(),new Error("No instrumentation data found for sequenceNumber"));r.finalizeKeystrokeLog(f,1);e&&e();r._instrumentationProvider.onItemClick();n.config.forceLogFlush?Log2.ForceFlush():Log2.FlushMainQueueDontForce();_w.clickFlushedTime=sb_gt()},r.instrumentLayoutItemSelect=function(n,t){var i={AppNS:n.getAppNS(),K:n.getLayoutKValue()};r.logClientInstEvent("Select","ItemClicked",t,i)},r.createBaseCustomGPingPayload=function(n,t){var i={};switch(n){case 1:i.i="k";i.mk=r.getModifierKeyCodes(t);break;case 3:i.i="t";break;case 4:i.i="p";break;case 5:i.i="n";break;case 6:i.i="b";break;case 0:i.i="x";i.mk=r.getModifierKeyCodes(t);break;default:i.mk=r.getModifierKeyCodes(t)}return i},r.addContextMenuDataToGPingPayload=function(n,t){n.cm=t},r.addPreviewPaneDataToGPingPayload=function(n,t,i,r){t&&(n.pp=t,i&&(n.ppit=i),typeof r=="number"&&(n.rho=r))},r.sendCustomGPing=function(t,i,r){var u=i;n.isEmpty(t)||(u+="&PR="+JSON.stringify(t));n.safeExecute(function(){return _w.si_T(u,null,null,0,r)},"logCustomGPing")},r.getModifierKeyCodes=function(n){if(n){var t=n.altKey?"A":"";if(t+=n.ctrlKey?"C":"",t+=n.shiftKey?"S":"",t)return t}return undefined},r.notifyTopHitPreviewPaneOpenedOrInterrupted=function(t,i){var u=r._keystrokesPerfPingData[t];u&&u.PreviewPanePendingInfo!=null&&(u.PreviewPanePendingInfo.latency=r.getOffsettedNow(),i?u.PreviewPaneOpened=u.PreviewPanePendingInfo:u.PreviewPaneCanceled=u.PreviewPanePendingInfo,u.PreviewPanePendingInfo=null,r.tryInstrumentRenderStopped(t,u));n.config.perfInstV2&&i&&r.safeInstrumentPerf(t,function(n){n.PreviewPaneFinish=r.getOffsettedNow()},"instrumentFetchesEnd",null)},r.previewPaneOpenedOrClosed=function(n,t,i,u,f,e){var s=n?"Select":"Unselect",h=n?"PreviewPaneOpened":"PreviewPaneClosed",o;r.logClientInstEvent(s,h,t,e);n&&r._keystrokesPerfPingData[t]&&r.notifyTopHitPreviewPaneOpenedOrInterrupted(t,!0);n&&r._clientTelemetry&&(o=r._keystrokesInstrumentationData[t],o&&r._clientTelemetry.logPreviewPaneOpenedMeasure(i,u,f))},r.logClientInstEvent=function(n,t,i,u){var e=null,f;i&&(f=r._keystrokesInstrumentationData[i],f&&(e=f.ImpressionGuid));Log2.LogEvent(n,u,t,null,null,e,null,null)},r.safeInstrument=function(n,t,i,u){var f=r._keystrokesInstrumentationData[n];f?t(f):SharedLogHelper.LogError(i,(u?u+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"))},r.safeInstrumentPerf=function(t,i,u,f){var e=r._keystrokesPerfPingData[t];e?n.safeExecute(function(){return i(e)},u):SharedLogHelper.LogError(u,(f?f+" ":"")+" sequenceNumber: "+t,new Error("No instrumentation data found for sequenceNumber"))},r.instrumentRenderingStarted=function(n){r.safeInstrument(n,function(t){t.RenderingStarted=!0;r.updatePageIG(n)},"instrumentRenderingStarted")},r.instrumentQueryChangedRequest=function(t,i){var e;delete r._keystrokesInstrumentationData[t-1];n.InstrumentedItem.resetKValues(t);e=r._keystrokesPerfPingData[t];e&&SharedLogHelper.LogError("instrumentQueryChangedRequest","sequenceNumber: "+t,new Error("Duplicate BeginRequest for sequenceNumber"));var f=n.Host.getConversationId(),u=n.Host.getRawImpressionGuid(),o=n.cleanGuid(u),s=n.getCurrentTime(),c={RawImpressionGuid:u,ImpressionGuid:o,ConversationId:f,Query:i,PendingDataSources:{},DataSources:{},RankerExtraInfo:{},DuplicateDS:{},Layout:[],MasterPageImpressionCreated:!1,RenderingStarted:!1,PendingInstrumentedItems:{},PendingSyntheticSuggestions:{},OriginalTimestamp:s},h={RawImpressionGuid:u,ImpressionGuid:o,ConversationId:f,PrefixLength:i.queryToFetch?i.queryToFetch.length:0,SearchHomeRenderEvent:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,ClientShownEvent:r.getOffsettedNow(r._clientShownTimestamp),RequestBegin:r.getOffsettedNow(s),ResponseReceived:{},MultipleResponsesReceived:{},DataSourcesState:r._searchServiceStatus?{Indexer:r._searchServiceStatus}:undefined,RenderFinished:{},renderGroupFinished:{},AllRenderFinished:0,AllDataSourcesProcessed:!1,PendingIcons:0,PreviewPanePendingInfo:undefined,TopResultRendered:[],ResponseFromCache:{},DataSourcesFetchBegin:0,DataSourcesFetchEnd:0,ResponseParsed:{},PreviewPaneOpened:{},PreviewPaneCanceled:{},PageLoadTime:0,SearchHomeLoadTime:0,FirstRenderTime:0,MultipleResponsesParsed:{},ConversationStart:n.config.perfInstV2?r._conversationStartTimestamp:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,SequenceStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProviderFetchStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProviderFetchFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProvidersFinished:{},RendersCompleted:{},PreviewPaneStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,PreviewPaneFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE};r._keystrokesInstrumentationData[t]=c;r._keystrokesPerfPingData[t]=h;r._currentRender=0;n.config.perfInstV2&&r._keyDownTimeStamp!=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE&&(r.safeInstrumentPerf(t,function(n){n.SequenceStart=r._keyDownTimeStamp-r._conversationStartTimestamp},"instrumentKeyDown",null),r._keyDownTimeStamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE);r._clientTelemetry&&r._clientTelemetry.logNewKeystrokeMeasure(f,u,i);r.updatePageIG(t);r.fireKeystrokeTimelineUpdatedHandlers(h)},r.setSearchServiceStatus=function(n){r._searchServiceStatus=n},r.instrumentResponseReceived=function(t,i,u,f,e,o){r.safeInstrumentPerf(t,function(t){if(!e){var o=r.getOffsettedNow();typeof t.ResponseReceived[i]!="number"?(t.ResponseReceived[i]=o,n.config.useWhereId&&i=="IFF"):(t.MultipleResponsesReceived[i]||(t.MultipleResponsesReceived[i]=[t.ResponseReceived[i]]),t.MultipleResponsesReceived[i].push(o))}u&&(t.DataSourcesState=t.DataSourcesState||{},t.DataSourcesState[i]=u);f&&(t.ResponseFromCache[i]=f)},"instrumentResponseReceived",i);n.config.perfInstV2&&r.safeInstrumentPerf(t,function(n){o||(n.DataProvidersFinished[i]=r.getOffsettedNow(),n.DataProviderFetchFinish<n.DataProvidersFinished[i]&&(n.DataProviderFetchFinish=n.DataProvidersFinished[i]));u&&(n.DataSourcesState=n.DataSourcesState||{},n.DataSourcesState[i]=u);f&&(n.ResponseFromCache[i]=f)},"instrumentResponseReceived",i)},r.instrumentTopResultRendered=function(t,i,u){r.safeInstrumentPerf(t,function(f){var e=r.getOffsettedNow(),o="T"+i.join(","),s;f.renderGroupFinished[o]?u||(f.renderGroupFinished[o].iconsFinished=e):(f.TopResultRendered.push({V:e,T:i.join(",")}),r._clientTelemetry&&(s=e-f.RequestBegin,r._clientTelemetry.logTopResultsRenderedMeasure(f.RawImpressionGuid,i,s)),f.renderGroupFinished[o]={iconsFinished:e,suggestionsFinished:e});r.tryInstrumentRenderStopped(t,f);n.MockUrlParameters&&n.safeFireEvent("TopResultRendered")},"instrumentTopResultRendered")},r.instrumentRenderedLocalSuggestion=function(n,t){var u=r._keystrokesInstrumentationData[n],f,e,i;if(u){for(f={},e={},i=0;i<t.length;i++)t[i].type=="FV"?f[i]="TBD":t[i].type=="HU"&&(e[i]="TBD");u.FvSug=f;u.HuSug=e}},r.instrumentAggregatorCall=function(t,i){r.safeInstrument(t,function(t){var e={fastRankModelId:r._instrumentationProvider.getRankerModelId()},f,u;for(f in t.RankerExtraInfo)e[f]=t.RankerExtraInfo[f];t.RankerExtraInfo={};u={T:"D.Aggregator",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Aggregator",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:[],rankerModelIds:e};n.config.counterFactualLoggingOn&&(u.counterFactualDiff=u.counterFactualDiff||i);t.DataSources.aggregator=u},"instrumentAggregatorCall")},r.addDuplicatesDataSource=function(t){var i=Object.keys(t.DuplicateDS).map(function(n){return t.DuplicateDS[n]});i.length>0&&(t.DataSources.duplicates={T:"D.Duplicates",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Duplicates",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:i})},r.instrumentDuplicate=function(t,i,u){r.safeInstrument(t,function(t){var r=t.DuplicateDS[i.instItem.getHValue()],f;r||(r={T:"D.Duplicate",DS:[{T:"D.DSRef",KRef:i.instItem.getKValue()}]},i.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(r.DS[0].AppNS=i.instItem.getAppNS()),t.DuplicateDS[i.instItem.getHValue()]=r);f={T:"D.DSRef",KRef:u.instItem.getKValue()};u.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(f.AppNS=u.instItem.getAppNS());r.DS.push(f)},"instrumentDuplicate")},r.renderingStopped=function(n){return n.PendingIcons==0&&n.AllDataSourcesProcessed&&n.PreviewPanePendingInfo==null},r.notifyAllDataSourcesProcessed=function(n){r.safeInstrumentPerf(n,function(t){t.AllDataSourcesProcessed=!0;r.tryInstrumentRenderStopped(n,t)},"notifyAllDataSourcesProcessed")},r.notifyIconPending=function(n,t){r.safeInstrumentPerf(n,function(n){n.PendingIcons++},"notifyIconPending",t?"TR":"SUG")},r.notifyIconReadyOrFailed=function(n,t){r.safeInstrumentPerf(n,function(n){n.PendingIcons--},"notifyIconReadyOrFailed",t?"TR":"SUG")},r.notifyPreviewPaneStartRender=function(t){n.config.perfInstV2&&r.safeInstrumentPerf(t,function(n){n.PreviewPaneStart=r.getOffsettedNow()},"previewPaneStart")},r.notifyPreviewPanePending=function(n,t,i){var u=r._keystrokesPerfPingData[n];u&&(u.PreviewPanePendingInfo={previewPaneType:t,suggestionType:i})},r.tryInstrumentRenderStopped=function(t,i){r.renderingStopped(i)&&(r.finalizeKeystrokeLog(t,2),n.TestHookUrlParameters&&n.safeFireEvent("RenderStopped"))},r.isLayoutLogged=function(n){return r._keystrokesInstrumentationData[n].MasterPageImpressionCreated},r.finalizeKeystrokeLog=function(t,i){var f,u;(i===void 0&&(i=0),n.config.perfPingAtEndOnly&&i==2)||(r._finalizeKeystrokeHandlers.forEach(function(n){return n(i==0)}),f=r._keystrokesInstrumentationData[t],f&&r.logKeystrokeData(f,t),i!=1&&(u=r._keystrokesPerfPingData[t],u&&(r.logPerfPingEvent(r.createKeystrokePerfPingEvent(t,u)),r._clientTelemetry&&r._clientTelemetry.logDataSourcePerformancesMeasure(u),r.fireKeystrokeTimelineUpdatedHandlers(u))))},r.instrumentZiRendered=function(t){r._instrumentationProvider.logProfilerMarker(1,0,"ZiRendered",r.getImpressionGuid(t),{});n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("RenderZeroInput");r.safeInstrumentPerf(t,function(n){n.SearchHomeRenderEvent=r.getOffsettedNow()},"instrumentSearchHomeRender",null)},r.instrumentRenderFinished=function(t,i,u,f,e,o){var h,s;o||r._keystrokesPerfPingData[t].FirstRenderTime||(r._keystrokesPerfPingData[t].FirstRenderTime=r.getOffsettedNow());n.config.perfInstV2&&(r._keystrokesPerfPingData[t].RendersCompleted[r._currentRender++]=r.getOffsettedNow());!r._firstRenderOccurred&&e&&(r._firstRenderOccurred=!0,h={CVID:n.Host.getConversationId()},r._instrumentationProvider.logProfilerMarker(1,0,"FirstRender",r.getImpressionGuid(t),h));r.safeInstrumentPerf(t,function(n){var e=r.getOffsettedNow(),o="S"+i.join(",");n.renderGroupFinished[o]?f||(n.renderGroupFinished[o].iconsFinished=e):(i.forEach(function(t){return n.RenderFinished[t]=e}),n.renderGroupFinished[o]={iconsFinished:e,suggestionsFinished:e});r.tryInstrumentRenderStopped(t,n);r._clientTelemetry&&r._clientTelemetry.logGroupsRenderedMeasure(u)},"instrumentRenderFinished",i.join(","));s=r._keystrokesPerfPingData[t];s&&r.fireKeystrokeTimelineUpdatedHandlers(s)},r.instrumentSyntheticInstrumentedItem=function(n,t,i){var u=r._keystrokesInstrumentationData[n];u?u.PendingInstrumentedItems[t]=i:SharedLogHelper.LogError("instrumentSyntheticInstrumentedItem",t,new Error("keystrokesInstrumentationData not found"))},r.instrumentSyntheticSuggestion=function(n,t){var i=r._keystrokesInstrumentationData[n];i?i.PendingSyntheticSuggestions[t.type]=t:SharedLogHelper.LogError("instrumentSyntheticSuggestion",t.type,new Error("Instrumentation synthetic suggestion after flush"))},r.getInstrumentedSyntheticSuggestion=function(n,t){return r._keystrokesInstrumentationData[n].PendingSyntheticSuggestions[t]},r.instrumentDataSource=function(n,t,i,u){r.safeInstrument(n,function(n){var r,f,e;if(u&&u.rankerExtraInfo)for(r in u.rankerExtraInfo)n.RankerExtraInfo[r]=u.rankerExtraInfo[r];f=i||[];e=n.PendingDataSources[t];n.PendingDataSources[t]=e?e.concat(f):f},"instrumentDataSource",t)},r.processPendingDataSources=function(t){var i,s,u,f,h,e,o,c,l;for(i in t.PendingDataSources)if(s=t.PendingDataSources[i],s.length>0){for(u=[],f=0,h=s;f<h.length;f++)for(e=h[f],u.push(r._instrumentationProvider.createDataSourceObject(e)),o=0,c=e.subInstItems||[];o<c.length;o++)l=c[o],u.push(r._instrumentationProvider.createDataSourceObject(e,l));i=="Web"&&(i="WebAS");u.length>0&&(t.DataSources[i]={T:"D."+i,AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:i,SC:u.length,DS:u})}t.PendingDataSources={}},r.instrumentSnRProviderFetchUrl=function(n,t){r.safeInstrument(n,function(n){n.SnRProviderFetchUrl=t},"instrumentSnRProviderFetchUrl")},r.onConversationStart=function(){if(r._conversationStartTimestamp=n.getCurrentTime(),r._searchServiceStatus=null,r._firstRenderOccurred=!1,r._clientTelemetry){var t=n.Host.getConversationId();r._clientTelemetry.logConversationStartMeasure(t,r._conversationStartTimestamp)}r._keystrokesPerfPingData=[];r._currentRender=0},r.getConversationStartTimestamp=function(){return r._conversationStartTimestamp},r.logDataSourceTimeout=function(n,t){r._instrumentationProvider.logDataSourceTimeout(n,t)},r.getPpoFromPpi=function(n){return typeof n.latency=="number"?{L:n.latency,T:n.previewPaneType}:{}},r.createKeystrokePerfPingEvent=function(t,i){var u={I:t,PL:i.PrefixLength,K:i.RequestBegin,F:i.DataSourcesFetchEnd,PPO:r.getPpoFromPpi(i.PreviewPaneOpened),PPC:r.getPpoFromPpi(i.PreviewPaneCanceled),RRT:i.ResponseReceived,RPT:i.ResponseParsed,MRT:i.MultipleResponsesReceived,RFT:i.RenderFinished,TRR:i.TopResultRendered,RS:undefined,PLT:undefined,HLT:undefined,FRT:undefined,IRFT:{},TRIR:[],MPT:i.MultipleResponsesParsed,CS:n.config.perfInstV2?i.ConversationStart:undefined,KS:n.config.perfInstV2?i.SequenceStart:undefined,RB:n.config.perfInstV2?i.RequestBegin:undefined,FS:n.config.perfInstV2?i.DataProviderFetchStart:undefined,FF:n.config.perfInstV2?i.DataProviderFetchFinish:undefined,PFT:n.config.perfInstV2?i.DataProvidersFinished:undefined,RC:n.config.perfInstV2?i.RendersCompleted:undefined,PS:n.config.perfInstV2?i.PreviewPaneStart:undefined,PF:n.config.perfInstV2?i.PreviewPaneFinish:undefined},o,h,v,s,c,l,f,e,a;for(e in i.renderGroupFinished)if(o=i.renderGroupFinished[e],o.iconsFinished!=o.suggestionsFinished)if(h=e.substr(1),e.startsWith("T"))u.TRIR.push({T:h,V:o.iconsFinished});else for(v=h.split(","),s=0,c=v;s<c.length;s++)l=c[s],u.IRFT[l]=Math.max(o.iconsFinished,u.IRFT[l]||0);if(r.renderingStopped(i)){f=0;for(e in i.renderGroupFinished)f=Math.max(f,i.renderGroupFinished[e].iconsFinished);i.FirstRenderTime&&(u.FRT=i.FirstRenderTime);f&&(i.AllRenderFinished=f,u.RS=f,f=Math.max(f,i.PreviewPaneOpened.latency||i.PreviewPaneCanceled.latency||0),i.PageLoadTime=f,u.PLT=f);i.SearchHomeRenderEvent!=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE&&(u.HLT=Math.max(u.PLT-u.K,i.SearchHomeRenderEvent))}else a=r.getOffsettedNow(),u.RS=a,u.PLT=a;return n.InstrumentationCommon.createPerfPingEvent(i.ImpressionGuid,[u],"Keystroke",i.ConversationId,i.DataSourcesState,i.ResponseFromCache)},r.updatePageIG=function(n){_G.IG=r.getImpressionGuid(n)},r.createMasterPageImpression=function(t,u,f,e,o){var c={dataSources:o||[],layoutNodes:[],pageName:t,rawQuery:e?e.queryToFetch:"",isQuery:!1,impressionUrl:r.createVirtualImpressionURL(u,f),appName:r._instrumentationProvider.getApplicationName(),enrichedClientInfo:{FDPartnerEntry:i,nclid:_G.nclid,isOffline:n.isBrowserOnline()?0:1,webRequested:f?1:0}},s=n.safeExecute(function(){return r._instrumentationProvider.getEnrichedClientInfo(e)},"getEnrichedClientInfo"),h;if(s)for(h in s)c.enrichedClientInfo[h]=s[h];return c},r.logKeystrokeData=function(i){var f,e,u;(r.processPendingDataSources(i),n.TestHookUrlParameters&&r.addDuplicatesDataSource(i),f=Object.keys(i.DataSources).map(function(n){return i.DataSources[n]}).concat(r.createNonSuggestionsDataSource(i.PendingInstrumentedItems,i.PendingSyntheticSuggestions)),i.DataSources={},i.PendingSyntheticSuggestions={},i.PendingInstrumentedItems={},f.length==0&&i.MasterPageImpressionCreated)||(i.RenderingStarted&&(e=DsLManager.CreateLayoutNode(_d.body,n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,!1,!0,i.MasterPageImpressionCreated)),i.MasterPageImpressionCreated?Log2.LogEvent("ClientInst",null,null,f,e,i.ImpressionGuid,null,null):(u=r.createMasterPageImpression(r._instrumentationProvider.getSuggestionsPageName(),t,i.SnRProviderFetchUrl?i.SnRProviderFetchUrl.substring(i.SnRProviderFetchUrl.indexOf("?")+1):"",i.Query,f),e&&(u.layoutNodes=e),i.FvSug&&Object.keys(i.FvSug).length>0&&(u.enrichedClientInfo.FvSug=i.FvSug),i.HuSug&&Object.keys(i.HuSug).length>0&&(u.enrichedClientInfo.HuSug=i.HuSug),u.clientTimestamp=i.OriginalTimestamp,r.logMasterPageImpression(i.ImpressionGuid,u),i.MasterPageImpressionCreated=!0))},r.logPerfPingEvent=function(t){Log2.LogEvent(t.EventType,t.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,t.ImpressionGuid,null,null);n.ClientTestHooks&&n.ClientTestHooks.DebugLogNoConsole("perfPingEvent",[t])},r.logMasterPageImpression=function(t,i){if(i){if(!t){SharedLogHelper.LogError("logMasterPageImpression",null,new Error("Missing impressionGuid"));return}i.impressionGuid=t;r._instrumentationProvider.logMasterPageImpression(i,n.Host.getConversationId());n.ClientTestHooks&&n.ClientTestHooks.DebugLogNoConsole("masterPageImpression",i,t)}},r.instrumentAppVisibleFinish=function(t){var i=n.getCurrentTime();r._conversationTimeline.AppVisibleStart=t;r._conversationTimeline.AppVisibleFinish=i},r.instrumentAppShownFinish=function(t){var i=n.getCurrentTime();r._conversationTimeline.AppShownStart=t;r._conversationTimeline.AppShownFinish=i},r.instrumentConversationTimelineFinish=function(){var t=_G.ServerIG,i,u;if(!t){SharedLogHelper.LogError("instrumentConversationTimelineFinish","Could not instrument as server IG not known",new Error("Could not instrument initilization finish"));return}r._conversationTimeline.RawImpressionGuid=n.Host.getRawImpressionGuid();r._conversationTimeline.ImpressionGuid=n.cleanGuid(r._conversationTimeline.RawImpressionGuid);r._conversationTimeline.ConversationId=n.Host.getConversationId();i={CID:r._conversationTimeline.ConversationId,ASB:r._conversationTimeline.AppShownStart,ASF:r._conversationTimeline.AppShownFinish,AVB:r._conversationTimeline.AppVisibleStart,AVF:r._conversationTimeline.AppVisibleFinish};u=n.InstrumentationCommon.createPerfPingEvent(t,[i],"ConversationTimeline",r._conversationTimeline.ConversationId);r.logPerfPingEvent(u)},r.instrumentInitializationFinish=function(t){var f=_G.ServerIG,i,u;if(!f){SharedLogHelper.LogError("instrumentInitializationFinish","Could not instrument as server IG not known",new Error("Could not instrument initilization finish"));return}if(i=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,u=_w.performance,u&&u.timing&&(i=u.timing.navigationStart),!(i<=0)){var e=t.getTime()-i,o=n.getCurrentTime()-i,s=[{BLT:e,ILT:o}],h=n.InstrumentationCommon.createPerfPingEvent(f,s,"Load");r.logPerfPingEvent(h)}},r.getOffsettedNow=function(t){return t===void 0&&(t=n.getCurrentTime()),t-r._conversationStartTimestamp},r.createNonSuggestionsDataSource=function(t,i){var u=[],f,e;for(f in t)u.push(r._instrumentationProvider.createNonSuggestionDataSourceObject(f,t[f]));for(f in i)u.push(r._instrumentationProvider.createDataSourceObject(i[f]));return u.length?(e={T:"D.ContentGroup",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"NonSuggestions",SC:u.length,DS:u},[e]):[]},r.createVirtualImpressionURL=function(t,i){var r=n.getWindowProtocol()+"//"+n.getWindowHost()+t;return r+=i?i:n.Service.QueryParams.ConversationId+"="+n.encodeQueryParameter(n.Host.getConversationId()),_G.ServerIG&&(r+="&ASInitIG="+n.encodeQueryParameter(_G.ServerIG)),r},r._clientShownTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,r._conversationStartTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,r._firstRenderOccurred=!1,r._currentRender=0,r._keyDownTimeStamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,r._keystrokesPerfPingData={},r._keystrokesInstrumentationData={},r._keystrokeTimelineUpdatedHandlers=[],r._finalizeKeystrokeHandlers=[],r}();n.InstrumentationHelper=r}(WSB||(WSB={})),function(n){var t="&nclid=",i="&ts=",r="&nclidts=",u="&tsms=",f="&elv=",e="&cc=",o="&setlang=",s="&cvid=",h="&qs=",c="&ao=",l="&wsso=",a=function(){function a(t,i){if(t===void 0&&(t=Date.now),i===void 0&&(i=n.getWindowProtocol()+"//"+n.getWindowHost()),this.getNowTimestamp=t,this._baseUrl=i,n.config.overrideHost){var r=n.getWindowHost();r.startsWith("www.")&&(this._baseUrl=n.getWindowProtocol()+"//"+n.config.overrideHost+r.substring(3))}}return a.prototype.getSearchUrl=function(t,i,r,u,e,o,s,h,a){var b=this.getVerticalFromHandoffType(e),v,y,p,w;return u||(u=(b?"/"+b:"")+"/search?q="+n.encodeQueryParameter(i)),v=this._baseUrl+u,v+=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isWindowsTest)?"&form=MONITR&traffictype=wintest":"&form="+n.encodeQueryParameter(o||n.Host.getFormCode()),a&&(v+=c+"1"),v=this.enrichUrlWithSuggestionType(v,h?"P":r),v=this.enrichUrlWithCvid(v),n.config.suppressPqParameter||(v+="&pq="+n.encodeQueryParameter(t)),y=n.Host.getMSNRefIg(),y&&(v+="&refig="+y),v=this.enrichUrlWithMarketInfo(v),v=this.enrichUrlWithDeviceInfo(v),s||(v=this.enrichUrlWithMuidInfo(v),p=n.Host.getElToken(),p&&this._baseUrl.startsWith("https:")&&(v+=f+n.encodeQueryParameter(p)),v=this.enrichUrlWithSafeSearchInfo(v)),w=n.Host.getSafeSearchSetting(),w&&(v+=l+w),v},a.prototype.getImageSearchUrl=function(){var t=this._baseUrl+"/images/detail/upload?FORM=SBIWSB";return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isWindowsTest)&&(t+="&isWindowsTest=1&traffictype=Test"),t},a.prototype.getVerticalFromHandoffType=function(n){return n===13?"images":n===14?"videos":n===15?"shop":""},a.prototype.enrichUrlWithDeviceInfo=function(t){n.Host.isEducationEnvironment()&&(t+="&DAF0=1");n.Host.isWindowsS()&&(t+="&DAF1=1");var i=n.Host.getPartnerSearchCode();return i&&(t+="&PC="+i),t},a.prototype.enrichUrlWithMarketInfo=function(t){var i=n.Host.getRegion(),r=n.Host.getLanguage();return i&&(t+=e+i),r&&(t+=o+r),t},a.prototype.enrichUrlWithSafeSearchInfo=function(t){return n.Host.getSafeSearchSetting()=="Strict"?t+"&adlt=strict":t},a.prototype.enrichUrlWithMuidInfo=function(f){var e,o,s;return _G.nclid&&(f+=t+n.encodeQueryParameter(_G.nclid),e=this.getNowTimestamp().toString(),f+=i+n.encodeQueryParameter(e),o=e.substring(0,e.length-3),f+=r+n.encodeQueryParameter(o),s=e.substring(e.length-3),f+=u+n.encodeQueryParameter(s)),f},a.prototype.enrichUrlWithCvid=function(t){return t+(s+n.encodeQueryParameter(n.Host.getConversationId()))},a.prototype.enrichUrlWithSuggestionType=function(t,i){return t+(h+n.encodeQueryParameter(i))},a}();n.NavigationHelper=a}(WSB||(WSB={})),function(n){var t=function(){function t(t){var i=this;this._selectableItemsContainer=t;n.Host.bindKeyDown(function(r,u,f){var e=!1;r==9?e=i.selectFirstItemInNextGroup(u&&u.shiftKey):n.isUpOrDownKey(r)&&(e=i.selectNextItem(n.isUpKey(r)));t.onAfterKeyDown(r,u,f,e)})}return t.prototype.selectFirstItemInNextGroup=function(t){var i=this._selectableItemsContainer.getSelectableItemsByGroup(),u;if(i.length==0)return!1;var f=this._selectableItemsContainer.getSelectedItem(),r=i.findIndex(function(t){return n.contains(t,f)}),e=r<0?-1:i[r].findIndex(function(n){return n==f});return(f&&f.onUnselected&&f.onUnselected(),r<0?u=i[0][0]:t&&e>0?u=i[r][0]:t?r>0&&(u=i[r-1][0]):r+1<i.length&&(u=i[r+1][0]),u)?(this._selectableItemsContainer.select(u,!0),u.onSelected&&u.onSelected(),!0):!1},t.prototype.selectNextItem=function(t){var i=this._selectableItemsContainer.getSelectableItems(),r,u,e,f;return i.length==0?!1:(r=this._selectableItemsContainer.getSelectedItem(),u=r?i.indexOf(r):-1,r&&r.onUnselected&&r.onUnselected(),e=t?u==0:u==i.length-1,e&&n.RuntimeConfig.AllowKeyboardNavOffCanvas)?(this._selectableItemsContainer.select(null,!0),!0):e&&!n.RuntimeConfig.AllowKeyboardNavCycling?!1:(f=t?u<=0?i.length-1:u-1:(u+1)%i.length,this._selectableItemsContainer.select(i[f],!0),i[f]&&i[f].onSelected&&i[f].onSelected(),!0)},t}();n.KeyboardEvtHandler=t}(WSB||(WSB={}));__spreadArrays=this&&this.__spreadArrays||function(){for(var i=0,n=0,r=arguments.length;n<r;n++)i+=arguments[n].length;for(var u=Array(i),f=0,n=0;n<r;n++)for(var e=arguments[n],t=0,o=e.length;t<o;t++,f++)u[f]=e[t];return u},function(n){var t=function(){function t(n,t){this._aggregator=n;this._rootViewModel=t;this._sequenceNumber=-1;this._suggestionsQueue={};this._dataSourcesCompleted={}}return t.prototype.initiateSequenceNumber=function(t,i,r){var u=this,e,o,f,h,s;if(this._sequenceNumber>=t){SharedLogHelper.LogError("initiateSequenceNumber",null,new Error("Unexpected sequence number"));return}for(this.resetStateForNewQuery(t,i),this._highPriorityDataSources=[],this._normalPriorityDataSources=[],this._lowPriorityDataSources=[],e=0,o=n.config.enabledDataSources;e<o.length;e++)f=o[e],h=i.enabledDataSources[f],h&&(n.config.lowPriorityDataSources[f]?this._lowPriorityDataSources.push(f):n.config.highPriorityDataSources[f]?this._highPriorityDataSources.push(f):this._normalPriorityDataSources.push(f));this._HighPriDoneProcessing=this._highPriorityDataSources.length==0;this._highPriorityDataSources.length==0&&this._normalPriorityDataSources.length==0&&this._lowPriorityDataSources.length==0?this.processSuggestions(!1):(s=this.getLatencyTimeout(),s>0&&(this._bufferingTimer=n.safeSetTimeout(function(){u._bufferingTimer=null;u.processSuggestions(!0)},s,"processSuggestionsBuffering"),n.config.dataSourceTimeLimit&&(this._processingTimeoutTimer=n.safeSetTimeout(function(){u._processingTimeoutTimer=null;var t=__spreadArrays(u._highPriorityDataSources.filter(function(t){return!n.contains(u._arrivedDataSources,t)}),u._normalPriorityDataSources.filter(function(t){return!n.contains(u._arrivedDataSources,t)}),u._lowPriorityDataSources.filter(function(t){return!n.contains(u._arrivedDataSources,t)}));SharedLogHelper.LogError("SuggestionsRenderingManager",t.join(","),new Error("Data provider did not complete before the time limit"));u._processingStopped=!0;u._allDataSourcesArrived=!0;u.processSuggestions(!1);r&&r()},n.config.dataSourceTimeLimit,"processSuggestionsTimeout"))))},t.prototype.getLatencyTimeout=function(){return this._partialQuery.queryToFetch?n.config.latencyTimeout:n.config.latencyTimeoutForZeroInput},t.prototype.queueSuggestions=function(t,i,r,u,f){var e;if(t>this._sequenceNumber){SharedLogHelper.LogError("queueSuggestions",null,new Error("Unexpected sequence number"));return}if(!(t<this._sequenceNumber)){if(this._dataSourcesCompleted[i]){SharedLogHelper.LogError("queueSuggestions",i,new Error("Data source already completed"));return}if(!n.contains(this._highPriorityDataSources,i)&&!n.contains(this._normalPriorityDataSources,i)&&!n.contains(this._lowPriorityDataSources,i)){SharedLogHelper.LogError("queueSuggestions",i,new Error("Unexpected data source"));return}this._allDataSourcesArrived||(this._suggestionsQueue[i]&&!this._suggestionsQueue[i].updated?(e=this._suggestionsQueue[i].suggestions).push.apply(e,r):this._suggestionsQueue[i]={suggestions:r,updated:!1},this._dataSourcesCompleted[i]=!f,u&&(this._extraSignalsMap[i]=u),f||this._arrivedDataSources.push(i),this._allDataSourcesArrived=this.haveAllDataSourcesArrived(this._highPriorityDataSources.concat(this._normalPriorityDataSources).concat(this._lowPriorityDataSources)),this._processingStopped||n.InstrumentationHelper.isLayoutLogged(this._sequenceNumber)?this._allDataSourcesArrived&&(this.resetTimers(),n.InstrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber)):this.processSuggestions(!1))}},t.prototype.resetTimers=function(){this._bufferingTimer&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);this._processingTimeoutTimer&&(sb_ct(this._processingTimeoutTimer),this._processingTimeoutTimer=null)},t.prototype.resetStateForNewQuery=function(t,i){this._arrivedDataSources=[];this._allProcessedDataSources={};this._sequenceNumber=t;this._partialQuery=i;this._suggestionsQueue={};this._dataSourcesCompleted={};this._extraSignalsMap={};this._renderedThisSequenceNumber=!1;this._waitingForMoreResults=!0;this._processingStopped=!1;this._allDataSourcesArrived=n.isEmpty(i.enabledDataSources);this.resetTimers()},t.prototype.getDependencies=function(t){var i=this;return n.Host.dataSourceDependencies(t).filter(function(t){return n.isDataSourceEnabled(t,i._partialQuery)})},t.prototype.haveAllDataSourcesArrived=function(t){var i=this;return n.config.mergeQueries&&this._partialQuery.scope==n.Scope.Documents?t.every(function(n){switch(n){case"MPHO":case"MVID":case"MDOC":return!!i._partialQuery.enabledDataSources.MPHO&&!!i._partialQuery.enabledDataSources.MVID&&!!i._partialQuery.enabledDataSources.MDOC&&!!i._partialQuery.enabledDataSources.MPVD;default:return!!i._suggestionsQueue[n]}}):t.every(function(n){return!!i._suggestionsQueue[n]})},t.prototype.haveAllDataSourcesCompleted=function(t){var i=this;return n.config.mergeQueries&&this._partialQuery.scope==n.Scope.Documents?t.every(function(n){switch(n){case"MPHO":case"MVID":case"MDOC":return!!i._partialQuery.enabledDataSources.MPHO&&!!i._partialQuery.enabledDataSources.MVID&&!!i._partialQuery.enabledDataSources.MDOC&&!!i._partialQuery.enabledDataSources.MPVD;default:return!!i._dataSourcesCompleted[n]}}):t.every(function(n){return!!i._dataSourcesCompleted[n]})},t.prototype.processSuggestions=function(t){var i=this,u=[],o=[],r,y=this.getLatencyTimeout()>0&&this._bufferingTimer==null,s=this.haveAllDataSourcesArrived(this._highPriorityDataSources),h=s||y,p=this.haveAllDataSourcesCompleted(this._normalPriorityDataSources),c=this.haveAllDataSourcesCompleted(this._highPriorityDataSources),l=c&&p,a,v;t&&n.InstrumentationHelper.logDataSourceTimeout(Object.keys(this._suggestionsQueue),this._partialQuery);var f=t&&!this._renderedThisSequenceNumber,w=function(t,e){var s;if(!t.updated&&i.getDependencies(e).every(function(t){return n.contains(i._arrivedDataSources,t)})){if(o.push(e),i._allProcessedDataSources[e]=!0,t.suggestions.length>0&&(s=i.canHaveSuppressions(e)?t.suggestions.filter(function(n){return!i.isSuppressed(e,n)}):t.suggestions,s.length>0)){r||(r=i._renderedThisSequenceNumber?i._rootViewModel.getSuggestions(!0):[]);var h=i.removeDuplicatesAndAssignIds(s,r,u,e),c=h[0],l=h[1];u=u.concat(c);l&&(f=!0)}t.updated=!0}},e=function(n){var u,t,r;for(u in n)t=n[u],r=i._suggestionsQueue[t],r&&w(r,t)};h&&e(this._highPriorityDataSources);this._bufferingTimer&&l&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);a=h&&!this._HighPriDoneProcessing;v=a||(this.getLatencyTimeout()>0?this._bufferingTimer==null:s);v&&(e(this._normalPriorityDataSources),e(this._lowPriorityDataSources));this._waitingForMoreResults&&l&&(this._waitingForMoreResults=!1,(!this._renderedThisSequenceNumber||this._rootViewModel.mayNeedFlush()||(r||this._rootViewModel.getSuggestions(!0)).length==0)&&(f=!0));this._partialQuery.showProgressBar&&this._allDataSourcesArrived&&(f=!0);(u.length>0||f)&&(r||(r=this._renderedThisSequenceNumber?this._rootViewModel.getSuggestions(!0):[]),this.addSuggestions(r,u,o,f));this._allDataSourcesArrived&&(this.resetTimers(),n.InstrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber));this._HighPriDoneProcessing=c},t.prototype.getAggregatorResult=function(t,i,r){var e=this.waitingForWebProvider(),f=null,u,o;return n.config.counterFactualLoggingOn&&(f=this._aggregator.rank(i,r,this._extraSignalsMap,this._partialQuery,t,this._sequenceNumber,e,!0)),u=this._aggregator.rank(i,r,this._extraSignalsMap,this._partialQuery,t,this._sequenceNumber,e,!1),o=n.config.counterFactualLoggingOn&&(!this.isSuggestionOrderTheSame(u.topResults,f.topResults)||!this.isSuggestionOrderTheSame(u.suggestionsToAdd,f.suggestionsToAdd)),[u,o]},t.prototype.waitingForWebProvider=function(){var t=this;return n.isBrowserOnline()&&["Web"].concat(this.getDependencies("Web")).some(function(i){return n.isDataSourceEnabled(i,t._partialQuery)&&!t._allProcessedDataSources[i]})},t.prototype.isSuggestionOrderTheSame=function(n,t){var r=function(n){return n.query+"\t"+n.type},i;if(n.length!=t.length)return!1;for(i=0;i<n.length;i++)if(r(n[i])!=r(t[i]))return!1;return!0},t.prototype.addSuggestions=function(t,i,r,u){var e=this,o=this._renderedThisSequenceNumber?this._rootViewModel.getCurrentTopResults():[],v=n.safeExecute(function(){return e.getAggregatorResult(o,t,i)},"getAggregatorResults",[null,!1]),f=v[0],p=v[1],s,h,l,c,a,y;for(f||(f={topResults:o,suggestionsToAdd:i,suggestionsToRemove:[],groupOrder:[]}),n.InstrumentationHelper.instrumentAggregatorCall(this._sequenceNumber,p),i=f.suggestionsToAdd,s=f.suggestionsToRemove,h=0,l=f.topResults;h<l.length;h++)c=l[h],n.contains(t,c)&&!n.contains(o,c)&&s.push(c);(u||i.length!=0||s.length!=0||!n.sequenceEqual(o,f.topResults))&&(a=!this._renderedThisSequenceNumber,a&&(this._renderedThisSequenceNumber=!0,n.InstrumentationHelper.instrumentRenderingStarted(this._sequenceNumber)),y=n.safeExecute(function(){return e._rootViewModel.update(a,f.topResults,e._waitingForMoreResults,e._sequenceNumber,i,s,r,f.groupOrder,e._allDataSourcesArrived,e._extraSignalsMap)},"rootViewModel.update",0,null,function(t){n&&n.fallbackToPrepopulatedBundle&&n.fallbackToPrepopulatedBundle(t)}),y==0&&(this._processingStopped=!0,this.resetTimers()))},t.prototype.removeDuplicatesAndAssignIds=function(t,i,r,u){var f=this,c=function(n){var t;n.id||(n.id=n.path?n.path:n.type+n.text+((t=n.additionalInfoText)!==null&&t!==void 0?t:""))},h=!1,s;if(this._aggregator.canHaveDuplicates(u,this._partialQuery)){var e=[],l=function(s){var v=t[s],a=i.findIndex(function(n){return f._aggregator.mergeDuplicates(f._partialQuery,n,v)}),l;if(a>=0)return l=i[a],l.needsRefreshAfterDeduping&&(h=!0),n.InstrumentationHelper.instrumentDuplicate(o._sequenceNumber,l,v),"continue";if(a=r.findIndex(function(n){return f._aggregator.mergeDuplicates(f._partialQuery,n,v)}),a>=0)return l=r[a],l.needsRefreshAfterDeduping&&(l.needsRefreshAfterDeduping=!1,l.previewPaneNeedsRefreshAfterDeduping=!1),n.InstrumentationHelper.instrumentDuplicate(o._sequenceNumber,l,v),"continue";if(o._aggregator.canHaveDuplicatesWithinDataSource(u,o._partialQuery)&&(a=e.findIndex(function(n){return f._aggregator.mergeDuplicates(f._partialQuery,n,v)}),a>=0))return l=e[a],l.needsRefreshAfterDeduping&&(l.needsRefreshAfterDeduping=!1,l.previewPaneNeedsRefreshAfterDeduping=!1),n.InstrumentationHelper.instrumentDuplicate(o._sequenceNumber,e[a],v),"continue";c(v);e.push(v)},o=this;for(s=0;s<t.length;++s)l(s);return[e,h]}return t.forEach(function(n){return c(n)}),[t,h]},t.prototype.canHaveSuppressions=function(t){return n.config.suppressDataSources[t]||n.config.dataSourcesWithSuppressedTypes[t]},t.prototype.isSuppressed=function(t,i){return n.config.suppressDataSources[t]||n.config.suppressTypes[i.type]},t}();n.SuggestionsRenderingManager=t}(WSB||(WSB={})),function(n){function y(n){return n.handoffType==1?n.query:HitHighlightingParser.removeMarkers(n.text)}function f(n){var t,i;if(n.length==0)return 0;for(t=0,i=0;i<n.length;i++)t=(t<<5)-t+n.charCodeAt(i)|0;return t}function t(n,t){var u,i,r;if(!n)return t.length;if(!t)return n.length;for(u=[],i=0;i<=t.length;i++)u[i]=[i];for(r=0;r<=n.length;r++)u[0][r]=r;for(i=1;i<=t.length;i++)for(r=1;r<=n.length;r++)u[i][r]=t.charAt(i-1)==n.charAt(r-1)?u[i-1][r-1]:Math.min(u[i-1][r-1]+1,Math.min(u[i][r-1]+1,u[i-1][r]+1));return u[t.length][n.length]}function p(n,i){return n&&(n=n.toLocaleLowerCase()),i&&(i=i.toLocaleLowerCase()),t(n,i)}function o(n,t,i){var r=0,u;return(t>0||i>0)&&(t>0&&i>0?(i>t&&(u=t,t=i,i=u),r=n/(t-n+i)):r=Number.MAX_VALUE),r}function s(n,t){var r=n.length,e=t.length,a,v,f,o,i;if(r===0&&e===0)return 1;var h=new Array(r),s=new Array(e),u=0,c=0,l=Math.floor(Math.max(r,e)/2)-1;for(i=0;i<r;i++)for(a=Math.max(0,i-l),v=Math.min(e,i+l+1),f=a;f<=v;f++)if(!s[f]&&n[i]==t[f]){h[i]=!0;s[f]=!0;u++;break}if(u===0)return 0;for(o=0,i=0;i<r;i++)if(h[i]){while(!s[o])o++;n[i]!=t[o]&&c++;o++}return(u/r+u/e+(u-c/2)/u)/3}function w(n,t){var i=s(n,t),r,u;return i<1?i:(r=.1,u=h(n,t),i+u*r*(1-i))}function h(n,t){for(var i=0;i<4;i++)if(n[i]!=t[i])return i;return++i}function b(n,t){return!n||!t?0:n.length+1<=t.length&&t[n.length]==" "?1:n.length==t.length?1:0}function k(n){var r=0,i=1,t;if(n&&n.length>1)for(t=1;t<n.length;t++)n.charAt(t)==n.charAt(t-1)?i++:i=1,i>r&&(r=i);else if(n)return 1;return r}function d(n){return n&&n.length>0?n.trim().split(" ").length:0}function g(n){var t=new RegExp("^[0-9a-zA-Z ]+$");return n&&t.test(n)?1:0}function nt(n){return n&&n.length>0&&n.charAt(n.length-1)==" "?1:0}function tt(n){return n&&n.length>0&&(n.includes("http://")||n.includes("https://")||n.includes("."))?1:0}function it(t,i,r,u){var o,e,s,h;t.includes("?")&&(r[117]=1,ot(t)&&(r[127]=1));t.replace("///","").replace("//","").includes("/")&&(r[118]=1);t.includes(".")&&(r[119]=1);o=u.cvid+u.privacyNumber+t;r[120]=f(o);e=t.toLocaleLowerCase();(e.startsWith("www.")||e.startsWith("http://www.")||e.startsWith("https://www."))&&(r[122]=1);e.startsWith("www.")||e.startsWith("http://")?r[123]=1:e.startsWith("https://")?r[124]=1:e.startsWith("ftp://")?r[125]=1:r[126]=1;i&&(s=n.normalizeUrl(e,15),h=n.normalizeUrl(i,15).toLocaleLowerCase(),s.startsWith(h)&&(r[187]=1))}function rt(n,i,r,u,e){if(e){r[128]=t(e,i);r[129]=e.length;var o=u.cvid+u.privacyNumber+e;r[130]=f(o)}}function ut(n,i,r){var e=n.toLocaleLowerCase(),s,u,f,h,c;if(r[140]=n.length,s=e.split(" "),r[144]=s.length,i)for(r[141]=t(n,i),r[142]=Math.min(100,o(r[141],i.length,n.length)),u=i.toLocaleLowerCase(),e.includes(u)&&(r[143]=1),e.startsWith(u)&&(r[188]=1),f=0,h=s;f<h.length;f++)if(c=h[f],c==u){r[145]=1;break}}function ot(n){var t=et.find(function(t){return n.startsWith(t)});return n=t?n.substr(t.length):n,ft.some(function(t){return n.startsWith(t)})}function st(n){var i=0,r,t;if(n)for(r in n)t=n[r],t&&t.prefixLaunchCount&&(i+=t.prefixLaunchCount);return i}function ht(t,i,r,u){if(r){var f=r[t];f&&(i[47]=f.prefixLaunchCount,i[49]=f.lastLaunchTime,i[101]=u,u>0&&(i[100]=f.prefixLaunchCount/u),f.previewPaneLaunchCount&&f.lastPreviewPaneLaunchTime&&(i[301]=f.previewPaneLaunchCount,f.lastPreviewPaneLaunchTime==f.lastLaunchTime&&(i[302]=1),i[303]=n.getCurrentTime()-f.lastPreviewPaneLaunchTime))}}function ct(n,t,i){if(i){var r=i[n];r&&(t[281]=r.probability,t[282]=r.weight)}}function lt(n,t,r,u,f,e){if(t){var s=i(u,r),o=t[s];o&&(f?(n[153]=o.ProbSugClickGivenPref,n[152]=o.ClicksOnSugGivenPref):e?(n[161]=o.Loglikelihood,n[162]=o.ProbSugClickGivenBackground,n[163]=o.ClicksOnSugGivenPref,n[164]=o.ProbSugClickGivenPref,n[165]=o.CCR,n[166]=o.EventCount,n[293]=o.ProbSugClickGivenPrefTime,n[168]=o.CCRTime,n[294]=o.ProbSugClickGivenBackgroundTime,n[295]=o.LoglikelihoodTime):(n[6]=o.Loglikelihood,n[3]=o.ProbSugClickGivenBackground,n[151]=o.ClicksOnSugGivenPref,n[0]=o.ProbSugClickGivenPref,n[94]=o.CCR,n[95]=o.EventCount,n[290]=o.ProbSugClickGivenPrefTime,n[155]=o.CCRTime,n[291]=o.ProbSugClickGivenBackgroundTime,n[292]=o.LoglikelihoodTime))}}function at(n,t,i){if(t){var r=t[i];r&&(n[256]=r.PSGPCR,n[257]=r.PSGCCR,n[258]=r.PSGSTR,n[286]=r.PSGSATCCR,n[287]=r.PSGSATPCR)}}function i(n,t){return(n+"\t"+t).toLocaleLowerCase()}function r(t,i,r){i==11..toString()&&i==0..toString();switch(n.config.athenaKeyType){case 0:return t||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group is empty")),t;case 1:return i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),i;case 2:return r||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key suggestion type is empty")),i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),r+"_"+i;default:return SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group type is not set")),""}}function u(t,i,r){switch(n.config.athenaKeyType){case 0:return i==t;case 1:return r==t;case 2:return r==t;default:return!1}}function vt(t){var i={};return t?(n.config.athenaKeyType==2?wt(t,i):(yt(t,i),pt(t,i)),i):i}function yt(t,f){var y=t.Suggestions?t.Suggestions.split("\t"):[],p=t.ProbSugClickGivenPrefs?t.ProbSugClickGivenPrefs.split("\t"):[],w=t.ClicksOnSugGivenPrefs?t.ClicksOnSugGivenPrefs.split("\t"):[],b=t.ProbSugClickGivenBackground?t.ProbSugClickGivenBackground.split("\t"):[],k=t.Loglikelihoods?t.Loglikelihoods.split("\t"):[],a=t.SuggestionGroups?t.SuggestionGroups.split("\t"):[],d=t.ProbSugClickGivenPrefWeeks?t.ProbSugClickGivenPrefWeeks.split("\t"):[],v=t.ProbSugClickGivenPrefWeekends?t.ProbSugClickGivenPrefWeekends.split("\t"):[],g=t.ProbSugClickGivenBackgroundWeeks?t.ProbSugClickGivenBackgroundWeeks.split("\t"):[],it=t.ProbSugClickGivenBackgroundWeekends?t.ProbSugClickGivenBackgroundWeekends.split("\t"):[],nt=t.LoglikelihoodWeeks?t.LoglikelihoodWeeks.split("\t"):[],tt=t.LoglikelihoodWeekends?t.LoglikelihoodWeekends.split("\t"):[],c=n.config.athenaKeyType==0||!t.SuggestionHandOffTypes?[]:t.SuggestionHandOffTypes.split("\t"),s=y.length,l=e(),o;if(u(s,a.length,c.length))for(o=0;o<s;o++){var rt=a&&a.length>o?a[o]:"",ut=c&&c.length>o?c[o]:"",ft=r(rt,ut,""),h=i(y[o],ft);f[h]={SuggestionGroup:+a[o]};b.length==s&&(f[h].ProbSugClickGivenBackground=Number(b[o]));p.length==s&&(f[h].ProbSugClickGivenPref=Number(p[o]));w.length==s&&(f[h].ClicksOnSugGivenPref=Number(w[o]));k.length==s&&(f[h].Loglikelihood=Number(k[o]));n.config.athenaKeyType!=0&&c.length==s&&(f[h].SuggestionHandOffType=Number(c[o]));d.length!=s||l?v.length==s&&l&&(f[h].ProbSugClickGivenPrefTime=Number(v[o])):f[h].ProbSugClickGivenPrefTime=Number(d[o]);g.length!=s||l?v.length==s&&l&&(f[h].ProbSugClickGivenBackgroundTime=Number(it[o])):f[h].ProbSugClickGivenBackgroundTime=Number(g[o]);nt.length!=s||l?tt.length==s&&l&&(f[h].LoglikelihoodTime=Number(tt[o])):f[h].LoglikelihoodTime=Number(nt[o])}else SharedLogHelper.LogError("parseLLSignals",null,new Error("Length doesn't match"))}function pt(t,f){var a=t.CCRSuggestions?t.CCRSuggestions.split("\t"):[],l=t.CCRSuggestionGroups?t.CCRSuggestionGroups.split("\t"):[],v=t.CCRs?t.CCRs.split("\t"):[],y=t.EventCounts?t.EventCounts.split("\t"):[],c=n.config.athenaKeyType==0||!t.CCRSuggestionHandOffTypes?[]:t.CCRSuggestionHandOffTypes.split("\t"),p=t.CCRsWeek?t.CCRsWeek.split("\t"):[],w=t.CCRsWeekend?t.CCRsWeekend.split("\t"):[],s=a.length,b=e(),o;if(u(s,l.length,c.length))for(o=0;o<s;o++){var k=l&&l.length>o?l[o]:"",d=c&&c.length>o?c[o]:"",g=r(k,d,""),h=i(a[o],g);f[h]||(f[h]={SuggestionGroup:Number(l[o])});v.length==s&&(f[h].CCR=Number(v[o]));y.length==s&&(f[h].EventCount=Number(y[o]));n.config.athenaKeyType!=0&&c.length==s&&(f[h].CCRSuggestionHandOffType=Number(c[o]));p.length!=s||b?w.length==s&&b&&(f[h].CCRTime=Number(w[o])):f[h].CCRTime=Number(p[o])}else SharedLogHelper.LogError("parseCCRSignals",null,new Error("Length doesn't match"))}function wt(n,t){var o=n.SugTypes?n.SugTypes.split("\t"):[],s=n.HandOffTypes?n.HandOffTypes.split("\t"):[],h=n.PSGPCRs?n.PSGPCRs.split("\t"):[],c=n.PSGCCRs?n.PSGCCRs.split("\t"):[],l=n.PSGSTRs?n.PSGSTRs.split("\t"):[],a=n.PSGSATCCRs?n.PSGSATCCRs.split("\t"):[],v=n.PSGSATPCRs?n.PSGSATPCRs.split("\t"):[],f=o.length,i;if(u(f,0,s.length))for(i=0;i<f;i++){var y=o[i],p=s[i],e=r("",p,y);t[e]={};h.length==f&&(t[e].PSGPCR=Number(h[i]));c.length==f&&(t[e].PSGCCR=Number(c[i]));l.length==f&&(t[e].PSGSTR=Number(l[i]));a.length==f&&(t[e].PSGSATCCR=Number(a[i]));v.length==f&&(t[e].PSGSATPCR=Number(v[i]))}else SharedLogHelper.LogError("parseGroupEngagementSignals",null,new Error("Length doesn't match"))}function bt(n,t){var r={},f,s,o,i;if(t){var h=0,v=0,u={};for(f=0,s=t;f<s.length;f++){var y=s[f],e=y.key,p=y.value;u[e]={lexicalSimilarity:0,groupClickCounts:{},groupWeight:{}};v+=c(u,e,n);o=a(p);u[e].groupClickCounts=o.groupLaunches;for(i in u[e].groupClickCounts)r[i]||(r[i]={probability:0,weight:0}),r[i].probability+=o.groupHits[i],h+=o.groupHits[i]}l(r,u,v,h)}return r}function kt(n,t){var r={},f,o,i;if(t){var h=0,a=0,u={};for(f=0,o=t;f<o.length;f++){var v=o[f],s=v.key,e=v.value;u[s]={lexicalSimilarity:0,groupClickCounts:{},groupWeight:{}};a+=c(u,s,n);for(i in e)e[i]&&e[i].prefixLaunchCount&&(r[i]||(r[i]={probability:0,weight:0}),u[s].groupClickCounts[i]=e[i].prefixLaunchCount,r[i].probability++,h++)}l(r,u,a,h)}return r}function c(n,t,i){var r=t.length-i.length,u=r/t.length;return n[t].lexicalSimilarity=1-u,n[t].lexicalSimilarity}function l(n,t,i,r){var o=0,s,e,f,u;for(e in t){f=t[e];f.lexicalSimilarity/=i;for(u in f.groupClickCounts)s=f.groupClickCounts[u],f.groupWeight[u]=s*f.lexicalSimilarity,o+=f.groupWeight[u]}for(u in n)n[u].probability/=r;for(e in t){f=t[e];for(u in f.groupClickCounts)n[u]||(n[u]={probability:0,weight:0}),f.groupWeight[u]/=o,n[u].weight+=f.groupWeight[u]}}function a(n){var u=function(n,t,i){return n[t]=n[t]?n[t]+i:i},r={groupLaunches:{},groupHits:{},otherGroupLaunches:0},f,t,i;for(f in n)(t=n[f],t&&t.prefixLaunchCount)&&(i=t.groupType,i||i===0?(u(r.groupLaunches,i,t.prefixLaunchCount),u(r.groupHits,i,1)):r.otherGroupLaunches+=t.prefixLaunchCount);return r}function dt(n,t,i,r){if(r){var f=i(t),u=r[f];u&&(n[266]=u.probability,n[267]=u.weight)}}function e(t){var i=t?t.getDay():n.getCurrentDate().getDay();return i==6||i==0}function gt(n){for(var t in n)n[t]?n[t]=v(Number(n[t])):delete n[t]}function v(n){return Number(n.toFixed(5))}function ni(n,t){n.featureStore||(n.featureStore={});n.featureStore[t]=1}n.getTextForLexicalFeatures=y;n.stringHashCode=f;n.getEditDistance=t;n.getEditDistanceIgnoreCase=p;n.computeEditDistanceRatio=o;n.computeJaroSimilarity=s;n.computeJaroWinklerSimilarity=w;n.computeJaroWinklerPrefixOverLapCount=h;n.isWordBoundary=b;n.countMaxContiguousRepeatedChars=k;n.getNumberOfWords=d;n.containsOnlyDigitsLettersOrSpaces=g;n.endsWithSpace=nt;n.prefixIsLikeUrl=tt;n.computeUrlFeatures=it;n.computeDomainFeatures=rt;n.computeTitleFeatures=ut;var ft=["www.bing.","cn.bing.","www.google.","www.yandex.","www.baidu.","www.yahoo.",],et=["http://","https://",];n.getSumMruLaunches=st;n.setMRUSignal=ht;n.setMRUBackPropSignal=ct;n.setEngagementSignals=lt;n.setSuggestionGroupEngagementSignals=at;n.getEngagementSignalKey=i;n.getAthenaGroupKey=r;n.checkAthenaGroupLength=u;n.parseWebEngagementSignals=vt;n.computeGroupBackpropagatedClicks=bt;n.computeSuggestionBackpropagatedClicks=kt;n.evaluateGroupLaunches=a;n.setMRUGroupBackpropClicks=dt;n.isWeekend=e;n.removeUndefinedAndZeroAndTrimValues=gt;n.trimFeatureStoreValue=v;n.setFlagInFeatureStore=ni}(WSB||(WSB={})),function(n){var t;(function(t){function u(n){return n.isSearchHomeZI}var i=.4,r;t.suggestionRankingModels={};r=function(){function r(){}return r.prototype.rank=function(t,i,r,f,e,o,s,h,c,l){var a,v,y,p;return u(t)?{topResults:[],mruSuppressions:null}:t.scope==n.Scope.PathCompletion?this.rankPathCompletion(i):(a=n.isL2(t)?null:{mruGroupRatios:null,maxGroupCCR:null,maxGroupProbSugClickGivenPref:null,mruGroupBackpropWeights:null,mruGroupBackpropRatios:null},v=i.slice(),this.orderSuggestions(t,i,r,f,o,s,h,c,a,e),this.setMRUHintEnabled(t,i),this.setGroupSuppressionSignals(a,i),y=this.getTopHitCandidates(t,i,l.searchTheWeb,v),p=this.createMulticlassClassifierTopHitSuggestionList(y),{topResults:p,mruSuppressions:a})},r.prototype.isNotChromeIntent=function(n,t){var r="google chrome",i;return t.length==0?!1:(i=t.filter(function(n){return n.query.toLocaleLowerCase()==r&&n.type=="PP"}),i.length>0&&!n.queryToFetch.includes("c")&&!n.queryToFetch.includes("h")&&!n.queryToFetch.includes("r")&&!n.queryToFetch.includes("m"))?!0:!1},r.prototype.setMRUHintEnabled=function(t,i){var f,r,u;if(n.config.enableMRUHint)for(f=t.queryToFetch.toLocaleLowerCase(),r=0;r<i.length;r++)u=i[r].featureStore,u[281]&&u[282]&&(n.config.enableMRUHint!=1&&i[r].text.toLocaleLowerCase().startsWith(f)||(i[r].mruHintEnabled=!0))},r.prototype.rankPathCompletion=function(n){var t=n.find(function(n){return n.type=="CG"})||n[0];return{topResults:t?[t]:[],mruSuppressions:null}},r.prototype.swapHighConfidenceTopHit=function(t){var o={minimum:0,penalty:.1},s={minimum:.08,penalty:.05},h={minimum:.01,penalty:.05},c={minimum:.45,penalty:.9},e=function(n){var t=-5;return(n-t)/(8-t)},r=t[0],f=0,u,i;if(!(t.length<=1)&&!(r.simpleFeatures.mruScore>0)){for(u=0;u<t.length;u++)i=t[u],n.isApp(i.type)?(i.simpleFeatures.topHitScore=e(-.45052*i.simpleFeatures.ciGeoMeanScoreNormalized+.15451*i.simpleFeatures.ciGlobalScore+-.34223*i.simpleFeatures.ciLocalScore+-.18174*i.simpleFeatures.ciMatchScore+3.9928),!n.isApp(r.type)&&i.simpleFeatures.topHitScore>o.minimum&&i.simpleFeatures.topHitScore>r.simpleFeatures.topHitScore+o.penalty&&(r=i,f=u)):n.isSetting(i.type)?(i.simpleFeatures.topHitScore=e(-.42912*i.simpleFeatures.ciGeoMeanScoreNormalized+-.0173*i.simpleFeatures.ciLocalScore+-.1516*i.simpleFeatures.ciMatchScore+.28754),!n.isSetting(r.type)&&i.simpleFeatures.topHitScore>s.minimum&&i.simpleFeatures.topHitScore>r.simpleFeatures.topHitScore+s.penalty&&(r=i,f=u)):n.isFileOrFolder(i.type)?(i.simpleFeatures.topHitScore=e(.99907*i.simpleFeatures.startsWithPrefix+1.1431*i.simpleFeatures.containsPrefix+3.1153*i.simpleFeatures.jaroWinklerScore+-3.9697),r==i&&(i.simpleFeatures.topHitScore=0),!n.isFileOrFolder(r.type)&&i.simpleFeatures.topHitScore>c.minimum&&i.simpleFeatures.topHitScore>r.simpleFeatures.topHitScore+c.penalty&&(r=i,f=u)):n.isWebSuggestion(i)||i.type=="MB"||i.isAnswer?(i.simpleFeatures.topHitScore=e(5.3465*i.simpleFeatures.webConfidence+-5.6972),(!n.isWebSuggestion(r)&&i.simpleFeatures.topHitScore>h.minimum&&i.simpleFeatures.topHitScore>r.simpleFeatures.topHitScore+h.penalty||i.type=="MB"&&n.isWebSuggestion(r))&&(r=i,f=u)):(i.type=="PT"||i.type=="CG")&&(r=i,f=u);f!=0&&(t.unshift(r),t.splice(f+1,1))}},r.prototype.extractSimpleFeatures=function(t){var i=t.featureStore,f=64,r=0,u={mruScore:i[282]||r,sugTypeBucket:10,ciGeoMeanScoreNormalized:Math.floor(i[405]/1e3)||f,ciGlobalScore:i[269]/1e3||f,ciLocalScore:i[270]/1e3||f,ciMatchScore:Math.floor(i[158]/1e3)||0,rank:Math.floor(i[16]/1e3)||128,webScore:this.getSuggestionScoreFromSuggestionLogMeta(t.suggestionLogMeta)||r,webConfidence:i[17]||r,prefixEqualsSuggestion:i[133]||r,startsWithPrefix:i[188]||r,containsPrefix:i[143]||r,jaroWinklerScore:i[421]||r,topHitScore:r};return u.sugTypeBucket=n.isApp(t.type)?0:n.isSetting(t.type)?1:n.isFileOrFolder(t.type)?2:t.type=="MB"?3:n.isWebSuggestion(t)?4:5,t.type=="IBA"&&i[269]<1&&(u.ciGeoMeanScoreNormalized=64),u.ciMatchScore==0&&u.startsWithPrefix==0&&u.sugTypeBucket<=1&&(u.ciMatchScore+=1),u},r.prototype.orderSuggestions=function(i,r,u,f,e,o,s,h,c,l){var g=this,v,p,y,b,k,w,d,a;if(n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBRanking.orderSuggestions"),!n.config.bypassRankerOnNoNewSuggestions||i.hasNewSuggestions){if(v=n.safeExecute(function(){return g.createFeatureStore(i,r,u,f,e,o,s,c,l)},"createFeatureStore"),v=v||r.map(function(){return{}}),y=h?n.config.counterFactualRankerId:n.config.mainRankerId,y?(p=n.safeExecute(function(){return t.suggestionRankingModels[y]},"getRanker"),p||SharedLogHelper.LogError("getRanker",y,new Error("Model not found"))):SharedLogHelper.LogError("getRanker",y,new Error(h?"CounterFactualRankerId not defined ":"MainRankerId not defined")),n.config.enableSimpleRanker){for(a=0;a<r.length;a++)b=v[a],r[a].featureStore=b,r[a].simpleFeatures=this.extractSimpleFeatures(r[a]);for(n.config.enableMatchQueryDemotions?r.sort(function(n,t){return t.simpleFeatures.mruScore-n.simpleFeatures.mruScore||n.simpleFeatures.sugTypeBucket-t.simpleFeatures.sugTypeBucket||Math.floor(n.simpleFeatures.ciMatchScore/10)-Math.floor(t.simpleFeatures.ciMatchScore/10)||n.simpleFeatures.ciGeoMeanScoreNormalized-t.simpleFeatures.ciGeoMeanScoreNormalized||n.simpleFeatures.rank-t.simpleFeatures.rank||t.simpleFeatures.prefixEqualsSuggestion-n.simpleFeatures.prefixEqualsSuggestion||t.simpleFeatures.startsWithPrefix-n.simpleFeatures.startsWithPrefix||t.simpleFeatures.containsPrefix-n.simpleFeatures.containsPrefix||t.simpleFeatures.jaroWinklerScore-n.simpleFeatures.jaroWinklerScore}):r.sort(function(n,t){return t.simpleFeatures.mruScore-n.simpleFeatures.mruScore||n.simpleFeatures.sugTypeBucket-t.simpleFeatures.sugTypeBucket||n.simpleFeatures.ciGeoMeanScoreNormalized-t.simpleFeatures.ciGeoMeanScoreNormalized||n.simpleFeatures.ciMatchScore-t.simpleFeatures.ciMatchScore||n.simpleFeatures.rank-t.simpleFeatures.rank||t.simpleFeatures.prefixEqualsSuggestion-n.simpleFeatures.prefixEqualsSuggestion||t.simpleFeatures.startsWithPrefix-n.simpleFeatures.startsWithPrefix||t.simpleFeatures.containsPrefix-n.simpleFeatures.containsPrefix||t.simpleFeatures.jaroWinklerScore-n.simpleFeatures.jaroWinklerScore}),a=0;a<r.length;a++)r[a].rankingScore=-a;this.swapHighConfidenceTopHit(r)}else if(p)for(k=function(t){var i=v[t],u;if(n.config.enableConversationCache&&r[t].skipRerank)return"continue";u=n.safeExecute(function(){return p(i)},"calculateRankingScore");r[t].rankingScore=n.trimFeatureStoreValue(u);r[t].featureStore=i;n.config.enableConversationCache&&(r[t].skipRerank=!0)},a=0;a<r.length;a++)k(a);if(w=r.filter(function(n){return n.type=="MB"}),n.config.enableSimpleRanker||r.sort(function(n,t){return t.rankingScore-n.rankingScore}),w.length>1)for(d=r.map(function(n,t){return n.type=="MB"?t:undefined}).filter(function(n){return typeof n=="number"}),a=0;a<w.length;++a)r[d[a]]=w[a];n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.orderSuggestions")}},r.prototype.getSuggestionScoreFromSuggestionLogMeta=function(n){var t=";2152:";return n&&n.indexOf(t)>=0?parseInt(n.substring(n.indexOf(t)+6).split(";")[0].slice(1,-1)):NaN},r.prototype.getTopWebSuggestion=function(t){var f,e,i,o,r,u;if(t.length==0)return null;if(n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBRanking.getTopWebSuggestion"),f=t[0],e=64e3,t.length>1)for(i=0,o=t;i<o.length;i++)r=o[i],r.suggestionLogMeta&&(u=this.getSuggestionScoreFromSuggestionLogMeta(r.suggestionLogMeta),!isNaN(u)&&u<e&&(e=u,f=r));return n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopWebSuggestion"),f},r.prototype.bypassFallbackForMSB=function(t,i,r){return(n.config.bypassFallbackOnMSBTopHit==2||n.config.bypassFallbackOnMSBTopHit==3)&&i.every(function(t){return n.isWebSuggestion(t)||t.handoffType==17||t.isAnswer})?!0:(n.config.bypassFallbackOnMSBTopHit==1||n.config.bypassFallbackOnMSBTopHit==4)&&!i.some(function(t){return n.isApp(t.type)||n.isSetting(t.type)})&&r.length>0&&n.isMsbOnlineSuggestionType(r[0].type)?!0:n.config.bypassFallbackOnMSBTopHit==4&&!i.some(function(t){return n.isApp(t.type)||n.isSetting(t.type)})&&r.length>1&&(r[0].isAnswer||n.isWebSuggestion(r[0]))&&(n.isMsbOnlineSuggestionType(r[1].type)||r.length>2&&r[0].isAnswer&&r[1].isAnswer&&n.isMsbOnlineSuggestionType(r[2].type))?!0:!1},r.prototype.getTopHitCandidates=function(t,r,u,f){var l=this,e,h,o,s,c;return(n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBRanking.getTopHitCandidates"),e=r.filter(function(n){return l.allowInTopHit(t,n,f)}),this.bypassFallbackForMSB(t,r,e,f)&&(h=[],o=f.filter(function(t){return n.isOnlineSuggestionPersonType(t.type)}),o.length==0&&(o=f.filter(function(t){return n.isOnlineSuggestionMsbOtherTypes(t.type)})),o.length>0&&o[0].autoOpenPreviewPaneWhenOnTopHit&&(n.config.bypassFallbackOnMSBTopHit!=3||n.getTextForLexicalFeatures(o[0]).toLowerCase().startsWith(t.queryToFetch.toLowerCase()))&&h.push(o[0]),n.config.bypassFallbackOnMSBTopHit==4&&(e[0].isAnswer||n.isWebSuggestion(e[0]))&&(e[0].isAnswer||this.getFallbackClassifierScore(e[0])>i)&&h.push(e[0]),n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopHitCandidates"),h.length>0))?h:this.enableFallbackClassifier(t,e,u)?(e=this.getFallbackClassifierSuggestions(e),n.config.enableGGSupp&&this.isNotChromeIntent(t,e))?(n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopHitCandidates"),[]):(n.config.demoteWebForApps&&(s=this.getTopAppSuggestion(r),c=s?s.query.toLocaleLowerCase():"",s&&this.allowInTopHit(t,s)&&e.every(function(t){return n.isWebSuggestion(t)})&&(c.startsWith(t.queryToFetch)||c.includes(" "+t.queryToFetch))&&(e=[s])),n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopHitCandidates"),e):(n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopHitCandidates"),e)},r.prototype.getFallbackClassifierScore=function(i){var r=n.safeExecute(function(){return t.suggestionRankingModels[n.config.fallbackClassifierId]},"getFallbackClassifier"),u=r?n.safeExecute(function(){return r(i.featureStore)},"calculateFallbackClassifierScore"):0;return n.trimFeatureStoreValue(u)},r.prototype.getFallbackClassifierSuggestions=function(r){if(r=r.filter(function(n){return n.type!="SW"}),r.length>0){var f=0,u=r[0];return u.fbcScore=this.getFallbackClassifierScore(u),f=n.config.enableAppsSettingsFbcScoreThreshold?n.isApp(u.type)||n.isSetting(u.type)?n.config.appsSettingsFbcScoreThreshold:n.isWebSuggestion(u)?i:n.config.nonWebFbcScoreThreshold:n.isWebSuggestion(u)?i:n.config.nonWebFbcScoreThreshold,u.fbcScore>=f?r.slice(0,t.topHitIsMultiEntity(r)?2:1):[]}return[]},r.prototype.enableFallbackClassifier=function(t,i,r){if(r&&n.config.fallbackClassifierId&&i.length>0){var u=i[0];return n.getGroupType(u)==n.GroupType.Cortana?!1:u.isAnswer?!1:!0}return!1},r.prototype.getTopAppSuggestion=function(t){for(var u,i=0,r=t;i<r.length;i++)if(u=r[i],n.isApp(u.type))return u;return null},r.prototype.isRecourse=function(t){return t.notAResult&&!n.contains(["SW","PWL","SSTS"],t.type)},r.prototype.allowInTopHit=function(t,i,r){var s=!r||r.length==1,e,f,o,u;if(n.RuntimeConfig.QfMode==8||n.config.demoteTopHitOnNoQueryMatch&&(n.isApp(i.type)||n.isSetting(i.type))&&!i.ciMatchedQuery&&!i.query.toLocaleLowerCase().includes(t.queryToFetch.toLocaleLowerCase()))return!1;if(t.topHitRestriction==1&&i.query.toLocaleLowerCase()!=t.queryToFetch.toLocaleLowerCase()&&(n.contains(i.features,"ForcePrefixOnTop")||i.features.push("ForcePrefixOnTop")),this.isRecourse(i))return s;e=n.getGroupType(i);switch(e){case n.GroupType.Store:return i.hc;case n.GroupType.Command:return i.hc||s;case n.GroupType.LocalPlaces:return!1}if(n.getScope(e)==n.Scope.Emails&&!i.hc)return!1;if(n.enforceOriginalOrder(i)&&r)for(f=0,o=r;f<o.length;f++){if(u=o[f],u==i)break;if(u.type==i.type&&u.handoffType==i.handoffType&&u.sourceForGroup==i.sourceForGroup)return!1}return n.RuntimeConfig.AlwaysWide&&!i.previewPaneType?!1:!0},r.prototype.createMulticlassClassifierTopHitSuggestionList=function(i){for(var r=0,u=0;u<Math.min(i.length,n.config.maxNumberOfTopResults);u++)i[u].rankingScore!==undefined&&i[u].rankingScore>.5&&(r=u);return r==0&&t.topHitIsMultiEntity(i)&&(r=1),n.config.bypassFallbackOnMSBTopHit==4&&i.length>0&&n.isMsbOnlineSuggestionType(i[0].type)&&(r=1),i.slice(0,r+1)},r.prototype.createFeatureStore=function(t,i,r,u,f,e,o,s,h){var st=[],nt=0,ht=0,tt=0,ct=t.queryToFetch.toLocaleLowerCase(),bt=function(t){return n.getGroupType(t)},lt=n.getSumMruLaunches(u),at=0,vt={},it,rt,yt,k,ut,v,y,l,p,d,ft,et,w,g,ot,a,c,b,pt,wt;for(u&&(it=n.evaluateGroupLaunches(u),at=it.otherGroupLaunches,vt=it.groupLaunches),rt=n.computeGroupBackpropagatedClicks(t.queryToFetch,h),yt=n.computeSuggestionBackpropagatedClicks(t.queryToFetch,h),k=0,ut=i;k<ut.length;k++)v=ut[k],v.handoffType==2&&(y=n.getAppItem(v),y&&(ht+=y.totalLaunches,y.totalLaunches>nt&&(nt=y.totalLaunches)),v.deviceItem&&v.deviceItem.rankScore>tt&&(tt=v.deviceItem.rankScore));for(l={},n.isWeekend()&&(l[440]=1),l[441]=this.getLocalHourBucket(new Date),p=ct.split(" "),d=0,ft=p;d<ft.length;d++){if(et=ft[d],et=="install"){l[451]=1;break}if(et=="uninstall"){l[450]=1;break}}for(p&&p.length>0&&(w=p[0],l[452]=w.indexOf("c:")>-1||w.indexOf("d:")>-1||w.indexOf("e:")>-1||w.indexOf("f:")>-1?1:0),g=0,ot=i;g<ot.length;g++)a=ot[g],c=this.getSuggestionFeatureStore(ct,a,f,r,ht,o),c[13]=nt,c[7]=tt,r&&r.WebSignalsAvailable&&(c[93]=1),n.setMRUSignal(n.getSuggestionKey(a),c,u,lt),this.setMRUGroupLaunchRatios(c,a,lt,vt,at,s),n.setMRUBackPropSignal(n.getSuggestionKey(a),c,yt),rt&&n.setMRUGroupBackpropClicks(c,a,bt,rt),b=n.getTextForLexicalFeatures(a),b&&(a.handoffType==1&&(n.computeUrlFeatures(b,t.queryToFetch,c,e),pt=n.getDomain(b),n.computeDomainFeatures(a,t.queryToFetch,c,e,pt,f)),n.isFileOrFolder(a.type)&&(wt=e.cvid+e.privacyNumber+b,c[131]=n.stringHashCode(wt))),l&&(c[440]=l[440],c[441]=l[441],c[451]=l[451],c[450]=l[450],c[452]=l[452]),n.removeUndefinedAndZeroAndTrimValues(c),st.push(c);return st},r.prototype.setGroupSuppressionSignals=function(t,i){var f,e,u;if(t)for(t.maxGroupCCR={},t.maxGroupProbSugClickGivenPref={},t.mruGroupBackpropRatios={},t.mruGroupBackpropWeights={},f=0,e=i;f<e.length;f++)if(u=e[f],u.featureStore){var r=n.getGroupType(u),o=u.featureStore[94]||0,s=u.featureStore[0]||0;t.maxGroupCCR[r]=t.maxGroupCCR[r]?Math.max(t.maxGroupCCR[r],o):o;t.maxGroupProbSugClickGivenPref[r]=t.maxGroupProbSugClickGivenPref[r]?Math.max(t.maxGroupProbSugClickGivenPref[r],s):s;t.mruGroupBackpropRatios[r]=u.featureStore[266];t.mruGroupBackpropWeights[r]=u.featureStore[267];(t.mruGroupBackpropWeights[r]||t.mruGroupBackpropRatios[r])&&(t.backPropDataExists=!0)}},r.prototype.setMRUGroupLaunchRatios=function(t,i,r,u,f,e){var s,o;if(r){e&&(e.mruGroupRatios={});t[186]=f/r;for(s in u){o=u[s]/r;n.getGroupType(i)==Number(s)&&(t[271]=o);e&&(e.mruGroupRatios[s]=o);switch(Number(s)){case n.GroupType.Apps:t[169]=o;break;case n.GroupType.Settings:t[170]=o;break;case n.GroupType.Cortana:t[171]=o;break;case n.GroupType.Command:t[172]=o;break;case n.GroupType.Photos:t[173]=o;break;case n.GroupType.Videos:t[174]=o;break;case n.GroupType.Music:t[175]=o;break;case n.GroupType.Documents:t[176]=o;break;case n.GroupType.Folders:t[177]=o;break;case n.GroupType.Emails:t[178]=o;break;case n.GroupType.Store:t[179]=o;break;case n.GroupType.SearchSuggestions:t[262]=o;t[180]=u[n.GroupType.Websites]?(u[n.GroupType.Websites]+u[s])/r:o;break;case n.GroupType.Websites:t[263]=o;t[180]=u[n.GroupType.SearchSuggestions]?(u[n.GroupType.SearchSuggestions]+u[s])/r:o;break;case n.GroupType.PathCompletion:t[181]=o;break;case n.GroupType.People:t[184]=o;break;case n.GroupType.Bookmarks:t[260]=o;break;case n.GroupType.LocalPlaces:t[261]=o}}}},r.prototype.getRank=function(t){if(t.deviceItem&&typeof t.deviceItem.rankScore!="undefined")return t.deviceItem.rankScore;var i=n.isJumpListSuggestion(t)?t.jumpListItem.usagePoints:undefined;return typeof i!="undefined"?i:undefined},r.prototype.getSuggestionFeatureStore=function(t,i,r,u,f,e){var o={},c,b,l,a,v,y,h,s,k,nt,p,d,tt,w,g;if(this.setTypeSignal(i,o),c=n.getAppItem(i),c?(o[2]=c.totalLaunches,o[92]=c.launchArguments?1:0,f>0&&(o[103]=c.totalLaunches/f),this.addLastAccessDate(c.lastAccessed,o)):this.addLastAccessDate(n.isJumpListSuggestion(i)?i.jumpListItem.lastAccessed:null,o),o[99]=i.confidence,o[150]=i.source,o[283]=i.pinnedToTaskbar?1:undefined,i.hc&&(o[189]=1),o[17]=i.highConfidenceMetaSuggestionScore,b=this.getRank(i),typeof b!="undefined"?o[16]=b:o[4]=1,l=i,l.matchedOnlyOnContent&&(o[259]=1),l.matchedOnlyOnAuthor&&(o[273]=1),l.lastModifiedDate&&(o[268]=n.getTimeDiffInDays(l.lastModifiedDate)),l.extensionLC==".lnk"&&(o[272]=1),o[23]=i.prefetchConfidenceScore,o[264]=u&&u.ProbNextKS!==undefined?u.ProbNextKS:1,o[296]=u&&u.ProbNextKSV2!==undefined?u.ProbNextKSV2:1,this.setThresholdRatios(o,u),this.setRatios(o,u),a=n.getGroupType(i),v=i.query,i.type=="SW"&&(v="SearchTheWeb"),y=n.getAthenaGroupKey(String(a),String(i.handoffType),i.type),n.setEngagementSignals(o,r,y,v,!1,!1),n.setEngagementSignals(o,e,y,v,!1,!0),e&&!r&&n.setEngagementSignals(o,e,y,v,!1,!1),o[10]=t.length,(i.isAnswer||a==n.GroupType.Cortana)&&(o[11]=1),h=n.getTextForLexicalFeatures(i),s=h?h.toLocaleLowerCase():null,h||(o[132]=1),s==t&&(o[133]=1),i.handoffType==2&&(o[8]=1,n.isSetting(i.type)&&(o[64]=1),n.isApp(i.type)&&(o[83]=1)),a==n.GroupType.SearchSuggestions&&(i.type!="SW"&&(o[82]=1),o[25]=1),k=o[132]==1,k?o[137]=t.length:(o[137]=h.length,o[134]=n.getEditDistance(t,s),o[135]=Math.min(100,n.computeEditDistanceRatio(o[134],t.length,h.length)),o[136]=n.isWordBoundary(t,h),o[284]=Math.abs(h.length-t.length)),!k&&s){for(s.indexOf(t)>-1&&(o[143]=1),s.substring(0,t.length)===t&&(o[188]=1),nt=s.split(" "),p=0,d=nt;p<d.length;p++)if(tt=d[p],tt==t){o[145]=1;break}o[420]=n.computeJaroSimilarity(t,s);o[421]=n.computeJaroWinklerSimilarity(t,s)}return o[1]==1&&i.deviceItem&&(w=n.getAppItem(i),w.extension&&(o[400]=w.extension===".exe"?1:0,o[401]=w.extension===".appref-ms"?1:0),s&&(o[402]=s.indexOf("install")>-1?1:0)),o[1]||i.type!="FL"&&i.type!="FD"&&i.type!="ST"||(o[403]=1),(i.type=="QP"||i.type=="QS"||i.type=="SC"||i.type=="OS")&&(o[404]=1),o[8]==1&&(o[27]=o[133]),(i.isAnswer||a==n.GroupType.Cortana)&&(o[55]=o[133]),(i.type=="HS"||i.fromHistory)&&(o[121]=1),o[41]=o[83]==1?o[40]:o[64]==1?o[39]:o[11]==1?o[32]:o[89]==1?o[54]:o[85]==1?o[30]:o[86]==1?o[53]:o[87]==1?o[52]:o[61]==1?o[31]:o[88]==1?o[51]:o[63]==1?o[35]:o[82]==1?o[29]:o[90]==1?o[50]:o[59]==1?o[34]:o[37],(n.isSetting(i.type)||n.isApp(i.type))&&(g=i.ciMetaData,this.computeConstraintIndexFeatures(i.deviceItem,o,g),i.ciMatchedQuery=this.getConstraintIndexMatchedQuery(g),o[269]&&o[270]&&(o[405]=Math.sqrt(o[269]*o[270]))),i.signals&&(o[230]=i.signals.DistanceToEntity,o[231]=i.signals.DistanceToEntityPrecision,o[232]=i.signals.RankingScore),o},r.prototype.addLastAccessDate=function(t,i){var r=n.getTimeDiffInDays(t);r!=null?i[9]=r:i[19]=1},r.prototype.setTypeSignal=function(n,t){switch(n.type){case"LDOC":case"FL":t[61]=1;break;case"LI":t[85]=1;break;case"LV":t[86]=1;break;case"MU":t[87]=1;break;case"FD":t[88]=1;break;case"CG":t[89]=1;break;case"PT":t[90]=1;break;case"PP":case"IBA":t[1]=1;break;case"ML":case"MD":t[21]=1;break;case"SW":t[59]=1}},r.prototype.setRatios=function(n,t){t&&t.AppsRatio!==undefined&&(n[26]=t.AppsRatio,t.SettingsRatio&&(n[5]=t.SettingsRatio),t.StoreRatio&&(n[57]=t.StoreRatio),t.PrefixProbability&&(n[12]=t.PrefixProbability),t.FilesRatio&&(n[24]=t.FilesRatio),t.WebRatio&&(n[18]=t.WebRatio),t.PhotosVideosMusicRatio&&(n[28]=t.PhotosVideosMusicRatio),t.ContactsRatio&&(n[56]=t.ContactsRatio),t.LocalProtocolRatio&&(n[91]=t.LocalProtocolRatio))},r.prototype.setThresholdRatios=function(n,t){t&&t.ThApps!==undefined?(n[40]=t.ThApps,t.ThStore&&(n[35]=t.ThStore),t.ThSetting&&(n[39]=t.ThSetting),t.ThCortAns&&(n[32]=t.ThCortAns),t.ThPrefixCount&&(n[38]=t.ThPrefixCount),t.ThWeb&&(n[29]=t.ThWeb),t.ThSearchTheWeb&&(n[34]=t.ThSearchTheWeb),t.ThOther&&(n[37]=t.ThOther),t.ThFile&&(n[31]=t.ThFile),t.ThFolder&&(n[51]=t.ThFolder),t.ThPath&&(n[50]=t.ThPath),t.ThEmail&&(n[33]=t.ThEmail),t.ThCommAns&&(n[54]=t.ThCommAns),t.ThPhotoAns&&(n[30]=t.ThPhotoAns),t.ThVideoAns&&(n[53]=t.ThVideoAns),t.ThMusicAns&&(n[52]=t.ThMusicAns),t.ThDNav&&(n[147]=t.ThDNav)):n[42]=1},r.prototype.computeConstraintIndexFeatures=function(n,t,i){var u,o,f,e,s,r;if(n&&n.rawIndexResponse){if(!i)return;if(t[157]=i.GrammarScore,t[158]=i.MatchScore,i.Parses&&i.Parses.length>0&&i.Parses[0].Entities&&i.Parses[0].Entities.length>0)for(u=0,o=i.Parses[0].Entities;u<o.length;u++)if(f=o[u],t[159]=f.EntityScore,f.Attributes)for(e=0,s=f.Attributes;e<s.length;e++)r=s[e],r.Name=="gscore"?t[269]=Number(r.Value):r.Name=="lscore"&&(t[270]=Number(r.Value))}},r.prototype.getConstraintIndexMatchedQuery=function(n){return!n||n.MatchScore==0?null:n.Query},r.prototype.getLocalHourBucket=function(n){var t=n.getHours(),i=1;return t>=0&&t<6?i=1:t>=6&&t<12?i=2:t>=12&&t<18?i=3:t>=18&&t<=23&&(i=4),i},r}();t.FastRankRanker=r})(t=n.Ranking||(n.Ranking={}))}(WSB||(WSB={})),function(n){var t=function(){function t(t){var i=this;this._instrumentationProvider=t;n.Host.bindDismissed(function(){return i.flushAggregatedMeasure(!0)})}return t.prototype.onNewKeystroke=function(n,t,i){this.flushAggregatedMeasure();this._aggregatedMeasureFlushed=!1;this._currentLeftPaneSuggestions=null;this._currentRawImpressionGuid=t;this._currentRawClientImpressionGuid=SearchAppWrapper.CortanaApp.impressionId;this._keystrokeAggregatedMeasure={CVID:n};this._currentKeystrokeAggregatedMeasureIsForSearchHome=i},t.prototype.flushAggregatedMeasure=function(n){(n||this._currentKeystrokeAggregatedMeasureIsForSearchHome)&&!this._aggregatedMeasureFlushed&&this._keystrokeAggregatedMeasure&&Object.keys(this._keystrokeAggregatedMeasure).length>1&&(this.logProfilerMarker(1,0,"KeystrokeAggregatedMeasure",this._currentRawImpressionGuid,this._currentRawClientImpressionGuid,this._keystrokeAggregatedMeasure),this._aggregatedMeasureFlushed=!0)},t.prototype.logSingleMeasure=function(n,t,i){this.logProfilerMarker(1,0,n,t,SearchAppWrapper.CortanaApp.impressionId||t,i)},t.prototype.logProfilerMarker=function(n,t,i,r,u,f){u!=r&&(f.ServerIG=r);this._instrumentationProvider.logProfilerMarker(n,t,i,u,f)},t.prototype.logAggregate=function(n,t){this._keystrokeAggregatedMeasure[n]=t},t.prototype.getItemLayoutFromSuggestionsList=function(n){var u,e,i,f,r,t;if(this._currentLeftPaneSuggestions){for(u=this._currentLeftPaneSuggestions.topResults,e=this._currentLeftPaneSuggestions.groups,t=0;t<u.length;++t)if(u[t].instItem==n)return{IsInTopResult:!0,GroupType:undefined,PositionInGroup:t};for(i=0,f=e;i<f.length;i++)for(r=f[i],t=0;t<r.suggestions.length;++t)if(r.suggestions[t].instItem==n)return{IsInTopResult:undefined,GroupType:r.typeWithSource.type,PositionInGroup:t}}return undefined},t.prototype.updateSuggestionsList=function(n,t){this._currentLeftPaneSuggestions={topResults:n,groups:t}},t.prototype.logDataSourcePerformancesMeasure=function(n){var t=n.RequestBegin,i=Object.keys(n.ResponseReceived).map(function(i){return{Name:i,ResponseReceivedTime:n.ResponseReceived[i]-t,RenderedTime:n.RenderFinished[i]-t,Status:n.DataSourcesState&&n.DataSourcesState[i]}}),r=n.TopResultRendered.map(function(n){return{Type:n.T,Time:n.V-t}}),u={DataSources:i,TopResultRendered:r};this.logAggregate("DataSourcePerformancesMeasure",u)},t.prototype.logNewKeystrokeMeasure=function(t,i,r){this.onNewKeystroke(t,i,r.isSearchHomeZI);var u={ScopeInQuery:r.scopePrefix,Scope:r.scope,IsSearchHome:r.isSearchHomeZI};u.CIVersion=n.ConstraintIndex.currentCIVersion;this.logAggregate("NewKeystrokeMeasure",u)},t.prototype.logTopResultsRenderedMeasure=function(t,i){this._instrumentationProvider.logProfilerMarker(1,0,"topResultRendered",t,{CI:n.ConstraintIndex.currentCIVersion});var r={SuggestionTypes:i};this.logAggregate("TopResultsRenderedMeasure",r)},t.prototype.logGroupsRenderedMeasure=function(n){var t={GroupTypes:n};this.logAggregate("GroupsRenderedMeasure",t)},t.prototype.logPreviewPaneOpenedMeasure=function(n,t,i){var r={ParentType:n.getQsCode(),PreviewPaneType:t,ParentLayoutInfo:this.getItemLayoutFromSuggestionsList(n),AutoOpened:i||undefined};this.logAggregate("LastPreviewPaneOpened",r)},t.prototype.logConversationStartMeasure=function(n,t){var i={CVID:n,StartTime:t};this.logSingleMeasure("ConversationStartMeasure",n,i)},t.prototype.logItemClickedMeasure=function(n,t,i,r){var u={CVID:n,ItemType:i.getQsCode(),InputType:r,LayoutInfo:this.getItemLayoutFromSuggestionsList(i)};this.flushAggregatedMeasure(!0);this.logSingleMeasure("ItemClickedMeasure",t,u)},t}();n.WindowsTelemetry=t}(WSB||(WSB={})),function(n){var t=/[+.\\*?\[\]()]/g,i={".":"\\.","+":"\\+","*":"\\*","\\":"\\\\","?":"\\?","[":"\\[","]":"\\]","(":"\\(",")":"\\)"},r=/^(?:https?:\/\/)?(.*)/,u=/^(?:(?:https?:\/\/(?:www\.)?)|(?:www\.))(.*)/,f=/^\s+/,e=function(){function e(){var t=this;n.Host.bindKeyDown(function(i){n.isUpOrDownKey(i)&&t.reset()});n.Host.bindQueryChangedOrInitialized(function(n){t._currentQuery=n;!t._fullAutoCompletedQuery||t._fullAutoCompletedQuery.startsWith(n.originalQuery)||n.originalQuery.startsWith(t._fullAutoCompletedQuery)||t.reset()})}return e.prototype.apply=function(t){var r,o,i;if(t.query!=this._autoCompletedQuery){if(r=this._currentQuery.originalQuery,n.Host.setAutoCompleteQueryText(""),this._currentQuery.originalCursorPosition===r.length){var s=this._currentQuery.scopePrefix?this._currentQuery.scopePrefix.length+1:0,u=r.substr(s).replace(f,"").toLowerCase(),e=t.query.toLowerCase();if(u!==e&&(o=1,i=this.fullAutoCompleteOffset(e,u),i<0&&t.url&&(i=this.infixAutoCompleteOffset(e,u),o=2),i<0&&(i=this.directNavAutoCompleteOffset(e,u)),i>=0)){this.setAutoCompletedQuery(r,t.query,i);t.autoCompleteType=o;return}}this._autoCompletedQuery&&(this.reset(),n.Host.setAutoCompleteQueryText(r))}},e.prototype.reset=function(){this._autoCompletedQuery=null;this._fullAutoCompletedQuery=null},e.prototype.fullAutoCompleteOffset=function(n,t){var i=n.startsWith(t);return i?t.length:-1},e.prototype.infixAutoCompleteOffset=function(n,u){var f=n.search("[ .:,\\\\/+_&-]"+u.replace(t,function(n){return i[n]})),e,o;return f>0&&(e=n.substring(0,f+1).match(r)[1],o=e?e.match(/[ .:,\\/+_&-]+/g).length+1:1,o<3)?f+1+u.length:-1},e.prototype.directNavAutoCompleteOffset=function(n,t){var i=t.match(u),r;return i&&(r=i[1],r.length>0&&n.startsWith(i[1]))?r.length:-1},e.prototype.setAutoCompletedQuery=function(t,i,r){var u=t+i.slice(r);n.Host.setAutoCompleteQueryText(u);this._autoCompletedQuery=i;this._fullAutoCompletedQuery=u},e}();n.WSBAutoComplete=e}(WSB||(WSB={})),function(n){var t;(function(t){function e(t,i){var r,u;return i?(r=n.getKnownFolderPathLC(n.FOLDERID_SkyDrive),r?r+="\\":r="\\onedrive\\",u=t.indexOf(r),u>=0&&(t=t.substr(u+r.length))):t.startsWith("onedrive:\\")&&(t=t.substr(10)),t}function o(t,i,r){var f,e,s,u,o;return i?(f=n.getKnownFolderPathLC(n.FOLDERID_Profile)+"\\onedrive - ",e=t.indexOf(f),e>=0&&(s=t.indexOf("\\",e+f.length),t=t.substr(s+1))):(u=n.AccessTokenManager.getWindowsIdentity(),u&&t.startsWith("onedrive for business:\\")&&r&&(o=u.indexOf("@"),o!=-1&&r.toLocaleLowerCase().indexOf("personal/"+u.substr(0,o))>0&&(t=t.substr(23)))),t}function l(n){return{fullySuppressedGroups:n.fullySuppressedGroups?n.fullySuppressedGroups.slice(0):[],partiallySuppressedGroups:n.partiallySuppressedGroups?n.partiallySuppressedGroups.slice(0):[],suppressedSuggestions:n.suppressedSuggestions?n.suppressedSuggestions.slice(0):[]}}function s(t,i,r){var f="",e,o,u,s;return r?(e=n.getKnownFolderPathLC(n.FOLDERID_Profile)+"\\"+n.SubstrateTenantName.toLocaleLowerCase()+"\\",o=i.indexOf(e),o>=0&&(u=o+e.length,s=i.indexOf(" - ",u),f=i.substr(u,s-u).toLocaleLowerCase(),i=i.substr(s+3))):i.startsWith("sharepoint:\\")&&(i=i.substr(12),f=t.siteTitle.toLocaleLowerCase()),[i,f]}function a(n){return n.type=="SW"||n.type=="PWL"}function r(n,t){return!n.suppressed&&n.handoffType==0&&!n.htmlContent&&n.query.toLocaleLowerCase()==t.queryToFetch.toLocaleLowerCase()}function h(n){return n.length>=2&&n[0].type=="MB"&&n[1].type=="MB"}var u={"Microsoft.Windows.ControlPanel":"ControlPanel","Microsoft.AutoGenerated.{923DD477-5846-686B-A659-0FCCD73851A8}":"Classic_{E9C71548-B580-43B2-ACDB-1BA924002754}","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\dfrgui.exe":"Classic_{7D13A5DB-6081-48BD-8EA3-A9D7FE67A335}","{6D809377-6AF0-444B-8957-A3773F02200E}\\Windows Defender\\MSASCui.exe":"NameSpace_Classic_{D8559EB9-20C0-410E-BEDA-7ED416AECC2A}","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\cleanmgr.exe":"Classic_{AACA901F-E74F-4894-B074-F55059532853}","Microsoft.AutoGenerated.{BB044BFD-25B7-2FAA-22A8-6371A93E0456}":"Classic_{45FDB5DF-1457-4A41-A824-7AD9C75767BC}","Microsoft.Windows.PCSettings.DefaultApps":"AAA_SettingsPageAppsDefaults"},f={"NameSpace_Classic_{F942C606-0914-47AB-BE56-1321B8035096}":"Classic_{232A1851-808C-4B44-A92A-38E862989CE5",AAA_Proxy_Automatic_Config_Group:"AAA_SettingsPageNetworkProxy",AAA_Settings_DeveloperModeGroup:"AAA_SettingsPageRestoreDeveloperOptions",AAA_SystemSettings_Users_PicturePassword:"AAA_SettingsGroupPicturePassword"},i,c;(function(n){n[n.NotDuplicate=0]="NotDuplicate";n[n.NoMetadata=1]="NoMetadata";n[n.MergeMetadata=2]="MergeMetadata"})(i||(i={}));t.isWebSuggestionForPrefix=r;t.topHitIsMultiEntity=h;c=function(){function t(t,i,r,u,f,e,o,s){var h=this;this._navigationHelper=t;this._previousKeystrokeCache=i;this._conversationCache=r;this._ranker=u;this._renderedTopResults=f;this._previewPane=e;this._imageSearchViewModel=o;this._upsellViewModel=s;n.config.enableConversationCache&&this._conversationCache&&n.Host.bindDismissed(function(){h._conversationCache.clean()})}return t.prototype.launchWebSearch=function(t,i,r,u){var f=t.queryToFetch;n.Host.launchSearch(f,this._navigationHelper.getSearchUrl(t.fullPartialQuery,f,r,null,u),i)},t.prototype.getProtocol=function(t,i){var u="PWL",r=n.InstrumentationHelper.getInstrumentedSyntheticSuggestion(i,u),f;return r?r:(r=n.createSuggestion(t,null,n.Host.getEdgeIcon,null,u,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(u,n.SyntheticQSCodesMaps.KValues),1,i,!1,"tp",function(){return n.Host.launchUri(r.url)}),r.notAResult=!0,f=function(t){var i=n.prettyPrintUrl(t.fixedUrl,t.queryToFetch,!0);r.url=t.fixedUrl;r.tooltip=t.fixedUrl;r.query=i;r.text=HitHighlightingParser.addMarkers(i);r.narratorText=n.getNarratorText(r,n.Host.getLocString("DirectNavSuggestion"))},f(t),r.updateFromQuery=function(n){return n.isProtocol?(f(n),!0):!1},n.InstrumentationHelper.instrumentSyntheticSuggestion(i,r),r)},t.prototype.getWebSearch=function(t,i,r,u,f,e){var o=this,s=n.contains([13,14],f);return n.getSyntheticSuggestion(t,i,r,u,f,e,s,function(n,t){return o.launchWebSearch(t,n.useRaf,r,f)})},t.prototype.getExplorerSearch=function(t,i){var r=n.getSyntheticSuggestion(t,i,"SDFE",{content:"&#xEC50",type:1},2,n.Host.getLocString("SearchInFileExplorer"),!0,function(t,i){return n.Host.launchSearchInFileExplorer(i.queryToFetch)});return n.shouldSetThisPcGroupSource(n.GroupType.Documents,t)&&(r.sourceForGroup=1),r},t.prototype.getOutlookWebAccessSearch=function(t,i){var r=n.AccessTokenManager.getWindowsAccountType()==1;return n.getSyntheticSuggestion(t,i,"OWA",{content:"&#xE715",type:2},r?8:12,n.Host.getLocString("SearchInOutlookWeb"),!0,function(){return n.Host.launchUri(r?"https://outlook.office.com/owa":"https://outlook.live.com/owa")})},t.prototype.getStoreSearch=function(t,i){return n.getSyntheticSuggestion(t,i,"STS",{content:"&#xEA96",type:2},3,n.Host.getLocString("SearchForAppsInTheStore"),!0,function(t,i){return n.Host.launchStoreSearch(i.queryToFetch)})},t.prototype.getRecourse=function(t,i){if(!t.queryToFetch||t.taskFrame)return null;switch(n.getEffectiveScope(t)){case n.Scope.Apps:return n.isBingEnabled()?this.getStoreSearch(t,i):null;case n.Scope.Documents:return this.getExplorerSearch(t,i);case n.Scope.Emails:return n.ScopeConfig[n.Scope.Emails].showUpsellOnSuggestionsList()?null:this.getOutlookWebAccessSearch(t,i);case n.Scope.Photos:return n.isBingEnabled()?this.getWebSearch(t,i,"SBI",{content:"&#xEB9F",type:2},13,n.Host.getLocString("SearchForWebImages")):null;case n.Scope.Videos:return n.isBingEnabled()?this.getWebSearch(t,i,"SBV",{content:"&#xE714",type:1},14,n.Host.getLocString("SearchForWebVideos")):null;default:return null}},t.prototype.getSyntheticSuggestions=function(t,i){var f=n.getScopeConfig(t),e=f.webSyntheticEnabled&&f.webSyntheticEnabled(t),o=e?this.getWebSearch(t,i,"SW",n.getSearchSuggestionIcon(),0,n.getWebSuggestionAnnotation(n.msbEnabledForQuery(t))):null,s=t.isProtocol&&n.RuntimeConfig.AllowProtocolSyntheticSuggestions?this.getProtocol(t,i):null,u=this.getRecourse(t,i),r;return u&&(u.rankingScore=-Number.MAX_VALUE),r=[],this._imageSearchViewModel&&t.isSearchHomeZI&&t.scope==n.Scope.All&&r.push(this._imageSearchViewModel.getSnipSearchSyntheticSuggestion(t,i)),this._upsellViewModel&&r.push(this._upsellViewModel.getUpsellSyntheticSuggestion(t,i)),{protocol:s,searchTheWeb:o,recourse:u,others:r.filter(function(n){return!!n})}},t.prototype.canHaveDuplicates=function(t,i){switch(t){case"Web":case"MRU":case"OSTMA":case"MSBC":case"MSBS":case"QS":case"PP":case"IBA":case"LRA":case"ST":case"FL":case"LM":case"IFF":case"LDIC":case"CG":case"PT":case"MPP":case"MST":case"MFF":case"MRS":case"ODC":case"MPVD":case"MDOC":case"MFOL":case"MPHO":case"MVID":case"MMUS":case"SSUE":case"SSUC":case"ANA":return!0;case"FEH":case"TOPP":case"QSCH":case"LSQS":case"WWE":case"MSNW":case"BIMG":case"MSNN":case"SMP":case"SREE":return!1;case"SSEE":return i.scope==n.Scope.Documents||i.scope==n.Scope.Emails||n.RuntimeConfig.QfMode==5;case"SSEC":return i.scope==n.Scope.Emails}throw new Error("New data source "+t+" needs to be explicity classified as needed deduping with other data sources or not");},t.prototype.canHaveDuplicatesWithinDataSource=function(t,i){switch(t){case"MPP":case"MST":case"MRU":case"ST":return!0;case"SSEE":case"SSEC":return i.scope==n.Scope.Emails}return n.supportsShortcuts(t,i)},t.prototype.getAppPfn=function(t){var i=n.getAppItem(t);return i?i.packageFamilyName:null},t.prototype.isDuplicate=function(t,r,h){var a,v,c,l,g,nt,tt,it,d,y,p,rt,ut,b,k;if(r.type=="TOPL"&&t.isSearchHomeZI)return i.NotDuplicate;if(this.isMsbDuplicate(r,h)||n.contains([5,4],r.handoffType)&&n.contains([5,4],h.handoffType)&&r.actionUri==h.actionUri&&r.query.toLocaleLowerCase()==h.query.toLocaleLowerCase()||r.handoffType==10&&h.handoffType==10&&r.type==h.type&&!r.htmlContent&&!h.htmlContent&&r.query.toLocaleLowerCase()==h.query.toLocaleLowerCase()||r.type!="PWL"&&r.handoffType==1&&h.handoffType==1&&n.isDuplicateUrl(t,r.url,h.url)||(a=n.getAppItem(r),v=n.getAppItem(h),c=a?a.filePath:r.path,c&&(c=c.toLocaleLowerCase()),l=v?v.filePath:h.path,l&&(l=l.toLocaleLowerCase()),g=this.getAppPfn(r),nt=this.getAppPfn(h),g&&nt&&g.toLocaleLowerCase()==nt.toLocaleLowerCase()))return i.NoMetadata;if(tt=n.getCommandLineItem(r),it=n.getCommandLineItem(h),tt&&v||it&&a){var ft=c||l,w=tt||it,et=w.encodedPath;return ft&&et&&ft==et.toLocaleLowerCase()?(d=a||v,!w.launchArguments||(d.launchArguments||"").toLocaleLowerCase()==w.launchArguments.toLocaleLowerCase()||!d.launchArguments&&w.launchArguments&&d.displayName.toLocaleLowerCase().startsWith(w.displayName.toLocaleLowerCase())?i.NoMetadata:i.NotDuplicate):i.NotDuplicate}if(r.deviceItem&&h.deviceItem){if(y=r.deviceItem.id||"",p=h.deviceItem.id||"",n.isSetting(r.type)&&n.isSetting(h.type)&&(y=r.deviceItem.displayName,p=h.deviceItem.displayName),y.toLocaleLowerCase()==p.toLocaleLowerCase())return c&&!a&&l&&!v?i.MergeMetadata:i.NoMetadata;if(a){if(n.isSetting(h.type)&&u[y]==p)return i.NoMetadata}else if(n.isSetting(r.type)&&(v&&u[p]==y||n.isSetting(h.type)&&(f[y]==p||f[p]==y)))return i.NoMetadata}if(this.isIcoShortcutDuplicate(r,h)||this.isIcoShortcutDuplicate(h,r))return i.NoMetadata;if(c&&l){if(c==l)return i.MergeMetadata;if(!a&&!v)if(r.handoffType==h.handoffType){if(r.handoffType==8&&r.url==h.url)return i.MergeMetadata}else{if((c=e(c,r.handoffType!=7),l=e(l,h.handoffType!=7),c==l)||(rt=r.handoffType!=8,ut=h.handoffType!=8,c=o(c,rt,r.url),l=o(l,ut,h.url),c==l))return i.MergeMetadata;if(n.SubstrateTenantName){var ot=s(r,c,rt),st=ot[0],lt=ot[1],ht=s(h,l,ut),ct=ht[0],at=ht[1];if(lt==at&&(ct.endsWith(st)||st.endsWith(ct)))return i.MergeMetadata}}if(b=r.targetPathLC,k=h.targetPathLC,a&&h.type=="IBA"&&(c=n.resolveKnownFolderGUIDsInPath(c)),v&&r.type=="IBA"&&(l=n.resolveKnownFolderGUIDsInPath(l)),(b&&k&&b==k||b&&b==l||k&&c==k||c==l)&&(!a||!v||(a.launchArguments||"").toLocaleLowerCase()==(v.launchArguments||"").toLocaleLowerCase()))return i.NoMetadata}return this.isCortanaSettingDuplicate(r,h)||this.isCortanaSettingDuplicate(h,r)?i.NoMetadata:r.type==="PPL"&&h.type==="PPL"&&r.uniqueName&&h.uniqueName&&r.uniqueName.toLocaleLowerCase()===h.uniqueName.toLocaleLowerCase()?i.NoMetadata:r.type==="OLE"&&h.type==="OLE"&&r.internetMessageId===h.internetMessageId?i.NoMetadata:r.type==="BKS"&&h.type==="BKS"&&r.url&&h.url&&r.url===h.url?i.NoMetadata:i.NotDuplicate},t.prototype.mergeDuplicates=function(t,r,u){var f=this.isDuplicate(t,r,u);return f?(f==i.MergeMetadata&&n.enrichMetadataFromDuplicate(t,r,u),r.duplicates=r.duplicates||[],n.contains(r.duplicates,u)||(r.duplicates.push(u),r.needsRefreshAfterDeduping=!0,r.previewPaneNeedsRefreshAfterDeduping=f==i.MergeMetadata),!0):!1},t.prototype.isIcoShortcutDuplicate=function(t,i){return t.targetPathLC&&n.isApp(t.type)&&n.isApp(i.type)&&t.targetPathLC.includes("\\installer\\")&&t.targetPathLC.endsWith(".ico")&&t.text==i.text},t.prototype.isCortanaSettingDuplicate=function(n,t){return n.handoffType==5&&n.actionUri=="ms-cortana://navigate/Settings"&&t.deviceItem&&t.deviceItem.id=="CortanaSettings"},t.prototype.isMsbDuplicate=function(n,t){return n.msbDomain!=null&&n.msbDomain===t.msbDomain&&n.msbId!=null&&n.msbId===t.msbId},t.prototype.rank=function(t,i,u,f,e,o,s,h){var bt,kt=this,ft,ct,ni,nt,k,tt,lt,ti,it,et,vt,d,yt,rt,ii,ot,v,g,ri,st,pt,ui,wt,w,fi;n.isL2(f)&&(s=!1);var b=u.Web,ht=b?b.rankingSignals:null,ei=b?b.webTopResultRoutingType:1,ut=u.MRU,dt=null,c=null,gt=null;ht&&(ht.WebSignalsAvailable=!0,dt=b.engagementSignals,c=b.suppressedGroups,(n.config.groupsToNeverFullySuppress||[]).length>0&&c&&(c.fullySuppressedGroups||[]).length>0&&(ft=[],ct=[],c.fullySuppressedGroups.forEach(function(t){n.contains(n.config.groupsToNeverFullySuppress,t)?ft.push(t):ct.push(t)}),ft.length>0&&(c=l(c),c.fullySuppressedGroups=ct,(bt=c.partiallySuppressedGroups).push.apply(bt,ft))));this._previousKeystrokeCache&&(gt=this._previousKeystrokeCache.getPreviousEventWebSignalsData(f.queryToFetch));var oi=ut?ut.SuggestionEngagementData:null,si=ut?ut.LookupCompletions:null,hi={cvid:n.Host.getConversationId(),privacyNumber:n.Host.getPrivacyNumber()},a=this.getSyntheticSuggestions(f,o);if(i=i.slice(),c&&(c.fullySuppressedGroups&&c.fullySuppressedGroups.length>0&&(i=i.filter(function(t){return!n.contains(c.fullySuppressedGroups,String(kt.getGroupTypeForSuppressions(t)))})),c.suppressedSuggestions&&c.suppressedSuggestions.length>0&&(i=i.filter(function(t){return!n.contains(c.suppressedSuggestions,n.getSuggestionKey(t))}))),n.config.suppressFileFolders&&f.queryToFetch.length<n.config.maxPrefixLengthForSupp&&f.scope==n.Scope.All&&(ni=[n.GroupType.Documents,n.GroupType.Folders],i=i.filter(function(t){return!n.contains(ni,n.getGroupType(t))})),t.length==0&&(a.others.length>0&&i.unshift.apply(i,a.others),a.protocol&&i.unshift(a.protocol)),nt=e.length==1&&e[0].childSuggestions&&e[0].childSuggestions.some(function(n){return n.displayed}),k=this.getSuggestionsToRank(nt,t,i,a,o),n.config.bypassRankerOnNoNewSuggestions&&i&&i.length&&(f.hasNewSuggestions=!0),tt=[],n.config.enableConversationCache&&this._conversationCache&&!n.isL2(f)&&(this._conversationCache.refreshPartialQuery(f.queryToFetch),tt=k.filter(function(n){return!kt.isConversationCached(n,f)&&n.type!="SW"}),tt.length>0&&f.queryToFetch.length>0)){lt=!1;t.some(function(n){return n.type=="SW"})&&(lt=!0);t=this._conversationCache.retrieveItemsFromCache(!0);for(ti in t)t[ti].sequenceNumber=o;i=tt;k=this.getSuggestionsToRank(nt,t,i,a,o);lt&&a.searchTheWeb&&t.push(a.searchTheWeb)}it=this._ranker.rank(f,k,ht,oi,si,dt,hi,gt,h,a);this._previousKeystrokeCache&&!s&&this._previousKeystrokeCache.updateSpellerTriggerData(f.queryToFetch,k);t.length==0&&a.recourse&&i.push(a.recourse);var y=this.determineTopResults(e,i,it,a,f,o,nt),at=t.filter(function(t){return!n.contains(e,t)}),p=this.determineSuggestionsToAddToGroups(at,i,e,y,a,f,nt,s);if(!n.RuntimeConfig.FlatListWithoutGroups&&it.mruSuppressions&&it.mruSuppressions.backPropDataExists)this.applyMRUSuppressions(it,e,y,p,f);else if(c&&c.partiallySuppressedGroups&&this.canPartiallySuppressGroups(y,p))for(et=0,vt=p;et<vt.length;et++)d=vt[et],r(d,f)||(yt=this.getGroupTypeForSuppressions(d),this.canBePartiallySuppressed(d,yt)&&n.contains(c.partiallySuppressedGroups,String(yt))&&(n.contains(e,d)||(d.suppressed=!0)));if(rt=[],this.removeProtocolIfDuplicate(f,a,y,at,p,rt),ii=n.isDataSourceEnabled("SMP",f)&&i.some(function(t){return n.getGroupType(t)==n.GroupType.MeetingPrep}),ii&&(ot=a.others.find(function(n){return n.type=="SNSC"}),ot&&(n.tryRemove(p,ot)||n.config.enableConversationCache||rt.push(ot))),this.setUseRafFlag(y,p,f,ei),v=this.getGroupOrder(f,p,at),f.staticGroupOrder){for(g=[],ri=function(n){var t=v.findIndex(function(t){return t.type==n});t>=0&&(g.push(v[t]),v.splice(t,1))},st=0,pt=f.staticGroupOrder;st<pt.length;st++)ui=pt[st],ri(ui);g.length>0&&(g.push.apply(g,v),v=g)}else f.forceGroupOnTop&&(wt=f.forceGroupOnTop,w=v.findIndex(function(t){return n.sameGroup(t,wt)}),w>=0&&(v.splice(w,1),v.unshift(wt)),w=v.findIndex(function(t){return n.isTopHitChildGroup(t)}),w>=0&&(fi=v[w],v.splice(w,1),v.unshift(fi)));if(n.RuntimeConfig.FlatListWithoutGroups&&(y=y.concat(p.filter(function(n){return!n.suppressed})),p=[],n.trimList(y,n.RuntimeConfig.MaxSuggestionsWhenFlatList,function(i){return!n.contains(t,i)&&!i.notAResult}),rt.length!=0))throw new Error("Can't remove suggestions from groups when there are no groups");return n.config.promoteEdgeOverIE&&this.promoteEdgeOverInternetExplorer(p,y),n.config.disableEdgeUpsellQF||f.scope!==n.Scope.All||n.RuntimeConfig.QfMode!==0&&n.RuntimeConfig.QfMode!==1||this.promoteEdgeUpsellBanner(y,f,o),n.config.enableConversationCache&&this._conversationCache&&!n.isL2(f)&&tt.length>0&&f.queryToFetch.length>0&&(this._conversationCache.setTopResultCount(y.length),this._conversationCache.setSuggestions(k)),{topResults:y,suggestionsToAdd:p,suggestionsToRemove:rt,groupOrder:v}},t.prototype.isConversationCached=function(n,t){for(var i,f=this._conversationCache.retrieveItemsFromCache(!0),r=0,u=f;r<u.length;r++){if(i=u[r],this.isDuplicate(t,n,i))return this._conversationCache.update(n),!0;if(n.query==i.query&&n.handoffType==i.handoffType){if(n.type=="SW"&&i.type!="SW"&&i.handoffType==0)continue;return!0}if(this._conversationCache.isCached(n))return!0}return!1},t.prototype.promoteEdgeOverInternetExplorer=function(t,i){var r=i.findIndex(function(t){return t.deviceItem&&t.deviceItem.id==n.InternetExplorerId}),u=t.findIndex(function(t){return t.deviceItem&&n.contains(n.AnaheimAppIds,t.deviceItem.id)});r>=0&&u>=0&&(i.unshift(t.splice(u,1)[0]),t.unshift(i.splice(r+1,1)[0]))},t.prototype.promoteEdgeUpsellBanner=function(t,i,r){var f="EUP",e=t.findIndex(function(t){return t.deviceItem&&t.deviceItem.id==n.InternetExplorerId}),o=t.findIndex(function(n){return n.id==f}),u;e>=0&&o<0&&n.canShowQFUpsell()&&(u=this._upsellViewModel.getEdgeUpsellBanner(i,r),u&&t.unshift(u))},t.prototype.applyMRUSuppressions=function(t,i,u,f,e){var h,l,s,o;if(this.canPartiallySuppressGroups(u,f)){var c={};for(h=0,l=f;h<l.length;h++)if(s=l[h],!r(s,e)&&(o=n.getGroupType(s),this.canBePartiallySuppressed(s,o))){if(!c[o]){var a=t.mruSuppressions.maxGroupCCR?t.mruSuppressions.maxGroupCCR[o]||0:0,v=t.mruSuppressions.maxGroupProbSugClickGivenPref?t.mruSuppressions.maxGroupProbSugClickGivenPref[o]||0:0,y=t.mruSuppressions.mruGroupRatios?t.mruSuppressions.mruGroupRatios[o]||0:0,p=t.mruSuppressions.mruGroupBackpropRatios?t.mruSuppressions.mruGroupBackpropRatios[o]||0:0,w=t.mruSuppressions.mruGroupBackpropWeights?t.mruSuppressions.mruGroupBackpropWeights[o]||0:0,b=3.34728026*a+3.523466*v+3.72204852*y+.5865976*p+1.37432766*w+-1.75450325,k=1/(1+Math.exp(-b));c[o]=n.trimFeatureStoreValue(k)}s.mruSuppressionScore=c[o];s.mruSuppressionScore<n.config.lRModelCutOff&&(n.contains(i,s)||(s.suppressed=!0))}}},t.prototype.allowedInGroups=function(n){return n.isAnswer?n.allowedInGroups:!0},t.prototype.getGroupTypeForSuppressions=function(t){var i=n.getGroupType(t);return i==n.GroupType.LocalPlaces?n.GroupType.SearchSuggestions:i},t.prototype.canBePartiallySuppressed=function(t,i){return n.getScope(i)!=n.Scope.All},t.prototype.canPartiallySuppressGroups=function(t,i){return n.RuntimeConfig.ScopesAvailable?t.every(function(t){return n.getGroupType(t)==n.GroupType.SearchSuggestions})&&i.every(function(t){return n.getGroupType(t)==n.GroupType.SearchSuggestions})?!1:!0:!1},t.prototype.isProtocolDuplicate=function(t,i,r){return t==r?!1:t.type=="MD"?!0:t.handoffType==1&&n.isDuplicateUrl(i,t.url,r.url)},t.prototype.removeProtocolIfDuplicate=function(t,i,r,u,f,e){var h=this,o,s;i.protocol&&(o=function(n){return!n.suppressed&&h.isProtocolDuplicate(n,t,i.protocol)},(r.some(o)||u.some(o)||f.some(o))&&(n.tryRemove(r,i.protocol)?r.length||(s=n.removeFirstWhere(u,o)||n.removeFirstWhere(f,o),r.push(s)):n.tryRemove(f,i.protocol)||n.contains(u,i.protocol)&&(n.config.enableConversationCache||e.push(i.protocol)),i.protocol=null))},t.prototype.getSuggestionsToRank=function(t,i,r,u){t&&(i=i.filter(function(t){return!n.isChildSuggestion(t)}));u.recourse&&(i=i.filter(function(n){return n!=u.recourse}));var f=i.concat(r);return n.config.enableConversationCache&&this._conversationCache?u.searchTheWeb&&!n.contains(f,u.searchTheWeb)&&f.push(u.searchTheWeb):u.searchTheWeb&&!n.contains(i,u.searchTheWeb)&&f.push(u.searchTheWeb),f},t.prototype.determineTopResults=function(t,i,u,f,e,o,s){var it=this,c,b,l,v,y,g,k,ut,d,nt,tt,p,w;if(s||!e.queryToFetch||n.config.stickyTopResultsV2&&t.length>1&&!n.isL2(e))return t;if(e.inorganic&&e.queryToFetch){if(t.length>0)return t;if(f.searchTheWeb.query===e.queryToFetch)return t.push(f.searchTheWeb),t}if(c=u.topResults,b=this._previewPane?this._previewPane.getPreviewedSuggestionToForceTopHit():null,b&&this._ranker.allowInTopHit(e,b)&&(l=function(t){return n.isEquivalentForPreviewPanePurposes(e,b,t)},v=c.findIndex(l),v!=0&&(y=void 0,v>0?(y=c[v],c.splice(v,1)):y=t.find(l)||i.find(l)||(f.searchTheWeb?[f.searchTheWeb]:[]).find(l),y&&c.unshift(y))),f.protocol&&f.searchTheWeb&&this._ranker.allowInTopHit(e,f.protocol)&&n.tryRemove(c,f.searchTheWeb),f.searchTheWeb&&(g=c.indexOf(f.searchTheWeb),g>=0&&c.some(function(n){return n!=f.searchTheWeb&&r(n,e)})&&c.splice(g,1)),c.length==0&&(n.config.stickyTopResultsV2&&t.length>0?c.push.apply(c,t):f.protocol&&this._ranker.allowInTopHit(e,f.protocol)?c.push(f.protocol):f.searchTheWeb&&this._ranker.allowInTopHit(e,f.searchTheWeb)?c.push(f.searchTheWeb):f.recourse&&this._ranker.allowInTopHit(e,f.recourse)&&c.push(f.recourse)),k=n.getEffectiveScope(e)==n.Scope.Emails?n.config.maxNumberOfEmailsInTopResult:Math.max(n.config.maxNumberOfTopResults,h(c)?2:0,t.length),n.config.bypassFallbackOnMSBTopHit==4&&c.length>0&&n.isMsbOnlineSuggestionType(c[0].type)&&(k=2),c.length>k&&(c=c.slice(0,k)),n.config.synthWebNoBestMatch&&c.length==1){var rt=[n.GroupType.SearchSuggestions,n.GroupType.Websites],ft=i.filter(function(t){return!n.contains(rt,n.getGroupType(t))}),et=c.filter(function(t){return!n.contains(rt,n.getGroupType(t))});ft.length==0&&et.length==0&&(c=[])}for(ut=function(r){var u=t[r];if(!n.contains(c,u)){if(n.config.enableConversationCache&&c.some(function(n){return it.isDuplicate(e,u,n)}))return"continue";u.useRaf&&(u.useRaf=!1);u!=f.searchTheWeb&&i.unshift(u)}},d=t.length-1;d>=0;--d)ut(d);return c.length==1&&n.safeExecute(function(){return it.applyAppOverride(c,i)},"applyDeviceInfoOverride"),c.forEach(function(n){return n.suppressed=!1}),nt=n.isL2(e),n.config.stickyTopResultsV2&&c.length==1&&t.length==1&&!nt&&(tt=c[0],p=t[0],tt==p||a(p)||n.config.msbDisableStickyWeb&&n.isWebSuggestion(p)&&n.isMsbOnlineSuggestionType(tt.type)||c.unshift(p)),n.config.enableMRUHint&&c.length>0&&this._previousKeystrokeCache&&(w=this._previousKeystrokeCache.getPreviousTopHit(),w&&w.mruHintEnabled&&w.text==c[0].text&&w.type==c[0].type&&(c[0].mruHintEnabled=!0)),n.config.enableCISpeller&&c.length==1&&this._previousKeystrokeCache&&(c[0].type=="PP"||c[0].type=="ST")&&this._previousKeystrokeCache.setPreviousTopHit(nt?null:c[0]),n.config.enableConversationCache&&c.length==2&&this.isDuplicate(e,c[0],c[1])&&c.splice(1,1),c},t.prototype.applyAppOverride=function(n,t){var r=["Microsoft.Office.WINWORD.EXE","{6D809377-6AF0-444B-8957-A3773F02200E}\\Windows NT\\Accessories\\wordpad.exe"],u=n[0].deviceItem?n[0].deviceItem.id:null,i;u&&u.startsWith(r[1])&&(i=t.findIndex(function(n){return n.deviceItem&&n.deviceItem.id&&n.deviceItem.id.startsWith(r[0])}),i>=0&&n.splice(0,1,t[i]))},t.prototype.setUseRafFlag=function(t,i,r,u){var e,s,o,h,f;if(n.isCortanaEnabledCache)if(u==2)for(e=0,s=t;e<s.length;e++)f=s[e],f.handoffType!=0||f.isAnswer||(f.useRaf=!0);else for(o=0,h=t;o<h.length;o++)f=h[o],f.handoffType==0&&!f.isAnswer&&n.Host.matchesVcd(f.query)&&(f.useRaf=!0)},t.prototype.determineSuggestionsToAddToGroups=function(t,i,u,f,e,o,s,h){var b=this,c=i.filter(function(t){return!n.contains(f,t)}),a,l,v,y,p,w;for(n.config.enableConversationCache&&this._conversationCache&&this._conversationCache.isFirstRender()&&!n.isL2(o)&&(c=c.concat(t.filter(function(t){return!n.contains(f,t)}))),a=[],n.RuntimeConfig.FlatListWithoutGroups||c.forEach(function(t,i){b.allowedInGroups(t)||(n.getScope(n.getGroupType(t))==n.Scope.All?a.push(i):t.suppressed=!0)}),l=a.length-1;l>=0;--l)c.splice(l,1);return e.searchTheWeb&&(v=f.indexOf(e.searchTheWeb),v!=-1&&(y=n.removeFirstWhere(c,function(n){return r(n,o)}),y&&(f[v]=y))),p=c.filter(function(t){return n.contains([n.GroupType.SearchSuggestions,n.GroupType.Websites,n.GroupType.LocalPlaces],n.getGroupType(t))}),w=c.filter(n.enforceOriginalOrder),!s&&this.canRenderChildSuggestions(f,h,o)&&this.addChildSuggestions(f[0],c),o.queryToFetch&&c.sort(function(n,t){return t.rankingScore-n.rankingScore}),this.insertDefaultSearchTheWeb(o,e,f,t,c,p),c=this.insertSuggestionsToRightPlace(c,w),this.insertSuggestionsToRightPlace(c,p)},t.prototype.insertDefaultSearchTheWeb=function(t,i,u,f,e,o){var s,h;i.searchTheWeb&&(t.scope==n.Scope.Web||t.scope==n.Scope.All)&&(s=o.findIndex(function(n){return r(n,t)}),f.some(function(n){return r(n,t)})||u.some(function(n){return r(n,t)})?s!=-1&&(h=o[s],o.splice(s,1),e.splice(e.indexOf(h),1)):s==-1&&(o.unshift(i.searchTheWeb),e.unshift(i.searchTheWeb)))},t.prototype.getGroupOrder=function(t,i,r){var f,o,a,u,w,b,h,v,k,d,g,c,y,s;switch(t.scope){case n.Scope.Web:if(!t.queryToFetch)return[{type:n.GroupType.Websites},{type:n.GroupType.SearchSuggestions}];break;case n.Scope.Apps:return[{type:n.GroupType.Apps},{type:n.GroupType.Store}];case n.Scope.Photos:return[{type:n.GroupType.Photos},{type:n.GroupType.SearchSuggestions}];case n.Scope.Videos:return[{type:n.GroupType.Videos},{type:n.GroupType.SearchSuggestions}]}f=r.concat(i);f.sort(function(n,t){return t.rankingScore-n.rankingScore});var p=[],l=[],e=[],nt=function(t){if(t.suppressed)l.push(t);else if(p.push(t),n.config.enableStaticGroupRanking){var r=n.getGroupType(t),i={type:r,source:t.sourceForGroup};e.some(function(t){return n.sameGroup(t,i)})||e.push(i)}};for(o=0,a=f;o<a.length;o++)s=a[o],nt(s);if(l.length!=0&&(f=p.concat(l)),u=[],n.config.enableStaticGroupRanking&&f.length>0&&n.getGroupType(f[0])!=n.GroupType.SearchSuggestions){for(w=[{type:n.GroupType.Apps},{type:n.GroupType.Settings},{type:n.GroupType.Documents,source:1}],b=function(t){e.some(function(i){return n.sameGroup(i,t)})&&u.push(t)},h=0,v=w;h<v.length;h++)k=v[h],b(k);n.RuntimeConfig.QfMode!=8&&e.some(function(t){return n.sameGroup(t,{type:n.GroupType.SearchSuggestions})})&&u.push({type:n.GroupType.SearchSuggestions})}for(d=function(t){var r=n.getGroupType(t),i=g.getTypeWithSource(r,t);u.some(function(t){return n.sameGroup(t,i)})||(n.RuntimeConfig.QfMode==8&&i.type==n.GroupType.SearchSuggestions?u.unshift(i):n.config.enableStaticGroupRanking&&n.isTopHitChildGroup(i)?u.unshift(i):u.push(i))},g=this,c=0,y=f;c<y.length;c++)s=y[c],d(s);return u},t.prototype.getTypeWithSource=function(t,i){var r=t==n.GroupType.MRUHistory?undefined:i.sourceForGroup;return{type:t,source:r}},t.prototype.addChildSuggestions=function(t,i){t.calculateChildSuggestions&&t.calculateChildSuggestions();t.childSuggestions&&t.childSuggestions.length>0&&Object.keys(n.config.topHitChildGroups).forEach(function(r,u){var f=parseInt(r),e=n.contains(n.config.suppressedTopHitChildGroups,f)?0:n.config.topHitChildGroups[r],o;e>0&&(o=t.childSuggestions.filter(function(n){return n.groupType==f}).slice(0,e),o.forEach(function(n,t){n.rankingScore=1e4-100*u-t;i.push(n)}))})},t.prototype.canRenderChildSuggestions=function(t,i){var r,u;return n.RuntimeConfig.FlatListWithoutGroups?!1:t.length!=1?!1:(r=t[0],n.RuntimeConfig.AlwaysWide&&r.previewPaneType!=1)?!1:i?this._renderedTopResults.topResults.length==1?(u=this._renderedTopResults.topResults[0],u.hasChildSuggestionsDisplayed&&u.query==r.query&&n.getGroupType(u)==n.getGroupType(r)):!1:!0},t.prototype.insertSuggestionsToRightPlace=function(t,i){var r,e,u,f;if(i.length==0)return t;for(r=[],e=i[0],u=0;u<t.length;u++)f=t[u],f==e?r=r.concat(i):n.contains(i,f)||r.push(f);return r},t}();t.Aggregator=c})(t=n.Ranking||(n.Ranking={}))}(WSB||(WSB={}));__spreadArrays=this&&this.__spreadArrays||function(){for(var i=0,n=0,r=arguments.length;n<r;n++)i+=arguments[n].length;for(var u=Array(i),f=0,n=0;n<r;n++)for(var e=arguments[n],t=0,o=e.length;t<o;t++,f++)u[f]=e[t];return u},function(n){function s(t,i){t(n.getCurrentTime(),n.getInputType(i),i)}function i(n,t){var i=parseInt(n.substr(1),16),r=i>>16&255,u=i>>8&255,f=i&255;return"rgba("+r+","+u+","+f+","+t+")"}function h(n,t){var i=parseInt(n.substr(1),16),r=Math.max(0,(i>>16)-t),u=Math.max(0,(i>>8&255)-t),f=Math.max(0,(i&255)-t);return"#"+String("000000"+(f|u<<8|r<<16).toString(16)).slice(-6)}function u(n,t){var i=parseInt(n.substr(1),16),r=Math.max(0,(i>>16)*t),u=Math.max(0,(i>>8&255)*t),f=Math.max(0,(i&255)*t);return"#"+String("000000"+(f|u<<8|r<<16).toString(16)).slice(-6)}var f,e,t,r,o;n.invokeClickHandler=s;f="slideInMessage";e="indexingMessage";n.SinglePaneWidth=344;n.PreviewPaneWidth=440;n.DebugWindowWidth=800;n.CobaltPreviewPaneWidth=410;r="aria-selected";o=function(){function o(i){var u=this,e,f;this.lightweightStorage=i;this._performanceWidget=_ge("performanceWidget");this._root=_ge("root");this._windowsTemporaryMessageShown=!1;this._windowsIndexingMessageShown=!1;this._progressBarVisible=!1;this._previewPaneVisible=!1;this._debugWindowVisible=!1;this._suggestionsContainerHeight=0;this._renderingInProgress=!1;this._narratorLaunchHandlers=[];this._viewData={};this._targetElemCache={};e=new MutationObserver(function(n){var t,o,i,f,s,e;if(!u._renderingInProgress){for(t=[],i=0,f=n;i<f.length;i++)s=f[i],e=s.target,o=e.id,t.push(e.getAttribute(r)=="true"?1:0);(t.length==1&&t[0]==0||t.length==2&&t[0]^t[1])&&u._narratorLaunchHandlers.forEach(function(n){return n(o)})}});e.observe(document,{subtree:!0,attributes:!0,attributeFilter:[r]});n.View.getLocString=function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return n.Host.getLocString.apply(n.Host,__spreadArrays([t],r))};this.addViewData("TestHooksEnabled",n.TestHookUrlParameters);t=SearchAppWrapper.CortanaApp;this._windowsTemporaryMessageWrapper=_ge("temporaryMessageWrapper");this._windowsIndexingMessageWrapper=_ge("temporaryMessageWrapper");this._qfContainer=_ge("qfContainer");this._flyout=_ge("flyoutContainer");this._flyoutOverlay=_ge("overlayContainer");n.Host.bindAppVisible(function(){var i=t.width,r=t.height;i&&r?u.setDimensions(i,r):ThresholdUtilities.getCortanaHeaders(function(n){if(n){var t=n["X-BM-DeviceDimensionsLogical"].split("x"),i=t[0],r=t[1];u.setDimensions(parseInt(i),r)}});u._isFileExplorerOrControlPanel=n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9;n.RuntimeConfig.PreviewPaneAvailable&&(u.initPreviewPane(),n.setVisibility(u._previewPane,n.RuntimeConfig.AlwaysWide),!n.RuntimeConfig.AlwaysWide&&n.Host.hasFallbackHappened()&&t.resetToDefaultSize());u.initDebugWindow();u.setConditionalCss("wideByDefault",n.RuntimeConfig.AlwaysWide);u.setConditionalCss("settingsApp",n.RuntimeConfig.QfMode==7);u.setConditionalCss("santorini",n.RuntimeConfig.QfMode==8);u.setConditionalCss("lockscreen",n.RuntimeConfig.QfMode==6);u.setConditionalCss("fileExplorer",u._isFileExplorerOrControlPanel);u.setConditionalCss("panelCanResize",n.RuntimeConfig.PanelCanResize);u.setConditionalCss("flatListWithoutGroups",n.RuntimeConfig.FlatListWithoutGroups);u.setConditionalCss("searchBoxOnTop",n.RuntimeConfig.SearchBoxOnTop);u.setConditionalCss("noScopes",!n.RuntimeConfig.ScopesAvailable);u.setConditionalCss("searchHomeQuickAnswer",n.shouldEnableQuickSearches(n.Host.getLanguage().toLowerCase()));u.setConditionalCss("cloudDocsOnTheLeft",n.config.cloudDocsOnTheLeft);u.setConditionalCss("showBingImage",n.canShowBingDailyImage(u.lightweightStorage));u.setConditionalCss("snipSearchEnabled",n.shouldEnableSnipSearch());u.setConditionalCss("edgeUpsellBottom",n.config.enableEdgeUpsellBottom);u.setConditionalCss("wweTour",n.config.enableWWETour);u.setConditionalCss("msnNewsAltUX",n.config.msnNewsAlternativeUX);u.setConditionalCss("edgeUpsellIconTransition",n.shouldEnableEdgeUpsellSHTransitionIcon());u.setConditionalCss("enableEdgeUpsellSHTop",n.config.enableEdgeUpsellSHTop);u.setConditionalCss("enableEdgeUpsellResetBanner",n.config.enableAnaheimUpsellResetDefault3);u.setConditionalCss("prong1md",n.config.prong1md&&n.RuntimeConfig.AlwaysWide&&n.config.weatherTileMarkets[n.getCurrentLanguage()]);u.setConditionalCss("prong1Right",n.config.prong1Right);u.setConditionalCss("cobaltFontExperiment",n.config.cobaltFontExperiment);u.setConditionalCss("cobaltIconExperiment",n.config.cobaltIconExperiment);u.setConditionalCss("cobaltSelectionExperiment",n.config.cobaltSelectionExperiment);u.setQueryBasedCss(null)});n.Host.bindBootstrapDone(function(){n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindBootstrapDone");var t=_ge("preBootstrapPane");t&&(n.setVisibility(t,!1),t.remove());n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindBootstrapDone")});n.Host.bindShown(function(){n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindShown");u.applyAccentColor();u.setThemeBasedCss();u.setConditionalCss("snipSearch",t.entryPoint=="WNSSBS"&&n.config.enableSnipSearchV2);n.setVisibility(u._root,!0);n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindShown")});n.Host.bindAppHidden(function(){n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindAppHidden");u._openPreviewPaneButtonCache=undefined;n.setVisibility(u._previewPane,!1);n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindAppHidden")});n.Host.bindQueryChangedOrInitialized(function(){n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindQueryChangedOrInitialized");u._isFileExplorerOrControlPanel&&u.updateFENarratorSuggestionCount(null);n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindQueryChangedOrInitialized")});n.Host.bindSearchBoxClick(function(){n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindSearchBoxClick");n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindSearchBoxClick")});f=function(){n.RuntimeConfig.AlwaysWide||(u._previewPaneVisible=!1,n.setVisibility(u._previewPane,!1));u.setDebugWindowVisibility(!1)};n.Host.bindDismissed(function(){u.resetSuggestionsContainerHeight();f()});!!this._performanceWidget&&n.View.PerformanceWidget&&(n.setVisibility(this._performanceWidget,!0),n.Host.bindShown(function(){u.renderReactView("performanceWidget",n.View.PerformanceWidget,{keystrokeTimeline:null})}),n.InstrumentationHelper.bindKeystrokeTimelineUpdated(function(t){u.renderReactView("performanceWidget",n.View.PerformanceWidget,{keystrokeTimeline:t})}));n.config.alwaysWideBeforeRS5&&t.addEventListener("openanimationcompleted",function(){u.ensureWebViewWidthExpanded()});t.addEventListener("resettingtodefaultsize",function(){f()});sj_be(sj_b,"contextmenu",function(n){for(var t=n.target;t;){if(t.classList.contains("allowcontextmenu"))break;t=t.parentElement}t||sj_pd(n)})}return o.prototype.setConditionalCss=function(n,t){t?this._root.classList.add(n):this._root.classList.remove(n)},o.prototype.setQueryBasedCss=function(t){n.RuntimeConfig.QfMode==8?this.setConditionalCss("zeroInputSantorini",!t||!t.queryToFetch):(this.setConditionalCss("zeroInput19H1",t?t.isSearchHomeZI:n.RuntimeConfig.SearchHomeAvailable==1),this.setConditionalCss("allScope",t&&t.scope==n.Scope.All))},o.prototype.setThemeBasedCss=function(){if(n.config.isThemeAware){var t=n.Host.getWindowsTheme(),i=n.Host.getAppTheme();this.setConditionalCss("darkThemeBeta",n.config.darkMode&&t==2&&i==2);this.setConditionalCss("darkTheme19H1",t==2);this.setConditionalCss("lightTheme19H1",t==1)}else n.config.searchHomeSupported&&(this.setConditionalCss("lightTheme19H1",!0),this.setConditionalCss("lightThemeRS5",!0))},o.prototype.initPreviewPane=function(){var i=t.textScaleFactor||1,r=n.config.UseCobaltCSS?n.CobaltPreviewPaneWidth/i:n.PreviewPaneWidth/i;this._previewPane||(this._previewPane=_ge("qfPreviewPane"),this._previewPane.classList.remove("transitionOn"));this._previewPane.style.minWidth=r+"px"},o.prototype.initDebugWindow=function(){this._debugWindow||(this._debugWindow=_ge("qfDebugPane"),this._debugWindow&&(this._debugWindow.style.flexBasis=n.DebugWindowWidth+"px"))},o.prototype.setDimensions=function(n){if(!this._previewPaneVisible&&!this._debugWindowVisible){this.onPaneWidthSet(n);this._originalPaneWidth=n}},o.prototype.ensureWebViewWidthExpanded=function(){var i=n.SinglePaneWidth+n.PreviewPaneWidth;n.RuntimeConfig.QfMode==1&&t.width<i&&(t.setPaneWidth(i),this.setDimensions(i,null))},o.prototype.getScrollTop=function(){return this._qfContainer.scrollTop},o.prototype.scrollToTop=function(){this._qfContainer.scrollTop=0;_d.body.scrollTop=0},o.prototype.scrollTo=function(n){var t=_ge(n.id);this.scrollToElement(t,this._qfContainer,this._qfContainer.offsetHeight)},o.prototype.scrollToElement=function(n,t,i){var u=t.scrollTop,r=n.offsetTop-t.offsetTop,f=r+n.offsetHeight;f>u+i?t.scrollTop=f-i:r<u&&(t.scrollTop=r)},o.prototype.getSuggestionsContainerHeight=function(){return this._suggestionsContainerHeight||this.calculateSuggestionsContainerHeight(),this._suggestionsContainerHeight},o.prototype.getSuggestionsContainerWidth=function(){return(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)?t.width:_w.innerWidth},o.prototype.resetSuggestionsContainerHeight=function(){this._suggestionsContainerHeight=0},o.prototype.calculateSuggestionsContainerHeight=function(){var n=_ge("root").clientHeight,t;n<440&&(n=440);t=_ge("temporaryMessage");n-=t.offsetHeight;this._suggestionsContainerHeight=n},o.prototype.getPanelWidthFor=function(t){var i=this._originalPaneWidth;return i+=t&1?n.PreviewPaneWidth:0,i+(t&2?n.DebugWindowWidth:0)},o.prototype.getPanelState=function(){switch(t.width-this._originalPaneWidth){case 0:return 0;case n.PreviewPaneWidth:return 1;case n.DebugWindowWidth:return 2;case n.PreviewPaneWidth+n.DebugWindowWidth:return 3;default:return 0}},o.prototype.openSidePanel=function(n){var i=this.getPanelState(),u,r;if(i==0&&this.setDimensions(t.width,null),!(i&n)){u=i|n;r=this.getPanelWidthFor(u);t.setPaneWidth(r);this.onPaneWidthSet(r)}},o.prototype.closeSidePanel=function(i){var u=this.getPanelState(),f,r;if(u&i){f=u&~i;r=this.getPanelWidthFor(f);r!=this._originalPaneWidth||n.config.alwaysWideBeforeRS5?t.setPaneWidth(r):t.resetToDefaultSize();this.onPaneWidthSet(r)}},o.prototype.onPaneWidthSet=function(t){n.safeFireEvent("CortanaPaneWidthSet",t)},o.prototype.getOpenPreviewPaneButton=function(){if(!n.RuntimeConfig.PreviewPaneAvailable)return null;if(!this._openPreviewPaneButtonCache){var t=n.isRtl(),i=t?"&#xE96F":"&#xE970";this._openPreviewPaneButtonCache={defaultIcon:{content:i,type:2},openedIcon:{content:t?"&#xE72B":"&#xE72A",type:2},clickHandler:this._openPreviewPaneClickHandler}}return this._openPreviewPaneButtonCache},o.prototype.setContextMenuHandler=function(n){this._contextMenuHandler=n},o.prototype.setSuggestionClickHandler=function(n){this._suggestionClickHandler=n},o.prototype.setOpenPreviewPaneClickHandler=function(n){this._openPreviewPaneClickHandler=n},o.prototype.setExpanderClickInstrumentation=function(n){this._expanderClickInstrumentation=n},o.prototype.updateGroupsView=function(t){var r=this;if((n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.forceRenderingCrashOnSecondConversation)&&n.Host.getPaneCloseCount())throw new Error("Simulated exception");this.setQueryBasedCss(t.query);this.setConditionalCss("ieTopBanner",t.topResults.findIndex(function(t){return t.staticGroupType==n.GroupType.Upsell})>=0);this.setConditionalCss("noSuggestions",t.topResults.length==0&&t.groups.length==0);this.setConditionalCss("msnNewsEnabled",n.shouldEnableMSNNewsSearches(n.Host.getLanguage().toLowerCase()));var u=t.query&&t.query.isSearchHomeZI,f=u?null:" - "+n.getWebSuggestionAnnotation(n.msbEnabledForQuery(t.query)),e=n.RuntimeConfig.QfMode==8&&(!t.query||!t.query.queryToFetch)&&t.groups.length>0&&t.groups[0].type!=n.GroupType.QuickSearch,i={groups:t.groups,contextMenuHandler:this._contextMenuHandler,clickHandler:this._suggestionClickHandler,openPreviewPaneButton:this.getOpenPreviewPaneButton(),webSuggestionAnnotation:f,deleteMRUButtonCallback:e?function(){return r.deleteMRUButtonCallback()}:null,notifyIconPending:function(t,i){return n.InstrumentationHelper.notifyIconPending(t,i)},notifyIconReadyOrFailed:function(t,i){return n.InstrumentationHelper.notifyIconReadyOrFailed(t,i)}};this.renderReactView("groups",n.View.WindowsGroups,n.config.reactGroups?n.deepCopy(i,["parent"],["deviceItem"]):i)},o.prototype.deleteMRUButtonCallback=function(){sj_evt.fire("clearMRUButtonClicked");n.Host.refreshCurrentPane()},o.prototype.updateFENarratorSuggestionCount=function(t){var i="";this._isFileExplorerOrControlPanel&&t&&(i=n.Host.getLocString("SuggestionCountNarrator",""+t));this.renderReactView("narratorMessageContainer",n.View.FileExplorerNarratorAnnouncement,{message:i})},o.prototype.updateTopResultsView=function(t){var i,r;this.setQueryBasedCss(t.query);this.setConditionalCss("noSuggestions",t.topResults.length==0&&t.groups.length==0);this._isFileExplorerOrControlPanel&&(i=t.topResults.length,this.updateFENarratorSuggestionCount(i>0?i:null));r={suggestions:t.topResults,contextMenuHandler:this._contextMenuHandler,clickHandler:this._suggestionClickHandler,openPreviewPaneButton:this.getOpenPreviewPaneButton(),notifyIconPending:function(t,i){return n.InstrumentationHelper.notifyIconPending(t,i)},notifyIconReadyOrFailed:function(t,i){return n.InstrumentationHelper.notifyIconReadyOrFailed(t,i)}};this.renderReactView("topResults",n.View.WindowsTopResults,n.config.reactGroups?n.deepCopy(r,["parent"],["deviceItem"]):r)},o.prototype.showTemporaryMessage=function(t){var i=this,r;this._windowsTemporaryMessageShown?(this.hideTemporaryMessage(),n.safeSetTimeout(function(){return i.showTemporaryMessage(t)},100,"showTemporaryMessage")):(r={messageText:t,clickHandler:function(){i.hideTemporaryMessage();n.Host.setFocusInSearchBox(null,"temporaryMessage")}},this.updateTemporaryMessageView(r),this._windowsTemporaryMessageShown=!0,n.setVisibility(this._windowsTemporaryMessageWrapper,!0))},o.prototype.hideTemporaryMessage=function(){this._windowsTemporaryMessageShown&&(this.updateTemporaryMessageView(null),this._windowsTemporaryMessageShown=!1,n.setVisibility(this._windowsTemporaryMessageWrapper,!1))},o.prototype.updateTemporaryMessageView=function(t){this.renderReactView("temporaryMessage",n.View.WindowsMessage,{dataModel:t,icon:{content:"&#xE946",type:2},messageClassName:f})},o.prototype.updateIndexingMessageView=function(t){var i=!!t;this._windowsIndexingMessageShown!=i&&(this.renderReactView("temporaryMessage",n.View.WindowsMessage,{dataModel:t,icon:t&&t.messageText==n.Host.getLocString("WindowsIndexingInProgressMessage")?{content:"&#xE895",type:2}:null,messageClassName:e}),this._windowsIndexingMessageShown=i,n.setVisibility(this._windowsIndexingMessageWrapper,i),this.resetSuggestionsContainerHeight())},o.prototype.updateDialogBox=function(t){t.isVisible?n.Host.setFocusInWebView("updateDialogBox"):n.Host.setFocusInSearchBox(null,"updateDialogBox: hidden");this.renderReactView("dialogBox",n.View.WindowsDialogBox,{dataModel:t})},o.prototype.updateRewardsFlyout=function(t){this.renderReactView("rewardsFlyoutContainer",n.View.RewardsFlyout,{dataModel:t})},o.prototype.updateTopHitHeaderView=function(t){this.renderReactView("topHitHeader",n.View.TopHitHeader,n.config.reactGroups?n.deepCopy({dataModel:t},["parent"]):{dataModel:t})},o.prototype.createFlyout=function(t,i){var r=this;return n.config.enableEducationalFlyout?(this._flyoutController||(this._flyoutController=new n.FlyoutController(this,i),n.Host.bindQueryChangedOrInitialized(function(n){r._flyoutController.onQueryChange(n)})),this._flyoutController.createFlyout(t)):null},o.prototype.renderFlyoutAreaView=function(t){t.acknowledgeFlyoutText=n.Host.getLocString("AcknowledgeFlyoutText");t.nextFlyoutText=n.Host.getLocString("NextFlyoutText");t.stepCounterText=n.Host.getLocString("FlyoutStepCounterFormat",(t.currentStep+1).toString(),t.nbSteps.toString());t.dismissFlyoutText=n.Host.getLocString("DismissFlyout");this._flyoutController.setQuery(n.Host.getQuery());n.RuntimeConfig.QfMode===0||n.RuntimeConfig.QfMode===4?this._flyout.classList.add("flyoutSinglePane"):this._flyout.classList.remove("flyoutSinglePane");this.renderReactView("flyoutContainer",n.View.Flyout,{dataModel:t});this.showFlyoutAreaView();this.renderReactView("overlayContainer",n.View.Overlay,{dataModel:t});t.overlay&&this.showOverlayAreaView()},o.prototype.showFlyoutAreaView=function(){n.setVisibility(this._flyout,!0);this._flyout.style.animation="none";this._flyout.offsetHeight;this._flyout.style.animation=null},o.prototype.hideFlyoutAreaView=function(){n.setVisibility(this._flyout,!1)},o.prototype.showOverlayAreaView=function(){n.setVisibility(this._flyoutOverlay,!0)},o.prototype.hideOverlayAreaView=function(){n.setVisibility(this._flyoutOverlay,!1)},o.prototype.updateScopesHeaderView=function(t){this.renderReactView("scopesHeader",n.View.ScopesHeader,{dataModel:t})},o.prototype.updatePreviewErrorMessageView=function(t){this.renderReactView("errorPane",n.View.PreviewErrorMessageContainer,{dataModel:t,icon:{content:"&#xF303",type:2}})},o.prototype.updatePreviewContainerView=function(t){this.renderReactView("localPane",n.View.WindowsPreviewContainer,{dataModel:t,expanderClickInstrumentation:this._expanderClickInstrumentation,chevronDownIcon:{content:"&#xE70D",type:2},cortanaInfoIcon:{content:"&#xE946",type:2}})},o.prototype.updateMsbPreviewContainerView=function(n){var t=_ge("b_bfb"),i,r;t!=null&&(i=_w.BingAtWork,i&&i.clearMsbContainer&&i.clearMsbContainer(),t.remove());r=_ge("msbPane");n.suggestion?(t=sj_ce("div","b_bfb"),t.classList.add("fbig"),r.appendChild(t),r.classList.add("localPreviewContainer","msbPreviewContainer")):r.classList.remove("localPreviewContainer","msbPreviewContainer")},o.prototype.updateMenuView=function(t){this.renderReactView("menuContainer",n.View.WindowsMenu,{dataModel:t})},o.prototype.updatePopoverView=function(t){this.renderReactView("popoverContainer",n.View.Popover,{dataModel:t})},o.prototype.updateSnipSearchMessageView=function(t){this.renderReactView("messageContainer",n.View.SnipSearchMessage,{dataModel:t})},o.prototype.setProgressIndicatorVisibility=function(t){this._progressBarVisible!=t&&(this._progressBar||(this._progressBar=_ge("b_progress")),n.setVisibility(this._progressBar,t),this._progressBarVisible=t)},o.prototype.setPreviewPaneVisibility=function(t){this._previewPaneVisible!=t&&(t||this.closeSidePanel(1),n.setVisibility(this._previewPane,t),t&&this.openSidePanel(1),this._previewPaneVisible=t)},o.prototype.toggleDebugWindowVisibility=function(){return this.setDebugWindowVisibility(!this._debugWindowVisible),this._debugWindowVisible},o.prototype.updateOptionsWindowView=function(t){this.renderReactView("optionsContainer",n.View.OptionsWindow,{dataModel:t})},o.prototype.setDebugWindowVisibility=function(t){n.setVisibility(this._debugWindow,t);n.RuntimeConfig.AlwaysWide?this.setConditionalCss("debugWindowOpen",t):t?this.openSidePanel(2):this.closeSidePanel(2);this._debugWindowVisible=t},o.prototype.applyAccentColor=function(){var r=n.Host.getAccentColor(),o,e,f,t;this._lastAccentColor!=r&&(e="accent-style",f=_ge(e),f||(f=_d.createElement("style"),f.setAttribute("id",e),f.type="text/css",o=!0),t=".icon svg { fill: {0} }",t+=".gridLayout .suggestion.sa_hv, .gridLayout .suggestion.sa_hv:hover { border-color: {1}; }",t+=".toggleSwitch input:checked + label::before { background-color: {0}; border-color: {0}; }",n.isHighContrastEnabled()||(t+=".accentColor, .accentColor:visited, .zeroInput19H1 .group.topItemsGroup .suggestion.liveTile.noImageBackground .forecast .fctext, .zeroInput19H1 .group.topItemsGroup .suggestion.liveTile.noImageBackground .forecast .iconContainer .icon, #MSNN .title, #MSNN .icon { color: {0}; }",t+=".sa_hv, .sa_hv.selectable:active, .sa_hv.selectable:hover, .sa_hv .openPreviewPaneBtn:active, .group.welcomeExperience .selectable.sa_hv { background-color: {1}; }",t+=".sa_hv.suggestion:hover { background-color: {3}; }",t+=".darkThemeBeta:not(.zeroInput19H1) .sa_hv.suggestion:hover { background-color: {4}; }",t+=".sa_hv.withOpenPreviewPaneBtn:not(.previewPaneOpened) .openPreviewPaneBtn:hover { background-color: {2}; }",t+=".sa_hv.withOpenPreviewPaneBtn:not(.previewPaneOpened) .suggDetailsContainer:hover { background-color: {2}; }",t+="#footer { background-color: {8}; }",t+="#footer:hover { background-color: {9}; }",t+="#footer:active { background-color: {10}; }",t+=".edgeUpsell .additionalCalloutText, .meetingPrep .additionalCalloutText { color: {15} }",t+=".zeroInput19H1 .edgeUpsell .additionalCalloutText, .zeroInput19H1 .meetingPrep .additionalCalloutText, .zeroInput19H1 .wweUpsell .additionalCalloutText, .zeroInput19H1 .group.skypePromoSuggGroup .suggestion .additionalCalloutText { background: {0} }",t+=".zeroInput19H1 .edgeUpsell .additionalCalloutText:hover, .edgeUpsell .additionalCalloutText:active, .zeroInput19H1 .meetingPrep .additionalCalloutText:hover, .meetingPrep .additionalCalloutText:active, .zeroInput19H1 .wweUpsell .additionalCalloutText:hover, .zeroInput19H1 .wweUpsell .additionalCalloutText:active, .zeroInput19H1 .group.skypePromoSuggGroup .suggestion .additionalCalloutText:hover, .zeroInput19H1 .group.skypePromoSuggGroup .suggestion .additionalCalloutText:active { background: {12} }",t+=".zeroInput19H1.wideByDefault.searchHomeQuickAnswer.darkTheme19H1 .groupContainer.skypePromoSuggGroup .promoLinkLabel { color: {13} }",t+=".zeroInput19H1.wideByDefault.searchHomeQuickAnswer .groupContainer.skypePromoSuggGroup .promoLinkLabel { color: {0} }",t+=":not(.groupContainer).topHitConnectedToGroup:not(.sa_hv):not(.previewPaneOpened) { background: {2}; }",t+="#root:not(.wideByDefault) .selectedScope { background-color: {3}; }",t+="#root:not(.wideByDefault) .selectedScope:hover { background-color: {4}; }",t+="#root:not(.wideByDefault) .selectedScope:active { background-color: {5}; }",t+="#root.wideByDefault .selectedScope { border-color: {0}; }",t+="#startMenu .icon { background-color: {5}; }",t+=".accentButtonBackground { background-color: {6}; }",t+=".accentButtonBackground:focus { background-color: {1}; }",t+=".scopeOptions input[type='button'], .topOptions input[type='button'] { background-color: {12}; border-color: {12} }",t+=".scopeOptions input[type='button']:hover, .topOptions input[type='button']:hover { border-color: {3} }",t+=".expanderContainer.selectedExpander .expanderInnerCircle, .expanderContainer:hover .expanderInnerCircle { background-color: {1}; border-color: {11} }",t+=".darkThemeBeta .expanderContainer.selectedExpander .expanderInnerCircle, .darkThemeBeta .expanderContainer:hover .expanderInnerCircle { background-color: {16}; border-color: {11} }",t+=".previewContainer .expanderContainer.selectedExpander .divider, .previewContainer .expanderContainer:hover .divider { border-color: {1} }",t+=".darkThemeBeta .previewContainer .expanderContainer.selectedExpander .divider, .darkThemeBeta .previewContainer .expanderContainer:hover .divider { border-color: {16} }",t+=".zeroInput19H1 .secondaryText.selectable { color: {12} }",t+=".zeroInput19H1.darkTheme19H1 .secondaryText.selectable, .darkThemeBeta .accentColor, .darkThemeBeta .accentColor:visited, .darkTheme19H1 .popover .buttonList .accentColor, .zeroInput19H1.darkTheme19H1 .group.topItemsGroup .suggestion.liveTile.noImageBackground .forecast .fctext, .zeroInput19H1.darkTheme19H1 .group.topItemsGroup .suggestion.liveTile.noImageBackground .forecast .iconContainer .icon, .zeroInput19H1.darkTheme19H1 #MSNN .title, .zeroInput19H1.darkTheme19H1 #MSNN .icon, .darkThemeBeta .edgeUpsellQF.edgeUpsell .additionalCalloutText, .meetingPrep .additionalCalloutText { color: {13} }",t+=".santorini .selectable, .santorini .appsGroup .selectable { border-color: transparent }",t+=".santorini .sa_hv.selectable, .santorini .appsGroup .sa_hv.selectable  { border-color: {0} }",t+="circle.radial { stroke: {0} }",t+="#dialog_overlay.wsbModal input.colored { background-color: {12}; }",t+="#dialog_overlay.wsbModal input.colored:hover {background-color: {15}}",t+=".zeroInput19H1.darkTheme19H1 #dialog_overlay.wsbModal input.colored { background-color: {16}; }",t+=".zeroInput19H1.darkTheme19H1 #dialog_overlay.wsbModal input.colored:hover {background-color: {13}}",t+=".flyoutButton { background-color: {0}; }",t+=".miniflyout .flyoutButton { color: {0}; }",t+=".zeroInput19H1.darkTheme19H1 .miniflyout .flyoutButton { color: {13}; }",t+=".zeroInput19H1 .suggestion.meetingPrep .meetingDetailsContainer .confirmedRect { background: {0} }",t+=".zeroInput19H1 .suggestion.meetingPrep .meetingDetailsContainer .joinMeetingText { color: {0} }",t+=".zeroInput19H1 .suggestion.meetingPrep .meetingDetailsContainer .unconfirmedRect { background-size: 7px 7px; background-image: linear-gradient(-45deg,{0} 25%, transparent 0,transparent 50%, {0}, {0} 75%, transparent 0, transparent); }",t+=".zeroInput19H1.darkTheme19H1 .suggestion.meetingPrep .meetingDetailsContainer .confirmedRect { background: {13} }",t+=".zeroInput19H1.darkTheme19H1 .suggestion.meetingPrep .meetingDetailsContainer .joinMeetingText { color: {13} }",t+=".zeroInput19H1.darkTheme19H1 .suggestion.meetingPrep .meetingDetailsContainer .unconfirmedRect { background-size: 7px 7px; background-image: linear-gradient(-45deg,{13} 25%, transparent 0,transparent 50%, {13}, {13} 75%, transparent 0, transparent); }",t+=".zeroInput19H1.darkTheme19H1 .suggestion.meetingPrep .additionalCalloutText { background: {13} }",t+=".zeroInput19H1.wideByDefault .topOptions .advancedOptions .advancedOption.msb-aad-upsell .messageWithButton .advancedOptionButton {  background: {0}; }",t+=".zeroInput19H1.wideByDefault .topOptions .advancedOptions .advancedOption.msb-aad-upsell .messageWithButton .advancedOptionButton:active {  background: {12} }",t+=".zeroInput19H1.wideByDefault .topOptions .advancedOptions .advancedOption.msb-aad-upsell .messageWithButton .advancedOptionButton:hover {  background: {12} }",t+=".cobaltSelectionExperiment:not(.zeroInput19H1) .suggestion.sa_hv:before {  border-color: {0} }"),f.innerHTML=n.formatString(t,[r,i(r,.3),i(r,.1),i(r,.4),i(r,.6),i(r,.7),i(r,.15),h(r,35),u(r,.65),u(r,.8),u(r,.9),i(r,0),n.Host.getAccentColor(1),n.Host.getAccentColor(-2),i(r,.2),n.Host.getAccentColor(2),n.Host.getAccentColor(-1),]),o&&_d.head.appendChild(f),this._lastAccentColor=r)},o.prototype.adjustHeightAsync=function(){n.safeSetTimeout(function(){return n.Host.adjustHeight()},0,"adjustHeightAsync")},o.prototype.bindOnNarratorLaunch=function(n){this._narratorLaunchHandlers.push(n)},o.prototype.render=function(t){var i=this;this._renderingTimer&&sb_ct(this._renderingTimer);this._renderingInProgress=!0;try{n.View.ViewData=this.getViewData();t()}finally{this._renderingTimer=n.safeSetTimeout(function(){i._renderingTimer=null;i._renderingInProgress=!1},0,"BasePage render")}},o.prototype.renderReactView=function(t,i,r){var e=this,u,f;n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("React Render - "+t);u=this._targetElemCache[t];u||(this._targetElemCache[t]=u=_ge(t));f=r;f.adjustHeight||(f.adjustHeight=function(){return e.adjustHeightAsync()});this.render(function(){return _w.ReactDOM.render(React.createElement(i,r),u)},t);n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("React Render - "+t)},o.prototype.addViewData=function(n,t){this._viewData[n]=t},o.prototype.getViewData=function(){return this._viewData},o}();n.Page=o}(WSB||(WSB={})),function(n){var t=54e5,i=function(){function i(i){var r=this;this._appCacheInstrumentationHelper=i;this._isReloadSuppressed=!1;this._pendingReload=!1;i.registerSuperFresh();n.Host.hasFallbackHappened()&&(this._isReloadSuppressed=!0,this._lastReloadAfterFallback=n.getCurrentTime());n.Host.bindAppHidden(function(){(r._isReloadSuppressed=r._lastReloadAfterFallback&&n.getCurrentTime()-r._lastReloadAfterFallback<t,r._isReloadSuppressed)||(!r._pendingReload&&n.config.reloadAfterConversations&&n.Host.getPaneCloseCount()>=n.config.reloadAfterConversations&&(r._pendingReload=!0),r._pendingReload&&(r.logReloadAttempt(),r.reload()))});sj_be(applicationCache,"updateready",function(){return r.onUpdateReady()});n.Host.bindConversationStart(function(){r._isReloadSuppressed=!0;r.shouldCheckForUpdate()&&n.contains([1,4,5],applicationCache.status)&&n.safeExecute(function(){return applicationCache.update()},"probe for manifest update: "+applicationCache.status)})}return i.prototype.shouldCheckForUpdate=function(){if(!n.isBingEnabled())return!1;return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.disableAppCache)?!1:!0},i.prototype.onUpdateReady=function(){this.logReloadAttempt();this._isReloadSuppressed?this._pendingReload=!0:this.reload()},i.prototype.reload=function(){n.Host.reloadWebView()},i.prototype.logReloadAttempt=function(){this._appCacheInstrumentationHelper.instrumentSuperFreshUpdate(this._isReloadSuppressed)},i}();n.SuperFreshAppCache=i}(WSB||(WSB={})),function(n){var t,i;(function(t){function u(t,i,r,u,f,e,o,s){var a,c,l,h,v;o===void 0&&(o=1);n.config.safeChainStack&&(a=(new Error).stack);l=function(i){n.config.safeChainStack&&(i.stack&&(a=i.stack+"\n"+a),i.stack=a);c&&f.unregister(c);switch(o){case 1:SharedLogHelper.LogError(t,e,s||i);break;case 2:SharedLogHelper.LogWarning(t,e,s||i)}u&&u(i)};try{h=i();h?(f&&h.cancel&&(c=f.register(function(){return h.cancel()},!1,t+" cancellation")),v=function(i){c&&f.unregister(c);r&&n.safeExecute(function(){return r(i)},t+" safeChain() completion")},h.done?h.done(v,l):h.then(v,l)):l(new Error("No promise returned"))}catch(y){l(y)}}function r(t,i,r,u){i.completed=!0;i.result=r;i.pendingCallbacks.forEach(function(t){return n.safeExecute(function(){return t(r)},u)});i.pendingCallbacks=null}function f(){i={}}function e(){var n=[];for(var t in i)i[t].completed||n.push(t);n.forEach(function(n){return delete i[n]})}function o(u,f,e,o,s,h,c,l,a){return a===void 0&&(a=1),function(v,y){var w=e(v),p=i[w],b;p||(p={started:!1,completed:!1,result:null,pendingCallbacks:[]},i[w]=p);p.completed?y(p.result):(p.pendingCallbacks.push(y),p.started||(p.started=!0,b=function(){t.safeChain(u,function(){return f(v)},function(n){h&&!h(n)&&delete i[w];r(w,p,o?o(n):n,u)},function(t){n.isCancellation(t)?r(w,p,null,u):l?(l-=1,b()):r(w,p,s,u)},null,c,a)},b()))}}t.safeChain=u;var i={};t.clearGlobalCache=f;t.clearPendingItemsFromCache=e;t.safeChainWithGlobalCaching=o})(t=n.Promise||(n.Promise={})),function(n){function t(n,t,i){for(var u,f,e={},r=0,o=n;r<o.length;r++)u=o[r],f=t[u],f&&(e[u]=i(f));return e}function i(n){for(var t in n)if(n[t])return!1;return!0}n.map=t;n.isEmpty=i}(i=n.Map||(n.Map={}))}(WSB||(WSB={})),function(n){var i="show",t=10,r=function(){function r(t,i,r){var u=this;this._page=t;this._showIcons=i;this.adjustHeight=r;this._root=_ge("root");this._menuStack=[];this._menuContainer=_ge("menuContainer");this._itemClickHandler=function(t,i){i.button==0&&(t.subItems?t.isSelectable&&!t.isExpanded&&(u.showSubMenu(t),t.isSticky=!0):t.click&&t.click(n.getCurrentTime(),n.getInputType(i)))};this._itemEnterHandler=function(t){t.isSelectable&&!t.isExpanded&&(t.subItems&&(u._hoverTimer&&sb_ct(u._hoverTimer),u._hoverTimer=n.safeSetTimeout(function(){u._hoverTimer=0;var n=_ge(t.id);t&&!t.isExpanded&&n&&n.matches(":hover")&&u.showSubMenu(t)},500,"menu item mouse enter")),u.stickParent(t))};this._itemLeaveHandler=function(t){t.isExpanded&&!t.isSticky&&n.safeSetTimeout(function(){var n=_ge(t.id);t&&!t.isSticky&&n&&!n.matches(":hover")&&(t.subItems.some(function(n){return n==u._selectedItem})&&u.select(null,!1),u.dismissSubMenu(t))},450,"menu item mouse leave")};sj_be(_d.body,"mouseup",function(n){u._menuContainer.contains(n.target)||u.dismiss()});n.TestHookUrlParameters||sj_be(_w,"blur",function(){return u.dismiss()});sj_evt.bind("ajax.threshold.pageStart",function(){return u.dismiss()});n.Host.bindKeyEscape(function(n){u.isMenuVisible()&&(n.handled=!0,u._menuStack.length>0?u.reselectParentItem():u.dismiss(!0))})}return r.prototype.showSubMenu=function(t){if(!t.isExpanded){this._selectedItem&&this.select(null,!1);var i=_ge(t.id),r=i.querySelector(".contextMenu");t.isExpanded=!0;n.setVisibility(r,!0);this.adjustSubMenuPosition(i,r);this._menuStack.push(t);this._page.updateMenuView(this.getDataModel())}},r.prototype.dismissSubMenu=function(t){var u,f,i,e,r;if(this._selectedItem&&this.select(null,!1),t){if(i=this._menuStack.indexOf(t),i<0)return;for(e=this._menuStack.slice(i),r=0;r<e.length;++r)this.dismissSubMenu()}else t=this._menuStack.pop(),u=_ge(t.id),f=u.querySelector(".contextMenu"),t.isExpanded=!1,t.isSticky=!1,n.setVisibility(f,!1);this._page.updateMenuView(this.getDataModel())},r.prototype.showMenu=function(t,r){var u=this,e,h,f,o,c,s;if(this._menuItems.length){for(n.setVisibility(this._menuContainer,!0),e=this.getDataModel(),this._page.updateMenuView(e),h=function(n){n.getIcon&&n.getIcon(1,function(t){n.icon=t;u._page.updateMenuView(u.getDataModel())})},f=0,o=this._menuItems;f<o.length;f++)c=o[f],h(c);s="renderContextMenu";n.safeSetTimeout(function(){u.adjustPosition(t,r,e.menuType!=0);u._menuContainer.classList.add(i);var f=_qs("#menuContainer > .contextMenu");f.focus();f.scrollTop=0;n.Host.setFocusInWebView(s)},0,s)}},r.prototype.innerShowContextMenu=function(n,t,i,r,u){this.dismiss();var f=this.getContextMenuItems(n,r);f&&f.length>0&&(this._menuItems=f,this._onDismiss=u,this._menuType=0,t-=this._root.offsetLeft,i-=this._root.offsetTop,this.showMenu(t,i))},r.prototype.showDropdownMenu=function(t,i,r,u){if(this.dismiss(),this._parentElement=i,t&&t.length>0){this._menuItems=t;this._onDismiss=u;this._menuType=r;var f=i.offsetLeft,e=i.offsetTop+i.offsetHeight+1;n.isRtl()&&(f+=i.offsetWidth);this.showMenu(f,e)}},r.prototype.showContextMenuOnElement=function(n,t,i,r){var u=t.getBoundingClientRect(),f=u.left+t.offsetWidth/2,e=u.top+this._page.getScrollTop()+t.offsetHeight/2;this.showContextMenuOnXY(n,f,e,i,r)},r.prototype.showContextMenuOnXY=function(t,i,r,u,f){var o=this,e,s;this._parentElement=null;f&&(e=t.childSuggestions.filter(function(n){return n.text===f.text}),e&&e.length&&(t=e[0]));s=n.getVerbsAsync("showContextMenu",t,n.config.rawVerbs,!1,function(f){return n.safeSetTimeout(function(){return o.innerShowContextMenu(n.extendVerbs(f,t,o._page),i,r,function(i,r,u,f){n.InstrumentationHelper.instrumentItemClickForContextMenu(r,t.instItem,t.sequenceNumber,t.instrumentPingBack,u,f,i)},u)},0,"showContextMenu handler")},function(){return!0});f||s||(this._page.hideTemporaryMessage(),n.Host.setFocusInSearchBox(null,"noContextMenu"))},r.prototype.getSelectableItems=function(){var n,t;return this._menuItems?(n=[],this._menuStack.length>0?(t=this._menuStack[this._menuStack.length-1],n=t.subItems):n=this._menuItems,n.map(function(n){return n.groupItems?n.groupItems:[n]}).reduce(function(n,t){return n.push.apply(n,t),n},[]).filter(function(n){return n.isSelectable})):[]},r.prototype.getSelectableItemsByGroup=function(){return[]},r.prototype.getSelectedItem=function(){return this._selectedItem},r.prototype.getDataModel=function(){return{items:this._menuItems,showIcons:this._showIcons,clickHandler:this._itemClickHandler,menuType:this._menuType,enterHandler:this._itemEnterHandler,leaveHandler:this._itemLeaveHandler,expandIcon:this.getExpandIcon()}},r.prototype.getExpandIcon=function(){return{content:n.isRtl()?"&#xE76B":"&#xE76C",type:2}},r.prototype.select=function(n){var t;this._selectedItem&&(t=_ge(this._selectedItem.id),t&&t.blur(),this._selectedItem.selected=!1);this._selectedItem=n;this._selectedItem&&(t=_ge(this._selectedItem.id),t&&t.focus(),this._selectedItem.selected=!0);n&&this.stickParent(n);this._page.updateMenuView(this.getDataModel())},r.prototype.stickParent=function(n){var u=this.getParent(n),f,t,r,i;for(u&&(u.isSticky=!0),f=this.getSiblings(n),t=0,r=f;t<r.length;t++)i=r[t],i.isSticky&&(i.isSticky=!1,this._itemLeaveHandler(i,null))},r.prototype.isItemInMenuOrMenuGroup=function(n,t){return t.some(function(t){return t==n||t.groupItems&&t.groupItems.indexOf(n)>=0})},r.prototype.getParent=function(n){for(var r,t=0,i=this._menuStack;t<i.length;t++)if(r=i[t],this.isItemInMenuOrMenuGroup(n,r.subItems))return r;if(this.isItemInMenuOrMenuGroup(n,this._menuItems))return null;throw new Error("Item: '"+n.id+"' was not found");},r.prototype.getSiblings=function(n,t){t===void 0&&(t=!1);var i=this.getParent(n),r=i?i.subItems:this._menuItems;return r.map(function(n){return n.groupItems?n.groupItems:[n]}).reduce(function(n,t){return n.push.apply(n,t),n},[]).filter(function(i){return i.isSelectable&&(t||i!=n)})},r.prototype.selectSubItem=function(n,t){this.showSubMenu(n);this.select(t,!1)},r.prototype.reselectParentItem=function(){var n=this._menuStack[this._menuStack.length-1];this.dismissSubMenu();this.select(n,!1)},r.prototype.onAfterKeyDown=function(t,i,r,u){var f,o,e;if((r||u)&&!n.isUpOrDownKey(t))return!1;if(t=n.getRtlAdjustedKey(t),t==39||t==13){if(f=this._selectedItem,f&&f.subItems&&f.subItems[0]&&(o=f.subItems.filter(function(n){return n.isSelectable})[0],o))return this.selectSubItem(f,o),!0}else if(t==37){if(this._menuStack.length>0)return this.reselectParentItem(),!0}else if(n.isUpOrDownKey(t)&&this._selectedItem)return e=this._menuStack.length==0?_qs(".contextMenu"):_ge(this._menuStack[this._menuStack.length-1].id).querySelector(".contextMenu"),e&&this._page.scrollToElement(_ge(this._selectedItem.id),e,e.offsetHeight),!0;return t==13},r.prototype.isMenuVisible=function(){return!!this._menuItems},r.prototype.dismiss=function(t){if(this._menuItems&&(this._menuItems=null,this._selectedItem&&(this._selectedItem.selected=!1,this._selectedItem=null),this._page.updateMenuView(this.getDataModel()),this._menuContainer.classList.remove(i),this._menuContainer.style.width=null,n.setVisibility(this._menuContainer,!1),n.RuntimeConfig.PanelCanResize&&(this._root.style.minHeight="",this.adjustHeight()),this._menuStack=[]),t&&this._parentElement&&this._parentElement.focus(),this._parentElement=null,this._onDismiss){var r=this._onDismiss;this._onDismiss=null;r()}},r.prototype.adjustSubMenuPosition=function(i,r){var h,y,d,o;if(this._menuItems){var f=this._menuContainer,p=f.offsetWidth,w=r.offsetHeight,s=r.offsetWidth,b=0,e=window.getComputedStyle(r).paddingTop;e.endsWith("px")&&(e=e.substr(0,e.length-2),b=+e+1);var l=0,k=_qs("#menuContainer .contextMenu").scrollTop,a=n.isRtl(),v=6;for(h=0,y=this._menuStack;h<y.length;h++)d=y[h],o=_ge(d.id).querySelector(".contextMenu"),v=+o.style.zIndex,l+=o.offsetLeft,k+=o.scrollTop,a=o.offsetLeft<0;++v;var u=f.offsetLeft+l+i.offsetLeft,c=f.offsetTop+i.offsetTop-k-b,g=this._root.offsetWidth-(u+p),nt=u,tt=s<g,it=s<nt;(a||!tt)&&it?u-=s:a&&it||!tt?u=nt>g?t:this._root.offsetWidth-s-t:u+=p-2;c+w>this._root.offsetHeight&&(c=Math.max(this._root.offsetHeight-w,this._root.offsetTop));u-=f.offsetLeft+l;c-=f.offsetTop;r.style.left=u+"px";r.style.top=c+"px";r.style.zIndex=v.toString()}},r.prototype.adjustPosition=function(i,r,u){var e,s;if(this._menuItems){var o=this._menuContainer,f=o.offsetWidth,h=o.offsetHeight;f>this._root.offsetWidth&&(f=this._root.offsetWidth,o.style.width=f+"px");e=i;s=r;n.isRtl()?(e-=f,e<0&&(e=u?t:i)):e+f>this._root.offsetWidth&&(e=u?this._root.offsetWidth-f-t:Math.max(i-f,this._root.offsetLeft));!u&&s+h>this._root.offsetHeight&&(s=Math.max(this._root.offsetHeight-h,this._root.offsetTop));o.style.left=e+"px";o.style.top=s+"px";n.RuntimeConfig.PanelCanResize&&(this._root.style.minHeight=s+h+"px",this.adjustHeight())}},r.prototype.getContextMenuItems=function(t,i){var r=this;return t.map(function(t,u){var f={id:encodeURIComponent(t.verb),text:t.displayName,isSeparator:!t.verb,selected:!1,isDefault:t.isDefault,icon:t.icon,getIcon:t.getIcon,click:undefined,title:undefined,cssClass:undefined,isSelectable:!!t.verb};return f.isSeparator?f.id="Separator"+u:f.click=function(u,f){i(t.verb,u,f,null);t.executeSync?(n.safeExecute(function(){return t.executeSync()},"verb.executeSync",null,t.verb),r.dismiss()):n.Promise.safeChain("verb.executeAsync",function(){return t.executeAsync()},function(){return r.dismiss()},null,null,t.verb)},f})},r}();n.MenuFactory=r}(WSB||(WSB={})),function(n){var t="ConnectedAccounts",i=function(){function i(t){this._storage=t;this._accountsCache={};(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.clearSSOCache)&&this.clear();this.init()}return i.prototype.setToken=function(n,t){this.setTokenInfo(t,n);this.writeToLocalStorage()},i.prototype.findAccount=function(n,t){var i=this._accountsCache[n];return i&&!this.isExpired(i.LastUpdated,t,i.ExpireDateTime)?i:null},i.prototype.clear=function(){this._accountsCache={};this.writeToLocalStorage()},i.prototype.init=function(){this._accountsCache={};var i=this._storage.getItem(t);i&&(this._accountsCache=n.safeExecute(function(){return JSON.parse(i)},"parseConnectedAccountString",{}))},i.prototype.writeToLocalStorage=function(){this._storage.setItem(t,JSON.stringify(this._accountsCache))},i.prototype.isExpired=function(t,i,r){var u,e,f;return i===undefined?!1:(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.forceTokenRefresh)?!0:(u=n.getCurrentTime(),r&&u>r)?!0:(e=6e4,f=Math.floor((u-t)/e),f<0||f>=i)},i.prototype.setTokenInfo=function(t,i){var r=this._accountsCache[t],u=n.getCurrentTime();r={Token:i.Token,LastUpdated:u,ExpireDateTime:i.ExpireDateTime,TenantName:i.TenantName,RoutingHint:i.RoutingHint,UserName:i.UserName};this._accountsCache[t]=r},i}();n.TokenStore=i}(WSB||(WSB={})),function(n){var i="SelectedAuthAccountId",t="consumers",r="organizations",u=60,f="72f988bf-86f1-41af-91ab-2d7cd011db47",e=function(){function e(n,t){var i=this;this._storage=n;this._tokenStore=t;this._pendingCallbacks={};this._availableMsaAccounts=[];this._availableAadAccounts=[];this._accessTokenAvailableHandlers=[];this._verifyAccountRequired=[];this._accountTypeChangedHandlers=[];this._selectedAccountChangedHandlers=[];SearchAppWrapper.CortanaApp.addEventListener("experiencelaunched",function(){SearchAppWrapper.CortanaApp.experienceId=="NotebookOffline"&&i._tokenStore.clear()})}return e.getWindowsAccountType=function(){return e._windowsAccountType},e.internalSetWindowsAccountType=function(n){e._windowsAccountType=n},e.getWindowsIdentity=function(){return e._windowsIdentity},e.internalSetWindowsIdentity=function(n){e._windowsIdentity=n},e.prototype.authTypeMatchesWindowsAccountType=function(n){var t=e.getWindowsAccountType();return t==4||(n==0?t==2:t==1)},e.prototype.setWindowsAccountType=function(n){var t=e.getWindowsAccountType();e.internalSetWindowsAccountType(n);n!=t&&this.fireAccountTypeChanged()},e.prototype.getAllSyncingAccounts=function(n,t,i,r,u){var c=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.registeredSyncRootInfo,o=[],l,e,s,h,f;for(l in c)f=c[l],typeof f=="string"&&f.includes("@")&&o.push(f);for(o.length==0&&u([]),e={responses:0,accounts:[]},s=0,h=o;s<h.length;s++)f=h[s],this.getAccountByUserName(n,t,f,i,r,function(n){++e.responses;n&&n.Token&&e.accounts.push(n);e.responses==o.length&&u(e.accounts)})},e.prototype.getAllAvailableAccounts=function(n){return n==0?this._availableMsaAccounts.slice(0):this._availableAadAccounts.slice(0)},e.prototype.getCachedAccountInfo=function(n){if(!this.authTypeMatchesWindowsAccountType(n))return null;switch(n){case 1:return this._cachedAAD;case 0:return this._cachedMSA;default:return null}},e.prototype.getSelectedAccountInfo=function(){var r=this._storage.getItem(i),n,t=this._availableAadAccounts.concat(this._availableMsaAccounts);if(t.length>0){if(r&&(n=t.filter(function(n){return n.accountId==r})[0],n))return this.cacheAccount(n),n;n||(n=t.filter(function(n){return n.isDefaultAccount})[0]);n||(n=t[0]);n&&this.setSelectedAccount(n)}return n},e.prototype.setSelectedAccount=function(n){if(this.cacheAccount(n),e.getWindowsAccountType()!=4){var r=this._storage.getItem(i),u=n.accountProviderAuthority==t?2:1;if(r==n.accountId)return;this.setWindowsAccountType(u);this.fireSelectedAccountChanged(n)}this._storage.setItem(i,n.accountId)},e.prototype.isMsaAvailable=function(){return this._availableMsaAccounts.length>0},e.prototype.isAadAvailable=function(){return this._availableAadAccounts.length>0},e.prototype.cacheAccount=function(n){n.accountProviderAuthority==t?this._cachedMSA=n:this._cachedAAD=n},e.prototype.cacheAllAccounts=function(n){var i,u,r;for(this._availableMsaAccounts=[],this._availableAadAccounts=[],i=0,u=n;i<u.length;i++)r=u[i],r.accountProviderAuthority==t?this._availableMsaAccounts.push(r):this._availableAadAccounts.push(r)},e.prototype.getAccountByUserName=function(t,i,r,u,f,e){var o,s=i==0?this._availableMsaAccounts:this._availableAadAccounts,h;s.length>0&&(o=s.find(function(n){return n.accountUserName.toLocaleLowerCase()==r.toLocaleLowerCase()}));o?(h=t?n.getSubstrateResourceOrScope(i):n.getBingResourceOrScope(i),this.getAccount(i,h,u,f,e,o)):e(null)},e.prototype.getAccount=function(n,t,i,r,u,f){var o=this,s,e;if(!t)throw new Error("Resource or Scope has to be set");if(s=function(n){var t=o._pendingCallbacks[e];o._pendingCallbacks[e]=null;t.forEach(function(t){return t(n)})},!this.authTypeMatchesWindowsAccountType(n)){u(null);return}if(f||(f=this.getCachedAccountInfo(n)),e=t+i+r+(f?f.accountId:""),this._pendingCallbacks[e]){this._pendingCallbacks[e].push(u);return}this._pendingCallbacks[e]=[u];this.authenticate(n,t,i,r,s,f)},e.prototype.authenticate=function(t,i,r,e,o,s){var l=this,a=t+"."+i+(s?"|"+s.accountId:""),h,c,y,p;if(e){var w=r?0:u,b=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.noAuthCache,v=b?null:this._tokenStore.findAccount(a,w);if(v){o(v);return}}h=function(){return o(null)};n.isBrowserOnline()?(c=SearchAppWrapper.CortanaApp.authenticationManager.createAuthenticateRequest(),c.accountType="Windows",c.silentMode=e,t==1?c.resource=i:c.scope=i,y=s&&SearchAppWrapper.CortanaApp.authenticationManager.authenticateSearchWebAccountAsync,p=y?function(){return SearchAppWrapper.CortanaApp.authenticationManager.authenticateSearchWebAccountAsync(c,s)}:function(){return SearchAppWrapper.CortanaApp.authenticationManager.authenticateAsync(c)},n.Promise.safeChain("authenticateAsyncWAM",p,function(r){var u,c,v,y,p;if(n.TestHookUrlParameters)if(e){if(n.TestHookUrlParameters.ssoAuthFail){h();return}}else if(n.TestHookUrlParameters.uxAuthFail){h();return}if(!r){n.log("WAM returned null");h();return}if(n.RuntimeConfig.QfMode==8&&(t==1||i=="service::cortana.bing.com::mbi_ssl")&&e&&r.status==3){n.log("WAM indicates UserInteractionRequired");l.authenticate(t,i,!0,!1,o,s);return}if(r.token){if(u=r.properties,c=u.UPN||r.userName,!c){n.log("WAM didn't return UPN");h();return}v=void 0;t==0?v="MSA:"+c:(y=u.tid,n.isMsftAccountConnected=y==f,y&&u.OID&&(v="OID:"+u.OID+"@"+y));p={Token:r.token,ExpireDateTime:u.exp?parseInt(u.exp)*1e3-3e5:null,TenantName:u.tenant_display_name||"",RoutingHint:v||c,UserName:c};t==0&&(p.ExpireDateTime=n.getCurrentTime()+n.HourToMs);l._tokenStore.setToken(p,a);o(l._tokenStore.findAccount(a))}else r.errorCode||r.errorMessage?n.log("WAM error "+r.errorCode+": "+r.errorMessage):n.log("WAM returned an empty token"),h()},h)):h()},e.prototype.bindAccessTokenAvailable=function(n){this._accessTokenAvailableHandlers.push(n)},e.prototype.bindVerifyAccountRequired=function(n){this._verifyAccountRequired.push(n)},e.prototype.bindAccountTypesChanged=function(n){this._accountTypeChangedHandlers.push(n)},e.prototype.bindSelectedAccountChanged=function(n){this._selectedAccountChangedHandlers.push(n)},e.prototype.fireAccountTypeChanged=function(){this._accountTypeChangedHandlers.forEach(function(n){return n()})},e.prototype.fireSelectedAccountChanged=function(n){this._selectedAccountChangedHandlers.forEach(function(t){return t(n)})},e.prototype.tryConnect=function(t,i){var u=this,f=t==1?n.isSubstrateO365AccountConnected:n.isSubstrateOutlookAccountConnected,r;f||(r=n.getSubstrateResourceOrScope(t),this.getAccount(t,r,!1,!0,function(i){var f=!!i;t==1?n.isSubstrateO365AccountConnected=f:n.isSubstrateOutlookAccountConnected=f;f?u._accessTokenAvailableHandlers.forEach(function(i){return n.safeExecute(function(){return i(t,r)},"accessTokenAvailable",null,""+t)}):u._verifyAccountRequired.forEach(function(i){return n.safeExecute(function(){return i(t,r)},"accessTokenAvailable",null,""+t)})},i))},e.prototype.updateWindowsAccountType=function(i){for(var h,r,o,f=!1,u=!1,e=0,s=i;e<s.length;e++)h=s[e],h.accountProviderAuthority==t?f=n.isCloudSearchEnabledMsaCache:u=n.isCloudSearchEnabledAadCache;r=3;n.config.userProfileButtonEnabled?(o=this.getSelectedAccountInfo(),o&&(r=o.accountProviderAuthority==t?2:1)):!u||typeof n.isTenantMsbEnabled!="function"||!n.isTenantMsbEnabled()||(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)?f&&u?r=4:u?r=1:f&&(r=2):r=1;this.setWindowsAccountType(r)},e.prototype.connectAccounts=function(i,u){var e,o,f;for(n.isSubstrateO365AccountConnected=!1,n.isSubstrateOutlookAccountConnected=!1,e=0,o=i;e<o.length;e++)f=o[e],f.accountProviderAuthority==t&&n.isCloudSearchEnabledMsaCache?this.tryConnect(0,f,u):f.accountProviderAuthority==r&&n.isCloudSearchEnabledAadCache&&this.tryConnect(1,f,u)},e.prototype.accountTypeToAuthType=function(n){switch(n){case 2:return 0;case 1:return 1;default:throw new Error("Not a logged in account: "+n);}},e.prototype.enumerateAccountAuthority=function(i,u){var f=this;n.Promise.safeChain("enumerateAccountAuthorityAsync",function(){return SearchAppWrapper.CortanaApp.authenticationManager.enumerateAccountAuthorityAsync()},function(o){var s,h,c;if(s=e.getWindowsAccountType(),s==0){h=3;switch(o.Windows){case t:h=2;break;case r:h=1}f.setWindowsAccountType(h);s=e.getWindowsAccountType();s!=3&&(c=f.accountTypeToAuthType(s),f.getAccount(c,n.getBingResourceOrScope(c),!1,!0,function(n){return e.internalSetWindowsIdentity(n&&n.UserName?n.UserName:"")}))}n.isCloudSearchEnabledCache&&n.substrateProvidersEnabled()&&(s==1?f.tryConnect(1,null,i):s==2&&f.tryConnect(0,null,i));u()})},e.prototype.enumerateMultiAccountAuthority=function(i,u){var f=this;if(!SearchAppWrapper.CortanaApp.authenticationManager.getAllSearchWebAccountsAsync){this.enumerateAccountAuthority(i,u);return}n.Promise.safeChain("getAllSearchWebAccountsAsync",function(){return SearchAppWrapper.CortanaApp.authenticationManager.getAllSearchWebAccountsAsync()},function(o){var s,c,l,v,w,y,a,p,h;if(f.cacheAllAccounts(o),s=[],f._availableMsaAccounts.length>0&&(c=Math.max(f._availableMsaAccounts.findIndex(function(n){return n.isDefaultAccount}),0),s.push(f._availableMsaAccounts[c])),f._availableAadAccounts.length>0&&(c=Math.max(f._availableAadAccounts.findIndex(function(n){return n.isDefaultAccount}),0),s.push(f._availableAadAccounts[c])),!n.config.userProfileButtonEnabled)for(l=0,v=s;l<v.length;l++)h=v[l],f.cacheAccount(h);if(w=e.getWindowsAccountType(),f.updateWindowsAccountType(s),e.getWindowsAccountType()!=w)for(y=function(t,i){f.getAccount(t,n.getBingResourceOrScope(t),!1,!0,function(n){return e.internalSetWindowsIdentity(n&&n.UserName?n.UserName:"")},i)},a=0,p=s;a<p.length;a++)h=p[a],h.accountProviderAuthority==t&&n.isCloudSearchEnabledMsaCache?y(0,h):h.accountProviderAuthority==r&&n.isCloudSearchEnabledAadCache&&y(1,h);n.isCloudSearchEnabledCache&&n.substrateProvidersEnabled()&&f.connectAccounts(s,i);u()})},e.prototype.promptAutheticateDialog=function(t,i,r,u){var f=this,e=function(e){var o=!!e;t==1?n.isSubstrateO365AccountConnected=o:n.isSubstrateOutlookAccountConnected=o;o?(r(),f._accessTokenAvailableHandlers.forEach(function(r){return n.safeExecute(function(){return r(t,i)},"promptAccessTokenAvailable",null,""+t)})):(u(),f._verifyAccountRequired.forEach(function(r){return n.safeExecute(function(){return r(t,i)},"promptAccessTokenAvailable",null,""+t)}))};this.getAccount(t,i,!1,!1,e)},e._windowsAccountType=0,e}();n.AccessTokenManager=e}(WSB||(WSB={})),function(n){var i="cohortProfile",r="WSBFirstOpenedDate",u=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/,t=29,f=function(){function f(t){var i=this;this._lightweightStorage=t;this._cohortProfile=[];n.Host.bindShown(function(){i.deserializeCohortProfile();i.updateCohortProfileBasedOnWSBOpenedDate();i.determineWSBNewUser()});n.Host.bindDismissed(function(){i.serializeCohortProfile()})}return f.getSingleton=function(){return f._singleton||SharedLogHelper.LogError("cohortProfileManager.getSingleton()",null,"CohortProfileManager._singleton should be initialized first!"),f._singleton},f.initSingleton=function(n){return f._singleton||(f._singleton=new f(n)),f._singleton},f.prototype.serializeCohortProfile=function(){this._lightweightStorage.setItem(i,JSON.stringify(this._cohortProfile));this._lightweightStorage.setItem(r,JSON.stringify(this._WSBFirstOpenedDate))},f.prototype.deserializeCohortProfile=function(){var u=this,f=this._lightweightStorage.getItem(i),t;f&&(this._cohortProfile=n.safeExecute(function(){return JSON.parse(f,u.reviver)},"cohortProfile",null));t=this._lightweightStorage.getItem(r);t&&(this._WSBFirstOpenedDate=n.safeExecute(function(){return JSON.parse(t,u.reviver)},"firstOpen",null))},f.prototype.reviver=function(n,t){return typeof t=="string"&&u.test(t)?new Date(t):t},f.prototype.createCohortProfile=function(){var n,i;for(this._cohortProfile=[],n=0;n<30;n++)this._cohortProfile.push({date:null,count:0});i=new Date;this._cohortProfile[t].date=this.getCurrentDate(i);this._cohortProfile[t].count=1},f.prototype.recordWSBFirstOpenedDate=function(){for(var n=0;n<30;n++)this._cohortProfile[n].date&&(!this._WSBFirstOpenedDate||this._cohortProfile[n].date<this._WSBFirstOpenedDate)&&(this._WSBFirstOpenedDate=this._cohortProfile[n].date)},f.prototype.updateCohortProfileBasedOnWSBOpenedDate=function(){var i,f,n,r;if(this._cohortProfile.length==0)this.createCohortProfile(),this.recordWSBFirstOpenedDate();else{this._WSBFirstOpenedDate||this.recordWSBFirstOpenedDate();var e=this.getWSBLastOpenedDate(),o=new Date,u=this.getCurrentDate(o);if(e.getTime()===u.getTime())this._cohortProfile[t].count+=1;else if(i=this.getDaysBetween(e,u),i>30)this.createCohortProfile();else{for(f=[],n=0;n<30;n++)f.push({date:this._cohortProfile[n].date,count:this._cohortProfile[n].count});for(n=i;n<30;n++)this._cohortProfile[n-i]=f[n];for(n=0,r=30-i;n<i;n++,r++)this._cohortProfile[r].date=null,this._cohortProfile[r].count=0;this._cohortProfile[t].date=u;this._cohortProfile[t].count=1}}},f.prototype.getCurrentDate=function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate())},f.prototype.getDaysBetween=function(n,t){var i=n.getTime(),r=t.getTime(),u=r-i;return Math.round(u/864e5)},f.prototype.determineWSBNewUser=function(){var t,i,n;for(this._isWSBNewUser=!1,t=7,i=0,n=30-t;n<30-i;n++)this._WSBFirstOpenedDate!=null&&this._cohortProfile[n].date!=null&&this._WSBFirstOpenedDate.getTime()===this._cohortProfile[n].date.getTime()&&(this._isWSBNewUser=!0)},f.prototype.isWSBNewUser=function(){return this._isWSBNewUser},f.prototype.getWSBFirstOpenedDate=function(){return this._WSBFirstOpenedDate},f.prototype.getWSBLastOpenedDate=function(){return this._cohortProfile[t].date},f.prototype.getTimesOfWSBOpenedInLastNDays=function(n){var i,t;if(n>30)return-1;for(i=0,t=30-n;t<30;t++)i+=this._cohortProfile[t].count;return i},f.prototype.isWWEVisible=function(){if(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.showWWE)return n.config.enableWWENewUsers&&this._lightweightStorage.getItem("wweTourRefreshed")!="1";if(n.enableProngWeather(n.getCurrentLanguage()))return!1;var t=SearchAppWrapper.CortanaApp,r=t.entryPoint=="19h1wwe"||t.entryPoint=="19h2wwe",u=n.config.enableWWEUpsell&&r,i=n.config.enableWWENewUsers&&this.isWSBNewUser()&&this._lightweightStorage.getItem("wweTourTook")!="1";return this.isWSBNewUser()&&this._lightweightStorage.getItem("newUsersLogged")!="1"&&(n.InstrumentationHelper.logClientInstEvent("Select","newUsers",null),this._lightweightStorage.setItem("newUsersLogged","1")),i&&this._lightweightStorage.getItem("newUsersEnabledLogged")!="1"&&(n.InstrumentationHelper.logClientInstEvent("Select","newUsersEnabled",null),this._lightweightStorage.setItem("newUsersEnabledLogged","1")),(u||i)&&this._lightweightStorage.getItem("wweTourRefreshed")!="1"},f.prototype.isWWEVisibleSinglePane=function(){return this.isWWEVisible()&&!n.RuntimeConfig.AlwaysWide},f.prototype.isTourVisible=function(){var t=new n.LightweightStorage;return t.getItem("wweTourEnabled")=="1"},f.prototype.resetCohortProfileManager=function(){f._singleton=null;this._cohortProfile=[];this._WSBFirstOpenedDate=null},f.prototype.resetWSBFirstOpenedDate=function(){this._WSBFirstOpenedDate=null},f}();n.CohortProfileManager=f}(WSB||(WSB={})),function(n){var t;(function(t){function v(){n.Host.bindAppHidden(function(){SearchAppWrapper.CortanaApp.isBingEnabled&&n.isBrowserOnline()&&n.safeExecute(function(){return ut("asgw",["fp.msedge.net/conf/v1/asgw/fpconfig.min.json"],2e3)},"AFDFootprint.start",null,null)})}function ut(n,t,i){var o;if(n&&n.trim().length!==0&&Number(i)===i&&i%1==0&&!(i<0)){var e=h,v=rt,y=a(),p=f(),s="MonitorID="+n+"&rid="+p+"&w3c="+y+"&prot="+window.location.protocol+"&v="+v+"&DATA=";if(r)l(e,s,i);else{for(o in t)t[o]=e+t[o];u(t,0,c,e,s,i)}}}function l(n,t,i){var o=ft(r,n),s,f,u,e,h;if(o.length!==0){for(s=et(o,n,w),f=[],u=0,e=r.r;u<e.length;u++)h=e[u],f.push(n+h+"?"+t);ht(s,k,i,f)}}function u(t,i,f,e,o,s){var a=f!==it?0:1,h=t[i],v=SearchAppWrapper.CortanaApp.createStringMap(),c=SearchAppWrapper.CortanaApp.createStringMap();c["Content-Type"]="application/json";n.Promise.safeChain("fetchAFDUrl",function(){return SearchAppWrapper.CortanaApp.makeHttpRequestAsync(a,h,v,"",c)},function(c){c.statusCode===200&&e!=null&&o!=null&&s!=null&&n.Promise.safeChain("readAFDResponse",function(){return c.readAsStringAsync()},function(n){try{r=JSON.parse(n);l(e,o,s)}finally{}},function(){++i<t.length&&u(t,i,f,e,o,s)},null,h,0)},function(){++i<t.length&&u(t,i,f,e,o,s)},null,h,0,"makeHttpRequestAsync failed")}function ft(n,t){var o=[],l,a,r,v,w,u,h,b;if(!n||!n.e)return o;var k=t.toLowerCase()===p?s:e,nt=n.e,f=[],c=0;for(l=0,a=nt;l<a.length;l++)r=a[l],r.w>0&&(e<=r.m&&r.m<=y&&r.m&k||r.m===i)&&(c+=r.w,f.push({endpoint:r.e,cumWeight:c,weight:r.w,measurementType:r.m}));for(v=Math.min(n.n,f.length);o.length<v;){w=Math.floor(Math.random()*c);u=null;for(h in f)u==null?w<f[h].cumWeight&&(u=f[h],delete f[h]):f[h].cumWeight-=u.weight;c-=u.weight;b=u.measurementType&i?g:d;o.push({id:u.endpoint,testImage:b,measurementType:u.measurementType})}return o.sort(function(n,t){return n.measurementType-t.measurementType}),o}function et(n,t,r){for(var o,p,d,a=[],v=0,w=n;v<w.length;v++){var y=w[v],l=y.measurementType,k=y.testImage,u=y.id,c=t+u;u.indexOf(".")===-1?c+=".clo.footprintdns.com":u.charAt(0)==="*"&&(o=u.substring(2),p=f(),c=t+p+"."+o,u=o==="clo.footprintdns.com"||o==="nrb.footprintdns.com"||o==="azr.footprintdns.com"?p:o);c+=b;var g=c+r+"?"+f(),nt=l===i?t===h?e:s:l,tt=l!==i;a.push({url:g,requestID:u,object:r,conn:"cold",measurementType:nt,report:tt});d=c+k+"?"+f();a.push({url:d,requestID:u,object:k,conn:"warm",measurementType:l,report:!0})}return a}function ot(n,t){for(var r=[],i=0;i<t.length;i++)if(t[i].report){var f=n[i],u=t[i].measurementType,e=st(f,u);r.push({RequestID:t[i].requestID,Object:t[i].object,Conn:t[i].conn,Result:e,T:u})}return JSON.stringify(r)}function st(n,t){if(n===o)return n;if(t===i&&n>0){var r=nt/(n/tt);return Math.round(r)}return Math.round(n)}function f(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+n()+n()+n()+n()+n()+n()}function a(){return window.performance&&window.performance.getEntriesByName?!0:!1}function ht(n,t,i,r){function l(i){var k,p,g,w,nt,d,b,tt;if(f!=null&&clearTimeout(f),s[i]=h!=null?(new Date).getTime()-h:o,i=(v+y)%n.length,e=new Image,v++<n.length)h=(new Date).getTime(),e.onload=function(){l(i)},k=function(){e.onload=null;e.onerror=null;h=null;l(i)},f=setTimeout(function(){k()},t),e.onerror=function(){f!=null&&clearTimeout(f);f=null;k()},e.src=n[i].url;else if(r!=null&&r.length!==0){if(a())for(p=0;p<n.length;p++)g=n[p].url,w=window.performance.getEntriesByName(g),s[p]!==o&&w&&w[0]&&(s[p]=w[0].duration);for(nt=ot(s,n),d=[],b=0;b<r.length;b++)tt=r[b]+nt,d.push(tt);u(d,0,c,null,null,null)}}var h=null,f=null,s=[],v=0,e,y=0;setTimeout(function(){l(0)},i)}t.init=v;var r,e=1,s=2,y=3,i=8,p="http://",h="https://",w="trans.gif",b="/apc/",k=5e3,d="trans.gif",g="100k.gif",nt=822.128,tt=1e3,c="GET",it="POST",o=-1,rt="20180228"})(t=n.AFDFootprint||(n.AFDFootprint={}))}(WSB||(WSB={}));__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){var t=function(){function t(n,t){this.id=n;this._controller=t;this.flyoutMaxHeight=170;this.slackSize=10;this.currentStep=0;this.steps=[];this.dismissIntervalMs=0;this.repeatMax=1}return t.prototype.addMessage=function(n,t,i,r,u){t===void 0&&(t=null);var f={message:n,title:t};return i&&(f=__assign(__assign({},f),this.getPositions(i))),r&&(f.id=r),u&&(f.iconKey=u),this.steps.push(f),this},t.prototype.button=function(n,t,i){var r=this;return this.buttonMessage=n,this.buttonIcon={content:i,type:2},this.buttonClickHandler=function(n,i){r.dismiss();t(n,i)},this},t.prototype.showButton=function(n){return this.showButtonMessage=n,this},t.prototype.icon=function(n){return this._icon=n,this},t.prototype.overlay=function(n){return this._overlay=n,this},t.prototype.hasOverlay=function(){return this._overlay},t.prototype.getPositions=function(t,i){var d=n.RuntimeConfig.QfMode===0||n.RuntimeConfig.QfMode===4,f=d?336:400,e=152,p,w,o,h,b,c,l,s,a,k;this.flyoutClass==="miniflyout"&&(f=327,e=60);var r=_ge("root"),v=r?r.scrollHeight:document.body.scrollHeight,y=r?r.scrollWidth:document.body.scrollWidth,u=t.getBoundingClientRect();i||(p=u.bottom>v-this.flyoutMaxHeight,i=p?"Top":"Bottom");l=u.top+u.height/2;s=r?r.getBoundingClientRect().top:0;switch(i){case"Top":w=v-u.top+this.slackSize;break;case"Bottom":o=u.bottom+this.slackSize-s;break;case"Left":o=Math.max(Math.min(l-e/2-s,y-e),4);break;default:return null}switch(i){case"Top":case"Bottom":a=u.left+u.width/2;h=Math.max(Math.min(a-f/2,y-f),this.slackSize);c=Math.max(Math.min(a-h-this.slackSize,f-this.slackSize),this.slackSize);break;case"Left":k=r?r.getBoundingClientRect().right:0;b=k-u.left+this.slackSize;c=Math.max(Math.min(l-o-s-this.slackSize,e-this.slackSize),this.slackSize)}return{position:i,top:o,bottom:w,left:h,right:b,beakOffset:c}},t.prototype.target=function(n,t){if(!n)return this;var i=this.getPositions(n,t);return this.position=i.position,this.bottom=i.bottom,this.top=i.top,this.beakOffset=i.beakOffset,this.left=i.left,this.right=i.right,this},t.prototype.setSticky=function(){return this.sticky=!0,this},t.prototype.isSticky=function(){return this.sticky},t.prototype.show=function(){return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isTest)&&!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.showFlyoutInTests)||this._controller.showFlyout(this),this},t.prototype.dismissible=function(n,t){return this.dismissIntervalMs=n,this.dismissMessage=t,this},t.prototype.repeat=function(n){return this.repeatMax=n,this},t.prototype.dataModel=function(){var t=this;if(!this.isValid())return null;var n=this.steps[this.currentStep],i=n.message,r=n.title;return{title:r,message:i,flyoutClass:this.flyoutClass,left:this.stepHasProperty("left")?n.left:this.left,right:this.stepHasProperty("right")?n.right:this.right,top:this.stepHasProperty("top")?n.top:this.top,bottom:this.stepHasProperty("bottom")?n.bottom:this.bottom,beakOffset:this.stepHasProperty("beakOffset")?n.beakOffset:this.beakOffset,nextStep:function(){return t.nextStep()},nbSteps:this.steps.length,currentStep:this.currentStep,position:this.stepHasProperty("position")?n.position:this.position,iconKey:this.stepHasProperty("iconKey")?n.iconKey:this._icon,showDismissButton:!!(this.dismissIntervalMs&&this.dismissMessage),buttonClickHandler:function(i,r){t.buttonClickHandler(i,r);t._controller.instrumentClientEvent("FlyoutSubmit",{id:t.stepHasProperty("id")?n.id:t.id})},showButtonMessage:this.showButtonMessage,buttonMessage:this.buttonMessage,buttonIcon:this.buttonIcon,dismissMessage:this.dismissMessage,dismissClickHandler:function(){t.dismiss();t._controller.instrumentClientEvent("FlyoutDismiss",{id:t.stepHasProperty("id")?n.id:t.id})},id:this.stepHasProperty("id")?n.id:this.id,overlay:this._overlay}},t.prototype.setClass=function(n){return this.flyoutClass=n,this},t.prototype.isValid=function(){return this.steps.length>0&&(!isNaN(this.left)||!isNaN(this.right))&&(!isNaN(this.top)||!isNaN(this.bottom))},t.prototype.dismiss=function(){return this._controller.dismissFlyout(this.id),this},t.prototype.shouldBeShown=function(){var t=this._controller.getLastTimeShown(this.id),i=this._controller.getTimesShown(this.id);return(t==0||t+this.dismissIntervalMs<=n.getCurrentTime())&&i<this.repeatMax},t.prototype.hide=function(){return this.currentStep=0,this._controller.hideFlyout(this.id),this},t.prototype.nextStep=function(){this.currentStep=Math.min(this.currentStep+1,this.steps.length-1);this.show()},t.prototype.stepHasProperty=function(n){return n in this.steps[this.currentStep]},t}(),i=function(){function i(n,t){this._page=n;this._lightweightStorage=t;this.lastShownKey=function(n){return"flyout-last-shown-"+n};this.timesShownKey=function(n){return"flyout-times-shown-"+n}}return i.prototype.createFlyout=function(n){return new t(n,this)},i.prototype.showFlyout=function(n){var i=this.currentFlyout&&this.currentFlyout.id!=n.id,t;i&&(this.currentFlyout=n);this.currentFlyout=n;this.shouldShow(this.currentFlyout)&&(t=n.dataModel(),t&&(this._page.renderFlyoutAreaView(t),this.instrumentClientEvent("FlyoutShow",{id:this.currentFlyout.id})))},i.prototype.hideFlyout=function(t){(t===void 0&&(t=null),t&&this.currentFlyout&&t!==this.currentFlyout.id)||(this.currentFlyout&&this.currentFlyout.hasOverlay()&&(this._page.hideOverlayAreaView(),_ge("root").classList.remove("overlayEnabled")),this.currentFlyout=null,this._page.hideFlyoutAreaView(),n.config.enableWWETour&&(this._lightweightStorage.removeItem("wweTourEnabled"),n.Host.refreshCurrentPane(),this._lightweightStorage.removeItem("wweTourRefreshed")))},i.prototype.dismissFlyout=function(t){t&&this.currentFlyout&&t!==this.currentFlyout.id||(this.hideFlyout(t),this._lightweightStorage.setItem("wweTourTook","1"),this._lightweightStorage.setItem(this.lastShownKey(t),n.getCurrentTime().toString()),this._lightweightStorage.setItem(this.timesShownKey(t),(this.getTimesShown(t)+1).toString()))},i.prototype.wasDismissed=function(n){return!!this._lightweightStorage.getItem(this.lastShownKey(n))},i.prototype.shouldShow=function(n){return n.shouldBeShown()},i.prototype.getLastTimeShown=function(n){var t=parseInt(this._lightweightStorage.getItem(this.lastShownKey(n)));return t?t:0},i.prototype.getTimesShown=function(n){var t=parseInt(this._lightweightStorage.getItem(this.timesShownKey(n)));return t?t:0},i.prototype.onQueryChange=function(n){this.currentFlyout&&!this.currentFlyout.isSticky()&&this.queryOnActivation&&n.fullPartialQuery!=this.queryOnActivation.fullPartialQuery&&this.currentFlyout.hide()},i.prototype.setQuery=function(n){this.queryOnActivation=n},i.prototype.instrumentClientEvent=function(t,i){(i===void 0&&(i={}),n.InstrumentationHelper!=null)&&n.InstrumentationHelper.logClientInstEvent("Select",t,n.SequenceNumberManager.getSequenceNumber(),i)},i}();n.FlyoutController=i}(WSB||(WSB={})),function(n){var r="show",t=10,i=7,u=function(){function u(t){var i=this;this._page=t;this._root=_ge("root");this._popoverContainer=_ge("popoverContainer");n.Host.bindKeyEscape(function(n){i.isPopoverVisible()&&(n.handled=!0,i.dismiss(!0))});n.Host.bindShown(function(){i.dismiss(!1)});sj_be(this._popoverContainer,"mouseenter",function(){i.clearDismissTimer()});sj_be(this._popoverContainer,"mouseleave",function(){i.waitForEnterBeforeDismiss()});this.onMouseLeavesParent=this.onMouseLeavesParent.bind(this)}return u.prototype.getElementOffsetFromRoot=function(n){for(var t=0,i=0;n&&n!=this._root;)t+=n.offsetLeft,i+=n.offsetTop-n.scrollTop,n=n.offsetParent;return[t,i]},u.prototype.showPopover=function(n,t,i,r,u,f){if(this._parentElement){if(this._parentElement==i){this.clearDismissTimer();return}this.dismiss()}if(this._returnFocusToSearchBox=r,this._finishedOpening=!1,this._parentElement=i,sj_be(this._parentElement,"mouseleave",this.onMouseLeavesParent),n){this._text=n;this._buttons=t;this._className=f||"";var e=this.getElementOffsetFromRoot(i),o=e[0],s=e[1];o+=i.offsetWidth/2;this.showPopoverAt(o,s,u)}},u.prototype.isPopoverVisible=function(){return!!this._text&&this._finishedOpening},u.prototype.dismiss=function(t){this.clearDismissTimer();this._text&&(this._text=null,this._buttons=[],this._className="",this._popoverContainer.firstChild.blur(),this._selectedItem&&(this._selectedItem.selected=!1,this._selectedItem=null),this._page.updatePopoverView(this.getDataModel()),this._popoverContainer.classList.remove(r),n.setVisibility(this._popoverContainer,!1),this._popoverContainer.style.width=undefined,this._popoverContainer.style.bottom=undefined,this._popoverContainer.style.left=undefined);this._parentElement&&(sj_ue(this._parentElement,"mouseleave",this.onMouseLeavesParent),t&&(this._parentElement.focus(),this._returnFocusToSearchBox&&n.Host.setFocusInSearchBox(null,"popoverDismissed")));this._parentElement=null},u.prototype.getSelectableItems=function(){return this._buttons||[]},u.prototype.getSelectableItemsByGroup=function(){return[]},u.prototype.getSelectedItem=function(){return this._selectedItem},u.prototype.select=function(n){var t;this._selectedItem&&(t=_ge(this._selectedItem.id),t&&t.blur(),this._selectedItem.selected=!1);this._selectedItem=n;this._selectedItem&&(t=_ge(this._selectedItem.id),t&&t.focus(),this._selectedItem.selected=!0);this._page.updatePopoverView(this.getDataModel())},u.prototype.submit=function(t){var f,e,r,u,o,i;if(t.action){if(f=n.getCurrentTime(),t.instItem)for(n.InstrumentationHelper.instrumentItemClick(f,t.instItem,t.sequenceNumber,null,2,null),e=this.getSelectableItems(),r=0,u=e;r<u.length;r++)o=u[r],i=o,i.instItem&&n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(i.sequenceNumber,i.instItem.getQsCode(),i.instItem);t.action()}},u.prototype.onAfterKeyDown=function(t){var i,u,r;return(t=n.getRtlAdjustedKey(t),t==39||t==37)?(i=this.getSelectableItems(),i.length>0&&(u=this.getSelectedItem(),r=i.indexOf(u),r+=t==39?1:-1,r<0?this.select(i[i.length-1],!1):this.select(i[r%i.length],!1)),!0):t==13},u.prototype.onItemClick=function(n,t){t.button==0&&this.submit(n)},u.prototype.onMouseLeavesParent=function(){this.waitForEnterBeforeDismiss()},u.prototype.waitForEnterBeforeDismiss=function(){var t=this;this.clearDismissTimer();this._dismissTimer=n.safeSetTimeout(function(){t._dismissTimer=null;!t._parentElement||t._parentElement.matches(":hover")||t._popoverContainer.matches(":hover")||t.dismiss()},100,"waitForDismiss")},u.prototype.clearDismissTimer=function(){this._dismissTimer&&(sb_ct(this._dismissTimer),this._dismissTimer=null)},u.prototype.getDataModel=function(){var n=this;return{text:this._text,items:this._buttons,clickHandler:function(t,i){return n.onItemClick(t,i)},className:this._className}},u.prototype.adjustPosition=function(n,r){var f,o,h;if(this._text){var e=this._popoverContainer,u=e.offsetWidth+1,s=this._root.offsetWidth-2*t;u>s&&(u=s);e.style.width=u+"px";f=0;o=this._root.offsetHeight-r;n-=u/2;o+=i;n<t?f=t-n:n+u>this._root.offsetWidth-t&&(f=this._root.offsetWidth-t-(n+u));e.style.left=n+f+"px";e.style.bottom=o+"px";f<u/-2+i?f=u/-2+i:f>u/2-i&&(f=u/2-i);h=_qs(".popover .beak",this._popoverContainer);h.style.left="calc(50% - "+f+"px";this._finishedOpening=!0}},u.prototype.showPopoverAt=function(t,i,u){var f=this,o,e;n.setVisibility(this._popoverContainer,!0);o=this.getDataModel();this._page.updatePopoverView(o);e="renderPopover";n.safeSetTimeout(function(){if(f.adjustPosition(t,i),f._popoverContainer.classList.add(r),u&&f._buttons&&f._buttons.length!=0)f.select(f.getSelectableItems()[0],!1);else{var o=f._popoverContainer.firstElementChild;o.focus()}n.Host.setFocusInWebView(e)},0,e)},u}();n.PopoverFactory=u}(WSB||(WSB={})),function(n){function e(n,t){return n<<t|n>>>32-t}function t(n,t){var i=(n&65535)+(t&65535),r=(n>>16)+(t>>16)+(i>>16);return r<<16|i&65535}function h(n,t,i){return n&t|~n&i}function c(n,t,i){return n&i|t&~i}function l(n,t,i){return n^t^i}function a(n,t,i){return t^(n|~i)}function i(n,i,r,u,f,o,s){return n=t(n,t(t(h(i,r,u),f),s)),t(e(n,o),i)}function r(n,i,r,u,f,o,s){return n=t(n,t(t(c(i,r,u),f),s)),t(e(n,o),i)}function u(n,i,r,u,f,o,s){return n=t(n,t(t(l(i,r,u),f),s)),t(e(n,o),i)}function f(n,i,r,u,f,o,s){return n=t(n,t(t(a(i,r,u),f),s)),t(e(n,o),i)}function v(n){var i=[],r=n.length*8,t;for(i[(n.length>>2)-1]=undefined,t=0;t<i.length;t+=1)i[t]=0;for(t=0;t<r;t+=8)i[t>>5]|=(n.charCodeAt(t/8)&255)<<t%32;return i[r>>5]|=128<<r%32,i[(r+64>>>9<<4)+14]=r,i}function o(n){for(var u,t="",i="",r=0;r<=3;r++)u=n>>>r*8&255,i="0"+u.toString(16),t=t+i.substr(i.length-2,2);return t}function y(n){var ht,ct,lt,at,e=1732584193,s=4023233417,h=2562383102,c=271733878,y=7,p=12,w=17,b=22,k=5,d=9,g=14,nt=20,tt=4,it=11,rt=16,ut=23,ft=6,et=10,ot=15,st=21,a,l;for(n=unescape(encodeURIComponent(n)),a=v(n),l=0;l<a.length;l+=16)ht=e,ct=s,lt=h,at=c,e=i(e,s,h,c,a[l+0],y,3614090360),c=i(c,e,s,h,a[l+1],p,3905402710),h=i(h,c,e,s,a[l+2],w,606105819),s=i(s,h,c,e,a[l+3],b,3250441966),e=i(e,s,h,c,a[l+4],y,4118548399),c=i(c,e,s,h,a[l+5],p,1200080426),h=i(h,c,e,s,a[l+6],w,2821735955),s=i(s,h,c,e,a[l+7],b,4249261313),e=i(e,s,h,c,a[l+8],y,1770035416),c=i(c,e,s,h,a[l+9],p,2336552879),h=i(h,c,e,s,a[l+10],w,4294925233),s=i(s,h,c,e,a[l+11],b,2304563134),e=i(e,s,h,c,a[l+12],y,1804603682),c=i(c,e,s,h,a[l+13],p,4254626195),h=i(h,c,e,s,a[l+14],w,2792965006),s=i(s,h,c,e,a[l+15],b,1236535329),e=r(e,s,h,c,a[l+1],k,4129170786),c=r(c,e,s,h,a[l+6],d,3225465664),h=r(h,c,e,s,a[l+11],g,643717713),s=r(s,h,c,e,a[l+0],nt,3921069994),e=r(e,s,h,c,a[l+5],k,3593408605),c=r(c,e,s,h,a[l+10],d,38016083),h=r(h,c,e,s,a[l+15],g,3634488961),s=r(s,h,c,e,a[l+4],nt,3889429448),e=r(e,s,h,c,a[l+9],k,568446438),c=r(c,e,s,h,a[l+14],d,3275163606),h=r(h,c,e,s,a[l+3],g,4107603335),s=r(s,h,c,e,a[l+8],nt,1163531501),e=r(e,s,h,c,a[l+13],k,2850285829),c=r(c,e,s,h,a[l+2],d,4243563512),h=r(h,c,e,s,a[l+7],g,1735328473),s=r(s,h,c,e,a[l+12],nt,2368359562),e=u(e,s,h,c,a[l+5],tt,4294588738),c=u(c,e,s,h,a[l+8],it,2272392833),h=u(h,c,e,s,a[l+11],rt,1839030562),s=u(s,h,c,e,a[l+14],ut,4259657740),e=u(e,s,h,c,a[l+1],tt,2763975236),c=u(c,e,s,h,a[l+4],it,1272893353),h=u(h,c,e,s,a[l+7],rt,4139469664),s=u(s,h,c,e,a[l+10],ut,3200236656),e=u(e,s,h,c,a[l+13],tt,681279174),c=u(c,e,s,h,a[l+0],it,3936430074),h=u(h,c,e,s,a[l+3],rt,3572445317),s=u(s,h,c,e,a[l+6],ut,76029189),e=u(e,s,h,c,a[l+9],tt,3654602809),c=u(c,e,s,h,a[l+12],it,3873151461),h=u(h,c,e,s,a[l+15],rt,530742520),s=u(s,h,c,e,a[l+2],ut,3299628645),e=f(e,s,h,c,a[l+0],ft,4096336452),c=f(c,e,s,h,a[l+7],et,1126891415),h=f(h,c,e,s,a[l+14],ot,2878612391),s=f(s,h,c,e,a[l+5],st,4237533241),e=f(e,s,h,c,a[l+12],ft,1700485571),c=f(c,e,s,h,a[l+3],et,2399980690),h=f(h,c,e,s,a[l+10],ot,4293915773),s=f(s,h,c,e,a[l+1],st,2240044497),e=f(e,s,h,c,a[l+8],ft,1873313359),c=f(c,e,s,h,a[l+15],et,4264355552),h=f(h,c,e,s,a[l+6],ot,2734768916),s=f(s,h,c,e,a[l+13],st,1309151649),e=f(e,s,h,c,a[l+4],ft,4149444226),c=f(c,e,s,h,a[l+11],et,3174756917),h=f(h,c,e,s,a[l+2],ot,718787259),s=f(s,h,c,e,a[l+9],st,3951481745),e=t(e,ht),s=t(s,ct),h=t(h,lt),c=t(c,at);return(o(e)+o(s)+o(h)+o(c)).toLowerCase()}function p(n){var i=y(n),r,u,t;if(i==null||i.length!==32)return null;for(t=0;t<32;t++)if(r=i[t],!(/^\d+$/.test(r)||r>="a"&&r<="f"))return null;for(i+=0,u="",t=0;t<11;t++){var f=i[t*3],e=i[t*3+1],o=i[t*3+2],s=((f>="a"?f.charCodeAt(0)-"a".charCodeAt(0)+10:f.charCodeAt(0)-"0".charCodeAt(0))<<8)+((e>="a"?e.charCodeAt(0)-"a".charCodeAt(0)+10:e.charCodeAt(0)-"0".charCodeAt(0))<<4)+(o>="a"?o.charCodeAt(0)-"a".charCodeAt(0)+10:o.charCodeAt(0)-"0".charCodeAt(0));u=w(u,s)}return u}function w(n,t){return n.concat(s[Math.floor(t/64)]).concat(s[t%64])}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";n.generateKeyFromDomain=p}(WSB||(WSB={}))