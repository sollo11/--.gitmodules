(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([["255"],{"568":function(e,t,n){"use strict";n.r(t);n.d(t,"resourceKey",function(){return N});var r=n(0),i=n(25),s=n(5),o=n(7),u=n(83),a=n(381),f=n(6),l=n(15),c=n(785),h=n(30),p=n(129),d=n(85),v=n(60),m=n(138),g=n(338),y=n(2054),b=n(1754),w=n(178),E=n(80),S=n(1753),x=n(1420),T=(function(e){Object(r.__extends)(t,e);function t(t,n){var r=e.call(this,t,n)||this;r._moveCopyItems=function(e,t){return r._executeMoveCopy(e).then(function(n){return r._moveCopyOperationSuccess(n,t,e)},function(n){return i.n.wrapError(r._moveCopyHelper.moveCopyOperationFailure(n,t,e))})};r._itemProvider=n.itemProvider;r._itemTaskObserver=r.scope.attach(new n.itemTaskObserverType);r._moveCopyHelper=n.moveCopyItemsAsyncOperation;r._operationProvider=n.operationProvider;r._updateQuota=n.updateQuota;r._actionMap=n.actionMap;r._operatorBatchMonitorType=n.operatorBatchMonitorType;r._engagement=r.resources.consume(v.e);r._isItemsScopeEnabled=n.isItemsScopeEnabled;return r}t.prototype.copyItemsAsync=function(e){this._moveCopyHelper.startRumOneMeasure(!0,!1);return this._handleMoveCopyItemsAsync(e)};t.prototype.moveItemsAsync=function(e){this._moveCopyHelper.startRumOneMeasure(!0,!1);return this._handleMoveCopyItemsAsync(e)};t.prototype.copyItems=function(e){this._startTime=this._moveCopyHelper.startRumOneMeasure(!1,!1);return this._handleMoveCopyItems(e)};t.prototype.moveItems=function(e){var t=this;this._startTime=this._moveCopyHelper.startRumOneMeasure(!1,!0);var n=this._handleMoveCopyItems(e);return{group:n.group,wait:n.wait,complete:n.complete.then(function(n){for(var r=[],i={},s=0,o=n.items;s<o.length;s++){(f=o[s]).error||(i[f.id]=!0)}for(var u=0,a=e.items;u<a.length;u++){var f;i[(f=a[u]).id]&&r.push(new g.e(f.key).succeed({item:{key:f.key,parentKey:e.targetKey}}))}if(r.length){var l=t._itemTaskObserver;l.update(r);l.flush()}return n})}};t.prototype._moveCopyOperationSuccess=function(e,t,n){for(var r=0,i=t.length;r<i;r++){var s=t[r],o=e.items[r],u=o&&o.error,a=s.type.peek()===d.e.moveItems?w.r:w.e,f=s.payloads.peek().copyItems.item.key;if(u)this._moveCopyHelper.handleMoveCopyError(u,s);else{if(!e.items){S.i(f,a);throw new Error("No items returned from MoveCopy API")}s.progress.current(1);s.state(h.e.completed);S.r(f,a)}}this._itemProvider.invalidateItem(n.parentKey);this._itemProvider.invalidateItem(n.targetKey);this._isItemsScopeEnabled()&&this.resources.consumeAsync(l.D).then(function(e){e.invalidateItems(n.parentKey);e.invalidateItems(n.targetKey)});n.isMove||this._updateQuota(!0);t[0]&&t[0].type&&this._moveCopyHelper.endRumOneMeasure(this._startTime,!1,t[0].type.peek()===d.e.moveItems);return e};t.prototype._getContext=function(e){var t=e.remoteItem;return{parentKey:t&&t.ParentFolderUrl?t.ParentFolderUrl.split("&")&&t.ParentFolderUrl.split("&")[0]:e.targetKey,ignoreListContext:!0,webId:e.webId,siteId:e.siteId,remoteItem:e.remoteItem,authToken:e.authToken,remoteWebUrl:e.remoteWebUrl,isMountPointFolder:e.isMountPointFolder}};t.prototype._handleMoveCopyItemsAsync=function(e){var t=this,n=this._getContext(e),r=this._itemProvider.getItemSync(n).item,s=this.observables.create(!1),o=new p.e,u=this.scope.attach(new this._operatorBatchMonitorType({operationBatch:o})),a=e.items.map(function(n){return t._moveCopyHelper.registerOperation({item:n,context:e,targetItem:r.peek(),batch:o,getItemsError:s,moveCopyItems:function(e,n){return t._moveCopyItems(e,n).then(function(){})}})});return{group:u.getGroupOperation(),start:this._itemProvider.getItem(n).then(function(){return t._moveCopyHelper.handleMoveCopyAsyncItems(e,a)},function(n){var r;s(!0);t._moveCopyHelper.moveCopyOperationFailure(n,a,e);for(var o=0,u=a;o<u.length;o++){null===(r=u[o].actions().unlockVault)||void 0===r||r.isAvailable(!0)}return i.n.reject(n)}),wait:u.wait()}};t.prototype._handleMoveCopyItems=function(e){var t=this,n=this.observables,r=this._getContext(e),s=this._itemProvider.getItemSync(r).item,o=new p.e,u=this.scope.attach(new this._operatorBatchMonitorType({operationBatch:o})),a=e.items.map(function(r){var u,a={items:[r],parentKey:e.parentKey,targetId:e.targetId,targetKey:e.targetKey,cid:e.cid,group:e.group,isMove:e.isMove,nameConflict:e.nameConflict,taskId:e.taskId,deleteSource:e.deleteSource,isAsync:e.isAsync,overrideLock:e.overrideLock,ackMoveIfShared:e.ackMoveIfShared,remoteItem:e.remoteItem,authToken:e.authToken};return u=t._operationProvider.register({name:r.name,type:e.isMove?d.e.moveItems:d.e.copyItems,iconName:r.iconName,payloads:{moveItems:{item:r,destination:s.peek(),source:r.parent},copyItems:{item:r,destination:s.peek(),source:r.parent}},batch:o,actions:{rename:{isAvailable:n.create(!1),execute:function(){var n,r;t._engagement.logData({name:"MoveCopyItems.Rename.Click"});a.nameConflict=2;null===(n=u.actions().rename)||void 0===n||n.isAvailable(!1);null===(r=u.actions().overwrite)||void 0===r||r.isAvailable(!1);u.state(h.e.started);t._initEventQos(e);return a.isAsync?t._moveCopyHelper.handleMoveCopyAsyncItems(a,[u]):t._moveCopyItems(a,[u])}},overwrite:{isAvailable:n.create(!1),execute:function(){var n,r;t._engagement.logData({name:"MoveCopyItems.Overwrite.Click"});a.nameConflict=1;null===(n=u.actions().rename)||void 0===n||n.isAvailable(!1);null===(r=u.actions().overwrite)||void 0===r||r.isAvailable(!1);u.state(h.e.started);t._initEventQos(e);return a.isAsync?t._moveCopyHelper.handleMoveCopyAsyncItems(a,[u]):t._moveCopyItems(a,[u])}},cancel:{isAvailable:n.create(!1),execute:function(){var e,t,n=u.type.peek()===d.e.moveItems?w.r:w.e;null===(e=u.actions().rename)||void 0===e||e.isAvailable(!1);null===(t=u.actions().overwrite)||void 0===t||t.isAvailable(!1);u.state(h.e.canceled);S.t(u.payloads.peek().copyItems.item.key,n);return i.n.wrap(null)}},moveAnyway:{isAvailable:n.create(!1),execute:function(){var n,r,i;a.deleteSource=!0;a.isMove=!1;a.isAsync=!0;null===(n=u.actions().moveAnyway)||void 0===n||n.isAvailable(!1);null===(r=u.actions().rename)||void 0===r||r.isAvailable(!1);null===(i=u.actions().overwrite)||void 0===i||i.isAvailable(!1);u.state(h.e.started);t._initEventQos(e);return t._moveCopyHelper.handleMoveCopyAsyncItems(a,[u])}},moveLockedFile:{isAvailable:n.create(!1),execute:function(){var n;a.overrideLock=!0;t._initEventQos(e);null===(n=u.actions().moveLockedFile)||void 0===n||n.isAvailable(!1);return t.moveItems(a).complete}},vaultFileLimit:{isAvailable:n.create(!1),execute:function(){var e=new(t.managed(t._actionMap.VaultAction))({actionType:8,item:n.create(r),goPremiumSource:"PVault-QuotaErrorLearnMore"});u.state(h.e.expired);return e.execute({})}},moveSharedFileVault:{isAvailable:n.create(!1),execute:function(){u.state(h.e.completed);a.ackMoveIfShared=!1;t._initEventQos(e);return t.moveItems(a).complete}}},progress:{minimum:0,maximum:1,current:0}})});this._moveCopyHelper.markAllOperationsAsStarted(a);return{group:u.getGroupOperation(),complete:this._itemProvider.getItem(r).then(function(){return t._moveCopyItems(e,a)},function(n){return i.n.reject(t._moveCopyHelper.moveCopyOperationFailure(n,a,e))}),wait:u.wait()}};t.prototype._executeMoveCopy=function(e){return this.resources.consumeAsync(l.B).then(function(t){return e.isMove?t.moveItems(e):t.copyItems(e)})};t.prototype._initEventQos=function(e){var t=Object(b.e)(e),n=e.isMove?w.r:w.e;S.e(t,n)};t.dependencies=Object(r.__assign)(Object(r.__assign)({},o.n.dependencies),{itemProvider:u.resourceKey,moveCopyItemsAsyncOperation:y.resourceKey,itemTaskObserverType:c.r,operationProvider:m.e,updateQuota:a.e,isItemsScopeEnabled:E.c.lazy,actionMap:f.e,operatorBatchMonitorType:x.e});return t})(o.n);t.default=T;var N=Object(s.s)("MoveCopyProvider",T)},"674":function(e,t,n){"use strict";n.d(t,"e",function(){return c});var r=n(0),i=n(25),s=n(7),o=n(6),u=n(140),a=n(5),f=n(192),l=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});void 0===n&&(n={});var r=e.call(this,t,n)||this,i=r,s=i.resources,a=i.observables,l=n.getCurrentItem,c=void 0===l?s.consume(o.s.lazy.optional):l,h=n.getItemSetSelectionModel,p=void 0===h?s.consume(o.C.lazy.optional):h,d=n.getSelectionHelper,v=void 0===d?s.consume(u.t.lazy.optional):d,m=t.allowMultiSelect,g=void 0!==m&&m,y=t.canFallback,b=void 0!==y&&y,w=t.ignoreSelection,E=void 0!==w&&w,S=t.overrideItem,x=t.useCurrentSelectionGroup,T=void 0!==x&&x;r._allowMultiSelect=g;r._overrideItem=S;r._ignoreSelection=E;r._useCurrentSelectionGroup=T;r._placeholder=r.observables.create(new f.e);r._getSelectionModel=p;S||(r._selectionHelper=v&&v());b&&c&&(r._fallback=c());r.selection=a.pureCompute(r._computeSelection);r.firstItem=a.pureCompute(r._computeFirstItem);r.currentItem=a.pureCompute(function(){return(c&&c()||r._placeholder)()});return r}t.prototype.filterItems=function(e){var t=this.selection();if(!t.length)return!1;for(var n=this.observables,r=0,i=t;r<i.length;r++){var s=i[r],o=n.unwrap(s);if(!o)return!0;if(!e(o))return!1}return!0};t.prototype.resolveSelection=function(){var e=this;return this._resolveSelection().then(function(t){if(t&&t.length)return t;if(e._fallback){var n=e._fallback.peek();if(n)return[n]}return[]})};t.prototype.resolveFirst=function(){var e=this;return this._resolveSelection().then(function(t){return t&&t.length?t[0]:e._fallback?e._fallback.peek():void 0})};t.prototype.selectItems=function(e){var t=this._getSelectionModel();t&&t.setSelectedKeys(e.map(function(e){return e.key}))};t.prototype.clearSelection=function(){var e=this._getSelectionModel();e&&e.clear()};t.prototype.selectAll=function(){var e=this._getSelectionModel();e&&e.selectAll()};t.prototype._computeSelection=function(){var e=this._getCurrentSelection();return!this._allowMultiSelect&&e.length>1?[]:e||[]};t.prototype._computeFirstItem=function(){var e=this.selection();return e&&e[0]&&e[0]()};t.prototype._getCurrentSelection=function(){if(this._overrideItem)return[this._overrideItem];var e,t=this._getSelectionModel();if(t){if(this._useCurrentSelectionGroup&&t.getSelectionModelGroup()){var n=t.getSelectionModelGroup().currentSelection();n&&(t=n)}e=t.selection()}else e=[];(0===e.length||this._ignoreSelection)&&this._fallback&&(e=[this._fallback]);return e};t.prototype._resolveSelection=function(){var e=this;if(this._overrideItem)return i.n.resolve([this._overrideItem.peek()]);var t=this.observables.ignore(function(){return e._computeSelection()});if(this._ignoreSelection||!t.length)return i.n.resolve([]);var n=this._selectionHelper;return n?n.resolveSelection():i.n.reject(new Error("Unable to resolve selection."))};return t})(s.n),c=Object(a.o)("ItemSelectionHelper",l,Object(r.__assign)(Object(r.__assign)({},s.n.dependencies),{currentItem:o.s.lazy.optional,itemSetSelectionModel:o.C.lazy.optional,selectionHelper:u.t.lazy.optional}))},"753":function(e,t,n){"use strict";var r,i=n(0),s=n(63),o=n(764),u=n(101),a=Object(u.e)({eventName:"RUMOneDataUpload,",shortEventName:"RUMOneDataUpload"},{streamName:1,dictionary:4,privacyClassification:{isPrefixingDisabled:!0,type:1}}).withData({privacyClassification:"requiredService"}),f=n(371),l=n(112),c=n(251),h=n(802),p="undefined"==typeof window?self:window;(function(e){e[e.xhr=0]="xhr";e[e.fetch=1]="fetch"})(r||(r={}));var d,v,m=(function(){function e(){this._requestIdGenerator=(e=0,function(){return(e++).toString()});var e}e.prototype.instrument=function(e){var t=this;if(!p.__RUMOneAPITrackerInstrumented){p.__RUMOneAPITrackerInstrumented=!0;var n=e.fetch,r=e.xhr;if("XMLHttpRequest"in p&&"undefined"!=typeof XMLHttpRequest){this._originalXhrSend=XMLHttpRequest.prototype.send;this._originalXhrOpen=XMLHttpRequest.prototype.open;var i=this;XMLHttpRequest.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.requestUrl=e[1];return i._originalXhrOpen.apply(this,e)};XMLHttpRequest.prototype.send=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var s=i._requestIdGenerator();r.onRequest({request:this,id:s,type:0});this.addEventListener("readystatechange",function(){4===e.readyState&&r.onResponse({request:e,id:s,type:0})});return i._originalXhrSend.apply(this,t)}}if("fetch"in p&&void 0!==p.fetch){this._originalFetch=p.fetch.bind(p);p.fetch=function(e,r){return new Promise(function(i,s){var o=t._requestIdGenerator();n.onRequest({request:e,id:o,type:1});t._originalFetch(e,r).then(function(e){n.onResponse({response:e,id:o,type:1});i(e)},function(e){s(e)})})}}}};e.prototype.undoInstrument=function(){p.__RUMOneAPITrackerInstrumented=!1;this._originalXhrOpen&&(XMLHttpRequest.prototype.open=this._originalXhrOpen);this._originalXhrSend&&(XMLHttpRequest.prototype.send=this._originalXhrSend);this._originalFetch&&(p.fetch=this._originalFetch)};return e})(),g=n(104),y=n(153);n.d(t,"e",function(){return x});n.d(t,"t",function(){return C});(function(e){e[e.Incomplete=1]="Incomplete";e[e.ReadyToUpload=2]="ReadyToUpload";e[e.Uploaded=3]="Uploaded";e[e.TimeOut=4]="TimeOut";e[e.Skipped=5]="Skipped"})(d||(d={}));(function(e){e[e.own=0]="own";e[e.cors=1]="cors"})(v||(v={}));var b=function(e,t,n,r,i,s,o){this.url=e;this.duration=t;this.correlationId=n;this.status=r;this.startTime=i;this.endTime=s;this.name=o;this.clientDurationInMilliseconds=new Date(s).getTime()-new Date(i).getTime();this.origin=e&&new g.e(e).getHost()},w=["EUPL","ScenarioId"],E=/^[a-zA-Z0-9](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,S=/(?:\/api\/|\/_api\/)(.*?)(?:\(|\?|sharePoint\:|$)/,x=function(e,t,n,r,i,s,o){this.controlId=e;this.startTime=t;this.endTime=n;this.renderTimeCalculator=r;this.renderTimeRequiredDataChecker=i;this.ignoreForEUPL=void 0===s||s;this.needFlatten=void 0!==o&&o};function T(e){return null==e}var N={checkInterval:100,error_timeout:3e4,max_markers:200},C=(function(){function e(e,t,n){void 0===n&&(n=N);this._keyMetrics=w.slice(0);this.async=new s.e(this);this.dataStartTime=Date.now();this._rumoneData={};this.dataState=d.Incomplete;this.controls=[];this.apis=[];this._apiBuffer={};this._loggingFunctions=[];this.euplBreakDown={};this.ttiBreakDown={};this.serverMetrics={};this.isW3cTimingCollected=!1;this._isW3cResourceTimingCollected={};this.tempData={};this._settings={};this._emergencyUpdateFunc=this._emergencyUpload.bind(this);this._name=e;this.registerLoggingFunc(t);this._config=n;this.setPerfDataTimer();this._platformDetection=new f.e;this._hookUnloadEvent();this._apiTracker=new m}e.getRUMOneLogger=function(t,n,r){void 0===t&&(t="__default_rumone__");void 0===r&&(r=N);var i=n||function(e,t){a.logData({streamName:e,dictionary:t})};if(!e.Loggers[t])try{var s=new e(t,i,r);"__default_rumone__"===t&&(e.rumOneLogger=s);e.Loggers[t]=s}catch(e){}return e.Loggers[t]};e.prototype.registerLoggingFunc=function(e){var t=this,n=this._loggingFunctions.indexOf(e);n<0&&this._loggingFunctions.push(e);return function(){n>=0&&t._loggingFunctions.splice(n,1)}};Object.defineProperty(e.prototype,"KeyMetrics",{get:function(){if(this._TTIMeasurementEnabled()){this.addExpectedKeyMetric("TTI");this.addExpectedKeyMetric("FCI")}return this._keyMetrics},enumerable:!0,configurable:!0});e.prototype.getPerformanceData=function(){return this._rumoneData};e.prototype.startAPIMeasurement=function(e){var t=this,n=e&&e.ignore||function(e){return!1},r=e&&e.getAPIName||function(e){},s=function(e){var n=e.id,r=e.request,i=e.type,s=new b;s.startTime=(new Date).toISOString();s.startTimeRelative=t.now();1===i&&(s.url="string"==typeof r?r:r.url);t._apiBuffer[n]=s};this._apiTracker.instrument({fetch:{onRequest:s,onResponse:function(e){var s=e.response,o=e.id,u=t._apiBuffer[o];if(u&&!n(u.url)){var a=void 0;try{a=s.headers.get("SPClientServiceRequestDuration")}catch(e){}var f=void 0;try{f=s.headers.get("SPRequestGuid")}catch(e){}u.name=r(u.url);u=Object(i.__assign)(Object(i.__assign)({},u),Object(i.__assign)(Object(i.__assign)({endTime:(new Date).toISOString(),endTimeRelative:t.now(),clientDurationInMilliseconds:t.now()-u.startTimeRelative,status:s.status},a?{duration:Number(a)}:{}),f?{correlationId:f}:{}));t.apis.push(u)}}},xhr:{onRequest:s,onResponse:function(e){var s=e.request,o=e.id,u=t._apiBuffer[o],a=s.responseURL||s.requestUrl;if(u&&!n(a)){var f;f=s.getResponseHeader("SPClientServiceRequestDuration");var l;l=s.getResponseHeader("SPRequestGuid");u.name=r(a);u=Object(i.__assign)(Object(i.__assign)({},u),Object(i.__assign)(Object(i.__assign)(Object(i.__assign)({endTime:(new Date).toISOString(),endTimeRelative:t.now(),clientDurationInMilliseconds:t.now()-u.startTimeRelative,status:s.status},f?{duration:Number(f)}:{}),l?{correlationId:l}:{}),{url:a}));t.apis.push(u)}}}});return function(){t._apiTracker.undoInstrument()}};e.prototype.resetLogger=function(){this._emergencyUpload();this._apiBuffer={};this.dataStartTime=(new Date).getTime();this.dataState=d.Incomplete;this.isW3cTimingCollected=!1;this._isW3cResourceTimingCollected={};this.controls=[];this.apis=[];this.tempData={};this._rumoneData={};this._settings={};this._keyMetrics=w.slice(0);this.clearPerfDataTimer();this.setPerfDataTimer();this.euplBreakDown={};this.ttiBreakDown={};this.serverMetrics={};this.clearResourceTimings();Object(l.n)(this._getOwnMakers().map(function(e){return e.name}));e._markers[this._name]=[];this._unhookUnloadEvent();this._hookUnloadEvent();this._ttiPromise=void 0;this._fciPromise=void 0;this.logMessageInConsole("Reset performance Logger Done")};e.prototype.setSettings=function(e){this._settings=Object(i.__assign)(Object(i.__assign)({},this._settings),e)};e.prototype.excludePageForPerfData=function(){this.setSettings({excludePageData:!0})};e.prototype.getPerformanceDataPropertyValue=function(e){return e&&this._rumoneData[e]};e.prototype.setPerformanceDataPropertyValue=function(e,t){if(e&&E.test(e)){this._rumoneData[e]=t;return!0}console.error("key "+e+" does not confrim to the Regex "+E);return!1};e.prototype.addExpectedControl=function(e){var t=this._normalizeControl(e);this.expectingControl(e)?this.controls.filter(function(e){return e.controlId===t.controlId})[0].ignoreForEUPL=t.ignoreForEUPL:this.controls.push(t)};e.prototype.expectingControl=function(e){var t=this._normalizeControl(e);return this.controls.filter(function(e){return e.controlId===t.controlId}).length>0};e.prototype.writeServerCorrelationId=function(e){this._rumoneData.ServerCorrelationId=this._rumoneData.ServerCorrelationId||e};e.prototype.writeServerUrl=function(){this._rumoneData.ServerUrl=this._processEUIIUrl(location.href)};e.prototype.writeServerSideLatency=function(e,t){if(!this.isCollected("ServerRequestDuration")){this._rumoneData.ServerRequestDuration=e;this._rumoneData.IISLatency=t}};e.prototype.writeControlPerformanceData=function(e){if(e){var t=this.controls.filter(function(t){return t.controlId===e.controlId})[0];if(t)t.data||(t.data=e);else{var n={controlId:e.controlId,data:e,ignoreForEUPL:e.ignoreForEUPL};this.controls.push(n)}}};e.prototype.writeAPICallPerformanceData=function(e){e&&this.apis.push(e)};e.prototype.readAPICallPerformanceData=function(){return this.apis};e.prototype.writeAppCache=function(e){this.isCollected("AppCache")||(this._rumoneData.AppCache=e)};e.prototype.writePageTransitionType=function(e,t){this.isCollected("PageTransitionType")&&!t||e!==o.e.fullPageLoad&&e!==o.e.none&&e!==o.e.onePageAppNavigation||(this._rumoneData.PageTransitionType=e)};e.prototype.writeScenarioId=function(e,t){this.isCollected("ScenarioId")&&!t||(this._rumoneData.ScenarioId=e)};e.prototype.collectW3CPerfTimings=function(){if(!this.isW3cTimingCollected){var e=["navigationStart","unloadEventStart","unloadEventEnd","fetchStart","redirectStart","redirectEnd","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domComplete","loadEventStart","loadEventEnd"],t=performance&&performance.timing;if(t){for(var n=0;n<e.length;n++){var r=t[e[n]];r&&this._logRUMOneData(this.getW3cTimingName(e[n]),Number(r))}this.isW3cTimingCollected=!0}}};e.prototype.collectW3cResourceTimings=function(t){void 0===t&&(t=void 0);var n=t||{},r=n.logSummery,s=void 0===r||r,o=n.start,u=void 0===o?0:o,a=n.end,f=void 0===a?Math.round(this.now()):a,l=n.columnNameOverride,c=void 0===l?function(e){return e}:l,h="logSummery="+s+"|start="+u+"|end="+f+"|columnNameOverride="+c,p=this._isW3cResourceTimingCollected[h];if(window.document&&!p&&performance&&performance.getEntriesByType){for(var d=performance.getEntriesByType("resource"),v=document.getElementsByTagName("iframe"),m=0;m<v.length;m++){var g=null;try{g=v[m].contentWindow.performance}catch(e){}g&&g.getEntriesByType&&d.concat(g.getEntriesByType("resource"))}var y={SharePoint:function(e){return 0===e.name.search(window.location.protocol+"//"+window.location.host)}};y.CDN=e._isRequestFromCDN;y.ThirdParty=function(e){return!y.SharePoint(e)&&!y.CDN(e)};var b={ASPX:function(e){return/\.aspx/i.test(e.name)},JS:function(e){return/script/i.test(e.initiatorType)},CSS:function(e){return/link|css/i.test(e.initiatorType)},IMG:function(e){return/img/i.test(e.initiatorType)}};d=d.filter(function(e){return e.startTime>=u&&e.startTime<=f});var w=Object.keys(y);for(m=0;m<w.length;m++){var E=w[m],S=this.categorizeResourceRequests(d,{from:y[E],requestType:null});s&&this._logRUMOneData(c(E+"RequestCountTotal"),S.length);for(var x=Object.keys(b),T=0;T<x.length;T++){var N=x[T];s&&this._logRUMOneData(c(E+"RequestCount"+N),this.categorizeResourceRequests(S,{from:null,requestType:b[N]}).length)}if(S.length>0){s&&this._logRUMOneData(c(E+"RequestDownloadTime"),Math.round(S.reduce(function(e,t){return e+t.duration},0)/S.length));if("CDN"===E){var C=JSON.stringify(S.map(function(e){return Object(i.__assign)(Object(i.__assign)(Object(i.__assign)(Object(i.__assign)({name:e.name.split("/").map(function(e){return e.split("?")[0]}).filter(function(e){return e&&e.length>0}).slice(-1)[0].replace(/\(.*?\)/g,"()"),startTime:Math.round(e.startTime),duration:Math.round(e.duration),transferSize:e.transferSize||0,fetchStart:Math.round(e.fetchStart),requestStart:Math.round(e.requestStart),connect:Math.round(e.connectEnd-e.connectStart),domainLookup:Math.round(e.domainLookupEnd-e.domainLookupStart),redirect:Math.round(e.redirectEnd-e.redirectStart)},k(e,"workerStart")),k(e,"responseStart")),k(e,"responseEnd")),k(e,"secureConnectionStart"))}));this._logRUMOneData(c(E+"RequestNames"),C)}}}this._isW3cResourceTimingCollected[h]=!0}};e.prototype.saveTempData=function(e,t){this.tempData[e]=t};e.prototype.readTempData=function(e){return this.tempData[e]};e.prototype.writeRenderTime=function(e,t){this.isCollected("RenderTime")&&!t||(this._rumoneData.RenderTime=e)};e.prototype.writePreRenderTime=function(e){this.isCollected("PreRender")||(this._rumoneData.PreRender=e)};e.prototype.writePostRenderTime=function(e){this.isCollected("PostRender")||(this._rumoneData.PostRender=e)};e.prototype.writeDataFetchTime=function(e,t){this.isCollected("DataFetch")&&!t||(this._rumoneData.DataFetch=e)};e.prototype.writeAppInfo=function(e,t){this.isCollected("AppInfo")&&!t||(this._rumoneData.AppInfo=e)};e.prototype.isRunning=function(){return!(this.dataState===d.Uploaded||this.dataState===d.TimeOut||this.dataState===d.Skipped)};e.prototype.writeEUPLBreakdown=function(e,t){return this._writeBreakdown(this.euplBreakDown,e,t)};e.prototype.addEUPLBreakdown=function(e,t,n){return this._addBreakdown(this.euplBreakDown,e,t,n)};e.prototype.readEUPLBreakdown=function(e){return this._readBreakdown(this.euplBreakDown,e)};e.prototype.writeTTIBreakdown=function(e,t){return this._writeBreakdown(this.ttiBreakDown,e,t)};e.prototype.addTTIBreakdown=function(e,t,n){return this._addBreakdown(this.ttiBreakDown,e,t,n)};e.prototype.readTTIBreakdown=function(e){return this._readBreakdown(this.ttiBreakDown,e)};e.prototype.addFlights=function(e){if(e&&e.length>0){for(var t=JSON.parse(this.getPerformanceDataPropertyValue("Flights")||"[]"),n=0;n<e.length;n++){var r=e[n];r&&-1===t.indexOf(r)&&t.push(r)}this._rumoneData.Flights=JSON.stringify(t)}};e.prototype.collectSPClientFlights=function(e){for(var t="",n=0,r=e.ExpFeatures;n<r.length;n++){var i=r[n];t+=this._numberToBinString(i).split("").reverse().join("")}this._rumoneData.Flights=t};e.prototype.collectODCClientRamps=function(e,t){for(var n=e.Ramps,r=void 0===n?{}:n,i=[],s=0,o=t;s<o.length;s++){var u=o[s];u.ODC&&"boolean"!=typeof u.ODC&&r[u.ODC]&&i.push(u.ODC)}this._rumoneData.Flights=JSON.stringify(i)};e.prototype.addServerMetrics=function(e,t){if(e)for(var n in e)n&&!T(e[n])&&(T(this.serverMetrics[n])||t)&&(this.serverMetrics[n]=e[n])};e.prototype.writeServerVersion=function(e){this._rumoneData.SharePointServerVersion=e};e.prototype.readControlPerformanceData=function(){return this.controls.filter(function(e){return!!e.data}).map(function(e){return e.data})};e.prototype.mark=function(t){(e._markers[this._name]=e._markers[this._name]||[]).push(t);Object(l.s)(t)};e.prototype.now=function(){return performance&&performance.now?Math.round(performance.now()):NaN};e.prototype.registerEUPLComputedHandler=function(e){this._EUPLComputedHandler=e};e.prototype.registerErrorHandler=function(e){};e.prototype.getMarkerTime=function(e){return Object(l.i)(e)};e.prototype.addExpectedKeyMetric=function(e){this._keyMetrics&&-1===this._keyMetrics.indexOf(e)&&this._keyMetrics.push(e)};Object.defineProperty(e.prototype,"waitOnAddingExpectedControl",{set:function(e){this.setSettings({waitOnAddingExpectedControl:e})},enumerable:!0,configurable:!0});e._isRequestFromCDN=function(e){var t=window._spPageContextInfo,n=e.name;return!(!t||!t.cdnPrefix||0!==n.search(window.location.protocol+"//"+t.cdnPrefix))||(!(!t||!t.cdnBaseUrl||0!==n.search(t.cdnBaseUrl))||/(cdn(ppe)?|static(ppe)?)\.sharepointonline\.com|\.akamaihd\.net|akamai\.odsp\.cdn\.office\.net/i.test(n))};e.prototype._measureTTI=function(){var e=this;this._rumoneData.TTISupported=Object(h.e)();if(this._TTIPolyfillEnabled()&&!this._ttiPromise){this._ttiPromise=Object(h.n)(this._settings.TTISettings.TTIPolyfillSettings.options);this._ttiPromise.then(function(t){var n=t||{},r=n.tti,i=n.longTasks,s=r;if(T(r))r=NaN;else{var o=e._settings.TTISettings.TTIPolyfillSettings.calculateTTI;o&&(r=o(Math.round(r),e._rumoneData,"TTI"))}e._rumoneData.TTI=r;if(i){e._rumoneData.TTILongTasks=JSON.stringify(i);c.e.isActivated("4c338685-350e-4aae-a03e-fb969ab4dc98","02/24/2021")||(e._rumoneData.TTILongTasksPostFMPCount=i.filter(function(t){return t.end>e._rumoneData.EUPL}).length)}e._logLastRequestBeforeTTI(r,i,"TTI");e.collectW3cResourceTimings({logSummery:!1,start:s-(r-e._rumoneData.EUPL),end:s,columnNameOverride:function(e){return e+"OfTTI"}})})}if(this._TTIPolyfillEnabled()&&!this._fciPromise){this._fciPromise=Object(h.t)();this._fciPromise.then(function(t){var n=t||{},r=n.fci,i=n.longTasks;if(T(r))r=NaN;else{var s=e._settings.TTISettings.TTIPolyfillSettings.calculateTTI;s&&(r=s(Math.round(r),e._rumoneData,"FCI"))}e._rumoneData.FCI=r;if(i){e._rumoneData.FCILongTasks=JSON.stringify(i);c.e.isActivated("4c338685-350e-4aae-a03e-fb969ab4dc98","02/24/2021")||(e._rumoneData.FCILongTasksPostFMPCount=i.filter(function(t){return t.end>e._rumoneData.EUPL}).length)}e._logLastRequestBeforeTTI(r,i,"FCI")})}};e.prototype._logLastRequestBeforeTTI=function(t,n,r){var i=performance.getEntriesByType("resource");if(t&&n&&n.length>0&&i&&i.length>0){for(var s=n[n.length-1].start,o=i[0],u=0,a=i;u<a.length;u++){var f=a[u];f.responseEnd<s&&f.responseEnd>o.responseEnd&&(o=f)}var l=void 0;l=e._isRequestFromCDN(o)?o.name:this._processLastNetworkUrl(o.name);var c=void 0;c=/\.aspx/i.test(o.name)?"ASPX":/\.js/i.test(o.name)?"JS":/\.css/i.test(o.name)?"CSS":/img/i.test(o.initiatorType)||/\.jpg|\.jpeg|\.png|\.gif/i.test(o.name)?"IMG":/aria\.microsoft\.com/i.test(o.name)?"Aria":/_api/i.test(o.name)?"API":"Other";if("TTI"===r){this._rumoneData.TTILastRequestName=l;this._rumoneData.TTILastRequestType=c;this._rumoneData.TTILastRequestStartTime=o.startTime;this._rumoneData.TTILastRequestEndTime=o.responseEnd}else{this._rumoneData.FCILastRequestName=l;this._rumoneData.FCILastRequestType=c;this._rumoneData.FCILastRequestStartTime=o.startTime;this._rumoneData.FCILastRequestEndTime=o.responseEnd}}};e.prototype._numberToBinString=function(e){var t=(e>>>0).toString(2);return""+Array(32-t.length+1).join("0")+t};e.prototype._logRUMOneData=function(e,t){e&&(this._rumoneData[e]=t)};e.prototype.clearResourceTimings=function(){performance&&performance.clearResourceTimings&&performance.clearResourceTimings()};e.prototype._isBreakdownValue=function(e){return void 0!==e.needFlatten};e.prototype.collectMarks=function(){var e=this,t={},n=0;this._getOwnMakers().forEach(function(r){if(n<e._config.max_markers){var i=r.name.substr(l.t.length)+".mark"+n++;t[i]=Math.round(r.startTime)}});this.writeEUPLBreakdown(JSON.stringify(t))};e.prototype._getOwnMakers=function(){var t=this,n=e._markers,r=[].concat.apply([],Object.keys(n).filter(function(e){return n.hasOwnProperty(e)&&e!==t._name}).map(function(e){return n[e]}));return Object(l.r)().filter(function(e){return-1===r.indexOf(e.name)})};e.prototype.logMessageInConsole=function(e){this.isRUMOneDebuggingEnabled&&console.log(e)};Object.defineProperty(e.prototype,"isRUMOneDebuggingEnabled",{get:function(){try{if("sessionStorage"in window&&window.sessionStorage){var e=window.sessionStorage.enableRUMOneDebugging;return e&&"true"===e.toLowerCase()&&"undefined"!=typeof console&&!!console}}catch(e){}return!1},enumerable:!0,configurable:!0});e.prototype.logObjectForDebugging=function(e,t){if(this.isRUMOneDebuggingEnabled){var n=this._name+" "+e+" : "+JSON.stringify(t);console.log(n)}};e.prototype.isCollected=function(e){return!T(this.getPerformanceDataPropertyValue(e))};e.prototype._normalizeControl=function(e){return"string"==typeof e?{controlId:e,ignoreForEUPL:!1}:e};e.prototype.setPerfDataTimer=function(){this.perfDataTimer=this.async.setTimeout(this.loopForDataCompleteness,this._config.checkInterval)};e.prototype.clearPerfDataTimer=function(){if(!T(this.perfDataTimer)){this.async.clearTimeout(this.perfDataTimer);this.perfDataTimer=null}};e.prototype._hookUnloadEvent=function(){window.addEventListener&&window.addEventListener("beforeunload",this._emergencyUpdateFunc)};e.prototype._unhookUnloadEvent=function(){window.removeEventListener&&window.removeEventListener("beforeunload",this._emergencyUpdateFunc)};e.prototype.categorizeResourceRequests=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];t.from&&!t.from(i)||t.requestType&&!t.requestType(i)||n.push(i)}return n};e.prototype._setFCP=function(){var e=NaN,t=performance&&performance.getEntriesByType&&performance.getEntriesByType("paint");if(t&&t.length>0){var n=t.filter(function(e){return"first-contentful-paint"===e.name});if(n&&1===n.length)e=n[0].startTime;else{var r=t.filter(function(e){return"first-paint"===e.name});r&&1===r.length&&(e=r[0].startTime)}}isNaN(e)||(this._rumoneData.FCP=Math.round(e))};e.prototype.collectSupplementaryData=function(){this._setFCP();this.setAPIDataToRUMOne();this.collectMarks();this.writeServerUrl();this.setBrowseInfo();this.setReferrer();this._collectMemoryData();this._collectPageServerData();this._setAppInfo();this._setTestName();this._collectExperiments();this._rumoneData.DOMElements=document&&document.querySelectorAll("*").length;this._rumoneData.ServerMetrics=JSON.stringify(this.serverMetrics);this._rumoneData.EUPLBreakdown=JSON.stringify(this.euplBreakDown);this._rumoneData.TTIBreakdown=JSON.stringify(this.ttiBreakDown)};e.prototype._collectExperiments=function(){var e=window.ODSP_EXPERIMENTS||{},t={};for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r&&r._serverTime&&Date.now()-new Date(r._serverTime).getTime()<1296e6&&(t[n]=e[n])}this._rumoneData.SPExperiments=JSON.stringify(t)};e.prototype._setTestName=function(){var e=new g.e(location.href).getQueryParameter("perftest");e&&!this._rumoneData.TestName&&(this._rumoneData.TestName=e)};e.prototype.loopForDataCompleteness=function(){this.clearPerfDataTimer();if(!this._settings.waitOnAddingExpectedControl){if(this.isRUMOneDebuggingEnabled){this.logMessageInConsole("====================================================================");this.logObjectForDebugging("RUMONE: ",this._rumoneData);this.logObjectForDebugging("RUMOne DataState: ",String(this.getReadableDataState(this.dataState)));this.logObjectForDebugging("Controls: ",this.controls);this.logObjectForDebugging("API Performance Data: ",this.apis);this.logObjectForDebugging("Temp Data: ",this.tempData);this.logObjectForDebugging("EUPLBreakdown: ",this.euplBreakDown);this.logObjectForDebugging("TTIBreakdown: ",this.ttiBreakDown);this.logObjectForDebugging("ServerMetrics: ",this.serverMetrics);this.logMessageInConsole("====================================================================\n\n")}if(!this.isRunning())return;this._updateState()}this._checkTimeout();this.isRunning()&&this.setPerfDataTimer()};e.prototype._updateState=function(){switch(this.dataState){case d.Incomplete:this.processControlRenderTime();this.readyToComputeEUPL()&&this.setEUPL();var e=this._getMissedControls();this._TTIMeasurementEnabled()&&this.isCollected("EUPL")&&0===e.length&&this._measureTTI();0===this._getMissedKeyMetrics().length&&0===e.length&&(this.dataState=d.ReadyToUpload);break;case d.ReadyToUpload:this._uploadPerfData({emergency:!1})}};e.prototype._checkTimeout=function(){if(this.isRunning()&&this.dataState!==d.ReadyToUpload){var e=Date.now();if(!(this.dataState===d.Incomplete&&e-this.dataStartTime<=this._config.error_timeout)){var t={reason:"TimeOut",details:{MissingMetrics:this._getMissedKeyMetrics(),MissingControls:this._getMissedControls()}};this._rumoneData.RUMOneError=JSON.stringify(t);this.dataState=d.TimeOut;this._uploadPerfData({emergency:!1})}}};e.prototype._getMissedKeyMetrics=function(){for(var e=[],t=0;t<this.KeyMetrics.length;t++){T(this.getPerformanceDataPropertyValue(this.KeyMetrics[t]))&&e.push(this.KeyMetrics[t])}return e};e.prototype._getMissedControls=function(){return this.controls.filter(function(e){return!e.data||!e.data.renderTime})};e.prototype._emergencyUpload=function(){this.isRunning()&&this._uploadPerfData({emergency:!0})};e.prototype._uploadPerfData=function(e){this.writeControlDataToRUMOne();this.collectSupplementaryData();var t,n=e.emergency;this._rumoneData.EmergencyUploaded=!!n;try{if(this._settings.excludePageData){this.dataState=d.Skipped;this.logMessageInConsole("Uploading perf data skipped as requested by the consumer")}else if(n||this.dataState===d.ReadyToUpload||this.dataState===d.TimeOut)if(this._loggingFunctions&&this._loggingFunctions.length>0)if(this._rumoneData){var r=this.getPerformanceData();this._loggingFunctions.forEach(function(e){e("RUMOne",r)});this.dataState=d.Uploaded;if(this.isRUMOneDebuggingEnabled){this.logMessageInConsole("Final Data uploaded");this.logObjectForDebugging("RUMONE: ",r);this.logObjectForDebugging("RUMOne DataState: ",this.getReadableDataState(this.dataState))}}else console.error("Error: Uploading perf data called but perf data is not available");else console.error("Uploading perf data skipped as loggingFunc is not defined");else console.error("Error: Uploading perf data called with wrong data state "+this.dataState)}catch(e){t="PerformanceLogger error writing RUMOne data: "+e,"undefined"!=typeof console&&Boolean(console)&&console.error(t)}finally{if(!this.isRunning()){this._unhookUnloadEvent();this._apiTracker.undoInstrument()}}};e.prototype._TTIPolyfillEnabled=function(){return!!(this._settings.TTISettings&&this._settings.TTISettings.TTIPolyfillSettings&&this._settings.TTISettings.TTIPolyfillSettings.enabled)};e.prototype._TTIMeasurementEnabled=function(){return this._TTIPolyfillEnabled()};e.prototype.getReadableDataState=function(e){for(var t in d)if(e===Number(d[t]))return t;return"NaN"};e.prototype.writeControlDataToRUMOne=function(){if(this.controls&&this.controls.length){var e=this.controls.slice(0).filter(function(e){return!!e.data&&!!e.data.renderTime&&!e.ignoreForEUPL});e.sort(function(e,t){return t.data.renderTime-e.data.renderTime});for(var t=0;t<10&&t<e.length;t++){this._logRUMOneData("Control"+(t+1)+"Id",e[t].controlId);this._logRUMOneData("Control"+(t+1)+"RenderTime",e[t].data.renderTime)}var n={};this.controls.slice(0).filter(function(e){return!!e.data&&!!e.data.renderTime&&!!e.ignoreForEUPL}).forEach(function(e){n[e.controlId]={data:e.data.renderTime,needFlatten:e.data.needFlatten}});Object.keys(n).length>0&&this.writeEUPLBreakdown(JSON.stringify(n),!0)}};e.prototype.processControlRenderTime=function(){for(var e=0,t=this.controls;e<t.length;e++){var n=t[e];n.data&&!n.data.renderTime&&n.data.renderTimeRequiredDataChecker(this,n.data)&&(n.data.renderTime=n.data.renderTimeCalculator(this,n.data))}};e.prototype.readyToComputeEUPL=function(){for(var e=this.controls.filter(function(e){return!e.ignoreForEUPL}),t=e.length>0,n=0,r=e;n<r.length;n++){var i=r[n];if(!i.data||!i.data.renderTime){t=!1;break}}return t};e.prototype.setEUPL=function(){if(!this.isCollected("EUPL")){for(var e=0,t=0,n=this.controls;t<n.length;t++){var r=n[t];!r.ignoreForEUPL&&r.data&&r.data.renderTime&&e<r.data.renderTime&&(e=r.data.renderTime)}this._rumoneData.EUPL=e;"function"==typeof this._EUPLComputedHandler&&this._EUPLComputedHandler(e)}};e.prototype.setBrowseInfo=function(){this._rumoneData.Browser=this._platformDetection.browserName+this._platformDetection.browserMajor;this._rumoneData.BrowserIsMobile=this._platformDetection.isMobile};e.prototype._collectMemoryData=function(){if(!this.isCollected("UsedJSHeapSize")&&"undefined"!=typeof performance&&void 0!==performance.memory){this._rumoneData.UsedJSHeapSize=performance.memory.usedJSHeapSize;this._rumoneData.TotalJSHeapSize=performance.memory.totalJSHeapSize}};e.prototype._collectPageServerData=function(){this.addServerMetrics({cpuDuration:window.g_cpuDuration,duration:window.g_duration,iisLatency:window.g_iisLatency,queryCount:window.g_queryCount,queryDuration:window.g_queryDuration,spPageContextDuration:window.g_pageContextDuration,deferred_cpuDuration:window.g_deferred_cpuDuration,deferred_duration:window.g_deferred_duration,deferred_iisLatency:window.g_deferred_iisLatency,deferred_queryCount:window.g_deferred_queryCount,deferred_queryDuration:window.g_deferred_queryDuration})};e.prototype.setAPIDataToRUMOne=function(){for(var e=0,t=0,n=[],r=0;r<this.apis.length;r++){var s=this.apis[r];if(s){e++;t+=s.duration;s.origin||(s.origin=new g.e(s.url).getHost());s.hostType=new g.e(window.location.href).getHost()===s.origin?v.own:v.cors;s.url;var o=Object(i.__rest)(s,["url"]);n.push(o)}}this._rumoneData.APICallCount=e;this._rumoneData.APICallDurationSum=t;this._rumoneData.APICalls=JSON.stringify(n)};e.prototype.setReferrer=function(){this._rumoneData.Referrer=this._processEUIIUrl(document.referrer)};e.prototype._setAppInfo=function(){if(!this._rumoneData.AppInfo){var e=window._spModuleLink;if(e){var t=e.buildNumber,n=e.manifestName,r=e.scenarioName,i=JSON.stringify({buildNumber:t,manifestName:n,scenarioName:r});this._rumoneData.AppInfo=i}}};e.prototype.getW3cTimingName=function(e){return"secureConnectionStart"!==e?"W3c"+e.charAt(0).toUpperCase()+e.slice(1):"W3cSecureConnectStart"};e.prototype._writeBreakdown=function(e,t,n){if(t)try{var r=JSON.parse(t);for(var i in r)r.hasOwnProperty(i)&&this._addBreakdown(e,i,r[i],n)}catch(e){this.logMessageInConsole("Failed to write EUPL breakdown data:"+e.toString())}};e.prototype._addBreakdown=function(e,t,n,r){if(t&&!T(n)){if(T(e[t])||r){var i=this._isBreakdownValue(n)?n.data:n;e[t]=i}this._isBreakdownValue(n)&&n.needFlatten&&(!this.isCollected(t)||r)&&this._logRUMOneData(t,n.data)}};e.prototype._readBreakdown=function(e,t){return t?e[t]:e};e.prototype._processEUIIUrl=function(e){var t=new y.e(e||"");return t.authority+"/{ length: "+t.path.length+", segments: "+t.segments.length+" }"};e.prototype._processLastNetworkUrl=function(e){var t=new y.e(e||"");if(t.authority.indexOf("lpcres")>0)return e;if(t.authority.indexOf("shell.cdn.office")>0)return e;var n=S.exec(e),r="";n&&n.length>0&&(r=""+n[0]);return""+t.authority+r};e.rumOneLogger=void 0;e.Loggers={};e._markers={};return e})();t.n=C;function k(e,t){var n;return t in e?((n={})[t]=Math.round(e[t]),n):{}}},"764":function(e,t,n){"use strict";var r;(function(e){e[e.none=0]="none";e[e.fullPageLoad=4]="fullPageLoad";e[e.onePageAppNavigation=5]="onePageAppNavigation"})(r||(r={}));t.e=r},"785":function(e,t,n){"use strict";n.d(t,"r",function(){return h});var r=n(0),i=n(7),s=n(338);n.d(t,"t",function(){return s.e});var o=n(192),u=n(105),a=n(337);n.d(t,"e",function(){return a});var f=n(3),l=n(5),c=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});void 0===n&&(n={});var r=e.call(this,t,n)||this,i=n.itemsStore,s=void 0===i?r.resources.consume(u.e):i;r._itemsStore=s;r._itemUpdatesByKey={};return r}t.prototype.update=function(e,t){void 0===t&&(t=!1);for(var n=0,r=e;n<r.length;n++){var i=r[n];this._processTask(i)}};t.prototype.flush=function(){var e;e={};for(var t=this._itemUpdatesByKey,n=Object.keys(t).filter(function(e){return!!t[e].item}),i=0,s=n;i<s.length;i++){var u=s[i],f=t[u],l=new o.e(u),c=this._getStoreItem(u);if(c){c.parent;var h=Object(r.__rest)(c,["parent"]);Object(a.default)(l,h)}Object(a.default)(l,{revision:0});for(var p=0,d=f.item;p<d.length;p++){var v=d[p];Object(a.default)(l,v)}e[u]=l}for(var m=0,g=n;m<g.length;m++){var y=(l=e[u=g[m]]).parentKey;if(y){var b=e[y]||this._getStoreItem(y)||new o.e(y);e[y]=b;l.parent=b}else delete l.parent}this._pushItemsToStore(e);for(var w=0,E=n;w<E.length;w++){u=E[w];delete(f=t[u]).item}};t.prototype.reset=function(){this._itemUpdatesByKey={}};t.prototype.getItem=function(e){var t=e.key;return this._getStoreItem(t)};t.prototype.getChildren=function(e){var t,n,r,i=e.parentKey,s=e.startIndex,o=e.endIndex,u=[],a=this._itemUpdatesByKey[i];if(a){var f=a.set;if(f)if(f.childrenByIndex){s=void 0===(n=(t={startIndex:s,endIndex:o}).startIndex)?f.startIndex:n,o=void 0===(r=t.endIndex)?f.endIndex:r;for(var l=s;l<o;l++){var c=f.childrenByIndex[l],h=this._getStoreItem(c);u.push(h)}}else if(f.childrenBySibling)for(var p={},d="";d=f.childrenBySibling[d];){if(p[d])throw new Error("Circular reference encountered enumerating the children of '"+i+"'.");p[d]=!0;h=this._getStoreItem(d);u.push(h)}}return u};t.prototype._processTask=function(e){var t=e.key,n=e.output,r=n.item,i=n.set,s=this._itemUpdatesByKey,o=s[t];o||(o=s[t]={});if(r){o.item||(o.item=[]);o.item.push(r)}if(i){var u=s[i.parent.key];u||(u=s[i.parent.key]={});u.set||(u.set={});var a=u.set;if(void 0!==i.index){a.childrenByIndex||(a.childrenByIndex=[]);void 0===a.startIndex?a.startIndex=i.index:a.startIndex=Math.min(a.startIndex,i.index);var f=a.childrenByIndex.length;a.childrenByIndex[i.index]=t;void 0===a.endIndex?a.endIndex=i.index+1:a.endIndex>i.index+1?a.endIndex+=a.childrenByIndex.length-f:a.endIndex=Math.max(a.endIndex,i.index+1)}else if(i.after){a.childrenBySibling||(a.childrenBySibling={});a.childrenBySibling[i.after.key]=t}}};t.prototype._getStoreItem=function(e){var t=this._itemsStore.getItem(e);return this.peekUnwrapObservable(t)};t.prototype._pushItemsToStore=function(e){var t={};for(var n in e){(s=t[i=e[(a=e[n]).parentKey]&&a.parentKey||""]||(t[i]=[])).push(n)}for(var r=[""];r.length;){var i,s;if(s=t[i=r.shift()]){for(var o=0,u=s;o<u.length;o++){var a;if(!(a=e[n=u[o]]))throw new Error("Attempted to update the same item multiple times.");this._itemsStore.setItem(a,n)}r.push.apply(r,s)}}};t.dependencies=Object(r.__assign)(Object(r.__assign)({},i.n.dependencies),{itemsStore:u.e});return t})(i.n),h=new f.t({name:"ItemTaskObserver",factory:new l.r(c)});t.n=c},"802":function(e,t,n){"use strict";n.d(t,"n",function(){return s});n.d(t,"t",function(){return o});n.d(t,"e",function(){return u});var r=n(0),i=n(805);function s(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(s){switch(s.label){case 0:t=Object(r.__assign)({minValue:Object(i.e)(),useMutationObserver:!1,trackNetworkRequests:!1,requiredMainThreadQuietnessDurationInMilliseconds:1e3,requiredNetworkQuietnessDurationInMilliseconds:1e3},e);return[4,Promise.all([n.e("deferred.resx-deferred"),n.e("deferred.office-ui-fabric-react"),n.e("deferred.odsp-common"),n.e("deferred.odsp-datasources"),n.e("deferred")]).then(n.bind(null,812))];case 1:return[2,s.sent().getFirstConsistentlyInteractive(t)]}})})}function o(){return Object(r.__awaiter)(this,void 0,void 0,function(){var e;return Object(r.__generator)(this,function(t){switch(t.label){case 0:e={measurementStartTime:Object(i.e)(),requiredMainThreadCPUIdleDurationInMilliseconds:1e3};return[4,Promise.all([n.e("deferred.resx-deferred"),n.e("deferred.office-ui-fabric-react"),n.e("deferred.odsp-common"),n.e("deferred.odsp-datasources"),n.e("deferred")]).then(n.bind(null,1051))];case 1:return[2,t.sent().getFirstCPUIdle(e)]}})})}function u(){return"PerformanceLongTaskTiming"in window}},"805":function(e,t,n){"use strict";n.d(t,"e",function(){return r});function r(){return window.performance&&performance.now?Math.round(performance.now()):Date.now()}},"979":function(e,t,n){"use strict";var r;(function(e){e[e.Recycle=2]="Recycle";e[e.PermanantDelete=3]="PermanantDelete";e[e.MoveToSecondStage=4]="MoveToSecondStage"})(r||(r={}));t.e=r},"1153":function(e,t,n){"use strict";n.d(t,"e",function(){return y});var r=n(25),i=n(5),s=n(22),o=n(979),u=n(785),a=n(105),f=n(3),l=n(83),c=n(381),h=n(80),p=n(338),d=n(15),v=n(31),m=n(337),g=(function(){function e(e,t){this._itemDataSource=t.itemDataSource;this._deleteRestoreDataSource=t.deleteRestoreDataSource;this._itemProvider=t.itemProvider;this._itemTaskObserver=new t.itemTaskObserverType;this._photoProvider=t.photoProvider;this._store=t.itemsStore;this._tagProvider=t.tagProvider;this._updateQuota=t.updateQuota;this._isItemsScopeEnabled=t.isItemsScopeEnabled;this._resources=t.resources}e.prototype.createFolder=function(e,t){var n=this,r=e.parent.key,i=e.folderName,s=new p.e(r+"&cf="+i,i);return this._performOperation([r],t,s,function(){return n._itemDataSource.createFolder(e)})};e.prototype.renameItem=function(e,t){var n=this,r=e.item,i=r.key,s=new p.e(i,r);return this._performOperation([e.parentKey,i],t,s,function(){return n._itemDataSource.renameItem(e)})};e.prototype.deleteItems=function(e,t){return this._handleDeleteOrRestore(e,t,this._handleDelete)};e.prototype.restoreItems=function(e,t){return this._handleDeleteOrRestore(e,t,this._handleRestore)};e.prototype.restoreAll=function(e){var t=this;return this._deleteRestoreDataSource.restoreAll(e).then(function(){t._itemProvider.invalidateItem(e.parentKey);t._updateQuota(!0);return!0})};e.prototype._handleDelete=function(e){var t=this,n=this._itemProvider;return this._deleteRestoreDataSource.deleteItems(e).then(function(r){var i;e.deletionType===o.e.Recycle&&(i={triggerFetch:!1,emptyAllOtherSets:!0});n.invalidateItem(e.parentKey,i);var s=e.items.map(function(e){return new p.e(e.key).succeed({item:{key:e.key,parentKey:m.remove()}})}),u=t._itemTaskObserver;u.update(s);u.flush();return r})};e.prototype._handleRestore=function(e){var t=this;return this._deleteRestoreDataSource.restoreItems(e).then(function(n){var r=s.e(e.parentKey);delete r.view;var i=s.n(r);t._itemProvider.invalidateItem(i,{emptyAllOtherSets:!0});(t._isItemsScopeEnabled||t._resources.consume(h.n))&&t._resources.consumeAsync(d.D).then(function(e){e.invalidateItems(i)});return n})};e.prototype._handleDeleteOrRestore=function(e,t,n){var r=this,i={},s=e.items.map(function(e){return i[e.id]=new p.e(e.key,e)}),o=this._itemProvider;t.update(s);return n.call(this,e).then(function(n){for(var i=0,o=e.items;i<o.length;i++){var u=o[i];r._invalidatePhoto(u)}r._store.invalidateAllPhotos();r._invalidateAllTags();s=s.map(function(e){return e.succeed()});t.update(s)},function(n){o.invalidateItem(e.parentKey);var r=n.data&&n.data.items||[];s=[];for(var u=0,a=r;u<a.length;u++){var f=a[u],l=i[f.id];delete i[f.id];s.push(f.error?l.fail(f.error):l.succeed())}for(var c in i){l=i[c];s.push(l.cancel())}t.update(s)}).then(function(){r._updateQuota(!0)})};e.prototype._invalidatePhoto=function(e){var t=s.e(e.key);delete t.qt;var n=s.n(t);this._store.invalidateItem(n);(this._isItemsScopeEnabled||this._resources.consume(h.n))&&this._resources.consumeAsync(d.D).then(function(e){e.invalidateItems(n)});if(e.tags)for(var r=0,i=e.tags;r<i.length;r++){var o=i[r];this._store.invalidateLocation(o.tag)}};e.prototype._invalidateAllTags=function(){var e=this._photoProvider,t=this._tagProvider;if(e&&t){var n=e.getAllPhotosSettings().peek();t.invalidateAllTags(n.rootId)}};e.prototype._performOperation=function(e,t,n,i){var s=this;t.update([n]);return i().then(function(r){for(var i=0,o=e;i<o.length;i++){var u=o[i];s._itemProvider.invalidateItem(u)}t.update([n.succeed(r)])},function(e){var i=new Error(e);t.update([n.fail(i)]);return r.n.wrapError(i)})};e.dependencies={itemDataSource:d.B,deleteRestoreDataSource:d.u,itemProvider:l.resourceKey,itemsStore:a.e,itemTaskObserverType:u.r,photoProvider:v.d.optional,tagProvider:v.T.optional,updateQuota:c.e,isItemsScopeEnabled:h.c,resources:f.o};return e})(),y=Object(i.s)("FileSystemProvider",g)},"1169":function(e,t,n){"use strict";var r=(function(){function e(e){this._tasksByKey={};this._onChanges=e}e.map=function(e,t){return{update:function(n,r){void 0===r&&(r=!1);e.update(n.map(function(e){return t(e)}),r)}}};e.prototype.dispose=function(){this._tasksByKey={};this._onChanges=null};e.prototype.getTasks=function(){var e=[];for(var t in this._tasksByKey)e.push(this._tasksByKey[t]);return e};e.prototype.getTask=function(e){return this._tasksByKey[e]};e.prototype.update=function(e,t){void 0===t&&(t=!1);var n,r,i;n={};for(var s in this._tasksByKey)n[s]=this._tasksByKey[s];i=[];for(var o=0,u=e;o<u.length;o++){var a=u[o],f=n[a.key],l=a.compare(f);l&&i.push(l);delete n[a.key];this._tasksByKey[a.key]=a}if(t)for(var s in n){r=n[s];delete this._tasksByKey[s];i.push({previous:r,current:null})}this.onChanges(i)};e.prototype.onChanges=function(e){this._onChanges&&this._onChanges(e)};return e})();t.e=r},"1173":function(e,t,n){"use strict";var r=n(753);t.e=r.e},"1420":function(e,t,n){"use strict";n.d(t,"e",function(){return c});var r=n(0),i=n(7),s=n(5),o=n(138),u=n(25),a=n(147),f=n(30),l=(function(e){Object(r.__extends)(t,e);function t(t,n){var r=e.call(this,t,n)||this;r._operationProvider=n.operationProvider;r._operationBatch=t.operationBatch;r._onOperationFinished=t.onOperationFinished;r._completionSignal=new a.e;r._completionSignal.getPromise().done(function(){r.dispose()},function(){r.dispose()});r.addDisposable(r._operationProvider.groups.subscribe(r._onOperationProviderGroupsChanged,r,"arrayChange"));return r}t.prototype.getGroupOperation=function(){return this._groupOperation};t.prototype.start=function(e){var t=this;return e().then(function(){t._completeIfNoGroupCreated()},function(e){t._completeIfNoGroupCreated();return u.n.wrapError(e)})};t.prototype.wait=function(){return this._completionSignal.getPromise()};t.prototype._createGroupOperationSubscription=function(e){var t=this,n=this.createPureComputed(function(){var t=e.state();return t===f.e.completed||t===f.e.canceled||t===f.e.failed||t===f.e.expired});this.createBackgroundComputed(function(){n()&&t.observables.ignore(function(){t._onOperationFinished&&t._onOperationFinished(e)})})};t.prototype._onOperationProviderGroupsChanged=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t],i=r.value;if(i.batch===this._operationBatch)if("added"===r.status){if(!this._groupOperation){this._groupOperation=i;this._createGroupOperationSubscription(i)}}else"deleted"!==r.status||r.moved||this._completionSignal.complete()}};t.prototype._completeIfNoGroupCreated=function(){this._groupOperation||this._completionSignal.complete()};t.dependencies=Object(r.__assign)(Object(r.__assign)({},i.n.dependencies),{operationProvider:o.e});return t})(i.n),c=Object(s.o)("OperatorBatchMonitor",l)},"1753":function(e,t,n){"use strict";n.d(t,"e",function(){return c});n.d(t,"r",function(){return h});n.d(t,"n",function(){return p});n.d(t,"i",function(){return d});n.d(t,"t",function(){return v});var r=n(0),i=n(154),s=n(26),o=new Map;function u(e){return o.get(e)}function a(e,t,n){var r={items:t,eventQos:n};o.set(e,r)}function f(e){o.delete(e)}function l(e){var t=u(e);if(t){(function(e){for(var t=0;t<e.length;t++)o.delete(e[t])})(t.items);return t.eventQos}}function c(e,t){for(var n={name:t},r=new i.e(n),s=0;s<e.length;s++)a(e[s],e,r)}function h(e,t){var n=u(e);if(n&&n.eventQos){f(e);for(var r=!0,i=0;i<n.items.length;i++)o.has(n.items[i])&&(r=!1);if(r){m(n.eventQos,s.e.Success)}}}function p(e,t){for(var n=e.length,r=0;r<n;r++){var i=u(e[r]);if(!i||!i.eventQos)return;f(e[r]);if(r===n-1){var a=!0;for(var l in null==i?void 0:i.items)o.has(l)&&(a=!1);if(a){m(i.eventQos,s.e.Success)}}}}function d(e,t,n){var r=l(e);r&&m(r,s.e.Failure,n)}function v(e,t,n){var r=l(e);r&&m(r,s.e.ExpectedFailure,n)}function m(e,t,n){var i={resultType:t};n&&(i=Object(r.__assign)(Object(r.__assign)({},i),{resultCode:n.name||"Unknown",error:n.message||"Unknown",extraData:{errorStackTrace:n.stack}}));e.end(i)}},"1754":function(e,t,n){"use strict";n.d(t,"e",function(){return r});function r(e){return e.items.map(function(e){return e.key})}},"2054":function(e,t,n){"use strict";n.r(t);n.d(t,"ODB_NAME_COLLISION",function(){return F});n.d(t,"ODB_FILE_LOCKED",function(){return I});n.d(t,"ODB_KEEPSHARING_MOVE_WARNING_CODES",function(){return q});n.d(t,"resourceKey",function(){return $});var r=n(0),i=n(5),s=n(85),o=n(30),u=n(129),a=n(36),f=n(405),l=n(25),c=n(138),h=n(83),p=n(60),d=n(342),v=n(8),m=n(2),g=n(47),y=n(240),b=n(114),w=n(7),E=n(6),S=n(31),x=n(15),T=n(381),N=n(239),C=n(674),k=n(80),L=n(251),A=n(178),O=n(230),M=n(764),_=n(1173),D=n(1753),P=n(1754),H=n(1153),B=n(1169),j=n(979),F=-2130575257,I=-2147018894,q=[-2147213271,-2147213270],R=8,U="InsufficientSpaceAvailable",z=162,W="InsufficientVaultQuota",X=[-2147213282,-2147213276,-2147213278,-2147213285,-2147213277,-2147213274,-2147213288],V=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});var r=e.call(this,t,n)||this,i=r._moveCopyDataSource=n.moveCopyDataSource;r._itemProvider=n.itemProvider;r._operationProvider=n.operationProvider;r._bundleLoader=n.bundleLoader;r._updateQuota=n.updateQuota;r._actionMap=n.actionMap;r._engagement=r.resources.consume(p.e);r._pollsForProgressSinceCancel={};r._cancelPromises={};r._cachePromises={};r._isItemsScopeEnabled=n.isItemsScopeEnabled;i&&i.getCapabilities().supportsProgressCaching&&r._resumePendingProgress();r._rumOneHelper=r.resources.consume(O.e);return r}t.prototype.registerOperation=function(e){var t=this,n=e.item,r=e.context,i=e.targetItem,a=e.taskId,f=e.batch,l=void 0===f?new u.e:f,c=e.getItemsError,h=e.moveCopyItems,p={items:[n],parentKey:r.parentKey,targetId:r.targetId,targetKey:r.targetKey,cid:r.cid,group:r.group,isMove:r.isMove,keepSharing:r.keepSharing,nameConflict:r.nameConflict,taskId:r.taskId,deleteSource:r.deleteSource,isAsync:r.isAsync,ackMoveIfShared:r.ackMoveIfShared,remoteItem:r.remoteItem,authToken:r.authToken,isMountPointFolder:r.isMountPointFolder},d=this._getKey(r),v=this.observables,m=r.isMove?A.r:A.e,g=[n.key],y=this._operationProvider.register({name:n.name,type:r.isMove?s.e.moveItems:s.e.copyItems,iconName:n.iconName,payloads:{moveItems:{item:n,destination:i,source:n.parent},copyItems:{item:n,destination:i,source:n.parent,taskId:a}},batch:l,actions:{rename:{isAvailable:v.create(!1),execute:function(){var e,n,i;p.nameConflict=2;null===(e=y.actions().rename)||void 0===e||e.isAvailable(!1);null===(n=y.actions().overwrite)||void 0===n||n.isAvailable(!1);null===(i=y.actions().cancel)||void 0===i||i.isAvailable(!0);y.state(o.e.started);t._startTime=t.startRumOneMeasure(!0,r.isMove);D.e(g,m);return t.handleMoveCopyAsyncItems(p,[y],a)}},overwrite:{isAvailable:v.create(!1),execute:function(){var e,n,r;p.nameConflict=1;null===(e=y.actions().rename)||void 0===e||e.isAvailable(!1);null===(n=y.actions().overwrite)||void 0===n||n.isAvailable(!1);null===(r=y.actions().cancel)||void 0===r||r.isAvailable(!0);y.state(o.e.started);D.e(g,m);return t.handleMoveCopyAsyncItems(p,[y],a)}},cancel:{isAvailable:v.create(!0),execute:function(){var e,n,i;null===(e=y.actions().rename)||void 0===e||e.isAvailable(!1);null===(n=y.actions().overwrite)||void 0===n||n.isAvailable(!1);var s=t._getKey(p),o=t._cachePromises[s]||t._cachePromises[d];t.endRumOneMeasure(t._startTime,!0,r.isMove);var u=(null===(i=y.payloads().moveItems)||void 0===i?void 0:i.item.key)||"";D.t(u,m,{name:"operation cancelled",message:"operation cancelled"});return o?o.then(function(e){return t._cancelAsyncOperation(p,y,e.id)}):t._cancelAsyncOperation(p,y,a)}},moveAnyway:{isAvailable:v.create(!1),execute:function(){var e,n,i,s;p.deleteSource=!0;p.isMove=!1;p.isAsync=!0;null===(e=y.actions().moveAnyway)||void 0===e||e.isAvailable(!1);null===(n=y.actions().rename)||void 0===n||n.isAvailable(!1);null===(i=y.actions().overwrite)||void 0===i||i.isAvailable(!1);null===(s=y.actions().cancel)||void 0===s||s.isAvailable(!0);y.state(o.e.started);t._startTime=t.startRumOneMeasure(!0,r.isMove);D.e(g,m);return t.handleMoveCopyAsyncItems(p,[y],a)}},moveAnywaySchemaMismatch:{isAvailable:v.create(!1),execute:function(){var e;t._engagement.logData({name:"MoveItemsAsync.MoveAnyway.Click"});p.allowSchemaMismatch=!0;y.actions().moveAnywaySchemaMismatch.isAvailable(!1);null===(e=y.actions().cancel)||void 0===e||e.isAvailable(!0);y.state(o.e.started);t._startTime=t.startRumOneMeasure(!0,r.isMove);D.e(g,m);return t.handleMoveCopyAsyncItems(p,[y],a)}},moveAnywayVersionLimit:{isAvailable:v.create(!1),execute:function(){var e;t._engagement.logData({name:"MoveItemsAsync.MoveAnywayVersionLimit.Click"});p.allowSmallerVersionLimit=!0;y.actions().moveAnywayVersionLimit.isAvailable(!1);null===(e=y.actions().cancel)||void 0===e||e.isAvailable(!1);y.state(o.e.started);t._startTime=t.startRumOneMeasure(!0,r.isMove);D.e(g,m);return t.handleMoveCopyAsyncItems(p,[y],a)}},unlockVault:{isAvailable:v.create(!1),execute:function(){return new(t.managed(t._actionMap.VaultAction))({actionType:2,item:v.create(n)}).execute({}).then(function(){var e,n;D.e(g,m);if(c&&c.peek()){c(!1);null===(e=y.actions().unlockVault)||void 0===e||e.isAvailable(!1);y.state(o.e.canceled);return r.isAsync?t.handleMoveCopyAsyncItems(r,[y]):h(r,[y])}null===(n=y.actions().unlockVault)||void 0===n||n.isAvailable(!1);y.state(o.e.started);t._startTime=t.startRumOneMeasure(!0,r.isMove);return t.handleMoveCopyAsyncItems(p,[y],a)})}},vaultFileLimit:{isAvailable:v.create(!1),execute:function(){t._engagement.logData({name:"Vault.PaywallError.LearnMore"});var e=new(t.managed(t._actionMap.VaultAction))({actionType:8,item:v.create(n),goPremiumSource:"PVault-QuotaErrorLearnMore"});t.endRumOneMeasure(t._startTime,!0,r.isMove);y.state(o.e.expired);return e.execute({})}},moveSharedFileVault:{isAvailable:v.create(!1),execute:function(){y.state(o.e.completed);y.actions().moveSharedFileVault.isAvailable(!1);p.ackMoveIfShared=!1;p.deleteSource=!0;t._startTime=t.startRumOneMeasure(!0,r.isMove);D.e(g,m);return t.handleMoveCopyAsyncItems(p,[y],a)}}},progress:{minimum:0,maximum:1,current:0}});y.state(o.e.started);return y};t.prototype.moveCopyOperationFailure=function(e,t,n){if(t)for(var r=0,i=t;r<i.length;r++){var s=i[r];this.handleMoveCopyError(e,s)}return e};t.prototype.handleMoveCopyAsyncItems=function(e,n,r){var i=this;this.markAllOperationsAsStarted(n);return(function(e,n,r){if(r){var s={id:r,progress:null,pageStats:null,targetId:null};e.taskId||(e.taskId=r);return i.pollForProgress(s,e,n)}t._activeAsyncTasks[i._getKey(e)]=null;var o=i._getKey(e);i._cachePromises[o]=(function(e){return i._moveCopyDataSource.copyItemsAsync(e)})(e);return i._cachePromises[o].then(function(t){var r=e.items.map(function(e){return e.key});i._progressCache&&i._progressCache.saveJobState(t,r,e.targetKey,e.isMove);e.taskId=t.id;i.pollForProgress(t,e,n);return t},function(t){return i.moveCopyOperationFailure(t,n,e)})})(e,n,r)};t.prototype.pollForProgress=function(e,n,r,i,s){var o=this;if(!e)return null;var u={workItemIds:[e.id],jobInfo:e.jobInfo,type:f.e.itemCopy,items:n.items,lastProcessedTime:s};this._progressCache&&(u.progressCache=this._progressCache);var a=function(e){o._getItemDataSource().then(function(t){return t.getWorkProgress(e)}).then(function(t){i&&i(r,t);o._handleGetWorkProgressSuccess(t,r,n,e,a)})};if(r)for(var l=function(t){var n=r[t],i=n.payloads.peek().copyItems;if(!i.taskId&&e&&e.progress){var s=e.progress.filter(function(e){return o._hasMatchingItemIds(n,e)});s[0]?i.taskId=s[0].id:i.taskId=e.progress[0]&&e.progress[0].id}},c=0;c<r.length;c++)l(c);if(e.progress){i&&i(r,e);this._handleGetWorkProgressSuccess(e,r,n,u,a)}else{var h=this.async.setTimeout(function(){a(u)},2e3);t._activeAsyncTasks[this._getKey(n)]=h}};t.prototype.handleMoveCopyError=function(e,t,n){var r,i,u,f,l,c,h,p,y,w,E,S,x,T,C,k,L=e.code;null===(r=t.actions().cancel)||void 0===r||r.isAvailable(!1);t.payloads.peek().copyItems.taskId="";if(1e3===L){null===(i=t.actions().rename)||void 0===i||i.isAvailable(!0);var O=!0,M=t.payloads.peek(),_=M.moveItems&&M.moveItems.item||M.copyItems&&M.copyItems.item;(null==_?void 0:_.type)===g.e.Folder&&(O=!1);null===(u=t.actions().overwrite)||void 0===u||u.isAvailable(O);k=O?m.e.conflictUploadErrorText:m.e.conflictUploadFolderWithRenameErrorText;t.error(new d.e({message:k}))}else if(L===F)if(t.payloads().moveItems.item.parentKey===t.payloads().moveItems.destination.key)t.error(new d.e({message:m.e.sameLocationMoveCopyErrorText}));else{this._engagement.logData({name:"MoveCopyItems.NameConflictError"});if(t.payloads().moveItems.item.type===g.e.Folder){null===(f=t.actions().rename)||void 0===f||f.isAvailable(!0);k=m.e.conflictUploadFolderWithRenameErrorText;t.error(new d.e({message:k}))}else{null===(l=t.actions().overwrite)||void 0===l||l.isAvailable(!0);null===(c=t.actions().rename)||void 0===c||c.isAvailable(!0);k=m.e.conflictUploadErrorText;t.error(new d.e({message:k}))}}else if(-2147213282===L){this._engagement.logData({name:"MoveItemsAsync.SchemaMismatchError"});k=m.e.moveFileFolderSchemaMismatch;t.actions().moveAnywaySchemaMismatch.isAvailable(!0);t.error(new d.e({message:k}))}else if(-2147213278===L){this._engagement.logData({name:"MoveItemsAsync.VersionLimitError"});k=m.e.moveFileFolderVersionLimit;t.actions().moveAnywayVersionLimit.isAvailable(!0);t.error(new d.e({message:k}))}else if(-2147024713===L||-2147024816===L)if(t.payloads().moveItems.item.type===g.e.Folder){k=m.e.conflictUploadFolderWithRenameErrorText;null===(h=t.actions().rename)||void 0===h||h.isAvailable(!0);t.error(new d.e({message:k}))}else{k=m.e.conflictUploadErrorText;null===(p=t.actions().overwrite)||void 0===p||p.isAvailable(!0);null===(y=t.actions().rename)||void 0===y||y.isAvailable(!0);t.error(new d.e({message:k}))}else if(L===I){if(e.message){k=e.message;t.error(new d.e({message:k}))}}else if(2028===L){k=v.e.moveItemCannotMoveOwnItemIntoMountPointError;null===(w=t.actions().moveAnyway)||void 0===w||w.isAvailable(!0);t.error(new d.e({message:k}))}else if(2029===L){k=v.e.moveItemCannotMoveSharedItemIntoOwnFolderError;null===(E=t.actions().moveAnyway)||void 0===E||E.isAvailable(!0);t.error(new d.e({message:k}))}else if(9001===L){k=e?e.message:void 0;null===(S=t.actions().moveLockedFile)||void 0===S||S.isAvailable(!0);t.error(new d.e({message:k}))}else if(-2130247142===L){var P=e.message;t.payloads().moveItems.item.type===g.e.Folder&&(t.payloads().moveItems.item.key===t.payloads().moveItems.destination.key?P=m.e.moveFolderToSameLocationErrorText:0===t.payloads().moveItems.destination.key.indexOf(t.payloads().moveItems.item.key)&&(P=m.e.moveFolderToOwnSubfolderErrorText));k=P;t.error(new d.e({message:P}))}else if(161===L){k=m.e.unlockRequiredMoveErrorText;null===(x=t.actions().unlockVault)||void 0===x||x.isAvailable(!0);this._engagement.logData({name:"Vault.Upload.UnlockErrorShown"});t.error(new d.e({message:k}))}else if(162===L){this._engagement.logData({name:"Vault.PaywallError.Shown"});k=a.format(m.e.insufficientVaultQuotaErrorText,N.n);null===(T=t.actions().vaultFileLimit)||void 0===T||T.isAvailable(!0);t.actions().vaultFileLimit.closeHostOnExecute=!0;t.error(new d.e({message:k}))}else if(9018===L){this._engagement.logData({name:"Vault.Move.RemoveSharingShown"});k=m.e.moveSharedFileVaultErrorText;null===(C=t.actions().moveSharedFileVault)||void 0===C||C.isAvailable(!0);t.actions().moveSharedFileVault.closeHostOnExecute=!0;t.error(new d.e({message:k}))}else{var H=m.e,B=void 0;switch(L){case 3e3:B=b.e.ItemNotFoundSubText;break;case 1007:B=H.moveFolderToSameLocationErrorText;break;case R:B=H.overQuotaCreateItemErrorText;break;case-2147213295:B=H.moveCopyIRMNotSupported;break;case-2147213288:B=H.moveCopyObjectsNotSameLevel;break;case-2147213287:B=H.moveCopyTargetIsSubfolder;break;case-2147213294:case-2147213293:B=H.moveFolderDeleteFail;break;case-2147213291:case-2147024684:case-2147213290:B=H.moveFileDeleteFail;break;case-2147213285:B=H.moveCopyPermissionsFail;break;case-2147213284:B=H.moveCopyNoScriptSourceFail;break;case-2147213283:B=H.moveCopyNoScriptTargetFail;break;case-2147213292:case-2147024809:B=H.moveCopyFatalErrorText;break;case 164:B=H.moveSpecialFoldersVaultError;this._engagement.logData({name:"Vault.Move.SpecialFolderBlocked"});break;case-2147023636:B=H.moveBlockedByPolicy;break;case-2147213252:var j=t.payloads().moveItems?t.payloads().moveItems.item.name:t.payloads().copyItems&&t.payloads().copyItems.item.name;B=a.format(m.e.moveCopyFluiFileNotSupported,j);break;case-2147213251:B=m.e.moveCopyInsufficientPermission;break;case-2147213259:var q=t.payloads().moveItems?t.payloads().moveItems.destination.displayName:t.payloads().copyItems&&t.payloads().copyItems.destination.displayName,U=e.message;B=a.format(m.e.moveCopyDestinationNotFound,q,U);break;default:B=e.message}k=B;t.error(new d.e({message:"string"==typeof B?B:void 0}))}var z=t.type.peek()===s.e.moveItems?A.r:A.e,W=t.payloads.peek().copyItems.item.key;X.indexOf(L)>-1?D.t(W,z,{name:L,message:k}):D.i(W,z,{name:L,message:k});var V=void 0===n||n;this.endRumOneMeasure(this._startTime,V,t.type.peek()===s.e.moveItems);t.state(o.e.failed)};t.prototype.markAllOperationsAsStarted=function(e){if(e)for(var t=0,n=e;t<n.length;t++){n[t].state(o.e.started)}};t.prototype.startRumOneMeasure=function(e,t){var n;n=e?t?A.i:A.t:t?A.s:A.n;if(this._rumOneHelper){var r=this._rumOneHelper.rumone;r.resetLogger();r.writeScenarioId(n);r.addExpectedControl(n);r.writePageTransitionType(M.e.none);this._startTime=Date.now()}return this._startTime};t.prototype.endRumOneMeasure=function(e,t,n){var r;r=t?n?A.i:A.t:n?A.s:A.n;if(this._rumOneHelper){var i=this._rumOneHelper.rumone,s=new _.e(r,e,Date.now(),this._renderTimeCalculator,this._renderTimeRequiredDataChecker);i.writeControlPerformanceData(s)}};t.prototype._handleGetWorkProgressSuccess=function(e,n,i,u,a){var f=this,l=!1,c=!1,h=i.taskId;void 0!==this._pollsForProgressSinceCancel[h]&&(this._pollsForProgressSinceCancel[h]+=1);if(n&&e&&e.progress)for(var p=function(t){for(var n,u=t.payloads.peek(),a=t.type.peek()===s.e.moveItems?A.r:A.e,p=t.payloads.peek().copyItems.item.key,m=0,g=e.progress;m<g.length;m++){var b=g[m];if(u.copyItems&&b.id===t.payloads.peek().copyItems.taskId&&v._hasMatchingItemIds(t,b)&&t.state.peek()!==o.e.completed&&t.state.peek()!==o.e.failed){n=b;break}}var w=function(){t.payloads(Object(r.__assign)(Object(r.__assign)({},t.payloads.peek()),{moveItems:Object(r.__assign)(Object(r.__assign)({},t.payloads.peek().moveItems),{createdItem:n.createdItem})}));if(!1===i.deleteSource)f.resources.consumeAsync(H.e).then(function(e){var n,r,i=new B.e;return e.deleteItems({items:[null===(n=t.payloads.peek().moveItems)||void 0===n?void 0:n.item],parentKey:null===(r=t.payloads.peek().moveItems)||void 0===r?void 0:r.source.key,overrideLock:!0,enforceETag:!0,deletionType:j.e.Recycle},i).then(function(){var e=i.getTasks()[0];if(e.error)f.handleMoveCopyError(e.error,t);else{t.progress.current(1);t.actions().cancel&&t.actions().cancel.isAvailable(!1);t.state(o.e.completed);c=!0}})});else{t.progress.current(1);t.actions().cancel&&t.actions().cancel.isAvailable(!1);t.state(o.e.completed);c=!0}};if(n){var E=n.error,S=y.e[n.status];if(S===y.e.Cancelled||v._pollsForProgressSinceCancel[h]>=3){t.actions().cancel.isAvailable(!1);t.state(o.e.canceled);c=!0}else if(E&&q.indexOf(E.code)<=-1){var x=n.errorCode;if(x===U){E.code=R;D.i(p,a,{name:E.code.toString(),message:x})}else x===W&&(E.code=z);if(v._progressCache){t.progress.current(0);t.state()!==o.e.failed&&v.handleMoveCopyError(E,t)}else v.handleMoveCopyError(E,t)}else if(S===y.e.Completed&&(L.e.isActivated("092F2A66-DF41-4F34-BA99-033B8AB7C668","09/09/2020","log error message when moving is not completed")||n.completedBytes>=n.totalBytes)){w();E&&q.indexOf(E.code)>-1&&t.error(new d.e({errorType:2,message:""}));v.endRumOneMeasure(v._startTime,!1,t.type.peek()===s.e.moveItems)}else{var T=t.progress.current.peek();if(n.completedBytes>T){t.progress.current(n.completedBytes);t.progress.maximum(n.totalBytes)}l=!0}v._progressCache&&v._progressCache.updateJobState(h,t,n)}else if(t.state()!==o.e.failed){w();v.endRumOneMeasure(v._startTime,!1,t.type.peek()===s.e.moveItems)}},v=this,m=0,g=n;m<g.length;m++){p(g[m])}var b=i.isMove?A.r:A.e;if(c){this._itemProvider.invalidateItem(i.parentKey);this._itemProvider.invalidateItem(i.targetKey);this._isItemsScopeEnabled()&&this.resources.consumeAsync(x.D).then(function(e){e.invalidateItems(i.targetKey);e.invalidateItems(i.parentKey)});var w=Object(P.e)(i);D.n(w,b);this._updateQuota()}if(l){var E=this.async.setTimeout(function(){a(u)},2e3);t._activeAsyncTasks[this._getKey(i)]=E}else if(this._progressCache){this._pollsForProgressSinceCancel={};this._progressCache.purgeJobState(h)}};t.prototype._renderTimeRequiredDataChecker=function(e,t){return!(!e||!t)&&(t.startTime>=0&&t.endTime>t.startTime)};t.prototype._renderTimeCalculator=function(e,t){return e&&t?t.endTime-t.startTime:0};t.prototype._hasMatchingItemIds=function(e,t){var n=e.payloads.peek().copyItems&&e.payloads.peek().copyItems.item;return!t.sourceResourceId||this._moveCopyDataSource.hasMatchingId(t.sourceResourceId,n)};t.prototype._cancelAsyncOperation=function(e,n,r){var i=this,s=r||e.taskId,u=t._activeAsyncTasks[this._getKey(e)];if(!this._cancelPromises[s]){var a={workItemIds:[s]};this._progressCache&&(a.progressCache=this._progressCache);this._cancelPromises[s]=this._getItemDataSource().then(function(e){return e.cancelWork(a)})}return this._cancelPromises[s].then(function(e){var t;if(i._progressCache){var r=i._progressCache.getCacheData(),a=r&&r[s];if(e||!a){n.state(o.e.canceled);i._progressCache.cancelJobs(s);u&&i.async.clearTimeout(u)}else i._pollsForProgressSinceCancel[s]=0}null===(t=n.actions().cancel)||void 0===t||t.isAvailable(!1);i._cancelPromises[s]=void 0},function(e){i._cancelPromises[s]=void 0})};t.prototype._getKey=function(e){return e.items.map(function(e){return e.key}).join(",")+e.targetKey};t.prototype._resumePendingProgress=function(){var e=this;this._bundleLoader.queueLoad("./MoveCopyAsyncProgressCache",function(){return l.n.resolve(n.e("256").then(n.bind(null,2267)))}).then(function(t){e._progressCache=new(e.managed(t))({moveCopyHelper:e});e._progressCache.resumePendingProgress()})};t.prototype._getItemDataSource=function(){return this.resources.consumeAsync(x.B)};t.dependencies=Object(r.__assign)(Object(r.__assign)({},w.n.dependencies),{moveCopyDataSource:x.o.optional,itemProvider:h.resourceKey,operationProvider:c.e,bundleLoader:S.e,updateQuota:T.e,actionMap:E.e,itemSelectionHelperType:C.e,isItemsScopeEnabled:k.c.lazy});t._activeAsyncTasks={};return t})(w.n);t.default=V;var $=Object(i.s)("MoveCopyItemsAsyncOperation",V)}}]);