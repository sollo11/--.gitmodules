(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([["51"],{"785":function(e,t,n){"use strict";n.d(t,"r",function(){return h});var r=n(0),i=n(7),s=n(338);n.d(t,"t",function(){return s.e});var o=n(192),u=n(105),a=n(337);n.d(t,"e",function(){return a});var f=n(3),l=n(5),c=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});void 0===n&&(n={});var r=e.call(this,t,n)||this,i=n.itemsStore,s=void 0===i?r.resources.consume(u.e):i;r._itemsStore=s;r._itemUpdatesByKey={};return r}t.prototype.update=function(e,t){void 0===t&&(t=!1);for(var n=0,r=e;n<r.length;n++){var i=r[n];this._processTask(i)}};t.prototype.flush=function(){var e;e={};for(var t=this._itemUpdatesByKey,n=Object.keys(t).filter(function(e){return!!t[e].item}),i=0,s=n;i<s.length;i++){var u=s[i],f=t[u],l=new o.e(u),c=this._getStoreItem(u);if(c){c.parent;var h=Object(r.__rest)(c,["parent"]);Object(a.default)(l,h)}Object(a.default)(l,{revision:0});for(var p=0,d=f.item;p<d.length;p++){var v=d[p];Object(a.default)(l,v)}e[u]=l}for(var m=0,g=n;m<g.length;m++){var y=(l=e[u=g[m]]).parentKey;if(y){var b=e[y]||this._getStoreItem(y)||new o.e(y);e[y]=b;l.parent=b}else delete l.parent}this._pushItemsToStore(e);for(var w=0,E=n;w<E.length;w++){u=E[w];delete(f=t[u]).item}};t.prototype.reset=function(){this._itemUpdatesByKey={}};t.prototype.getItem=function(e){var t=e.key;return this._getStoreItem(t)};t.prototype.getChildren=function(e){var t,n,r,i=e.parentKey,s=e.startIndex,o=e.endIndex,u=[],a=this._itemUpdatesByKey[i];if(a){var f=a.set;if(f)if(f.childrenByIndex){s=void 0===(n=(t={startIndex:s,endIndex:o}).startIndex)?f.startIndex:n,o=void 0===(r=t.endIndex)?f.endIndex:r;for(var l=s;l<o;l++){var c=f.childrenByIndex[l],h=this._getStoreItem(c);u.push(h)}}else if(f.childrenBySibling)for(var p={},d="";d=f.childrenBySibling[d];){if(p[d])throw new Error("Circular reference encountered enumerating the children of '"+i+"'.");p[d]=!0;h=this._getStoreItem(d);u.push(h)}}return u};t.prototype._processTask=function(e){var t=e.key,n=e.output,r=n.item,i=n.set,s=this._itemUpdatesByKey,o=s[t];o||(o=s[t]={});if(r){o.item||(o.item=[]);o.item.push(r)}if(i){var u=s[i.parent.key];u||(u=s[i.parent.key]={});u.set||(u.set={});var a=u.set;if(void 0!==i.index){a.childrenByIndex||(a.childrenByIndex=[]);void 0===a.startIndex?a.startIndex=i.index:a.startIndex=Math.min(a.startIndex,i.index);var f=a.childrenByIndex.length;a.childrenByIndex[i.index]=t;void 0===a.endIndex?a.endIndex=i.index+1:a.endIndex>i.index+1?a.endIndex+=a.childrenByIndex.length-f:a.endIndex=Math.max(a.endIndex,i.index+1)}else if(i.after){a.childrenBySibling||(a.childrenBySibling={});a.childrenBySibling[i.after.key]=t}}};t.prototype._getStoreItem=function(e){var t=this._itemsStore.getItem(e);return this.peekUnwrapObservable(t)};t.prototype._pushItemsToStore=function(e){var t={};for(var n in e){(s=t[i=e[(a=e[n]).parentKey]&&a.parentKey||""]||(t[i]=[])).push(n)}for(var r=[""];r.length;){var i,s;if(s=t[i=r.shift()]){for(var o=0,u=s;o<u.length;o++){var a;if(!(a=e[n=u[o]]))throw new Error("Attempted to update the same item multiple times.");this._itemsStore.setItem(a,n)}r.push.apply(r,s)}}};t.dependencies=Object(r.__assign)(Object(r.__assign)({},i.n.dependencies),{itemsStore:u.e});return t})(i.n),h=new f.t({name:"ItemTaskObserver",factory:new l.r(c)});t.n=c},"979":function(e,t,n){"use strict";var r;(function(e){e[e.Recycle=2]="Recycle";e[e.PermanantDelete=3]="PermanantDelete";e[e.MoveToSecondStage=4]="MoveToSecondStage"})(r||(r={}));t.e=r},"1153":function(e,t,n){"use strict";n.d(t,"e",function(){return y});var r=n(25),i=n(5),s=n(22),o=n(979),u=n(785),a=n(105),f=n(3),l=n(83),c=n(381),h=n(80),p=n(338),d=n(15),v=n(31),m=n(337),g=(function(){function e(e,t){this._itemDataSource=t.itemDataSource;this._deleteRestoreDataSource=t.deleteRestoreDataSource;this._itemProvider=t.itemProvider;this._itemTaskObserver=new t.itemTaskObserverType;this._photoProvider=t.photoProvider;this._store=t.itemsStore;this._tagProvider=t.tagProvider;this._updateQuota=t.updateQuota;this._isItemsScopeEnabled=t.isItemsScopeEnabled;this._resources=t.resources}e.prototype.createFolder=function(e,t){var n=this,r=e.parent.key,i=e.folderName,s=new p.e(r+"&cf="+i,i);return this._performOperation([r],t,s,function(){return n._itemDataSource.createFolder(e)})};e.prototype.renameItem=function(e,t){var n=this,r=e.item,i=r.key,s=new p.e(i,r);return this._performOperation([e.parentKey,i],t,s,function(){return n._itemDataSource.renameItem(e)})};e.prototype.deleteItems=function(e,t){return this._handleDeleteOrRestore(e,t,this._handleDelete)};e.prototype.restoreItems=function(e,t){return this._handleDeleteOrRestore(e,t,this._handleRestore)};e.prototype.restoreAll=function(e){var t=this;return this._deleteRestoreDataSource.restoreAll(e).then(function(){t._itemProvider.invalidateItem(e.parentKey);t._updateQuota(!0);return!0})};e.prototype._handleDelete=function(e){var t=this,n=this._itemProvider;return this._deleteRestoreDataSource.deleteItems(e).then(function(r){var i;e.deletionType===o.e.Recycle&&(i={triggerFetch:!1,emptyAllOtherSets:!0});n.invalidateItem(e.parentKey,i);var s=e.items.map(function(e){return new p.e(e.key).succeed({item:{key:e.key,parentKey:m.remove()}})}),u=t._itemTaskObserver;u.update(s);u.flush();return r})};e.prototype._handleRestore=function(e){var t=this;return this._deleteRestoreDataSource.restoreItems(e).then(function(n){var r=s.e(e.parentKey);delete r.view;var i=s.n(r);t._itemProvider.invalidateItem(i,{emptyAllOtherSets:!0});(t._isItemsScopeEnabled||t._resources.consume(h.n))&&t._resources.consumeAsync(d.D).then(function(e){e.invalidateItems(i)});return n})};e.prototype._handleDeleteOrRestore=function(e,t,n){var r=this,i={},s=e.items.map(function(e){return i[e.id]=new p.e(e.key,e)}),o=this._itemProvider;t.update(s);return n.call(this,e).then(function(n){for(var i=0,o=e.items;i<o.length;i++){var u=o[i];r._invalidatePhoto(u)}r._store.invalidateAllPhotos();r._invalidateAllTags();s=s.map(function(e){return e.succeed()});t.update(s)},function(n){o.invalidateItem(e.parentKey);var r=n.data&&n.data.items||[];s=[];for(var u=0,a=r;u<a.length;u++){var f=a[u],l=i[f.id];delete i[f.id];s.push(f.error?l.fail(f.error):l.succeed())}for(var c in i){l=i[c];s.push(l.cancel())}t.update(s)}).then(function(){r._updateQuota(!0)})};e.prototype._invalidatePhoto=function(e){var t=s.e(e.key);delete t.qt;var n=s.n(t);this._store.invalidateItem(n);(this._isItemsScopeEnabled||this._resources.consume(h.n))&&this._resources.consumeAsync(d.D).then(function(e){e.invalidateItems(n)});if(e.tags)for(var r=0,i=e.tags;r<i.length;r++){var o=i[r];this._store.invalidateLocation(o.tag)}};e.prototype._invalidateAllTags=function(){var e=this._photoProvider,t=this._tagProvider;if(e&&t){var n=e.getAllPhotosSettings().peek();t.invalidateAllTags(n.rootId)}};e.prototype._performOperation=function(e,t,n,i){var s=this;t.update([n]);return i().then(function(r){for(var i=0,o=e;i<o.length;i++){var u=o[i];s._itemProvider.invalidateItem(u)}t.update([n.succeed(r)])},function(e){var i=new Error(e);t.update([n.fail(i)]);return r.n.wrapError(i)})};e.dependencies={itemDataSource:d.B,deleteRestoreDataSource:d.u,itemProvider:l.resourceKey,itemsStore:a.e,itemTaskObserverType:u.r,photoProvider:v.d.optional,tagProvider:v.T.optional,updateQuota:c.e,isItemsScopeEnabled:h.c,resources:f.o};return e})(),y=Object(i.s)("FileSystemProvider",g)},"1181":function(e,t,n){"use strict";var r=n(0),i=n(7),s=n(25),o=n(256),u=n(264),a=n(155),f=n(1344),l=n(22),c=n(384),h=1e3,p=n(404);n.d(t,"n",function(){return d});n.d(t,"e",function(){return v});n.d(t,"r",function(){return m});n.d(t,"t",function(){return g});var d="__New",v="__Auto",m="__WeekendRecap",g="__EventRecap",y=(function(e){Object(r.__extends)(t,e);function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;n._urlDataSource=n.resources.consume(o.n);return n}t.prototype.addToAlbum=function(e,n){var r={id:e.id,name:null,items:this._getIdsFromKeyArray(n),action:t.ADD_TO_ALBUM_ACTION};return this._handleRequest(n,r)};t.prototype.removeFromAlbum=function(e,n){var r={id:e.id,name:null,items:this._getIdsFromKeyArray(n),action:t.REMOVE_FROM_ALBUM_ACTION};return this._handleRequest(n,r)};t.prototype.createAlbum=function(e,n){var r=this,i=this._getIdsFromKeyArray(n),o=i.slice(0,20),a={id:null,name:e,items:o,action:t.CREATE_ALBUM_ACTION};return(new u.e).send({requestType:"POST",postData:JSON.stringify(a),apiName:t.MODIFY_ALBUM_API_NAME+"."+a.action,url:this._getModifyAlbumUrl(),isErrorExpectedCallback:p.e}).then(function(e){if(!n||n&&n.length<20)return e;o=i.slice(20);var u={id:e.id,items:o,action:t.ADD_TO_ALBUM_ACTION,name:null};return r._handleRequest(o,u).then(function(t){return e},function(e){var t={errorType:c.e.other,error:new Error(e.data.message)};return s.n.wrapError(t)})},function(e){var t=c.e.other;e.data.code===h&&(t=c.e.conflict);var n={errorType:t,error:new Error(e.data.message)};return s.n.wrapError(n)})};t.prototype.getWalgreensLandingPageUrl=function(e){var t=this._urlDataSource.getPublishToWalgreensUrl();return(new u.e).sendPostUrlEncoded("PublishToWalgreens",t,JSON.stringify({ids:e}))};t.prototype.createAlbumFromFolder=function(e){var n=this._getModifyAlbumUrl(),r=new u.e,i={id:null,name:e.folder.name,items:[e.folder.id],action:t.CREATE_ALBUM_WITH_RENAME_ACTION};return r.send({apiName:t.MODIFY_ALBUM_API_NAME+"."+i.action,url:n,requestType:"POST",postData:JSON.stringify(i),isErrorExpectedCallback:p.e})};t.prototype.getAlbumsParentKey=function(e){var n;void 0===e&&(e={});var r=((n={}).id=t.ALBUMS_ID,n.cid=this._urlDataSource.getOwnerId(),n.tagFilter=e.tagFilter,n);return l.n(r,void 0,!0)};t.prototype.setCoverPhoto=function(e,n){var r=this._getModifyAlbumUrl(),i=new u.e,o={id:e.id,items:[n.id],action:t.SET_COVER_PHOTO_ACTION,name:null};return i.send({apiName:t.MODIFY_ALBUM_API_NAME+"."+o.action,url:r,requestType:"POST",postData:JSON.stringify(o),isErrorExpectedCallback:p.e}).then(null,function(e){var t=e&&e.data&&e.data.message||"";return s.n.wrapError(t)})};t.prototype._handleRequest=function(e,n){var r=this._getModifyAlbumUrl();return f.e.start({apiName:t.MODIFY_ALBUM_API_NAME+"."+n.action,url:r,batchSize:20,items:e,isErrorExpectedCallback:p.e,getPostData:function(e){return{id:n.id,name:n.name,items:e,action:n.action}}})};t.prototype._getModifyAlbumUrl=function(){return a.t.skyApiBaseUrl+t.MODIFY_ALBUM_API_NAME};t.prototype._getIdsFromKeyArray=function(e){return e.map(function(e){return l.e(e).id})};t.ADD_TO_ALBUM_ACTION="Add";t.CREATE_ALBUM_ACTION="Create";t.CREATE_ALBUM_WITH_RENAME_ACTION="CreateWithRename";t.REMOVE_FROM_ALBUM_ACTION="Remove";t.SET_COVER_PHOTO_ACTION="SetCoverPhoto";t.MODIFY_ALBUM_API_NAME="ModifyAlbum";t.ALBUMS_ID="albums";return t})(i.n);t.i=y},"1344":function(e,t,n){"use strict";var r=n(147),i=n(264),s=(function(){function e(){}e.start=function(e){var t=new r.e(function(){for(var e=0,t=o;e<t.length;e++){t[e].cancel()}}),n=e.items.slice(),s=e.parallelRequests||1,o=[];function u(e){var t=o.indexOf(e);t>=0&&o.splice(1,t)}function a(){var r=new i.e,s=n.splice(0,e.batchSize),f=JSON.stringify(e.getPostData(s)),l=r.send({apiName:e.apiName,url:e.url,requestType:"POST",postData:f,isErrorExpectedCallback:e.isErrorExpectedCallback}).then(function(){u(l);e.onBatchComplete&&e.onBatchComplete(s);n.length?a():t.complete()},function(e){u(l);(function(e){t.error(e)})(e)});o.push(l)}for(var f=0;n.length>0&&f<s;f++)a();return t.getPromise()};return e})();t.e=s},"1380":function(e,t,n){"use strict";n.r(t);n.d(t,"resourceKey",function(){return S});var r=n(0),i=n(7),s=n(15),o=n(25),u=n(138),a=n(83),f=n(31),l=n(30),c=n(129),h=n(85),p=n(338),d=n(405),v=n(240),m=n(114),g=n(5),y=n(1181),b=n(941),w=n(80),E=(function(e){Object(r.__extends)(t,e);function t(t,n){var r=e.call(this,t,n)||this;r._albumDataSource=n.albumDataSource;r._operationProvider=n.operationProvider;r._itemProvider=n.itemProvider;r._urlDataSource=n.urlDataSource;r._tagProvider=n.tagProvider;r._isSingleAlbumItemsScopeEnabled=r.resources.consume(w.a);return r}t.prototype.addToAlbum=function(e){for(var t=this,n=new c.e,r=this.observables.createArray(e.items).map(function(r){var i=t._operationProvider.register({name:r.name,type:h.e.addItemsToAlbum,payloads:{addItemsToAlbum:{item:r,album:e.album}},iconName:r.iconName,batch:n});i.progress.maximum(1);i.progress.current(0);return i}),i=0,s=r();i<s.length;i++){s[i].state(l.e.started)}return this._albumDataSource.addToAlbum(e.album,e.items.map(function(e){return e.id})).then(function(n){if(!t._isSingleAlbumItemsScopeEnabled){t._itemProvider.invalidateItem(e.album.key);t._itemProvider.invalidateItem(t.getAlbumsParentKey())}for(var i=0,s=r();i<s.length;i++){var o=s[i];o.progress.current(1);o.state(l.e.completed)}return n},function(e){for(var t=0,n=r();t<n.length;t++){n[t].state(l.e.failed)}return o.n.wrapError(e)})};t.prototype.createAlbum=function(e,t){var n=this,r=[new p.e("createAlbum="+e.name,e.name)],i=e.keys;return this._albumDataSource.createAlbum(e.name,i).then(function(e){return n._getNewlyCreatedAlbum(e.id)}).then(function(e){r=e?r.map(function(t){return t.succeed(e)}):r.map(function(e){return e.fail(m.e.DefaultTitle)});t.update(r)},function(e){r=r.map(function(t){return t.fail(e.error)});t.update(r);return o.n.wrapError(e)})};t.prototype.getWalgreensLandingPageUrl=function(e){for(var t=[],n=0;n<e.length;n++)e[n].photo&&!e[n].video&&t.push(e[n].id);return this._albumDataSource.getWalgreensLandingPageUrl(t)};t.prototype.removeFromAlbum=function(e){var t=this;return this._albumDataSource.removeFromAlbum(e.album,e.items.map(function(e){return e.id})).then(function(n){t._itemProvider.invalidateItem(t.getAlbumsParentKey());t._itemProvider.invalidateItem(e.album.key);return n},function(e){return o.n.wrapError(e)})};t.prototype.createAlbumFromFolder=function(e,n){for(var r=this,i=[new p.e("createAlbumFromFolder="+e.folder.id,e.folder.name)],s=0,u=i;s<u.length;s++){u[s].status=0}n.update(i);return this._albumDataSource.createAlbumFromFolder(e).then(function(e){return r._getNewlyCreatedAlbum(e.id)}).then(function(e){if(!e){var s=m.e.DefaultTitle;i=i.map(function(e){return e.fail(s)});n.update(i);return o.n.wrapError(s)}var u=null,a=function(){var s={type:d.e.albumFolderExtraction};u&&(s.workItemIds=u);r._itemProvider.getWorkProgress(s).done(function(s){var o;s.progress&&s.progress.length&&(o=s.progress[0]);if(o&&o.status!==v.e[v.e.Completed]){u||(u=[o.id]);r.async.setTimeout(a,t.ASYNC_DELAY)}else{i=i.map(function(t){return t.succeed(e)});n.update(i)}},function(e){i=i.map(function(e){return e.fail(m.e.DefaultTitle)});n.update(i)})};r.async.setTimeout(a,t.ASYNC_DELAY)},function(e){var t=m.e.DefaultTitle,r=new Error(t);i=i.map(function(e){return e.fail(r)});n.update(i);return o.n.wrapError(r)})};t.prototype.getAlbumsParentKey=function(e){void 0===e&&(e={});return this._albumDataSource.getAlbumsParentKey(e)};t.prototype.setCoverPhoto=function(e,t){var n=this,r=this.getAlbumsParentKey(),i=[new p.e(r+"&scp="+e.album.name,e.album.name)];return this._albumDataSource.setCoverPhoto(e.album,e.items[0]).then(function(s){n._itemProvider.invalidateItem(r);n._itemProvider.invalidateItem(e.album.key);i=i.map(function(e){return e.succeed(s.id)});t.update(i)},function(e){var n=new Error(e);i=i.map(function(e){return e.fail(n)});t.update(i);return o.n.wrapError(n)})};t.prototype.saveAutoAlbum=function(e,t,n){var r=this,i=e.album,s=i.properties.newTag,u=new p.e(i.key,i);if(!b.s(i)){u=u.fail();n.update([u]);return o.n.wrap(void 0)}n.update([u]);return this._tagProvider.updateTags({items:[i],tagsToDelete:[s],tagsToAdd:null,rootItemId:this.getAlbumsParentKey(),skipInvalidate:t}).then(function(e){u=u.succeed();n.update([u]);r._itemProvider.invalidateItem(r.getAlbumsParentKey({tagFilter:y.n}));r._itemProvider.invalidateItem(r.getAlbumsParentKey());r._itemProvider.invalidateItem(i.key)},function(e){var t=new Error(e);u=u.fail();n.update([u]);return o.n.wrapError(t)})};t.prototype.markAutoAlbumAsSeen=function(e,t){var n=e.properties.newTag,r=e.properties.autoAlbumTag;return n&&r?this._tagProvider.updateTags({items:[e],tagsToDelete:[n],tagsToAdd:null,rootItemId:this.getAlbumsParentKey(),skipInvalidate:t}).then(function(e){return e&&!e.error},function(e){return!1}):o.n.wrap(!1)};t.prototype.convertToAutoAlbum=function(e,t,n){var r=this,i=e.properties.newTag,s=e.properties.autoAlbumTag,u=new p.e(e.key,e);if(i){u=u.fail();n.update([u]);return o.n.wrap(void 0)}i={localizedTag:"__New",source:"SystemDefined",tag:"__New",type:"Keyword"};s||(s={localizedTag:"__Auto",source:"SystemDefined",tag:"__Auto",type:"Keyword"});return this._tagProvider.updateTags({items:[e],tagsToDelete:null,tagsToAdd:[s,i],rootItemId:this.getAlbumsParentKey(),skipInvalidate:t}).then(function(t){u=u.succeed();n.update([u]);r._itemProvider.invalidateItem(r.getAlbumsParentKey({tagFilter:y.n}));r._itemProvider.invalidateItem(r.getAlbumsParentKey());r._itemProvider.invalidateItem(e.key)},function(e){var t=new Error(e);u=u.fail();n.update([u]);return o.n.wrapError(t)})};t.prototype._getNewlyCreatedAlbum=function(e){var t=this.getAlbumsParentKey();this._itemProvider.invalidateItem(t);var n={parentKey:t,ownerId:this._urlDataSource.getOwnerId(t),pageSize:10,startIndex:0,isAscending:!1,skipCache:!0};return this._itemProvider.getItem(n).then(function(t){for(var n=t.content.peek().items,r=n.length,i=0;i<r;i++){var s=n[i].peek();if(s.id===e)return s}})};t.dependencies=Object(r.__assign)(Object(r.__assign)({},i.n.dependencies),{operationProvider:u.e,itemProvider:a.resourceKey,albumDataSource:s.e,urlDataSource:s.we,tagProvider:f.T});t.ASYNC_DELAY=5e3;t.ASYNC_RETRY_LIMIT=5;t.ASYNC_RETRY_DELAY=15e3;return t})(i.n);t.default=E;var S=Object(g.s)("AlbumProvider",E)},"3235":function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(7),s=n(26),o=n(1062),u=n(338),a=n(85),f=n(1153),l=n(979),c=n(1380),h=n(785),p=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n._context=t;n._fileSystemProvider=n.resources.consume(f.e);n._albumProvider=n.resources.consume(c.resourceKey);return n}t.prototype.getOperationDetails=function(t){var n=e.prototype.getOperationDetails.call(this,t),r=t.input;n.type=a.e.discardAutoAlbum;n.name=r.name;n.payloads.discardAutoAlbum={album:r};n.visibility=0;return n};t.prototype.onStart=function(e){var t=this,n=this._context.album,r=new u.e(n.key,n),i=this._albumProvider.getAlbumsParentKey({}),s=new(this.managed(h.n));e.update([r]);var o={items:[this._context.album],deletionType:l.e.Recycle,overrideLock:!1,parentKey:i,emptyRecycleBin:!1};this._updateAlbumDeletionStatus(s,n,1);return this._fileSystemProvider.deleteItems(o,e).then(function(e){t._updateAlbumDeletionStatus(s,n,2);s.dispose();return e})};t.prototype._updateAlbumDeletionStatus=function(e,t,n){var r=t.state&&t.state.delete||{};r.status=n;e.update([new u.e(t.key).succeed({item:{state:{delete:r}}})]);e.flush()};return t})(o.n),d=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n._selectionHelper=t.selectionHelper;return n}t.prototype.execute=function(e){var t=this,n={album:this._selectionHelper.firstItem.peek()};return this._selectionHelper.resolveSelection().then(function(){var e=new(t.managed(p))(n);t.trackPromise(e.start());return e.wait()}).then(function(){return{resultType:s.e.Success}},function(e){return{resultType:s.e.Failure}})};return t})(i.n);t.default=d}}]);