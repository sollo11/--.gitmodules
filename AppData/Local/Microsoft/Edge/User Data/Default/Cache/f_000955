var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Excel=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=18)}({18:function(e,t,i){"use strict";var n,o,r,s;i.r(t),function(e){e[e.u=0]="msoulscat_ES_EWAJS",e[e.h=1]="msoulscat_ES_EWAJSGrid",e[e.v=6]="msoulscat_ES_EWAJSChart",e[e.g=202]="msoulscat_MSOSP_FileMenuCommands",e[e._=225]="msoulscat_MSOSP_OTelJS",e[e.O=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.R=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.P=301]="msoulscat_Wac_WordViewer",e[e.F=306]="msoulscat_Wac_BrowserGeneral",e[e.A=320]="msoulscat_Wac_TaskPane",e[e.U=339]="msoulscat_Wac_OneNoteGeneral",e[e.W=340]="msoulscat_Wac_Ribbon",e[e.N=379]="msoulscat_Wac_WopiPendingApplication",e[e.H=383]="msoulscat_Wac_Telemetry",e[e.k=391]="msoulscat_Wac_WacCatchUpActivities",e[e.J=394]="msoulscat_Wac_Dictation",e[e.B=395]="msoulscat_Wac_OneNoteSync",e[e.j=700]="msoulscat_Wac_VisioApp",e[e.q=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.K=800]="msoulscat_Wac_PptAnimation",e[e.X=833]="msoulscat_Wac_PptLive",e[e.Z=834]="msoulscat_Wac_PptMWeb",e[e.$=815]="msoulscat_Wac_PptShape",e[e.Y=817]="msoulscat_Wac_PptSession",e[e.ee=830]="msoulscat_Wac_PptSlideshow",e[e.te=822]="msoulscat_Wac_PptView",e[e.ie=2300]="msoulscat_Wac_VersionHistory",e[e.ne=302]="msoulscat_Wac_WordPresence",e[e.oe=3005]="msoulscat_Wac_WordVersionHistory",e[e.re=3006]="msoulscat_Wac_LivePersonaCard",e[e.se=3012]="msoulscat_Wac_CatchUpFlyout",e[e.ae=3016]="msoulscat_Wac_WordDesigner",e[e.ce=3021]="msoulscat_Wac_ModernFontPicker",e[e.ue=3027]="msoulscat_Wac_UnifiedUiHost"}(n||(n={})),(r=o||(o={}))[r.Error=10]="Error",r[r.Warning=15]="Warning",r[r.Info=50]="Info",r[r.Verbose=100]="Verbose",r[r.Spam=200]="Spam",function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.IE=2]="IE",e[e.Edge=3]="Edge",e[e.Chrome=4]="Chrome",e[e.Safari=5]="Safari",e[e.Unknown=6]="Unknown"}(s||(s={}));var a=window.navigator,c=a?a.userAgent:void 0;function u(){if(c){if(c.indexOf("Firefox")>-1)return s.Firefox;if(c.indexOf("Opera")>-1||c.indexOf("OPR")>-1)return s.Opera;if(c.indexOf("Trident")>-1)return s.IE;if(c.indexOf("Edg")>-1)return s.Edge;if(c.indexOf("Chrome")>-1)return s.Chrome;if(c.indexOf("Safari")>-1)return s.Safari}return s.Unknown}function h(){"undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}})}function f(){try{return!!c&&c.indexOf("iPad")>=0||!!c&&c.indexOf("Macintosh")>=0&&v()&&!(c&&c.indexOf("iPhone")>=0)||!!c&&c.indexOf("Android")>=0||v()}catch(e){return!1}}function l(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(e){return!1}}function d(){return u()===s.IE&&!function(){if(u()!==s.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function p(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(e){return!1}}function v(){return!!a&&(a.maxTouchPoints>0||a.msMaxTouchPoints>0)}function m(e){return 8===e.toLowerCase().indexOf("ffc")}function w(e){return 8===e.toLowerCase().indexOf("ppc")}function g(e){var t=e.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return t&&t[1]?t[1]:"public"}function S(e,t){if(!t)return e;var i=e.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return i?""+i[1]+t+"-"+i[3]:e}function I(e){var t=e.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}function b(e,t){var i=e.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!i)throw new Error("Invalid URL");var n=i[2];if(void 0===t)return n;if(t<0)throw new Error("subDomainParts should be at least 1");return n.split(".").slice(-(t+1)).join(".")}function _(e,t,i){i&&(e[t.toLowerCase()]=i)}function y(e,t){e[t.toLowerCase()]=""}function O(e,t){var i=e.toLowerCase(),n=t.toLowerCase(),o=i.indexOf("&"+n+"=");if(-1===o&&(o=i.indexOf("?"+n+"=")),-1===o)return"";var r=o+(t.length+2),s=e.indexOf("&",r);return e.substring(r,-1===s?void 0:s)}function C(e,t,i,n){if(!i)return e;var o=e,r=o.indexOf("?"),s="&";r===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?s="":-1===r&&(s="?");var a=t.toLowerCase()+"=",c=o.toLowerCase().indexOf(a,r);if("?"!==s&&c>=0){if(n){var u=o.indexOf("&",c);o=o.substring(0,c)+a+i+(-1===u?"":o.substring(u))}return o}return o.concat(s,a,i)}function E(e){var t={},i=e.indexOf("?");return-1===i||i===e.length-1||e.substring(i+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(e){if(e){var i=e.indexOf("=");-1!==i&&i!==e.length-1&&(t[e.substring(0,i).toLowerCase()]=e.substring(i+1))}})),t}function T(e){if(!e)return"";var t=-1===e.indexOf("#")?e.length:e.indexOf("#"),i=e.lastIndexOf("/",t);if(-1!==i&&i+1===e.indexOf("://")+"://".length)return"";i+=1;var n=e.indexOf("?");if(-1!==(n=n>=t?-1:n)&&i>n)return"";var o=-1===n?t:n;return i>=o?"":e.substring(i,o)}function R(e){var t=new RegExp("(c[1-5])h?(-)");return e.replace(t,"$1h$2")}function P(e,t,i){var n=new RegExp("[?&]"+t+"=("+(i||"1")+")\\b","i"),o=e.match(n);return!!o&&(!i||o[1]===i)}function F(e,t){return{shouldPreload:function(t){return e(t)},preload:function(e,i,r,s){t(e,i,s).forEach((function(e){!function(e,t,i,r,s){var a=document.createElement("link");if(a.setAttribute("crossorigin","anonymous"),a.rel=U,a.href=e,t){var c=i||T(e);t.ULS.he(561059910,n.N,o.Info,"Preloading resource: "+c);a.addEventListener("error",(function(){t.ULS.he(561059911,n.N,o.Error,"Resource failed to load: "+c)}))}a.setAttribute("as","script"),r&&a.setAttribute("integrity",r);document.head.appendChild(a),s&&a.addEventListener("load",s,{once:!0})}(e[0],r,void 0,e[1])}))}}}var A,U=(A=u())===s.Firefox||A===s.IE?"prefetch":"preload";var x,W,N={en:"1033",cs:"1029",da:"1030",de:"1031",el:"1032",fi:"1035",fr:"1036",hu:"1038",it:"1040",ja:"1041",ko:"1042",nl:"1043",nb:"1044",sk:"1051",sv:"1053",tr:"1055",uk:"1058",sl:"1060",es:"3082",pl:"1045",ro:"1048",ru:"1049"};function H(e,t,i,n){var o=e.map((function(e){return function(e,t){var i={};i.G=e.tag,i.T=e.timestamp-t,i.M=e.message,i.C=e.category;var n=1e3*e.type+e.level;return i.D=n,i}(e,n)})),r=function(e,t,i,n){var o={};return o.T=e,o.L=t,o.S=i,o.I=n,o.V=1,o}(n,o,t,i);return JSON.stringify(r)}!function(e){e.Unknown="UNKNOWN",e.Initialized="INITIALIZED",e.Prebooted="PREBOOTED",e.Booting="BOOTING",e.Booted="BOOTED",e.Failed="FAILED",e.Disposing="DISPOSING",e.Disposed="DISPOSED"}(x||(x={})),function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(W||(W={}));var M,k=function(){try{var e=window.performance;return e&&e.now&&e.now()!==1/0}catch(e){return!1}}();function D(){return k?window.performance.now():Date.now()}function J(){if(!M){var e=window.performance;M=k&&e.timing&&e.timing.navigationStart?function(){return Math.round(e.now()+e.timing.navigationStart)}:Date.now?Date.now:function(){return(new Date).getTime()}}return M()}var B= "16.0.14020.35053";function L(){return B}var V,j,q=function(){function e(e){var t=this;this.fe=3e4,this.le=30,this.pe=0,this.ve=[],this.me=J(),this.we="",this.ge=0,this.flushOnClose=function(){t.Se(!1,!1)},this.flush=function(){t.Ie()},this.Ie=function(){window.setTimeout((function(){return t.Se(!0,!0)}),0)},this.Se=function(e,i){var n=D();if(window.clearTimeout(t.be),t._e){if(t.ve.length>0)t.pe+=1,!function(e,t,i){if(""!==t)if(navigator&&navigator.sendBeacon)navigator.sendBeacon(t,e);else{var n=new XMLHttpRequest;n.readyState!==XMLHttpRequest.UNSENT&&n.readyState!==XMLHttpRequest.DONE||(n.open("POST",t,i),n.send(e))}}(H(t.ve.splice(0,e?t.le:t.ve.length),t.we,t.pe,t.me),t._e,i),t.me=J();e&&(t.be=window.setTimeout(t.Ie,t.ve.length>t.le?1e3:t.fe)),t.ge+=D()-n}},e&&this.configure(e)}return e.prototype.getTimeSpentLogging=function(){return this.ge},e.prototype.addLoggingTime=function(e){this.ge+=e},e.prototype.configure=function(e){var t=this,i=D();if(e.uploadCadenceInMs&&(this.fe=e.uploadCadenceInMs),e.uploadTriggerSize&&(this.le=e.uploadTriggerSize),e.sessionId&&(this.we=e.sessionId),e.remoteUlsEndpoint){if(!e.sessionId&&this._e)throw new Error("Remote ULS endpoint is already set");this._e=e.remoteUlsEndpoint+"?usid="+this.we+"&officeserverversion="+L(),this.me=J(),window.setTimeout((function(){return t.Se(!0,!0)}),0)}this.ge+=D()-i},e.prototype.handleTrace=function(e){var t=D();e.message.length>3072&&(e.message=e.message.substring(0,3072-"... [Trimmed]".length)+"... [Trimmed]"),this.ve.push(e),(this.ve.length>this.le||e.level===o.Error)&&this.Ie(),this.ge+=D()-t},e}(),z=[];!function(e){e.ye="BootstrapperMaxUlsHeartbeatTime",e.Oe="BootstrapperNoCompleteWarning1Time",e.Ce="BootstrapperNoCompleteWarning2Time",e.Ee="RemoteUlsETag",e.Te="RemoteUlsSuppressions",e.Re="BootstrapperSettingsFetchPeriod",e.Pe="timestamp",e.Fe="BootstrapperUlsHeartbeatIntervalMs",e.Ae="BootstrapperUlsHeartBeatIsEnabled",e.Ue="BootstrapperUlsUploadCadenceMs",e.xe="WordConsumptionViewToEditRedirectIsEnabled",e.We="RequestedCallThrottlingDefaultToViewMinimumValue"}(j||(j={}));function G(e){var t=new q(e);function i(e,i,n,o){var r=D();if(!function(e){return 1===z[e]}(e)){var s={timestamp:J(),category:i,tag:e,level:n,type:W.Trace,message:o};t.addLoggingTime(D()-r),t.handleTrace(s)}}return{ULS:{he:function(e,t,n,o){i(e,t,n,o)},shipAssertTag:function(e,t,n,r){n&&i(e,t,o.Error,r)},debugAssertTag:function(e,t,i,n){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:t.flush,flushOnClose:t.flushOnClose},configure:function(e){t.configure(e)},settingsChangeHandler:function(e){var i,n;i=e.Ne.getValue(j.Te,""),n=e.Ne.getValue(j.Ee,""),V&&n===V||(z=[],V=n,i&&i.split(",").forEach((function(e){var t=parseInt(e,10);t&&(z[t]=1)}))),t.configure({uploadCadenceInMs:e.Ne.getValue(j.Ue,6e4)})},getTimeSpentLogging:function(){return t.getTimeSpentLogging()}}}var K=function(){return(K=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function X(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))}function Z(e,t){try{if(void 0===window.performance)return void t.ULS.he(595948609,n.N,o.Info,"Performance not supported");var i=window.performance.getEntriesByType("resource");if(void 0===i||i.length<=0)return void t.ULS.he(595948610,n.N,o.Info,"No resources under performance");for(var r=new RegExp(e+"(-boot.min|(.(app|preview))?.boot).js","i"),s=i.length-1;s>=0;s-=1){var a=i[s],c=a.name.match(r);if(c){var u=JSON.stringify(a);return u=u.replace(new RegExp(a.name,"g"),c[0]),void t.ULS.he(595948616,n.N,o.Info,u)}}t.ULS.he(595948484,n.N,o.Info,"Could not find JSAPI resource timing entry")}catch(e){t.ULS.he(595948617,n.N,o.Info,"Could not trace the resource timing: "+X(e))}}function $(e){var t=K(K({},e.host),{sessionId:e.hostSessionId,domain:location?location.host:void 0}),i={};if(e.wdParams){var n=JSON.parse(JSON.stringify(e.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(e){n[e]&&(i[e]=n[e])}))}var o=K({},e.rebootOverride);delete o.ackExpected,delete o["ui-language"],delete o.wdUserSession,delete o.rebootMode,delete o.documentUrl;var r=e.wopi;return{accessToken:r?{length:r.accessToken.length,expiry:r.expiry}:"N/A",bootParams:e.bootParams,build:L(),host:t,intent:e.intent,jsApiVersion:"v2",rebootOverride:o,region:g(e.appBaseUrl),sessionOrigin:e.hostInitDiagnostics?e.hostInitDiagnostics.entryPoint:void 0,sessionContext:e.sessionContext,throttling:e.throttling,ui:e.ui,viewMode:e.viewMode,wdParams:i}}function Q(){var e={perfNowSupported:k,browser:s[u()],touchMode:f(),highContrast:l(),windows10x:p()};try{var t=window.navigator,i=t.connection||t.mozConnection||t.webkitConnection;i&&(e.netDownlink=i.downlink,e.netDownlinkMax=i.downlinkMax,e.netEffectiveType=i.effectiveType,e.netRtt=i.rtt,e.netSaveData=i.saveData,e.netType=i.type),e.deviceMemory=t.deviceMemory,e.logicalProcessors=t.hardwareConcurrency}catch(e){}return e}var Y,ee;function te(e,t,i,r){if(t.getValue(j.Ae,!1)){Y=D();var s=e?3e3:5e3;ee=window.setInterval((function(){i.ULS.he(595724178,n.N,o.Info,"Boot_HeartBeat"),D()-Y>t.getValue(j.ye,3e5)&&(ie(),r&&r())}),t.getValue(j.Fe,s))}}function ie(){ee&&(window.clearInterval(ee),ee=void 0)}function ne(e,t){e.ULS.he(594901218,n.N,o.Warning,"Boot_NotComplete_"+(t||"Final")),e.ULS.flush()}function oe(e){for(var t=0;t<e.length;t+=1)e[t]&&window.clearTimeout(e[t])}var re;function se(e,t){return{isFeatureEnabled:function(i){return function(e,t,i){if(!t)return;try{return t(e)}catch(e){i&&i.ULS.he(594883024,n.N,o.Error,"IsFeatureEnabled callback error: "+X(e))}return}(i,e,t)}}}function ae(e,t){var i={};if(Object.keys(re).forEach((function(t){var n=e.isFeatureEnabled(re[t]);void 0!==n&&(i[re[t]]=n?"1":"0")})),t&&t.wdFlights)for(var n=0,o=t.wdFlights.toLowerCase().split(",");n<o.length;n++){var r=o[n];"et-treatment"!==r&&"et-control"!==r||(i[re.He]="et-treatment"===r?"1":"0")}return JSON.stringify(i)}!function(e){e.He="EnterpriseTemplates",e.Me="ExcelAdaptiveLayoutDownload",e.ke="ExcelJsApiV2",e.De="ExcelJsApiV2NoWrapper",e.Je="ExcelLandingPageOfflineTelemetry",e.Be="ExcelLandingPageObserverRetry",e.Le="H2StaticContent",e.Ve="HashedUrl",e.je="ODCShareLinkPreload",e.qe="OfficeComExcelJsApiV2",e.ze="OfficeComUiHost",e.Ge="OfficeComWordJsApiV2",e.Ke="OfficeHwaUiHost",e.Xe="OfficeUnifiedUiHostTeams",e.Ze="PowerPointJsApiV2",e.$e="WordJsApiV2",e.Qe="WordJsApiV2NoWrapper",e.Ye="WordViewToUnifiedRead"}(re||(re={}));var ce,ue,he,fe,le,de,pe=function(){function e(){this.et=[]}return e.prototype.add=function(e){e&&this.et.push(e)},e.prototype.remove=function(e){if(e){var t=this.et.indexOf(e);t>-1&&this.et.splice(t,1)}},e.prototype.removeAll=function(){this.et=[]},e.prototype.dispatch=function(e,t){this.et.forEach((function(i){try{i(e)}catch(e){t&&t(e)}}))},e}(),ve=function(){function e(e,t){var i=this;this.tt=0,this.nt=function(){if(i.ot){var e=new XMLHttpRequest;e.open("GET",i.ot),e.responseType="json",e.timeout=5e3,e.send(),e.onload=function(){if(200===e.status&&e.response?(i.setSettingsOnIdle(e.response),i.tt=0):(i.rt.ULS.he(592836771,n.N,o.Error,"Fetch settings error. Status: "+e.status+", curErrors: "+i.tt),i.tt+=1),!(i.tt>7)){var t=i.getValue(j.Re,3e5);i.tt>3&&(t+=(i.tt-3+1)*(t/2)),i.st=window.setTimeout(i.nt,t)}}}},this.at=e,this.ct="Prod"+e+"Settings",this.rt=t,this.ut=new pe,this.getCurrentSettings()}return e.prototype.initializePeriodicFetch=function(e,t){this.ct=(m(e)?"FF":"Prod")+this.at+"Settings",this.getCurrentSettings(),this.ot=e+"AppSettingsHandler.ashx?app="+this.at+"&usid="+t+"&build="+L(),this.st||(this.st=window.setTimeout(this.nt,3e4))},e.prototype.getValue=function(e,t){if(this.ht||this.getCurrentSettings(),!this.ht||!this.ht.hasOwnProperty(e))return t;var i=this.ht[e],n=typeof t;if(typeof i===n)return i;if("string"==typeof i){if("number"===n)return parseInt(i,10);if("boolean"===n)return"true"===i}return t},e.prototype.addSettingsChangeListener=function(e){this.ut.add(e)},e.prototype.removeSettingsChangeListener=function(e){this.ut.remove(e)},e.prototype.dispose=function(){this.st&&window.clearTimeout(this.st),this.ft&&self.cancelIdleCallback(this.ft),this.st=void 0,this.ft=void 0,this.ht=void 0,this.ut.removeAll()},e.prototype.getCurrentSettings=function(){try{if(!window||!window.localStorage)return;var e=window.localStorage.getItem(this.ct);if(!e)return;var t=JSON.parse(e);this.updateCurrentSettings(t)}catch(e){this.rt.ULS.he(592836768,n.N,o.Warning,"Failed to get settings from localStorage: "+X(e))}},e.prototype.updateCurrentSettings=function(e){var t=this;return!!this.isValidSettings(e)&&(this.ht=e,this.ut.dispatch({Ne:this},(function(e){t.rt.ULS.he(592836769,n.N,o.Error,"Settings listener error: "+X(e))})),!0)},e.prototype.isValidSettings=function(e){if(e&&"object"==typeof e){if(e.hasOwnProperty(j.Pe)&&!isNaN(e.timestamp))return!0;this.rt.ULS.he(592836770,n.N,o.Error,"Received invalid settings")}return!1},e.prototype.setSettingsOnIdle=function(e){var t=this;"requestIdleCallback"in window?(this.ft&&self.cancelIdleCallback(this.ft),this.ft=window.requestIdleCallback((function(){return t.setSettings(e)}),{timeout:1e4})):window.setTimeout((function(){return t.setSettings(e)}),0)},e.prototype.setSettings=function(e){if(this.updateCurrentSettings(e)&&window&&window.localStorage){var t=JSON.stringify(e);try{window.localStorage.setItem(this.ct,t)}catch(e){this.rt.ULS.he(592836800,n.N,o.Warning,"Failed to set localStorage: "+X(e))}}},e}();!function(e){e.appReboot="appReboot",e.boot="boot",e.closeTab="closeTab",e.createNew="createNew",e.dispose="dispose",e.frameTrust="frameTrust",e.getHostKeyValue="getHostKeyValue",e.handleBootState="handleBootState",e.rename="rename",e.setOverlayContent="setOverlayContent",e.storeHostKeyValue="storeHostKeyValue",e.switchMode="switchMode"}(ce||(ce={})),function(e){e.blurFocus="blurFocus",e.boot="boot",e.completeCreateNew="completeCreateNew",e.continueAccessibilityLoop="continueAccessibilityLoop",e.createNew="createNew",e.dispose="dispose",e.grabFocus="grabFocus",e.moveToFolder="moveToFolder",e.popState="popState",e.rename="rename",e.completeSharedFilePicker="completeSharedFilePicker",e.sendAccessToken="sendAccessToken",e.sendAuthToken="sendAuthToken",e.sendCustomAuthConfig="sendCustomAuthConfig",e.sendEmbeddedViewUrl="sendEmbeddedViewUrl",e.sendSessionInfo="sendSessionInfo",e.sendUserAccessAndPermissions="sendUserAccessAndPermissions",e.sendWopiInfo="sendWopiInfo",e.switchMode="switchMode",e.signalShared="signalShared"}(ue||(ue={})),function(e){e.lt="App_AccessibilityLoopComplete",e.dt="WacInitialize_Ready",e.pt="Wac_AppFailed",e.vt="Wac_AppBootState",e.wt="Wac_AppCompleted",e.gt="BrowserEvent",e.St="UI_Close",e.It="App_CloseTab",e.bt="UI_Conversation",e._t="UI_CopyAndEdit",e.yt="App_CreateNewDocument",e.Ot="Wac_AppDataSavedStatus",e.Ct="UI_Download",e.Et="UI_Edit",e.Tt="Error",e.Rt="UI_FileEmbed",e.Pt="UI_FileProperties",e.Ft="File_Rename",e.At="File_RenameFailed",e.Ut="UI_FileVersions",e.xt="StateChanged",e.Wt="App_IsFrameTrusted",e.Nt="GetAccessToken",e.Ht="App_GetAuthToken",e.Mt="App_GetCustomAuthConfig",e.kt="App_GetHostKeyValue",e.Dt="App_WopiInfoFromUrl",e.Jt="App_LoadingStatus",e.Bt="App_SwitchMode",e.Lt="App_MoveToFolder",e.Vt="UI_OpenInBrowser",e.jt="UI_OpenInClient",e.qt="PageChanged",e.zt="App_PushCommentContext",e.Gt="App_PushState",e.Kt="App_DocReboot",e.Xt="UI_RedeemForCommenting",e.Zt="App_RefreshSessionInfo",e.$t="UI_ReplyWithChanges",e.Qt="UI_ReportAbuse",e.Yt="App_FilePicker",e.ei="UI_SaveStatus",e.ti="WopiSession_Complete_Ack",e.ii="SetOverlayContent",e.ni="UI_Sharing",e.oi="UI_ShareForm",e.ri="UI_SignIn",e.si="App_StoreHostKeyValue",e.ai="App_Unloaded",e.ci="Wac_UnloadingApp",e.hi="PageCount",e.li="UI_CheckUserAccessAndGrantPermissions",e.di="User_Activity",e.pi="Edit_Notification",e.vi="UI_Workflow",e.mi="ZoomChanged",e.wi="Excel_HostFrameCacheSave",e.gi="Excel_HostFrameCacheEvict",e.Si="Excel_RegenerateFileBundle"}(he||(he={})),function(e){e.Ii="Ack",e.bi="WacInitialize_Ready_Ack",e._i="Wac_BeforeUnloadApp",e.yi="Blur_Focus",e.Oi="Wac_AppFailed_Ack",e.Ci="Wac_AppCompleted_Ack",e.Ei="WopiStartSession_Complete",e.Ti="WopiPendingSession_Complete",e.Ri="Host_AccessibilityLoopComplete",e.Wt="Host_IsFrameTrusted",e.Pi="Grab_Focus",e.Fi="HostCacheDiagnostic",e.Ai="Host_KeyValue",e.Ui="JsApiDiagnostics",e.Lt="Host_MoveToFolder",e.xi="PageChanged_Ack",e.Wi="App_PopState",e.Ni="File_Rename",e.Yt="Host_FilePicker",e.Hi="PostAccessToken",e.Mi="Host_SetAuthToken",e.ki="Host_SetCustomAuthConfig",e.Di="App_PushCommentContext",e.Ji="CanEmbed",e.Bi="Host_RefreshSessionInfo",e.Li="CheckUserAccessAndGrantPermissions_Result",e.Vi="Host_WopiInfoFromUrl",e.ji="SetCurrentPage",e.qi="SetZoomLevel",e.zi="WopiPendingSession_Fail",e.Gi="SetOverlayContent",e.Ki="WopiPendingApplicationComplete_Received",e.Xi="Host_SwitchMode",e.Zi="Host_Unload",e.$i="PageCount_Ack",e.Qi="ZoomChanged_Ack",e.Yi="Host_ShareUI"}(fe||(fe={})),function(e){e.AccessibilityLoopCompleted="AccessibilityLoopCompleted",e.BrowserEvent="BrowserEvent",e.Close="Close",e.Conversation="Conversation",e.CopyAndEdit="CopyAndEdit",e.CreateNewDocument="CreateNewDocument",e.Download="Download",e.Edit="Edit",e.Error="Error",e.FileEmbed="FileEmbed",e.FileProperties="FileProperties",e.FileRenamed="FileRenamed",e.FileVersions="FileVersions",e.FrameStateChanged="FrameStateChanged",e.GetAccessToken="GetAccessToken",e.GetAuthToken="GetAuthToken",e.GetCustomAuthConfig="GetCustomAuthConfig",e.GetWopiInfoFromUrl="GetWopiInfoFromUrl",e.ModeSwitched="ModeSwitched",e.MoveToFolder="MoveToFolder",e.OpenInBrowser="OpenInBrowser",e.OpenInClient="OpenInClient",e.PageChanged="PageChanged",e.PushState="PushState",e.Reboot="Reboot",e.RedeemForCommenting="RedeemForCommenting",e.RefreshSessionInfo="RefreshSessionInfo",e.ReplyWithChanges="ReplyWithChanges",e.ReportAbuse="ReportAbuse",e.SharedFilePicker="SharedFilePicker",e.SaveStatus="SaveStatus",e.Share="Share",e.ShareForm="ShareForm",e.SignIn="SignIn",e.UserAccessAndPermissions="UserAccessAndPermissions",e.UserActivity="UserActivity",e.UserEditActivity="UserEditActivity",e.Workflow="Workflow",e.ZoomChanged="ZoomChanged"}(le||(le={}));var me=((de={})[ue.boot]={tn:ce.boot},de[ue.createNew]={tn:ce.createNew},de[ue.dispose]={tn:ce.dispose},de[ue.rename]={tn:ce.rename},de[ue.switchMode]={tn:ce.switchMode},de[he.vt]={tn:ce.handleBootState},de[he.It]={tn:ce.closeTab},de[he.Wt]={tn:ce.frameTrust},de[he.kt]={tn:ce.getHostKeyValue},de[he.Kt]={tn:ce.appReboot},de[he.ii]={tn:ce.setOverlayContent},de[he.si]={tn:ce.storeHostKeyValue},de[ue.blurFocus]={in:fe.yi},de[ue.continueAccessibilityLoop]={in:fe.Ri},de[ue.grabFocus]={in:fe.Pi},de[ue.moveToFolder]={in:fe.Lt},de[ue.popState]={in:fe.Wi},de[ue.completeSharedFilePicker]={in:fe.Yt},de[he.lt]={nn:le.AccessibilityLoopCompleted},de[he.gt]={nn:le.BrowserEvent},de[he.St]={nn:le.Close},de[he.bt]={nn:le.Conversation},de[he._t]={nn:le.CopyAndEdit},de[he.yt]={nn:le.CreateNewDocument},de[he.Ct]={nn:le.Download},de[he.Et]={nn:le.Edit},de[he.Tt]={nn:le.Error},de[he.Pt]={nn:le.FileProperties},de[he.Ft]={nn:le.FileRenamed},de[he.Ut]={nn:le.FileVersions},de[he.xt]={nn:le.FrameStateChanged},de[he.Bt]={nn:le.ModeSwitched},de[he.Lt]={nn:le.MoveToFolder},de[he.Vt]={nn:le.OpenInBrowser},de[he.jt]={nn:le.OpenInClient},de[he.qt]={nn:le.PageChanged},de[he.Gt]={nn:le.PushState},de[he.Xt]={nn:le.RedeemForCommenting},de[he.$t]={nn:le.ReplyWithChanges},de[he.Yt]={nn:le.SharedFilePicker},de[he.Qt]={nn:le.ReportAbuse},de[he.ei]={nn:le.SaveStatus},de[he.oi]={nn:le.ShareForm},de[he.ri]={nn:le.SignIn},de[he.di]={nn:le.UserActivity},de[he.pi]={nn:le.UserEditActivity},de[he.vi]={nn:le.Workflow},de[he.mi]={nn:le.ZoomChanged},de[he.Rt]={on:{nn:le.FileEmbed,rn:ue.sendEmbeddedViewUrl,sn:fe.Ji,an:5e3}},de[he.Nt]={on:{nn:le.GetAccessToken,rn:ue.sendAccessToken,sn:fe.Hi}},de[he.Ht]={on:{nn:le.GetAuthToken,rn:ue.sendAuthToken,sn:fe.Mi}},de[he.Mt]={on:{nn:le.GetCustomAuthConfig,rn:ue.sendCustomAuthConfig,sn:fe.ki,an:5e3}},de[he.Dt]={on:{nn:le.GetWopiInfoFromUrl,rn:ue.sendWopiInfo,sn:fe.Vi,an:5e3}},de[he.Zt]={on:{nn:le.RefreshSessionInfo,rn:ue.sendSessionInfo,sn:fe.Bi,an:5e3}},de[he.li]={on:{nn:le.UserAccessAndPermissions,rn:ue.sendUserAccessAndPermissions,sn:fe.Li,an:5e3}},de[he.ni]={on:{nn:le.Share,rn:ue.signalShared,sn:fe.Yi,an:5e3}},de),we=function(){function e(e){var t=this;this.cn=!1,this.un=[],this.cancel=function(){t.cn||(t.cn=!0,t.un.map((function(e){return e()})),t.un=[])},window.setTimeout(this.cancel,e)}return Object.defineProperty(e.prototype,"isCancelled",{get:function(){return this.cn},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e){this.cn?e():this.un.push(e)},e}();function ge(e){return new we(e)}function Se(){var e=new Uint8Array(31),t=function(e){var t={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){t.crypto=!0;try{return i.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+X(e))}}t.perfNow=k;for(var n=0;n<e.length;n+=1){try{if(k){var o=Math.floor(100*window.performance.now())%10;(o<0||o>9)&&(o=0);for(var r=0;r<o;r+=1)Math.random()}}catch(e){t.exceptions.push("Math.random: "+X(e))}e[n]=Math.floor(16*Math.random())}return t}(e),i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=15&e[i];return i+=1,("x"===t?n:3&n|8).toString(16)})),t]}var Ie=function(){function e(e,t){this.hn=function(){return be(e,"OnBeforeUnload",t)},this.fn=function(){return be(e,"OnPageHide",t)},this.ln=function(){return be(e,"VisibilityChange_"+document.visibilityState,t)},this.dn=function(){return be(e,"OnUnload",t)},window.addEventListener("beforeunload",this.hn,{capture:!0,once:!0}),window.addEventListener("pagehide",this.fn,{capture:!0}),window.addEventListener("visibilitychange",this.ln,{capture:!0}),window.addEventListener("unload",this.dn,{capture:!0,once:!0})}return e.prototype.dispose=function(){window.removeEventListener("beforeunload",this.hn,{capture:!0}),window.removeEventListener("pagehide",this.fn,{capture:!0}),window.removeEventListener("visibilitychange",this.ln,{capture:!0}),window.removeEventListener("unload",this.dn,{capture:!0})},e}();function be(e,t,i){e.ULS.he(595957843,n.N,o.Info,"Page lifecycle: "+t+" fired"+(i?", flushing logger":"")),i&&e.ULS.flush()}var _e=function(){function e(e,t,i,r,s,a,c){var u,h=this;this.pendingReboot=!1,this.skipWopiValidation=!1,this.appContext={},this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.pn={},this.onMessage=function(e){var t=e.MessageId,i=e.Values||{},r=h.pn[t];if(r&&r.length>0)h.vn(t,i);else{var s=me[t];if(s){var a=s.tn,c=s.nn,u=s.on;a?(h.logger.ULS.he(574654543,n.N,o.Info,"Running flow: "+a),h.mn[a](t,i,h,h.wn[a]).catch((function(e){h.gn(a,e)}))):c?h.raiseEvent(c,i):u&&h.Sn(u,i)}}},this.gn=function(e,t){h.logger.ULS.he(596459925,n.N,o.Error,e+" flow error: "+X(t))},this.vn=function(e,t){return h.logger.ULS.he(574654544,n.N,o.Info,"Dispatching action: "+e),h.pn[e].map((function(i){try{i(e,t)}catch(t){h.logger.ULS.he(596444186,n.N,o.Error,e+" action handler error: "+X(t))}})),Promise.resolve({completion:"success"})},this.Sn=function(e,t){var i=function(t,i){h.container&&h.container.postMessage(e.sn,i),n()},n=function(){h.removeActionHandler(e.rn,i)};(h.addActionHandler(e.rn,i),void 0!==e.an)&&new we(e.an).subscribe(n);h.raiseEvent(e.nn,t)},this.state=x.Unknown;var f=Se(),l=f[0],d=f[1];this.logger=G(),this.logger.ULS.he(593506837,n.N,o.Info,JSON.stringify(d)),this.sessionId=l,this.hostSessionId=i.hostSessionId,this.host=e.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=e.user,this.bootstrapperUrl=e.bootstrapperUrl,this.ui=e.ui,this.viewMode=e.viewMode,this.application=r,this.appInfo=t,this.session=s,this.featureManager=se(e.host.capabilities&&e.host.capabilities.isFeatureEnabledCallback,this.logger),this.Ne=new ve(t.name,this.logger),this.preloader=t.preloader,u=a(this.featureManager),this.mn=u[0],this.wn=u[1],this.In=c,this.Ne.addSettingsChangeListener(this.logger.settingsChangeHandler),this.clientDiagnostics=Q(),this.pageStateObserver=new Ie(this.logger,!0)}return Object.defineProperty(e.prototype,"diagnostics",{get:function(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}},enumerable:!0,configurable:!0}),e.prototype.raiseEvent=function(e,t){this.logger.ULS.he(574654541,n.N,o.Info,"Raising event: "+e);try{this.In(e,t)}catch(e){this.logger.ULS.he(593506838,n.N,o.Error,"Event handler error: "+X(e))}},e.prototype.addActionHandler=function(e,t){this.pn[e]||(this.pn[e]=[]),this.pn[e].push(t)},e.prototype.removeActionHandler=function(e,t){var i=this.pn[e];if(i&&i.length>0){var n=i.indexOf(t);n>-1&&i.splice(n,1)}},e.prototype.run=function(e,t,i){var r=this,s=[],a=this.pn[e];if(a&&a.length>0)s.push(this.vn(e,t));else{var c=me[e];if(c){var u=c.tn,h=c.in;if(u){this.logger.ULS.he(574654542,n.N,o.Info,"Running flow: "+u);var f=this.mn[u](e,t,this,this.wn[u],i).catch((function(e){return r.gn(u,e),{completion:"failure",error:e}}));s.push(f)}else h&&(this.container&&this.container.postMessage(h,t),s.push(Promise.resolve({completion:"success"})))}else s.push(Promise.resolve({completion:"failure"})),this.logger.ULS.he(593500189,n.N,o.Warning,"Unhandled command: "+e)}return Promise.race(s)},e.prototype.dispose=function(){if(this.Ne.dispose(),this.pageStateObserver.dispose(),this.pn={},!this.pendingReboot){var e=this.application.sessions,t=e.indexOf(this.session);t>-1&&e.splice(t,1)}},e}();var ye,Oe=function(){function e(e,t,i,n,o,r){var s=this;!function(e){if(!e)throw new TypeError("SessionInitParams");if(!e.hostSessionId)throw new TypeError("HostSessionId")}(i);this.bn=new _e(e,t,i,n,this,r,(function(e,t){return o({type:e,data:t,session:s})})),this.bn.state=x.Initialized}return Object.defineProperty(e.prototype,"id",{get:function(){return this.bn.sessionId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diagnostics",{get:function(){return this.bn.diagnostics},enumerable:!0,configurable:!0}),e.prototype.run=function(e,t,i){return this.bn.run(e,t,i)},e.prototype.boot=function(e,t){return this.bn.run(ue.boot,e,t)},e.prototype.dispose=function(e){return this.bn.run(ue.dispose,void 0,e)},e}(),Ce=function(){function e(e,t,i){var r=this;this._n="",this.yn="",this.On=!1,this.Cn=!1,this.En=!1,this.Tn=function(e){var t=!1,i=!0,s="",a=!1;if(r.Rn&&(t=!0,i=e.source===r.Rn),e.origin&&(a=(s=b(e.origin,2).toLowerCase())===r.yn),!r.On&&(!r.Cn||a&&i)||r.rt.ULS.he(593232850,n.N,o.Info,"Window: available["+t+"] valid["+i+"]; Origin: valid["+a+"] expected["+r.yn+"] actual["+s+"]"),a&&(!r.En||i)){var c;try{c=JSON.parse(e.data)}catch(e){return void r.rt.ULS.he(593232851,n.N,o.Info,"Failed to parse event data: "+X(e))}var u=c.MessageId;if(u)if(r.rt.ULS.he(593232854,n.N,o.Info,"Received message: "+u+", correlation: "+c.CorrelationId),u!==he.wt&&u!==he.Jt||r.setTargetOrigin(e.origin),c.Values&&c.Values.ackExpected&&r.postMessage(fe.Ii,void 0,c.CorrelationId),r.Pn)try{r.Pn(c)}catch(e){r.rt.ULS.he(594556386,n.N,o.Error,"Message handler error: "+X(e))}else r.rt.ULS.he(591933923,n.N,o.Error,"No message handler");else(r.On||r.Cn)&&r.rt.ULS.he(593232853,n.N,o.Info,"Missing message id")}},this.rt=t,this.setTargetOrigin(e),i&&this.setMessageHandler(i),window.addEventListener("message",this.Tn,!1)}return e.prototype.setTargetOrigin=function(e){var t=I(e).toLowerCase();this._n&&this._n!==t&&this.rt.ULS.he(593232847,n.N,o.Warning,"Updating origin: ["+this._n.substring(8)+"]->["+t.substring(8)+"]"),this._n=t,this.yn=b(t,2),this.On=m(t),this.Cn=w(t)},e.prototype.setTargetWindow=function(e,t){this.Rn=e,this.En=!!t},e.prototype.setMessageHandler=function(e){this.Pn=e},e.prototype.removeMessageHandler=function(){this.Pn=void 0},e.prototype.postMessage=function(e,t,i){if(this.Rn){this.rt.ULS.he(593232849,n.N,o.Info,"Sending message: "+e);var r={MessageId:e,SendTime:J(),CorrelationId:i,Values:t};this.Rn.postMessage(JSON.stringify(r),this._n)}else this.rt.ULS.he(593232848,n.N,o.Info,"Missing target to send message")},e.prototype.dispose=function(){window.removeEventListener("message",this.Tn,!1),this.Pn=void 0},e}();!function(e){e.Fn="access_token",e.An="access_token_ttl",e.Un="bundleSrc",e.xn="bundleStaleness",e.Wn="DocID",e.Nn="ETag",e.Hn="feature_status",e.Mn="fileExtension",e.kn="fileGetUrl",e.Dn="fileName",e.Jn="fileSize",e.Bn="forceSLR",e.Ln="frameHeightPx",e.Vn="frameWidthtPx",e.jn="highContrast",e.qn="highDpi",e.zn="host_diagnostics",e.Gn="hostName",e.Kn="huictrls",e.Xn="owner_id",e.Zn="sc",e.$n="softBlockedBrowser",e.Qn="templateUrl",e.Yn="touchMode",e.eo="user_id",e.to="hfck",e.io="hfcv",e.no="timeZoneId"}(ye||(ye={}));function Ee(e,t){var i=I(t);e.setAttribute("allow","microphone "+i+"; camera "+i+";")}function Te(e,t){_(t,ye.Ln,String(e.offsetHeight)),_(t,ye.Vn,String(e.offsetWidth)),_(t,ye.Yn,String(f())),_(t,ye.jn,String(l())),_(t,ye.Bn,String(p()))}function Re(e){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(t){return e&&e.ULS.he(591525084,n.N,o.Info,"Trust check error: "+X(t)),!1}}var Pe,Fe=function(){function e(e,t){var i=this;this.oo=null,this.so=function(e){var t=e.target;i.oo=t.contentWindow,i.oo?i.ao.setTargetWindow(i.oo):i.rt.ULS.he(592524689,n.N,o.Error,"Content window not available")},function(e){if(void 0===e||void 0===e.appendChild)throw TypeError("Container")}(e),this.co=e,this.uo=t,this.ho=t+"_Form",this.fo=Re()}return Object.defineProperty(e.prototype,"element",{get:function(){return this.co},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameId",{get:function(){return this.uo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formId",{get:function(){return this.ho},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTopFrameTrusted",{get:function(){return this.fo},enumerable:!0,configurable:!0}),e.prototype.boot=function(e,t,i){this.rt=i,this.ao=new Ce(e,i,this.Pn),this.lo&&this.oo?(Ee(this.lo,e),this.ao.setTargetWindow(this.oo),this.rt.ULS.he(588793045,n.N,o.Info,"Reuse iframe and content window")):(this.lo=function(e,t,i,n){var o=e.ownerDocument.createElement("iframe");return o.id=t,o.name=t,o.src="",o.title="Office on the web Frame",o.width="100%",o.height="100%",o.marginWidth="0",o.marginHeight="0",o.style.left="0",o.style.top="0",o.style.right="0",o.style.bottom="0",o.style.display="block",o.style.position="absolute",o.style.backgroundColor="transparent",o.style.border="none",o.frameBorder="0",o.setAttribute("allowfullscreen","true"),o.setAttribute("allowTransparency","true"),Ee(o,i),n&&o.addEventListener("load",n,{once:!0}),e.appendChild(o),o}(this.co,this.uo,e,this.so),this.rt.ULS.he(588793046,n.N,o.Info,"Wac frame created")),Te(this.lo,t),this.do=function(e,t,i,n,o){var r=e.ownerDocument,s=r.createElement("form");for(var a in s.id=i,s.name=i,s.action=n,s.target=t,s.method="POST",o){var c=r.createElement("input");c.type="hidden",c.name=a,c.value=o[a],s.appendChild(c)}return e.appendChild(s),s}(this.co,this.uo,this.ho,e,t),this.do.submit()},e.prototype.setMessageHandler=function(e){this.Pn=e,this.ao&&this.ao.setMessageHandler(e)},e.prototype.setWrapperPostMessage=function(e){this.po=e},e.prototype.removeMessageHandler=function(){this.Pn=void 0,this.ao&&this.ao.removeMessageHandler()},e.prototype.postMessage=function(e,t){this.po?this.po(e,t):this.ao&&this.ao.postMessage(e,t)},e.prototype.dispose=function(e,t){var i=this;return new Promise((function(n){if(i.do&&(i.co.removeChild(i.do),i.do=void 0),i.ao&&(i.ao.dispose(),i.ao=void 0,i.Pn=void 0),i.po&&(i.po=void 0),i.rt=void 0,i.lo&&!e){var o=function(){i.co.removeChild(i.lo),i.lo=void 0,n()};t?o():(i.lo.src="about:blank",window.setTimeout(o,0))}else n()}))},e}(),Ae=function(){function e(e,t,i){var n=this;this.sessions=[],this.containers=[],this.vo=function(e){n.mo.dispatch(e)},function(e){if(!e)throw new TypeError("ApplicationInitParams");var t=e.host;if(!t||!t.storageHostName)throw new TypeError("HostInfo");var i=e.user;if(!i||null==i.id)throw new TypeError("UserInfo")}(e),this.wo=e,this.So=t,this.Io=i,this.mo=new pe,h()}return Object.defineProperty(e.prototype,"name",{get:function(){return this.So.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return L()},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e){this.mo.add(e)},e.prototype.removeEventListener=function(e){this.mo.remove(e)},e.prototype.createContainer=function(e){var t="WacFrame_"+this.So.name+"_"+this.containers.length,i=new Fe(e,t);return this.containers.push(i),i},e.prototype.createSession=function(e){var t=new Oe(this.wo,this.So,e,this,this.vo,this.Io);return this.sessions.push(t),t},e.prototype.dispose=function(e){var t=this,i=this.sessions.map((function(t){return t.dispose(e).catch((function(e){}))}));return Promise.all(i).then((function(e){return t.mo.removeAll(),t.sessions=[],t.containers=[],{completion:"success"}}))},e}();function Ue(e,t){t&&t.Diagnostics&&Object.keys(t.Diagnostics).forEach((function(i){return e[i]=t.Diagnostics[i]}))}function xe(e,t,i){t.ULS.he(596459999,n.N,i,"SessionTraces: "+JSON.stringify(e))}function We(e,t){t.stop();var i=t.getVisibilityChangeEvents();null!=i&&i.length>0&&(e.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,e.SessionTraces.tabSwitchDiagnostics=JSON.stringify(i)),t.dispose()}function Ne(e,t,i){try{var r=function(e,t){var i=K({},t);delete i.UserId,delete i.OwnerId,delete i.WdParams;var n=i,o=t.WdParams?JSON.parse(JSON.stringify(t.WdParams).toLowerCase()):{};return n.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(e){o[e]&&(n.WdParams[e]=o[e])})),n.UiEmbedMode=P(e,"uiembed"),n.UiHostName=O(e,"uih")||"N/A",n.HostDomain=location?location.hostname:"",n}(t.applicationUrl,t.sessionInformation);r.Build=L(),r.Region=g(t.applicationUrl);var s=K({},t.rebootOverrideData);delete s.ackExpected,delete s["ui-language"],delete s.wdUserSession,delete s.rebootMode,delete s.documentUrl,r.RebootOverride=s;var a=t.diagnostics.HostInitDiagnostics;a&&(e.ULS.he(596444238,n.N,o.Info,"HostInitDiagnostics: "+JSON.stringify(t.diagnostics.HostInitDiagnostics)),r.SessionOrigin=a.entryPoint),i&&e.ULS.he(595937313,n.N,o.Info,JSON.stringify(i)),e.ULS.he(595632928,n.N,o.Info,function(){if(window&&window.navigator){var e=window.navigator,t=e.connection||e.mozConnection||e.webkitConnection;if(t)return"EffectiveType: "+t.effectiveType+", BandwidthMps: "+t.downlink+", ConnectionType: "+t.type}return""}());var c=t.wopiInfo;c&&c.AccessToken&&c.AccessTokenExpiry||e.ULS.he(595894553,n.N,o.Warning,"There are some missing parameters"),c&&(c.AccessToken&&(r.AccessTokenLength=c.AccessToken.length),r.AccessTokenExpiry=c.AccessTokenExpiry);var u=re.ke;r.JsApiVersion=t.featureManager.isFeatureEnabled(u)?"v1Wrapper":"v1",e.ULS.he(596444237,n.N,o.Info,JSON.stringify({session:r,client:t.diagnostics.ClientDiagnostics}))}catch(t){e.ULS.he(590915460,n.N,o.Error,"Failed to log initialization info: "+X(t))}}function He(e){var t=window.navigator;if(t&&t.virtualKeyboard&&void 0!==t.virtualKeyboard.overlaysContent&&window===top)return t.virtualKeyboard.overlaysContent=e}!function(e){e.AppInitError="AppInitError",e.ApiDisabledError="ApiDisabledError",e.CannotLoadFirstPage="CannotLoadFirstPage",e.InvalidWopiInfo="InvalidWopiInfo",e.TimeoutWacReady="TimeoutWacReady",e.WacFailed="WacFailed"}(Pe||(Pe={}));var Me,ke=function(e,t,i,n,o){return e!==he.ii?Promise.reject("Wrong flow"):new Promise((function(e){He(t.overlayContent),i.container&&i.container.postMessage(fe.Gi,void 0),e({completion:"success"})}))};function De(e){if(!e)return"";var t=""+document.cookie,i=new RegExp("(?:^|; )"+e+"=([^;]*)"),n=t.match(i);return!n||n.length<2?"":n[1]}function Je(e){return De(e.hostKey)}!function(e){e[e.doNotSet=0]="doNotSet",e[e.none=1]="none",e[e.lax=2]="lax",e[e.strict=3]="strict"}(Me||(Me={}));var Be=function(e,t,i,r,s){return e!==he.kt?Promise.reject("Wrong flow"):new Promise((function(e){var r=t.hostKey;i.logger.ULS.he(574408915,n.N,o.Info,"getHostKeyValue "+r);var s=Je(t);i.container&&s&&i.container.postMessage(fe.Ai,{hostKey:r,hostValue:s}),e({completion:"success"})}))};function Le(e){!function e(t,i,n,o){void 0===o&&(o=Me.none);var r=t+"="+i,s="",a=new Date;a.setTime(a.getTime()+31536e6);var c=new Date;c.setTime(c.getTime()+864e5*n),c>a&&(c=a),c&&(s=";expires="+c.toUTCString());var u=";SameSite="+Me[o];return document.cookie=r+s+u,!(!document.cookie||-1===document.cookie.indexOf(r))||o===Me.none&&e(t,i,n,Me.doNotSet)}(e.hostKey,e.hostValue,365)}var Ve,je=function(e,t,i,r,s){return e!==he.si?Promise.reject("Wrong flow"):new Promise((function(e){var r=t.hostKey,s=t.hostValue;i.logger.ULS.he(574408914,n.N,o.Info,"storeHostKeyValue "+r+": "+s),Le(t),e({completion:"success"})}))};function qe(e,t,i){void 0===i&&(i=!1);var n=e.applicationUrl;e.wopiPrecheckInfo.IsNewFile&&n.replace("unified=1","edit=1&new=1");var o={};o.jsApi="1";var r=re.ke;if(o.jsapiver=e.featureManager.isFeatureEnabled(r)?"v1Wrapper":"v1",i&&(o.NewSession="1"),o.corrid=e.sessionId,o.usid=e.sessionId,o.sftc="1",(e.applicationCustomSettings&&e.applicationCustomSettings.IsCore||e.sessionInformation.IsCore)&&(o.core="1"),e.sessionInformation.HideViewerToolbar&&(o.hvt="1"),e.sessionInformation.HideEditUpsellDialog&&(o.hdeditdlg="1"),e.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),e.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(e.sessionInformation.HighContrastMode)),e.sessionInformation.SupportsAtMentions&&(o.sams="1"),e.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),e.sessionInformation.SupportsDocReboot){var s=e.sessionInformation.SupportsDocReboot;o.sdr=!0===s?"1":s.toString()}e.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),e.sessionInformation.SupportsAuthToken&&(o.sat="1"),e.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),e.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),e.sessionInformation.SupportsCommonFilePicker&&(o.sfp="1"),e.sessionInformation.SupportsExcelExternalLinks&&(o.xlel="1"),e.sessionInformation.SupportsRefreshAccessToken&&(o.rat="1"),e.sessionInformation.HideHeader&&(o.hhdr="1"),e.sessionInformation.HideAppLauncherInHeader&&(o.halh="1"),e.sessionInformation.HideChatInHeader&&(o.hch="1"),e.sessionInformation.HideMeInHeader&&(o.hmh="1"),e.sessionInformation.HideSearchInHeader&&(o.hsh="1"),e.sessionInformation.HideWorkflowInHeader&&(o.hwfh="1"),e.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),e.sessionInformation.HideTitleInViewer&&(o.htv="1"),e.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),e.sessionInformation.NoBrowserModalDialogs&&(o.nbmd="1"),e.applicationCustomSettings&&e.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),e.wopiPrecheckInfo.ReadOnly&&(o.readOnly="1"),e.sessionInformation.UIEmbed&&(o.uiEmbed="1"),e.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(e.sessionInformation.UiHostIntegrationType)),e.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(e.sessionInformation.MetaUiHostVersion)),e.applicationCustomSettings&&e.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),t.isSingleStepBoot?(t.bootFlowType===Ve.unifiedSingleFlush&&(e.isCreateNew||(o.instantedit="1",o.wopicomplete="1")),o.wdRedirectionReason=t.bootFlowType):(o.instantedit="1",o.fileSrc=encodeURIComponent(e.sessionInformation.HostName),o.pmOrigin=encodeURIComponent(I(window.location.href)),e.isCreateNew&&(o.new="1",e.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(o.wdTpl="fromhost"))),e.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(e.wopiPrecheckInfo.PreseededSessionKey)),e.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(e.wopiPrecheckInfo.PreseededWacSessionId)),e.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=e.wopiPrecheckInfo.RequestedCallThrottling),e.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=e.wopiPrecheckInfo.ClientThrottlingProtection);var a=e.wopiPrecheckInfo.FileSize;return a&&a>=52428800&&a<=104857600&&(o.ilf="1"),e.applicationCustomSettings&&e.applicationCustomSettings.additionalApplicationParameters&&(o=K(K({},e.applicationCustomSettings.additionalApplicationParameters),o)),e.rebootOverrideData&&e.rebootOverrideData.queryOverrides&&(o=K(K({},o),e.rebootOverrideData.queryOverrides)),function(e,t,i,n,o){var r=E(e);("teams"===r.uih&&"UnifiedUiHostTeams"!==t.UiHostIntegrationType||"owa"===r.uih)&&(r.hhdr="1");var s=e.indexOf("?"),a=-1===s?e.concat("?"):e.substring(0,s+1);t.UiLocale&&(r.ui=encodeURIComponent(t.UiLocale));t.DataLocale&&(r.rs=encodeURIComponent(t.DataLocale));t.HostSessionId&&(r.hid=encodeURIComponent(t.HostSessionId));t.DisableChat&&(r.dchat="1");t.SessionContext&&(r.sc=encodeURIComponent(t.SessionContext));i&&i.WopiSrc&&(r.wopisrc=encodeURIComponent(i.WopiSrc));t.CookieCompliant&&(r.mscc="1");n&&(n.entryPoint&&(r.wdorigin=encodeURI(n.entryPoint)),n.userClickTime&&(r.wdhostclicktime=n.userClickTime.toString()));r=K(K(K({},r),t.WdParams),o);var c={};for(var u in r)c[u.toLowerCase()]=r[u];var h=[];for(var u in c)c[u]&&h.push(u.concat("=",c[u]));return a.concat(h.join("&"))}(n,e.sessionInformation,e.wopiInfo,e.diagnostics.HostInitDiagnostics,o)}function ze(e){return e.AccessTokenExpiry?e.AccessTokenExpiry.getTime().toString():"0"}!function(e){e.bootWithoutWopiInfo="",e.unifiedSingleFlush="Unified_SingleFlush",e.unifiedIrmEnabled="Unified_IrmEnabled",e.unifiedViewActionUrl="Unified_ViewActionUrl",e.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",e.forceSingleStepBoot="Force_SingleStepBoot",e.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",e.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",e.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect"}(Ve||(Ve={}));var Ge,Ke,Xe,Ze,$e,Qe,Ye,et,tt,it,nt=["xlviewerinternal.aspx","xlembed.aspx"];function ot(e,t,i,r){Qe=e,Ye=t,et=void 0,tt=i,it=r,Ge=!1,Ke=!1,Xe=0,ct(),setTimeout((function(){Qe.ULS.he(593589517,n.N,o.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver heartbeat signal called after ms: 3000")}),3e3),setTimeout((function(){!function e(){if(Xe>=3)return void Qe.ULS.he(595350870,n.N,o.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Max Limit reached for retry attempts3");if(ct(),Ge)setTimeout((function(){(!Ke||Xe>0)&&Qe.ULS.he(595350872,n.N,o.Info,"ExcelLandingPageObserver: checkSecondFlushArrived Second Flush status: "+Ke+" after first flush retry attempt: "+Xe)}),$e);else{if(Xe+=1,Qe.ULS.he(595350871,n.N,o.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Retry Request: "+Xe),tt.isFeatureEnabled(re.Be)&&1===Xe)document.getElementById(Ye).submit();setTimeout((function(){e()}),Ze)}}()}),Ze),tt.isFeatureEnabled(re.Je)&&(window.localStorage?window.addEventListener("offline",ut):Qe.ULS.he(593589518,n.N,o.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver localstorage not supported by Browser. Skip saving in cache")),Qe.ULS.he(594622165,n.N,o.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver called with OfflineTelemetry: "+tt.isFeatureEnabled(re.Je))}function rt(e){"PageLoadSkeleton Presented"===e?Ge=!0:"BootstapContext Recieved"===e&&(Ke=!0)}function st(){if(tt.isFeatureEnabled(re.Je))if(window.localStorage)for(var e=0;e<localStorage.length;e+=1)try{var t=localStorage.key(e);if("OfflineMode_"===t.substring(0,"OfflineMode_".length)){var i=localStorage.getItem(t);Qe.ULS.he(593589520,n.N,o.Info,"ExcelLandingPageObserver:uploadOfflineModeTelemetry Message"+i),localStorage.removeItem(t)}}catch(e){Qe.ULS.he(593589521,n.N,o.Error,"ExcelLandingPageObserver:uploadOfflineModeTelemetry exception during loading from cache. Exception: "+X(e))}else Qe.ULS.he(593589519,n.N,o.Info,"ExcelLandingPageObserver:uploadOfflineModeTelemetry localstorage not supported by Browser. Skip uploading")}function at(e){return nt.some((function(t){return-1!==e.indexOf(t)}))}function ct(){Ze=3750,$e=6e3;var e=function(){if(window&&window.navigator){var e=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return e?e.effectiveType:void 0}}();if(void 0!==e)switch(void 0!==et&&et!==e&&Qe.ULS.he(595350873,n.N,o.Info,"ExcelLandingPageObserver: initializeTimeOutIntervals previousConnection: "+et+" currentConnection: "+e+" First Flush: "+Ge+" Second Flush:"+Ke),et=e,e){case"4g":Ze=3750,$e=6e3;break;case"3g":Ze=5e3,$e=8e3;break;case"2g":Ze=1e4,$e=24e3;break;case"slow-2g":Ze=2e4,$e=4e4}}function ut(){try{var e=J(),t="OfflineMode_"+it+"_"+e,i={"Sessionid:":it,OfflineTime:e};localStorage.setItem(t,JSON.stringify(i))}catch(e){Qe.ULS.he(593589522,n.N,o.Error,"ExcelLandingPageObserver:logOfflineModeTelemetry exception during saving into cache exception: "+X(e))}}var ht;function ft(e,t){ht=e;try{window.localStorage?(t.registerMessagePayloadHandler(he.wi,(function(e){!function(e){if(e&&e.hasOwnProperty("cacheItemKey")&&0===e.cacheItemKey.indexOf("XlHc_")&&e.hasOwnProperty("cacheItemValue"))try{window.localStorage.setItem(e.cacheItemKey,e.cacheItemValue),ht.ULS.he(574677249,n.N,o.Info,"ExcelHostFrameCacheManager: handleHostFrameSaveMessage: setting localstorage HostFrame cache item")}catch(e){ht.ULS.he(574677250,n.N,o.Warning,"ExcelHostFrameCacheManager: handleHostFrameSaveMessage: error while saving HostFrame to local storage. error: "+X(e))}else ht.ULS.he(574677251,n.N,o.Warning,"ExcelHostFrameCacheManager: handleHostFrameSaveMessage: HostFrame cache save message does not contain all expected values, skipping HostFrame cache save")}(e)})),t.registerMessagePayloadHandler(he.gi,(function(e){!function(e){if(e&&e.hasOwnProperty("workbookList")&&e.hasOwnProperty("evictAllExceptListed"))try{var t=e.evictAllExceptListed,i=JSON.parse(e.workbookList);ht.ULS.he(574677252,n.N,o.Info,"ExcelHostFrameCacheManager: handleHostFrameEvictMessage: removing items from cache. workbookList length: "+i.length+", evictAllExceptListed: "+t),!0===t?function(e){for(var t=new Date,i=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()).getTime(),r=0;r<localStorage.length;r+=1){var s=localStorage.key(r),a=!1;if(0===s.indexOf("XlHc_")){if(e.indexOf(s)<0)a=!0;else{var c=localStorage.getItem(s),u=void 0;try{u=JSON.parse(c)}catch(e){ht.ULS.he(574677255,n.N,o.Warning,"ExcelHostFrameCacheManager: evictAllItemsExcept: unable to check for stale HostFrame cache, error parsing HostFrame cache item, error: "+X(e))}if(u)i-u.LastModified>5184e6&&(a=!0);else a=!0}a&&(localStorage.removeItem(s),ht.ULS.he(574677256,n.N,o.Verbose,"ExcelHostFrameCacheManager: EvictAllItemsExcept: Removed HostFrame cache item"))}}}(i):function(e){for(var t=0;t<e.length;t+=1)localStorage.removeItem(e[t]),ht.ULS.he(574677257,n.N,o.Verbose,"ExcelHostFrameCacheManager: EvictSpecificItems: Removed HostFrame cache item")}(i)}catch(e){ht.ULS.he(574677253,n.N,o.Warning,"ExcelHostFrameCacheManager: handleHostFrameEvictMessage: error while evicting HostFrame from local storage. error: "+X(e))}else ht.ULS.he(574677254,n.N,o.Warning,"ExcelHostFrameCacheManager: handleHostFrameEvictMessage: HostFrame cache evict message does not contain all expected values")}(e)}))):ht.ULS.he(574677217,n.N,o.Warning,"ExcelHostFrameCacheManager: initHostFrameCacheManager: localstorage not supported by Browser. Skip saving HostFrame cache save")}catch(e){ht.ULS.he(574677218,n.N,o.Warning,"ExcelHostFrameCacheManager: initHostFrameCacheManager: error while initializing.")}}function lt(e,t,i,r,s,a,c){var u=function(e,t,i,n){var o=e.ownerDocument.createElement("iframe");o.name=i||"WebApplicationFrame",o.id="WebApplicationFrame",o.src="",o.title="Office Online Frame",o.width="100%",o.height="100%",o.marginWidth="0",o.marginHeight="0",o.style.left="0",o.style.top="0",o.style.right="0",o.style.bottom="0",o.style.display="block",o.style.position="absolute",o.style.backgroundColor="transparent",o.style.border="none",o.frameBorder="0",o.setAttribute("allowfullscreen","true"),o.setAttribute("allowTransparency","true");var r=I(t);return o.setAttribute("allow","microphone "+r+"; camera "+r+";"),n&&(o.onload=n),e.appendChild(o),o}(e,t,c);return at(t)&&ot(s,"office_form",r,a),function(e,t,i){try{ht||(ht=e);var r=t[ye.Wn]+"_"+i+"_"+t[ye.Gn]+"_"+t[ye.eo];if(r="XlHc_"+function(e){var t=0,i=e.length,n=0;if(i>0)for(;n<i;)t=(t<<5)-t+e.charCodeAt(n)|0,n+=1;return t}(r),t[ye.to]=r,window.localStorage){var s=localStorage.getItem(r);null!==s&&(t[ye.io]=s)}else ht.ULS.he(574677219,n.N,o.Warning,"ExcelHostFrameCacheManager: setHostFrameCachePostData: localstorage not supported by Browser. Skip saving HostFrame cache save")}catch(e){ht.ULS.he(574677248,n.N,o.Warning,"ExcelHostFrameCacheManager: setHostFrameCachePostData: error while setting host frame cache post data.")}}(s,i,""),function(e,t,i,n){Te(e,n);var o=t.ownerDocument,r=o.createElement("form");for(var s in r.id="office_form",r.name="office_form",r.action=i,r.target=e.name,r.method="POST",n){var a=o.createElement("input");a.type="hidden",a.name=s,a.value=n[s],r.appendChild(a)}return t.appendChild(r),r.submit(),e}(u,e,t,i)}var dt=function(){function e(e,t,i,n,o,r){var s=this;if(this.bo=!1,this._o=[],this.logWarningOnNoAppComplete=function(e){s.bo||ne(s.rt,e)},void 0===t)throw new TypeError("bootFlowInfo");if(t.isSingleStepBoot&&void 0===e.wopiInfo)throw new TypeError("wopiInfo");this.yo=e,this.Oo=t,this.rt=i,this.Co=n,this.Eo=o,this.To=r,this.Ro=e.diagnostics.AppInitDiagnostics,this.Po=e.diagnostics.SessionTraces,this.Po.wopiInitializeTime=J()}return e.prototype.Boot=function(){var e=this;this.rt.ULS.he(596444241,n.N,o.Info,"Initializing WAC frame");var t=qe(this.yo,this.Oo,!0),i=function(e,t){var i={};if(e.wopiInfo&&(i[ye.Fn]=e.wopiInfo.AccessToken,i[ye.An]=ze(e.wopiInfo)),e.wopiPrecheckInfo.BundleInfo&&e.wopiPrecheckInfo.BundleInfo.Url&&e.wopiPrecheckInfo.BundleInfo.Url.length>0)if(i[ye.Un]=e.wopiPrecheckInfo.BundleInfo.Url,null!=e.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==e.wopiPrecheckInfo.BundleInfo.BundleStaleness){var r=e.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();t.ULS.he(593503580,n.N,o.Info,"Content bundle staleness - "+r),i[ye.xn]=r}else t.ULS.he(593503581,n.N,o.Info,"Content bundle staleness does not exist");if(e.wopiPrecheckInfo.FileGetUrl&&(i[ye.kn]=e.wopiPrecheckInfo.FileGetUrl),e.wopiPrecheckInfo.FileName){var s=e.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==s){var a=e.wopiPrecheckInfo.FileName.substring(s+1);a&&(i[ye.Mn]=a)}i[ye.Dn]=e.wopiPrecheckInfo.FileName}e.newFileTemplateSource&&e.newFileTemplateSource.FileSize?i[ye.Jn]=e.newFileTemplateSource.FileSize.toString():e.wopiPrecheckInfo.FileSize&&(i[ye.Jn]=e.wopiPrecheckInfo.FileSize.toString()),e.sessionInformation.UserId&&(i[ye.eo]=e.sessionInformation.UserId),e.sessionInformation.OwnerId&&(i[ye.Xn]=e.sessionInformation.OwnerId),e.sessionInformation.SessionContext&&(i[ye.Zn]=e.sessionInformation.SessionContext),e.diagnostics.HostInitDiagnostics&&(i[ye.zn]=JSON.stringify({HostInitializeDiagnostics:e.diagnostics.HostInitDiagnostics,ClientDiagnostics:e.diagnostics.ClientDiagnostics})),i[ye.Hn]=ae(e.featureManager,e.sessionInformation.WdParams),e.applicationCustomSettings&&e.applicationCustomSettings.HostUIControls&&(i[ye.Kn]=JSON.stringify(e.applicationCustomSettings.HostUIControls)),i[ye.qn]=String(window.devicePixelRatio>1.24),i[ye.$n]=String(d()),i[ye.Gn]=e.sessionInformation.HostName;var c=e.newFileTemplateSource;return c&&c.FileGetUrl&&(i[ye.Qn]=c.FileGetUrl),c&&c.DocUniqueId?i[ye.Wn]=c.DocUniqueId:e.wopiPrecheckInfo.DocUniqueId&&(i[ye.Wn]=e.wopiPrecheckInfo.DocUniqueId),c&&c.ETag?i[ye.Nn]=c.ETag:e.wopiPrecheckInfo.ETag&&(i[ye.Nn]=e.wopiPrecheckInfo.ETag),i[ye.no]=Intl.DateTimeFormat().resolvedOptions().timeZone,i}(this.yo,this.rt);if(te(m(t),this.yo.Ne,this.rt,this.logWarningOnNoAppComplete),this.Co.registerMessagePayloadHandler(he.vt,(function(t){e.handleWacAppBootState(t)})),this.Co.registerMessagePayloadHandler(he.It,(function(){e.handleCloseTab()})),this.Co.registerMessagePayloadHandler(he.Wt,(function(t){e.handleTrustFrameRequest(t)})),this.Co.registerMessagePayloadHandler(he.ii,(function(t){e.handleSetOverlayContent(t)})),this.Co.registerMessagePayloadHandler(he.kt,(function(t){e.handleGetHostKeyValue(t)})),this.Co.registerMessagePayloadHandler(he.si,(function(t){e.handleStoreHostKeyValue(t)})),this.Oo.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(t,i),this.Oo.ignoreWacFramePostMessages){var r=this.getApplicationState();this.Eo(r)}return this.rt.ULS.he(595661019,n.N,o.Info,"Created Wac Frame"),this.Fo},e.prototype.bootWacFrame=function(e,t){this.Ro.officeFrameCreateTime=J(),this.Po.frameCreateStartTime=this.Ro.officeFrameCreateTime;var i=this.yo.applicationCustomSettings&&this.yo.applicationCustomSettings.appFrameName;this.Fo=lt(this.yo.container,e,t,this.yo.featureManager,this.rt,this.yo.sessionId,i),this.Co.activate(this.Fo)},e.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var e=this;this.Co.registerMessagePayloadHandler(he.wt,(function(t){e.handleWacCompleteMessage(t)})),this.Co.registerMessagePayloadHandler(he.pt,(function(t){e.handleWacFailureMessage(t)})),this._o.push(window.setTimeout((function(){return e.timeoutWacAppCompleteOrFail()}),15e3)),this._o.push(window.setTimeout((function(){return e.logWarningOnNoAppComplete(1)}),this.yo.Ne.getValue(j.Oe,6e4))),this._o.push(window.setTimeout((function(){return e.logWarningOnNoAppComplete(2)}),this.yo.Ne.getValue(j.Ce,18e4)))},e.prototype.handleWacAppBootState=function(e){var t=e&&e.state?e.state:"unknown";this.rt.ULS.he(595714271,n.N,o.Info,"WAC Boot App state:["+t+"]"),rt(t)},e.prototype.handleTrustFrameRequest=function(e){var t=Re(this.rt);this.rt.ULS.he(595653903,n.N,o.Info,"Top frame is trusted: "+t),this.sendWacPostMessage(fe.Wt,{isTopFrameTrusted:t})},e.prototype.handleSetOverlayContent=function(e){var t=He(e&&e.overlayContent);this.rt.ULS.he(587487432,n.N,o.Info,"Overlay content: "+t),this.sendWacPostMessage(fe.Gi,void 0)},e.prototype.handleWacCompleteMessage=function(e){if(this.rt.ULS.he(595986314,n.N,o.Info,"Received wac complete message"),this.rt.ULS.flush(),ie(),this.clearLogTimers(),st(),this.bo)this.rt.ULS.he(596444234,n.N,o.Info,"Received multiple wac complete or failure messages");else{this.bo=!0,this.sendWacPostMessage(fe.Ci,{}),Ue(this.Ro,e);var t=this.getApplicationState();this.Eo(t),this.sendJsApiDiagnosticsToWacFrame(this.yo.diagnostics)}},e.prototype.handleCloseTab=function(){this.rt.ULS.he(579342464,n.N,o.Info,"Received close tab message");try{window.close()}catch(e){this.rt.ULS.he(579213188,n.N,o.Warning,"Failed to close the browser tab")}},e.prototype.getApplicationState=function(){return{innerApplicationFrame:this.Fo}},e.prototype.handleWacFailureMessage=function(e){if(this.rt.ULS.he(595986315,n.N,o.Error,"Received wac failed message"),this.rt.ULS.flush(),ie(),this.clearLogTimers(),this.bo)this.rt.ULS.he(596444235,n.N,o.Info,"Received multiple wac complete or failure messages");else{this.bo=!0,this.sendWacPostMessage(fe.Oi,{});var t={errorType:Pe.WacFailed,errorObject:{}};e&&(t.errorObject=e.Error,this.Po.error=t),this.To(t)}},e.prototype.handleGetHostKeyValue=function(e){var t=e.hostKey;this.rt.ULS.he(574433173,n.N,o.Info,"GetHostKeyValue "+t);var i=Je(e);null!=i&&this.sendWacPostMessage(fe.Ai,{hostKey:t,hostValue:i})},e.prototype.handleStoreHostKeyValue=function(e){var t=e.hostKey,i=e.hostValue;this.rt.ULS.he(574433174,n.N,o.Info,"storeHostKeyValue "+t+": "+i),Le(e)},e.prototype.timeoutWacAppCompleteOrFail=function(){this.bo||this.rt.ULS.he(596444236,n.N,o.Warning,"Timeout. SessionTraces:"+JSON.stringify(this.Po))},e.prototype.clearLogTimers=function(){oe(this._o),this._o=[]},e.prototype.sendJsApiDiagnosticsToWacFrame=function(e){this.sendWacPostMessage(fe.Ui,{HostInitializeDiagnostics:e.HostInitDiagnostics,ClientDiagnostics:e.ClientDiagnostics})},e.prototype.sendWacPostMessage=function(e,t){this.Fo&&this.Fo.contentWindow?this.Co.sendPostMessage(this.Fo,e,t):this.rt.ULS.he(595955718,n.N,o.Info,"Attempted to send postmessage: "+e)},e}(),pt=!1,vt=!1;function mt(){pt=!1}function wt(e,t,i,r,s,a,c){if(t.ULS.he(595714433,n.N,o.Info,"Starting disposing the application. unloadApp:"+e+"; disposed:"+pt+"; unloading:"+vt),pt||vt&&e)t.ULS.he(595714908,n.N,o.Info,"Application is already disposed or unloading");else{var u,h={logger:t,postMessenger:i,innerApplicationFrame:r,onDisposed:s,onFrameRemoved:a,unloadTimeoutInMs:c||1e3,forceAppUnload:!1,disposeStartTime:J(),appUnloadTimedOut:!1};if(e&&r)return vt=!0,h.forceAppUnload=!0,(u=h).forceAppUnloadStartTime=J(),u.logger.ULS.he(595855490,n.N,o.Info,"Sending postmessage to unload app"),u.logger.ULS.flush(),u.postMessenger.registerMessagePayloadHandler(he.ai,(function(e){return function(e,t){e.forceAppUnloadEndTime=J(),e.appUnloadedMessageValues=t,e.logger.ULS.he(595855491,n.N,o.Info,"AppUnloaded received from app"),gt(e)}(u,e)})),u.postMessenger.sendPostMessage(u.innerApplicationFrame,fe.Zi,{}),void window.setTimeout((function(){return function(e){!vt&&pt||(e.appUnloadTimedOut=!0,e.logger.ULS.he(595855492,n.N,o.Info,"ApplicationUnload timed out, forcing dispose"),gt(e))}(u)}),u.unloadTimeoutInMs);gt(h)}}function gt(e){if(!pt)try{pt=!0,vt=!1,function(e){if(!e.innerApplicationFrame)return;e.innerApplicationFrame.src="about:blank",window.setTimeout((function(){e.innerApplicationFrame&&e.innerApplicationFrame.parentElement&&e.innerApplicationFrame.parentElement.removeChild(e.innerApplicationFrame),e.onFrameRemoved&&e.onFrameRemoved()}),0)}(e),function(e){var t={disposeStartTime:e.disposeStartTime,disposeEndTime:J(),forceAppUnload:e.forceAppUnload,appUnloadTimedOut:e.appUnloadTimedOut};e.forceAppUnloadStartTime&&(t.appUnloadStartTime=e.forceAppUnloadStartTime);e.forceAppUnloadEndTime&&(t.appUnloadEndTime=e.forceAppUnloadEndTime);if(e.appUnloadedMessageValues){var i=e.appUnloadedMessageValues,r=Number(i.hostMessageReceived);e.forceAppUnloadStartTime&&!isNaN(r)&&(t.hostToAppPostMessageLatency=r-e.forceAppUnloadStartTime);var s=Number(i.appMessageSent);!isNaN(s)&&e.forceAppUnloadEndTime&&(t.appToHostPostMessageLatency=e.forceAppUnloadEndTime-s);var a=Number(i.appUnloadStart),c=Number(i.appUnloadEnd);if(isNaN(a)||isNaN(c)||(t.appUnloadLatency=c-a),i.serverTimings){var u=i.serverTimings;for(var h in u)t["st-"+h.toString()]=u[h]}}e.logger.ULS.he(595855436,n.N,o.Info,"App disposed "+JSON.stringify(t)),e.logger.ULS.flushOnClose()}(e),e.onDisposed&&e.onDisposed()}catch(t){e.logger.ULS.he(595714434,n.N,o.Error,"Error disposing: "+X(t))}}var St,It=function(){function e(e,t,i,n,o,r,s){var a=this;this.Ao=!1,this.Uo=!1,this.xo=!1,this.Wo=null,this.No=!0,this.Ho=!1,this.Mo=!1,this.yo=e,this.Oo=t,this.Ro=e.diagnostics.AppInitDiagnostics,this.rt=i,this.Co=n,this.Eo=r,this.To=s,this.Po=e.diagnostics.SessionTraces,this.Po.wopiPendingInitializeTime=J(),this.Do=o,mt(),window.setTimeout((function(){return a.timeoutCompleteOrFail()}),5e3)}return e.prototype.Complete=function(e,t){if(this.xo)this.rt.ULS.he(596444184,n.N,o.Warning,"Complete called after Complete/Fail already called");else{this.rt.ULS.he(596444185,n.N,o.Info,"Complete called."),this.xo=!0,this.Jo=e,this.Po.wopiPendingCompleteTime=J();try{this.Oo.isSingleStepBoot?this.completeSingleStepFlow():this.completeTwoStepFlow(),this.Ao&&this.sendWacPostMessage(fe.Ki,{}),this.updateBrowserHistoryForCreateNew(t)}catch(e){this.rt.ULS.he(596444186,n.N,o.Error,"Unexpected script error: "+X(e))}finally{this.rt.ULS.flush()}}},e.prototype.Fail=function(e){this.xo?this.rt.ULS.he(596444187,n.N,o.Warning,"Fail called after Complete/Fail already called"):(this.rt.ULS.he(596444188,n.N,o.Warning,"Fail called. Reason: "+(e?JSON.stringify(e):"N/A")),this.xo=!0,this.Oo.isSingleStepBoot?this.failSingleStepFlow():this.failTwoStepFlow(e),this.rt.ULS.flush())},e.prototype.Dispose=function(e,t,i){var n=this;wt(e||!1,this.rt,this.Co,this.Fo,(function(){delete n.Fo,t&&t(),n.Do(),n.Co.dispose()}),void 0,i)},e.prototype.Boot=function(){this.Oo.isSingleStepBoot||this.bootTwoStepFlow(),this.rt.ULS.flush()},e.prototype.bootTwoStepFlow=function(){var e=this;this.rt.ULS.he(596444231,n.N,o.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout((function(){return e.timeoutWacReadyMessage()}),5e3),this.Co.registerMessagePayloadHandler(he.dt,(function(t){e.handleWacReadyMessage(t)})),this.Co.registerMessagePayloadHandler(he.ti,(function(t){e.handleWacFrameSessionCompleteAckMessage(t)}));var t=new dt(this.yo,this.Oo,this.rt,this.Co,this.Eo,this.To);this.Fo=t.Boot()},e.prototype.completeTwoStepFlow=function(){var e={ParallelizeStartSession:this.No,WacFrameIsLoaded:this.Ao,WacAcceptsStartSessionComplete:this.Ho};this.rt.ULS.he(596444232,n.N,o.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(e)),!this.No||this.Ao&&!this.Ho?this.Ao&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},e.prototype.completeSingleStepFlow=function(){this.rt.ULS.he(596444233,n.N,o.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),this.yo.wopiInfo=this.Jo;var e=new dt(this.yo,this.Oo,this.rt,this.Co,this.Eo,this.To);this.Fo=e.Boot()},e.prototype.failTwoStepFlow=function(e){this.Ao?(this.rt.ULS.he(595968481,n.N,o.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(e)):(this.rt.ULS.he(595968482,n.N,o.Warning,"Fail was called on the session prior to WacReady."),this.Wo=e)},e.prototype.sendFailurePostMessageToWacFrame=function(e){this.rt.ULS.he(596444189,n.N,o.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(fe.zi,e)},e.prototype.failSingleStepFlow=function(){this.rt.ULS.he(596444190,n.N,o.Warning,"Fail called during single step boot, calling host failure callback..."),this.To({errorType:Pe.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},e.prototype.timeoutWacReadyMessage=function(){this.Ao||(this.rt.ULS.he(596444191,n.N,o.Warning,"Timeout Wac Ready"),this.To({errorType:Pe.TimeoutWacReady,errorObject:void 0}))},e.prototype.timeoutCompleteOrFail=function(){this.xo||(this.Po.timeoutCompleteOrFail=J(),this.rt.ULS.he(596444192,n.N,o.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(this.Po)))},e.prototype.timeoutWacSessionCompletionMessageAck=function(e,t,i){this.Mo||(this.rt.ULS.he(596444193,n.N,o.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(e,t,i+1))},e.prototype.handleWacReadyMessage=function(e){if(this.Po.readyMessageReceiveTime=J(),this.sendWacPostMessage(fe.bi,{}),this.Ao)this.rt.ULS.he(596444194,n.N,o.Info,"Received multiple ready messages - frame is already loaded.");else{this.Ao=!0,this.Ho=e&&e.CanAcceptStartSessionComplete;var t={AcceptStartSessionComplete:this.Ho,ParallelizeStartSession:this.No,StartSessionResponseAvailable:!!this.Bo,WopiInfoAvailable:!!this.Jo};this.rt.ULS.he(596444195,n.N,o.Info,"HandleWacReadyMessage - "+JSON.stringify(t)),this.xo&&(this.Wo?this.sendFailurePostMessageToWacFrame(this.Wo):this.sendWacPostMessage(fe.Ki,{})),this.No&&this.Ho?this.Bo&&this.startSessionCompleted():this.Jo&&this.sendWopiInfoToWacFrame(),Ue(this.Ro,e)}},e.prototype.handleWacFrameSessionCompleteAckMessage=function(e){this.Mo=!0,this.Po.sessionCompleteAckReceivedTime=J()},e.prototype.sendWacPostMessage=function(e,t){this.Co.sendPostMessage(this.Fo,e,t)},e.prototype.sendSessionCompletionMessageWithRetry=function(e,t){this.sendSessionCompletionMessageWithRetryHelper(e,t,1)},e.prototype.sendSessionCompletionMessageWithRetryHelper=function(e,t,i){var r=this;if(i>3)this.rt.ULS.he(596444224,n.N,o.Error,"Attempted to call complete, but received no ack from the frame. Time: "+J());else{this.rt.ULS.he(596444225,n.N,o.Info,"Sending completion message to frame. Attempt number: "+i+", Time: "+J());var s=J();1===i&&(this.Bo&&this.Bo.Diagnostics&&(this.Bo.Diagnostics.completeMessageCreateTime=s),this.Po.completeMessageCreateTime=s),t.Diagnostics.completeMessageSendTime=s,this.Po.completeMessageSendTime=s,this.sendWacPostMessage(e,t),window.setTimeout((function(){return r.timeoutWacSessionCompletionMessageAck(e,t,i)}),1e3)}},e.prototype.makeStartSessionRequest=function(){var e=this;this.rt.ULS.he(596444226,n.N,o.Info,"Making parallelized startSession request.");var t=this.buildStartSessionUrl(this.Jo),i={"Content-Type":"application/x-www-form-urlencoded"},r="access_token="+encodeURIComponent(this.Jo.AccessToken)+"&access_token_ttl="+encodeURIComponent(ze(this.Jo));this.Po.startSessionStartTime=J(),function(e,t,i,n){var o=new XMLHttpRequest;for(var r in o.onreadystatechange=function(){if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{n&&n(o)}finally{null!=o&&(o.onreadystatechange=function(){})}}},o.open("POST",e),i)o.setRequestHeader(r,i[r]);o.send(t)}(t,r,i,(function(t){return e.onStartSessionRequestCompleted(t)}))},e.prototype.onStartSessionRequestCompleted=function(e){if(this.Po.startSessionCompleteTime=J(),this.Po.startSessionResponseStatus=e.status,this.Bo={StartSessionResponse:{RequestStatus:e.status,ResponseText:e.responseText},Diagnostics:{wopiPendingInitializeTime:this.Po.wopiPendingInitializeTime,wopiPendingCompleteTime:this.Po.wopiPendingCompleteTime,startSessionStartTime:this.Po.startSessionStartTime,startSessionCompleteTime:this.Po.startSessionCompleteTime,readyMessageReceiveTime:this.Po.readyMessageReceiveTime}},this.rt.ULS.he(596444227,n.N,o.Info,"StartSession request completed with status code: "+this.Bo.StartSessionResponse.RequestStatus+", Time: "+J()),this.Ao&&this.Ho)this.startSessionCompleted();else{var t={WacFrameIsLoaded:this.Ao,InitializeCompleted:this.Uo};this.rt.ULS.he(596444228,n.N,o.Info,"StartSessionCompleted not called - "+JSON.stringify(t))}},e.prototype.sendWopiInfoToWacFrame=function(){if(!this.Uo){this.Uo=!0,this.rt.ULS.he(596444229,n.N,o.Info,"Sending wopi info to the frame.");var e={WopiDetails:{WopiSrc:this.Jo.WopiSrc,AccessToken:this.Jo.AccessToken,AccessTokenTtl:ze(this.Jo)},Diagnostics:{wopiPendingInitializeTime:this.Po.wopiPendingInitializeTime,wopiPendingCompleteTime:this.Po.wopiPendingCompleteTime,readyMessageReceiveTime:this.Po.readyMessageReceiveTime}};this.sendSessionCompletionMessageWithRetry(fe.Ti,e)}},e.prototype.startSessionCompleted=function(){200===this.Bo.StartSessionResponse.RequestStatus?this.Uo||(this.Uo=!0,this.sendSessionCompletionMessageWithRetry(fe.Ei,this.Bo)):this.sendWopiInfoToWacFrame()},e.prototype.buildStartSessionUrl=function(e){var t=this.yo.applicationBasePath+"wordeditorstartsession.ashx",i=qe(this.yo,this.Oo,!1);return t=C(t+="?"+i.substring(i.indexOf("?")+1),"WOPISrc",encodeURIComponent(e.WopiSrc)),t=C(t,"build",encodeURIComponent(L())),t=C(t,"WacUserType",encodeURIComponent("WOPI")),this.yo.wopiPrecheckInfo.FileGetUrl&&(t=C(t,"fileGetUrlPresent","1")),t},e.prototype.updateBrowserHistoryForCreateNew=function(e){if(this.yo.isCreateNew){if(!e||!e.NewFilePath)return void this.rt.ULS.he(596444230,n.N,o.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",e.NewFilePath),e.UpdatedPageTitle&&(document.title=e.UpdatedPageTitle)}},e}(),bt=((St={})[ue.blurFocus]=fe.yi,St[ue.continueAccessibilityLoop]=fe.Ri,St[ue.grabFocus]=fe.Pi,St[ue.moveToFolder]=fe.Lt,St[ue.popState]=fe.Wi,St[ue.rename]=fe.Ni,St[ue.sendAccessToken]=fe.Hi,St[ue.sendAuthToken]=fe.Mi,St[ue.sendCustomAuthConfig]=fe.ki,St[ue.sendEmbeddedViewUrl]=fe.Ji,St[ue.sendSessionInfo]=fe.Bi,St[ue.sendUserAccessAndPermissions]=fe.Li,St[ue.sendWopiInfo]=fe.Vi,St[ue.completeSharedFilePicker]=fe.Yt,St[ue.switchMode]=fe.Xi,St[ue.signalShared]=fe.Yi,St),_t=function(){function e(e,t){var i=this;if(this.Lo=!1,this.Vo={},this._n="",this.yn="",this.En=!1,this.On=!1,this.Cn=!1,this.jo=function(e){var t=!1,r=!0,s="",a=!1;if(i.Fo&&i.Fo.contentWindow&&(t=!0,r=e.source===i.Fo.contentWindow),e.origin&&(a=(s=b(e.origin,2).toLowerCase())===i.yn),!i.On&&(!i.Cn||a&&r)||i.rt.ULS.he(595730526,n.N,o.Info,"Window is available: "+t+", window is valid: "+r+", origin is valid: "+a+", expected origin: "+i.yn+", actual origin: "+s),a&&(!i.En||r)){var c;try{c=JSON.parse(e.data)}catch(e){return void i.rt.ULS.he(596464282,n.N,o.Info,"Failed to parse event data: "+X(e)+".")}var u=c.MessageId;if(u){i.rt.ULS.he(595714715,n.N,o.Info,"Received messageId: "+u+", correlation: "+c.CorrelationId),u!==he.wt&&u!==he.Jt||i.setOrigin(e.origin),c.Values&&c.Values.ackExpected&&i.sendAckBack(e.source,e.origin,c.CorrelationId);var h=i.Vo[u];if(h){i.rt.ULS.he(596464288,n.N,o.Info,"Processing message: "+u);try{h(c.Values||{})}catch(e){i.rt.ULS.he(593773704,n.N,o.Error,"Handler error: "+X(e))}}else i.rt.ULS.he(596464289,n.N,o.Info,"No handler found for message id: "+u)}else(i.On||i.Cn)&&i.rt.ULS.he(595730520,n.N,o.Info,"Could not find message id")}},!e)throw new Error("Missing origin for PostMessageHandler");this.On=m(e),this.Cn=w(e),this.rt=t,this.setOrigin(e)}return e.prototype.registerMessagePayloadHandler=function(e,t){if(this.Vo[e])throw new Error("Duplicate registration!");this.Vo[e]=t},e.prototype.removeMessageHandler=function(e){delete this.Vo[e]},e.prototype.sendPostMessage=function(e,t,i){if(e&&e.contentWindow){this.rt.ULS.he(596464334,n.N,o.Info,"Sending message: "+t);var r={MessageId:t,SendTime:J(),Values:i};this.sendPostMessageInternal(e.contentWindow,JSON.stringify(r),this._n)}else this.rt.ULS.he(595948308,n.N,o.Info,"Missing target for SendPostMessage")},e.prototype.activate=function(e,t){this.Fo=e,this.En=!!t,this.Lo||(window.addEventListener("message",this.jo,!1),this.Lo=!0)},e.prototype.postMessageForCommand=function(e,t,i){var r=bt[t];r?(this.rt.ULS.he(595702598,n.N,o.Info,"Sending message "+r+" for command "+t),this.sendPostMessage(e,r,i)):this.rt.ULS.he(595702599,n.N,o.Warning,"No mapping for command "+t)},e.prototype.dispose=function(){this.Vo={},this.Lo&&(window.removeEventListener("message",this.jo,!1),this.Lo=!1)},e.prototype.sendAckBack=function(e,t,i){if(e){var r={MessageId:fe.Ii,CorrelationId:i,SendTime:J()};this.rt.ULS.he(595732176,n.N,o.Info,"Sending Ack back"),e.postMessage(JSON.stringify(r),t)}else this.rt.ULS.he(595736136,n.N,o.Info,"Missing target to send Ack back")},e.prototype.sendPostMessageInternal=function(e,t,i){e.postMessage(t,i)},e.prototype.setOrigin=function(e){var t=e.toLowerCase();this._n&&this._n!==t&&this.rt.ULS.he(596128131,n.N,o.Warning,"Updating origin: ["+this._n.substring(8)+"]->["+t.substring(8)+"]"),this._n=t,this.yn=b(t,2),this.On=m(t),this.Cn=w(t)},e}(),yt=function(){function e(){var e=this;if(this.qo=[],this.Vo=[],this.zo=function(){var t={visibility:document.visibilityState,time:J(),initialState:!1};e.qo.push(t);for(var i=0,n=e.Vo;i<n.length;i++){var o=n[i];o&&o(t)}},"hidden"===document.visibilityState){var t={visibility:document.visibilityState,time:J(),initialState:!0};this.qo.push(t)}document.addEventListener("visibilitychange",this.zo)}return e.prototype.registerEventHandler=function(e){this.Vo.push(e)},e.prototype.removeEventHandler=function(e){if(e){var t=this.Vo.indexOf(e);this.Vo.splice(t,1)}},e.prototype.stop=function(){document.removeEventListener("visibilitychange",this.zo)},e.prototype.getVisibilityChangeEvents=function(){return this.qo},e.prototype.dispose=function(){this.stop(),this.Vo=[],this.qo=[]},e}();function Ot(e,t,i,n,o,r){void 0===r&&(r=!1),e.SessionInformation.IsCore&&(e.SessionInformation.HideViewerToolbar=!0),function(e,t){var i=e.SessionInformation;i.WdParams||(i.WdParams={});if(i.WdParams.wd)return;t.substring(1).split("&").filter((function(e){if(0===e.indexOf("wd")){var t=e.split("=");t[0].length>2&&(i.WdParams[t[0]]=t[1])}}));var n=e.RebootOverrideData;n&&n.previousSessionId&&(i.WdParams.wdprevioussession=n.previousSessionId)}(e,window.location.search);var s=o||new ve("Excel",i);return{container:e.Container,sessionInformation:e.SessionInformation,applicationUrl:e.ApplicationUrl,wopiPrecheckInfo:e.WopiPrecheckInfo,applicationCustomSettings:e.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:e.Diagnostics,ClientDiagnostics:Q(),AppInitDiagnostics:{officeSessionId:t,officeBootstrapperVersion:L(),hostName:e.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:e.FnOnInitializeSuccess,fnOnInitializeFailure:e.FnOnInitializeFailure,sessionId:t,applicationBasePath:Ct(e.ApplicationUrl),wopiInfo:e.WopiInfo,forceSingleStepBoot:r,isCreateNew:e.WopiPrecheckInfo.IsNewFile||P(e.ApplicationUrl,"new"),featureManager:n||se(e.FnIsFeatureEnabled,i),Ne:s,newFileTemplateSource:e.NewFileTemplateSource,rebootOverrideData:e.RebootOverrideData,pageStateObserver:new Ie(i,!0)}}function Ct(e){var t=e.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}var Et=[];function Tt(e){window.performance&&window.performance.getEntriesByType&&window.addEventListener("load",(function(){try{for(var t=0,i=window.performance.getEntriesByType("resource");t<i.length;t++){var r=i[t],s=T(r.name);if("about:blank"!==r.name&&-1===s.indexOf("RemoteUls.ashx")&&-1===s.indexOf("mhtml:file"))if("excel-boot.min.js"===s)a=(a=JSON.stringify(r)).replace(new RegExp(r.name,"g"),s),e.ULS.he(574662801,n.N,o.Info,a);else if(-1!==Et.indexOf(s)){var a;a=(a=JSON.stringify(r)).replace(new RegExp(r.name,"g"),s),e.ULS.he(595736532,n.N,o.Info,a)}}window.performance.clearResourceTimings()}catch(t){e.ULS.he(595732049,n.N,o.Info,"ExcelPreloader.tryObserveResourceTiming: could not trace resource timing, error is: "+JSON.stringify(t))}}),{once:!0})}var Rt;function Pt(e,t){Rt=e;try{t.registerMessagePayloadHandler(he.Si,(function(e){!function(e){if(!e||!e.hasOwnProperty("fileUrl")||!e.hasOwnProperty("fileType"))return void Rt.ULS.he(572383453,n.N,o.Warning,"ExcelFileBundleRegenerationRequester.handleRegenerateFileBundleMessage: Message is missing parameter(s). values=null? "+!e+",\n        fileUrl=null? "+(e&&!e.hasOwnProperty("fileUrl"))+", fileType=null? "+(e&&!e.hasOwnProperty("fileType")));try{var t=function(){var e=new xt,t=new XMLHttpRequest;return t.timeout=3e4,t.withCredentials=!0,t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&(200===t.status?(e.IsSucceeded=!0,e.HostCorrelationId=function(e){var t,i=null;try{var r=(new window.DOMParser).parseFromString(e,"text/xml"),s=new URL(null!==(t=r.documentElement.textContent)&&void 0!==t?t:"");i=s.searchParams.get("correlationId")}catch(e){Rt.ULS.he(572383454,n.N,o.Warning,"ExcelFileBundleRegenerationRequester.readSpoCorrelationFromResponse: "+X(e))}return i}(t.responseText)):e.FailureReason="XhrHttp"+t.status,Ft(e))},t.onerror=function(t){e.FailureReason="XhrError",Ft(e)},t}(),i=function(e){var t=new URL(e.fileUrl).origin,i=new URL(t);return i.pathname="_api/SP.Utilities.WOPIHostUtility.GenerateFileBundle",i.searchParams.set("fileUrl",e.fileUrl),i.searchParams.set("fileType",e.fileType),i}(e);t.open("GET",i.toString(),!0),t.send()}catch(e){Rt.ULS.he(572381152,n.N,o.Warning,"ExcelFileBundleRegenerationRequester.handleRegenerateFileBundleMessage: "+X(e))}}(e)}))}catch(e){Rt.ULS.he(572383452,n.N,o.Warning,"ExcelFileBundleRegenerationRequester.initRegenerateFileBundleMessageHandler: "+X(e))}}function Ft(e){Rt.ULS.he(572383455,n.N,o.Warning,"ExcelFileBundleRegenerationRequester.logResult: "+JSON.stringify(e))}var At,Ut,xt=function(){this.IsSucceeded=!1,this.HostCorrelationId=null,this.FailureReason=null},Wt=function(){function e(e,t){this.Go=e,this.Ko=t}return e.prototype.GetVersion=function(){return L()},e.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},e.prototype.Prefetch=function(e){if(null!=e&&void 0!==e){var t=document.createElement("link");t.rel="prefetch";var i=e.BootstrapperUrl;".js"!==i.toString().slice(-3)&&(i+=".js"),t.href=i;var n=document.getElementsByTagName("head")[0];null!=n&&void 0!==n&&n.appendChild(t)}},e.prototype.InitializeWopiPending=function(e,t,i,r,s,a){var c,u,f,l,d,p=!1;try{var v,m=J();!function(e){if(void 0===e)throw new TypeError("initParams");var t=e.Container;if(void 0===t||void 0===t.appendChild)throw new TypeError("Container");var i=e.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");var n=e.ApplicationUrl;if(void 0===n||"string"!=typeof n)throw new TypeError("ApplicationUrl");var o=e.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===e.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===e.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(e),e.ApplicationUrl=S(e.ApplicationUrl,O(e.ApplicationUrl,"region")),e.ApplicationUrl=function(e,t){if(!e)return e;var i=e,n=i.indexOf("?"),o=t.toLowerCase()+"=",r=i.toLowerCase().indexOf(o,n);if(r>=0){var s=i.indexOf("&",r);return"&"===(i=i.substring(0,r)+(-1===s?"":i.substring(s+1))).slice(-1)&&(i=i.slice(0,-1)),i}return e}(e.ApplicationUrl,"region"),function(e){var t,i=e.RebootOverrideData;if(i)if(i.queryOverrides||(i.queryOverrides={}),t=i.mode)"view"===(t=t.toLowerCase())?i.queryOverrides.wdforcedmode="View":"edit"===t&&(i.queryOverrides.wdforcedmode="Edit");else{var n=i.reason;n&&"saveas"===(n=n.toLowerCase())&&(i.queryOverrides.wdforcedmode="Edit")}}(e),i?f=i:(f=(c=Se())[0],l=c[1]),u=t||G({remoteUlsEndpoint:Ct(e.ApplicationUrl)+"RemoteUls.ashx",sessionId:f}),d=Ot(e,f,u,s,a,this.Ko.forceSingleStepBoot),a||(d.Ne.addSettingsChangeListener(u.settingsChangeHandler),d.Ne.initializePeriodicFetch(d.applicationBasePath,f)),d.diagnostics.HostInitDiagnostics&&(d.diagnostics.HostInitDiagnostics.hostInitializeCallTime=m),Ne(u,d,l),p=!0;var w=e.BootstrapperUrl;w&&(v=this.periodicPrefetch(w,u));var g=function(){d.Ne.dispose(),d.pageStateObserver.dispose(),window.clearInterval(v)},b=I(e.ApplicationUrl),_=r||new _t(b,u),y=new yt,C=function(e,t){var i={isSingleStepBoot:e.forceSingleStepBoot,bootFlowType:e.forceSingleStepBoot?Ve.forceSingleStepBoot:Ve.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(e.forceSingleStepBoot,i.isSingleStepBoot){var r={singleStepBootIsRequired:!0,singleStepBootReason:i.bootFlowType,irmEnabled:e.wopiPrecheckInfo.IrmEnabled,readOnly:e.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:i.ignoreWacFramePostMessages};t.ULS.he(596444182,n.N,r.irmEnabled?o.Warning:o.Info,JSON.stringify(r))}else t.ULS.he(596444183,n.N,o.Info,"Received input valid for two step flow");return i}(d,u),E=function(e,t,i,r,s,a,c,u){return function(h){We(e,s),xe(e.SessionTraces,r,o.Info);var f=Ht(e);r.ULS.he(596448985,n.N,o.Info,JSON.stringify(f));var l=u(t,r,i,a,h);try{c(l,f)}catch(e){r.ULS.he(595719171,n.N,o.Error,"Exception thrown from host's success callback: "+X(e))}Z("excel",r),Nt(r)}}(d.diagnostics,d.sessionId,_,u,y,g,e.FnOnInitializeSuccess,this.Go),T=function(e,t,i,r){return function(s){We(e,i),xe(e.SessionTraces,t,o.Warning);var a=Ht(e);void 0!==s&&"Js Boot Failed"!==s.errorObject.errorType&&t.ULS.he(575931487,n.N,o.Error,"Core JS failure recieved "+JSON.stringify(s)),t.ULS.he(596448986,n.N,o.Error,JSON.stringify({error:s,appInitDiagnostics:a}));try{r(s,a)}catch(e){t.ULS.he(595719172,n.N,o.Error,"Exception thrown from host's failure callback: "+X(e))}Z("excel",t),Nt(t)}}(d.diagnostics,u,y,e.FnOnInitializeFailure);if(h(),e.FnOnAppModeSwitched&&_.registerMessagePayloadHandler(he.Bt,e.FnOnAppModeSwitched),ft(u,_),Pt(u,_),e.WopiPrecheckInfo.ReadOnly&&e.FnOnAppModeSwitched,w&&this.Ko.preloader&&this.Ko.preloader.shouldPreload(d.applicationUrl))try{var P=w;Tt(u),d.featureManager.isFeatureEnabled(re.Le)&&(u.ULS.he(595645891,n.N,o.Info,"HTTP2 preload enabled"),P=R(w));var F=d.sessionInformation.UiLocale;F||(F=decodeURIComponent(O(d.applicationUrl,"ui"))),this.Ko.preloader.preload(P,F,u,d.featureManager)}catch(e){u.ULS.he(595943884,n.N,o.Error,X(e))}var A=new It(d,C,u,_,g,E,T);return A.Boot(),A}catch(t){return u&&(u.ULS.he(596459925,n.N,o.Error,Pe.AppInitError+": "+X(t)),p||Ne(u,d||Ot(e,f,u,s,a,this.Ko.forceSingleStepBoot),l),u.ULS.flushOnClose()),void e.FnOnInitializeFailure({errorType:Pe.AppInitError,errorObject:t},void 0)}},e.prototype.periodicPrefetch=function(e,t){var i=this;return window.setInterval((function(){i.Prefetch({BootstrapperUrl:e}),t.ULS.he(595895774,n.N,o.Info,"Prefetching "+T(e))}),36e5)},e}();function Nt(e){e.ULS.he(590914655,n.N,o.Info,"Time spent logging: "+e.getTimeSpentLogging())}function Ht(e){return K(K(K({},e.AppInitDiagnostics),e.HostInitDiagnostics),{SessionTraces:e.SessionTraces})}!function(e){e.BrowserEvent="BrowserEvent",e.PageChanged="PageChanged",e.ZoomChanged="ZoomChanged",e.ContentRefreshBegin="ContentRefreshBegin",e.ContentRefreshEnd="ContentRefreshEnd",e.AppClosed="UI_Close",e.UserEdit="Edit_Notification",e.FileRename="File_Rename",e.FileShare="UI_Sharing",e.ShowFileVersions="UI_FileVersions",e.UIWorkflow="UI_Workflow",e.IsDisabled="IsDisabled",e.AccessibilityLoopComplete="App_AccessibilityLoopComplete",e.Unloaded="Unloaded",e.Disposed="Disposed",e.SwitchMode="App_SwitchMode",e.DocumentReboot="DocReboot",e.WopiInfoFromUrl="WopiInfoFromUrl",e.ModeSwitched="ModeSwitched",e.CreateNewDocument="App_CreateNewDocument",e.GetAuthToken="GetAuthToken",e.GetCustomAuthConfig="GetCustomAuthConfig",e.SetOverlayContent="SetOverlayContent",e.MoveToFolder="MoveToFolder",e.SharedFilePicker="SharedFilePicker"}(At||(At={}));(Ut={})[At.DocumentReboot]=he.Kt,Ut[At.GetAuthToken]=he.Ht,Ut[At.GetCustomAuthConfig]=he.Mt,Ut[At.WopiInfoFromUrl]=he.Dt,Ut[At.FileShare]=he.ni,he.Rt,he.Nt,he.Zt,he.li;var Mt=function(){function e(e,t,i,n,o){this.Vo={},this.Xo=!1,this.Zo=!1,this.$o=e,this.rt=t,this.Fo=o.innerApplicationFrame,this.Co=i,this.Qo=n,this.registerPostMessageHandlers(),mt()}return e.prototype.GetApplicationType=function(){throw new Error("Not implemented")},e.prototype.GetVersion=function(){return L()},e.prototype.GetSessionId=function(){return this.$o},e.prototype.RegisterEventHandler=function(e,t){if(this.Zo)throw new Error("RegisterEventHandler is not supposed to be called");this.Xo=!0,this.registerEventHandlerInternal(e,t)},e.prototype.RemoveEventHandler=function(e,t){if(this.Zo)throw new Error("RemoveEventHandler is not supposed to be called");switch(e){case At.Unloaded:case At.Disposed:case At.DocumentReboot:case At.FileShare:case At.WopiInfoFromUrl:case At.GetAuthToken:case At.GetCustomAuthConfig:case At.MoveToFolder:case At.SharedFilePicker:case At.SetOverlayContent:if(this.Vo[e]!==t)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.Vo[e];break;default:this.Co.removeMessageHandler(e)}},e.prototype.RegisterErrorHandler=function(e){},e.prototype.RemoveErrorHandler=function(e){},e.prototype.RegisterAllEventsHandler=function(e){throw new Error("RegisterAllEventsHandler is not supposed to be called")},e.prototype.PostCommand=function(e,t){this.Co.postMessageForCommand(this.Fo,e,t)},e.prototype.Dispose=function(e,t){var i=this;wt(e||!1,this.rt,this.Co,this.Fo,(function(){delete i.Fo,i.Qo(),i.Co.dispose(),i.raiseEvent(At.Unloaded,{})}),(function(){try{i.raiseEvent(At.Disposed,{}),i.Vo={}}catch(e){i.rt.ULS.he(589108815,n.N,o.Error,"onFrameRemoved error: "+X(e))}}),t)},e.prototype.registerEventHandlerInternal=function(e,t){switch(e){case At.Unloaded:case At.Disposed:case At.DocumentReboot:case At.WopiInfoFromUrl:case At.GetAuthToken:case At.GetCustomAuthConfig:case At.MoveToFolder:case At.SharedFilePicker:case At.SetOverlayContent:case At.FileShare:if(this.Vo[e])throw new Error("Duplicate registration");this.Vo[e]=t;break;default:this.Co.registerMessagePayloadHandler(e,t)}},e.prototype.registerPostMessageHandlers=function(){this.Co.registerMessagePayloadHandler(he.Kt,this.handleDocumentRebootMessage.bind(this)),this.Co.registerMessagePayloadHandler(he.Dt,this.handleWopiInfoFromUrlRequest.bind(this)),this.Co.registerMessagePayloadHandler(he.Ht,this.handleAuthTokenRequest.bind(this)),this.Co.registerMessagePayloadHandler(he.ni,this.handleShareRequest.bind(this)),this.Co.registerMessagePayloadHandler(he.Mt,this.handleCustomAuthConfigRequest.bind(this)),this.Co.registerMessagePayloadHandler(he.Lt,this.handleMoveToFolderRequest.bind(this)),this.Co.registerMessagePayloadHandler(he.Yt,this.handleSharedFilePickerRequest.bind(this))},e.prototype.raiseEvent=function(e,t){var i=this.Vo[e];if(i)try{i(t||{})}catch(e){this.rt.ULS.he(593773706,n.N,o.Error,"Handler error: "+X(e))}},e.prototype.handleDocumentRebootMessage=function(e){e.previousSessionId=this.$o,this.raiseEvent(At.DocumentReboot,e)},e.prototype.handleWopiInfoFromUrlRequest=function(e){this.raiseEvent(At.WopiInfoFromUrl,e)},e.prototype.handleAuthTokenRequest=function(e){this.raiseEvent(At.GetAuthToken,e)},e.prototype.handleShareRequest=function(e){this.raiseEvent(At.FileShare,e)},e.prototype.handleCustomAuthConfigRequest=function(e){this.raiseEvent(At.GetCustomAuthConfig,e)},e.prototype.handleMoveToFolderRequest=function(e){this.raiseEvent(At.MoveToFolder,e)},e.prototype.handleSharedFilePickerRequest=function(e){this.raiseEvent(At.SharedFilePicker,e)},e}();var kt="_layouts/xlviewerinternal.aspx";function Dt(e){return e.toLowerCase().indexOf(kt.split("/")[1])>0}function Jt(e,t,i,r,s){var a={};if(s)a=s;else try{a=JSON.parse( "{\"ewa.js\": {\"UrlHash\": \"hADFF6FE39A2F2C4E\", \"SriHash\": \"rf9v45ovLE5o5qJLv3Iwn9DpLevFPzXOklnvBraVOR0=\"}, \"aacorlib.min.js\": {\"UrlHash\": \"h2ABDB64D937180EC\", \"SriHash\": \"Kr22TZNxgOzOnRDSALytyq1HNTbuW7EmT5Rah571VZI=\"}, \"ewa.strings.wac.js\": {\"UrlHash\": \"h9EB80D9EAEE9211C\", \"SriHash\": \"nrgNnq7pIRxmmeTnXl0mKd1lOQGH7fC+hUtTSanZCvA=\"}, \"ewrdefault.css\": {\"UrlHash\": \"hFCBBF5EC71FD1D0C\", \"SriHash\": \"/Lv17HH9HQwEvB3itMLwYMu9EoiSzqS5xqcjKz+Q0Jc=\"}, \"excelframe.css\": {\"UrlHash\": \"hE6BADC2A49867D22\", \"SriHash\": \"5rrcKkmGfSIjyaRdbLzf15+djzsuhSDlF+6naouMRKo=\"}, \"gridrenderer.min.js\": {\"UrlHash\": \"h295AFAF0C310FD91\", \"SriHash\": \"KVr68MMQ/ZEZNAFEV5FoqSKLoH0wAsFWz1qmgM3W46Q=\"}}")}catch(e){r&&r.ULS.he(589178847,n.N,o.Info,"GetExcelResources failed to parse hash dictionary")}for(var c=I(e)+"/x/s/",u=function(e){var t=e?e.toLowerCase().split("-")[0]:"en";return N[t]}(null!=t?t:"en-US"),h=[],f=0,l=function(e){var t=[["App_Scripts/Ewa.js",!1],["App_Scripts/Aacorlib.min.js",!1],["App_Scripts/gridRenderer.min.js",!1]];e&&(t=t.concat([["App_Scripts/"+e+"/Ewa.Strings.Wac.js",!0],["Resources/"+e+"/EwrDefault.css",!0],["Resources/"+e+"/excelframe.css",!0]]));return t}(u);f<l.length;f++){var d=l[f],p=d[0],v=d[1],m=p.substring(p.lastIndexOf("/")+1);if(Et.push(m),!v||"1033"===u){var w=m.toLowerCase();if(console.log("lowerCaseFile"),a&&a[w]){var g=a[w].UrlHash,S=a[w].SriHash;if(g){var b=c+g+"__layouts/"+p,_=Bt(b);h.push([_,"sha256-"+S]),h.push([_,void 0]),h.push([b,void 0]),r&&r.ULS.he(589178849,n.N,o.Info,"GetExcelResources adding hashed url for "+m)}}}}return h}function Bt(e){var t=e.match(/(.*)(c[1-5])(.*)/);return t?""+t[1]+t[2]+"h"+t[3]:e}var Lt=function(e,t,i,r,s){return e!==he.Kt?Promise.reject("Wrong flow"):new Promise((function(e){i.pendingReboot=!0;var r=void 0;if(t.queryOverrides)try{r=JSON.parse(t.queryOverrides)}catch(e){i.logger.ULS.he(592217694,n.N,o.Error,"Failed to parse queryOverrides: "+r)}i.raiseEvent(le.Reboot,K(K({},t),{previousSessionId:i.sessionId,queryOverrides:r})),e({completion:"success"})}))};function Vt(e){return function(e,t){var i={};t&&Object.keys(t).forEach((function(e){i[e.toLowerCase()]=t[e]}));return e.split("&").forEach((function(e){if(/^wd\w+=\w+/i.test(e)){var t=e.split("=");i[t[0].toLowerCase()]=t[1]}})),i}(window.location.search.substring(1),e)}function jt(e,t,i){var n=K(K(K({},E(e.appUrl)),function(e){var t={};_(t,"jsapi","1"),_(t,"jsapiver","v2"),_(t,"corrid",e.sessionId),_(t,"usid",e.sessionId),_(t,"newsession","1"),_(t,"sftc","1"),e.hostSessionId&&_(t,"hid",encodeURIComponent(e.hostSessionId));var i=e.host;i.uiHostName&&_(t,"uih",i.uiHostName),i.uiHostIntegrationType&&_(t,"uihit",encodeURIComponent(i.uiHostIntegrationType)),i.metaUiHostVersion&&_(t,"muv",encodeURIComponent(i.metaUiHostVersion));var n=i.capabilities;n&&(n.accessibilityLoop&&_(t,"accloop","1"),n.rebootDoc&&_(t,"sdr",n.rebootDoc.toString()),n.createNewDoc&&_(t,"scnd","1"),n.authToken&&_(t,"sat","1"),n.customAuthConfig&&_(t,"cac","1"),n.excelExternalLinks&&_(t,"xlel","1"),n.refreshAccessToken&&_(t,"rat","1"),n.atMentions&&_(t,"sams","1"),n.moveToFolder&&_(t,"mtf","1"),n.noBrowserModalDialogs&&_(t,"nbmd","1"),n.commonFilePicker&&_(t,"sfp","1"));var o=e.ui;o&&(o.language&&_(t,"ui",encodeURIComponent(o.language)),o.uiEmbed&&_(t,"uiembed","1"),o.hideHeader&&_(t,"hhdr","1"),o.highContrast&&_(t,"hcm",encodeURIComponent(o.highContrast)),o.hideFileLocationPicker&&_(t,"hodflp","1"),o.hideAppLauncherInHeader&&_(t,"halh","1"),o.hideChatInHeader&&_(t,"hch","1"),o.hideMeInHeader&&_(t,"hmh","1"),o.hideSearchInHeader&&_(t,"hsh","1"),o.hideWorkflowInHeader&&_(t,"hwfh","1"));var r=e.wopi;r&&r.source&&_(t,"wopisrc",encodeURIComponent(r.source));var s=e.bootParams;s&&(s.dataLanguage&&_(t,"rs",encodeURIComponent(s.dataLanguage)),s.readOnly&&_(t,"readonly","1"),s.disableChat&&_(t,"dchat","1"),s.cookieCompliant&&_(t,"mscc","1"),s.isNewFile&&(_(t,"new","1"),s.isFromHostTemplate&&_(t,"wdtpl","fromhost"))),e.user.isLicensed&&_(t,"islicenseduser","1"),e.actNavId&&_(t,"actnavid",e.actNavId),e.sessionContext&&_(t,"sc",encodeURIComponent(e.sessionContext));var a=e.wdParams;if(a)for(var c in a)_(t,c,a[c]);var u=e.preseededSession;u&&(u.key&&_(t,"preseededsessionkey",encodeURIComponent(u.key)),u.id&&_(t,"preseededwacsessionid",encodeURIComponent(u.id)));var h=e.throttling;h&&(h.protection&&_(t,"ctp",h.protection),h.request&&_(t,"rct",h.request));var f=e.hostInitDiagnostics;f&&(f.entryPoint&&_(t,"wdorigin",encodeURI(f.entryPoint)),f.userClickTime&&_(t,"wdhostclicktime",f.userClickTime.toString()));var l=e.rebootOverride;return l&&l.previousSessionId&&_(t,"wdprevioussession",l.previousSessionId),y(t,"region"),t}(e)),i),o=e.rebootOverride;return o&&o.queryOverrides&&(n=K(K({},n),o.queryOverrides)),function(e,t,i){var n=[];for(var o in i)i[o]&&n.push(o+"="+i[o]);return e+t+(n.length>0?"?"+n.join("&"):"")}(e.appBasePath,t,n)}function qt(e,t){var i=function(e){var t={};_(t,ye.qn,String(window.devicePixelRatio>1.24)),_(t,ye.$n,String(d())),_(t,ye.Gn,e.hostName),_(t,ye.Hn,ae(e.featureManager,e.wdParams));var i=e.wopi;i&&(_(t,ye.Fn,i.accessToken),_(t,ye.An,i.expiry.toString()));var r=e.contentBundle;if(r&&r.url&&r.url.length>0){_(t,ye.Un,r.url);var s=r.staleness,a=null!=s;a&&_(t,ye.xn,s.toString()),e.logger.ULS.he(577783775,n.N,o.Info,"Content bundle staleness: "+(a?s:"N/A"))}var c=e.file,u=c.name;if(u){_(t,ye.Dn,u);var h=u.lastIndexOf(".");if(-1!==h){var f=u.substring(h+1);f&&_(t,ye.Mn,f)}}c.getUrl&&_(t,ye.kn,c.getUrl),c.size&&_(t,ye.Jn,c.size.toString()),c.eTag&&_(t,ye.Nn,c.eTag),c.uniqueId&&_(t,ye.Wn,c.uniqueId);var l=e.newFileTemplate;l&&(l.getUrl&&_(t,ye.Qn,l.getUrl),l.size&&_(t,ye.Jn,l.size.toString()),l.eTag&&_(t,ye.Nn,l.eTag),l.uniqueId&&_(t,ye.Wn,l.uniqueId)),e.user.id&&_(t,ye.eo,e.user.id),e.ownerId&&_(t,ye.Xn,e.ownerId),e.sessionContext&&_(t,ye.Zn,e.sessionContext);var p=e.ui;return p&&p.controls&&_(t,ye.Kn,JSON.stringify(p.controls)),t}(e);return Object.keys(t).forEach((function(e){t[e]?i[e]=t[e]:delete i[e]})),i}var zt=[],Gt=function(e,t,i,r,s){return e!==ue.boot?Promise.reject("Wrong flow"):new Promise((function(e){var a,c=J();i.state=x.Booting,i.pendingReboot=!1,function(e,t){if(!e)throw new TypeError("SessionBootParams");var i=e.appUrl,n=e.appBaseUrl;if(!i&&!n)throw new TypeError("Either appUrl or appBaseUrl should exist");if(i&&"string"!=typeof i)throw new TypeError("AppUrl");if(n&&"string"!=typeof n)throw new TypeError("AppBaseUrl");var o=e.file;if(!o||!o.name)throw new TypeError("FileInfo");var r,s=e.container;if(!s||!(s instanceof Fe)&&!s.appendChild)throw new TypeError("Container");if(!t&&(!((r=e.wopi)&&r.source&&r.accessToken)||!r.expiry&&0!==r.expiry))throw new TypeError("WopiInfo")}(t,i.skipWopiValidation),i.intent=t.intent,i.file=t.file,i.wopi=t.wopi,i.contentBundle=t.contentBundle,i.newFileTemplate=t.newFileTemplate,i.ownerId=t.ownerId,i.sessionContext=t.sessionContext,i.actNavId=t.actNavId,i.preseededSession=t.preseededSession,i.throttling=t.throttling,i.hostInitDiagnostics=K(K({},t.diagnostics),{hostInitializeCallTime:c}),i.wdParams=Vt(t.wdParams),i.rebootOverride=t.rebootOverride,i.appUrl=t.appUrl||"",i.bootParams=t.bootParams||{},P(i.appUrl,"new")&&(i.bootParams.isNewFile=!0),i.appBaseUrl=t.appBaseUrl?t.appBaseUrl.toLowerCase():I(t.appUrl).toLowerCase(),i.appBaseUrl=S(i.appBaseUrl,O(i.appUrl,"region")),r.initializeAppContext(i),i.appBasePath=r.buildAppBasePath(i);var u=!1,h=i.preseededSession;i.appInfo.usePreseededSessionId&&h&&h.id&&(i.sessionId=h.id,u=!0);var f,l,d=!1,p=t.hostGeneratedSessionId;if(!u&&p&&(i.sessionId=p,d=!0),t.rebootOverride&&(u||d||(a=Se(),i.sessionId=a[0],f=a[1]),i.Ne.addSettingsChangeListener(i.logger.settingsChangeHandler),i.pageStateObserver=new Ie(i.logger,!0)),i.logger.ULS.he(562696478,n.N,o.Info,"User session id: "+i.sessionId+", is preseeded: "+u+", is host generated: "+d),i.logger.configure({remoteUlsEndpoint:(l=i.appBasePath,l+"RemoteUls.ashx"),sessionId:i.sessionId}),i.Ne.initializePeriodicFetch(i.appBasePath,i.sessionId),f&&i.logger.ULS.he(590966790,n.N,o.Info,JSON.stringify(f)),function(e){try{var t=e.hostInitDiagnostics;e.logger.ULS.he(590447446,n.N,o.Info,"HostInitDiagnostics: "+(t?JSON.stringify(t):"N/A")),e.logger.ULS.he(596444237,n.N,o.Info,JSON.stringify({session:$(e),client:e.clientDiagnostics}))}catch(t){e.logger.ULS.he(590447447,n.N,o.Error,"Failed to log init info: "+X(t))}}(i),i.appInitDiagnostics={officeSessionId:i.sessionId,officeBootstrapperVersion:L(),hostName:i.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",(function(){i.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),!i.container){var v=t.container;i.container=v instanceof Fe?v:i.application.createContainer(v)}i.container.setMessageHandler(i.onMessage);var w=!!r.ignoreCompletionMessage&&r.ignoreCompletionMessage(i),g=function(e,t){var s,a;w||(i.container.postMessage(fe.Ci,void 0),s=i.appInitDiagnostics,(a=t.Diagnostics)&&Object.keys(a).forEach((function(e){s[e]=a[e]}))),r.onBootSuccess&&r.onBootSuccess(i),i.logger.ULS.he(596448985,n.N,o.Info,JSON.stringify(i.diagnostics)),i.logger.ULS.flush(),i.container.postMessage(fe.Ui,{HostInitializeDiagnostics:i.hostInitDiagnostics,ClientDiagnostics:i.clientDiagnostics}),i.state=x.Booted,_({completion:"success"}),Z(i.appInfo.name,i.logger)},b=function(e,t){i.logger.ULS.he(596448986,n.N,o.Error,JSON.stringify({error:t.Error,diagnostics:i.diagnostics})),i.logger.ULS.flush(),i.state=x.Failed,_({completion:"failure"}),Z(i.appInfo.name,i.logger)},_=function(t){w||(ie(),oe(zt),zt=[],i.removeActionHandler(he.wt,g),i.removeActionHandler(he.pt,b)),e(t)};(s||new we(3e5)).subscribe((function(){_({completion:"cancelled"})})),w||(i.addActionHandler(he.wt,g),i.addActionHandler(he.pt,b));var y=r.buildBootRequestParams(i),C=jt(i,y.appPageName,y.queryParamsOverrides);if(i.bootstrapperUrl&&i.preloader&&i.preloader.shouldPreload(C))try{r.beforePreload&&r.beforePreload(i);var E=i.bootstrapperUrl;i.featureManager.isFeatureEnabled(re.Le)&&(i.logger.ULS.he(590966791,n.N,o.Info,"HTTP2 preload enabled"),E=R(E));var T=void 0;i.ui&&(T=i.ui.language),T||(T=decodeURIComponent(O(C,"ui"))),i.preloader.preload(E,T,i.logger,i.featureManager)}catch(e){i.logger.ULS.he(590966792,n.N,o.Error,X(e))}var F=qt(i,y.postDataOverrides);r.beforeContainerBoot&&r.beforeContainerBoot(i,C),i.appInitDiagnostics.officeFrameCreateTime=J(),i.container.boot(C,F,i.logger),w?g(he.wt,{Diagnostics:{}}):(te(m(i.appBaseUrl),i.Ne,i.logger,(function(){return ne(i.logger)})),zt.push(window.setTimeout((function(){return ne(i.logger,1)}),i.Ne.getValue(j.Oe,6e4))),zt.push(window.setTimeout((function(){return ne(i.logger,2)}),i.Ne.getValue(j.Ce,18e4))))}))},Kt=function(e,t,i,r,s){return e!==he.It?Promise.reject("Wrong flow"):new Promise((function(e){try{window.close()}catch(e){i.logger.ULS.he(579213189,n.N,o.Warning,"Failed to close the browser tab")}e({completion:"success"})}))},Xt=function(e,t,i){return new Promise((function(t){i.logger.ULS.he(590111070,n.N,o.Error,"Unsupported flow: "+e),t({completion:"failure"})}))},Zt=function(e,t,i,r,s){return e!==ue.dispose?Promise.reject("Wrong flow"):new Promise((function(e){var t=i.host.requireExplicitUnload,r={disposeStartTime:J(),forceAppUnload:t};i.state=x.Disposing;var a=function(){i.state=x.Disposed,e({completion:"success"})},c=function(e){i.dispose(),r.disposeEndTime=J(),function(e,t,i){if(i){var r=Number(i.hostMessageReceived);t.appUnloadStartTime&&!isNaN(r)&&(t.hostToAppPostMessageLatency=r-t.appUnloadStartTime);var s=Number(i.appMessageSent);!isNaN(s)&&t.appUnloadEndTime&&(t.appToHostPostMessageLatency=t.appUnloadEndTime-s);var a=Number(i.appUnloadStart),c=Number(i.appUnloadEnd);if(isNaN(a)||isNaN(c)||(t.appUnloadLatency=c-a),i.serverTimings){var u=i.serverTimings;for(var h in u)t["st-"+h.toString()]=u[h]}}e.logger.ULS.he(592524822,n.N,o.Info,"App disposed: "+JSON.stringify(t)),e.logger.ULS.flushOnClose()}(i,r,e),i.container?i.container.dispose(i.pendingReboot,t).then(a):a()};if(t){r.appUnloadStartTime=J();i.addActionHandler(he.ai,(function(e,t){r.appUnloadEndTime=J(),c(t)})),(s||new we(5e3)).subscribe((function(){i.state===x.Disposing&&(r.appUnloadTimedOut=!0,c())})),i.container&&i.container.postMessage(fe.Zi,void 0)}else c()}))};var $t=function(e,t,i,r,s){return e!==he.Wt?Promise.reject("Wrong flow"):new Promise((function(e){var t=!!i.container&&i.container.isTopFrameTrusted;i.logger.ULS.he(592445957,n.N,o.Info,"Top frame is trusted: "+t),i.container&&i.container.postMessage(fe.Wt,{isTopFrameTrusted:t}),e({completion:"success"})}))},Qt=function(e,t,i,r,s){return e!==he.vt?Promise.reject("Wrong flow"):new Promise((function(e){var s=t&&t.state?t.state:"Unknown";i.logger.ULS.he(592839750,n.N,o.Info,"Boot state: ["+s+"]"),r&&r.beforeComplete&&r.beforeComplete(s),e({completion:"success"})}))},Yt=function(e,t,i,n,o){return e!==ue.rename?Promise.reject("Wrong flow"):new Promise((function(e){var n=function(e,i){var n={completion:i.NewName===t.NewName?"success":"failure"};s(n)},r=function(e,t){s({completion:"failure"})},s=function(t){i.removeActionHandler(he.Ft,n),i.removeActionHandler(he.At,r),e(t)};i.addActionHandler(he.Ft,n),i.addActionHandler(he.At,r),(o||new we(5e3)).subscribe((function(){s({completion:"cancelled"})})),i.container&&i.container.postMessage(fe.Ni,t)}))},ei=function(e,t,i,n,o){return e!==ue.switchMode?Promise.reject("Wrong flow"):new Promise((function(e){var n=function(e,t){r({completion:"success"})},r=function(t){i.removeActionHandler(he.Bt,n),e(t)};i.addActionHandler(he.Bt,n),(o||new we(5e3)).subscribe((function(){r({completion:"cancelled"})})),i.container&&i.container.postMessage(fe.Xi,t)}))};function ti(e){}function ii(e){Tt(e.logger)}function ni(e){return e.appBaseUrl+"/x/"}function oi(e){var t,i=e.appUrl.toLowerCase().indexOf("_layouts/xlembed.aspx")>-1?"_layouts/xlembed.aspx":kt,n={},o={};_(n,"wdredirectionreason","Force_SingleStepBoot");var r=e.viewMode;r&&(r.hideToolbar&&_(n,"hvt","1"),r.hideEditUpsellDialog&&_(n,"hdeditdlg","1"));var s=e.bootParams;s&&s.isNewFile?(y(n,"unified"),_(n,"edit","1"),_(n,"new","1")):_(n,"instantedit","1"),_(o,ye.zn,JSON.stringify({HostInitializeDiagnostics:e.hostInitDiagnostics,ClientDiagnostics:e.clientDiagnostics})),_(o,ye.no,Intl.DateTimeFormat().resolvedOptions().timeZone);var a=e.rebootOverride;if(a){var c=a.mode;c&&("view"===(c=c.toLowerCase())?_(n,"wdforcedmode","View"):"edit"===c&&_(n,"wdforcedmode","Edit"))}var u=null===(t=null==e?void 0:e.file)||void 0===t?void 0:t.size;return u&&u>=52428800&&u<=104857600&&_(n,"ilf","1"),{appPageName:i,queryParamsOverrides:n,postDataOverrides:o}}function ri(e,t){at(t)&&ot(e.logger,e.container.formId,e.featureManager,e.sessionId)}var si,ai=function(){var e,t;return[(e={},e[ce.appReboot]=Lt,e[ce.boot]=Gt,e[ce.closeTab]=Kt,e[ce.createNew]=Xt,e[ce.dispose]=Zt,e[ce.frameTrust]=$t,e[ce.getHostKeyValue]=Be,e[ce.handleBootState]=Qt,e[ce.rename]=Yt,e[ce.setOverlayContent]=ke,e[ce.storeHostKeyValue]=je,e[ce.switchMode]=ei,e),(t={},t[ce.boot]={initializeAppContext:ti,beforePreload:ii,buildAppBasePath:ni,buildBootRequestParams:oi,beforeContainerBoot:ri,onBootSuccess:st},t[ce.handleBootState]={beforeComplete:rt},t)]};!function(e){e[e.NotSupported=0]="NotSupported",e[e.SameDocOnly=1]="SameDocOnly",e[e.AnyDoc=2]="AnyDoc",e[e.OtherMode=4]="OtherMode"}(si||(si={})),i.d(t,"Application",(function(){return ci})),i.d(t,"createApplication",(function(){return ui})),i.d(t,"DocRebootSupportMode",(function(){return si})),i.d(t,"CommandIds",(function(){return ue})),i.d(t,"EventIds",(function(){return le})),i.d(t,"createCancellationToken",(function(){return ge}));var ci=new Wt((function(e,t,i,n,o){return new Mt(e,t,i,n,o)}),{forceSingleStepBoot:!0,preloader:F(Dt,Jt)}),ui=function(e){var t={name:"Excel",preloader:F(Dt,Jt)};return new Ae(e,t,ai)}}});

