/* Office web application gallery insertion dialog JavaScript file */

/*
	Copyright (c) Microsoft Corporation.  All rights reserved.
*/


/*
    Your use of this file is governed by the Microsoft Services Agreement http://go.microsoft.com/fwlink/?LinkId=266419.

    This file also contains the following Promise implementation (with a few small modifications):
        * @overview es6-promise - a tiny implementation of Promises/A+.
        * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
        * @license   Licensed under MIT license
        *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
        * @version   2.3.0
*/
var __extends=this&&this.__extends||function(){var a=function(c,b){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,a){b.__proto__=a}||function(c,a){for(var b in a)if(a.hasOwnProperty(b))c[b]=a[b]};return a(c,b)};return function(c,b){a(c,b);function d(){this.constructor=c}c.prototype=b===null?Object.create(b):(d.prototype=b.prototype,new d)}}(),OfficeExt;(function(b){var a=function(){var a=true;function b(){}b.prototype.isMsAjaxLoaded=function(){var b="function",c="undefined";if(typeof Sys!==c&&typeof Type!==c&&Sys.StringBuilder&&typeof Sys.StringBuilder===b&&Type.registerNamespace&&typeof Type.registerNamespace===b&&Type.registerClass&&typeof Type.registerClass===b&&typeof Function._validateParams===b&&Sys.Serialization&&Sys.Serialization.JavaScriptSerializer&&typeof Sys.Serialization.JavaScriptSerializer.serialize===b)return a;else return false};b.prototype.loadMsAjaxFull=function(b){var a=(window.location.protocol.toLowerCase()==="https:"?"https:":"http:")+"//ajax.aspnetcdn.com/ajax/3.5/MicrosoftAjax.js";OSF.OUtil.loadScript(a,b)};Object.defineProperty(b.prototype,"msAjaxError",{"get":function(){var a=this;if(a._msAjaxError==null&&a.isMsAjaxLoaded())a._msAjaxError=Error;return a._msAjaxError},"set":function(a){this._msAjaxError=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,"msAjaxString",{"get":function(){var a=this;if(a._msAjaxString==null&&a.isMsAjaxLoaded())a._msAjaxString=String;return a._msAjaxString},"set":function(a){this._msAjaxString=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,"msAjaxDebug",{"get":function(){var a=this;if(a._msAjaxDebug==null&&a.isMsAjaxLoaded())a._msAjaxDebug=Sys.Debug;return a._msAjaxDebug},"set":function(a){this._msAjaxDebug=a},enumerable:a,configurable:a});return b}();b.MicrosoftAjaxFactory=a})(OfficeExt||(OfficeExt={}));var OsfMsAjaxFactory=new OfficeExt.MicrosoftAjaxFactory,OSF=OSF||{};(function(b){var a=function(){function a(a){this._internalStorage=a}a.prototype.getItem=function(a){try{return this._internalStorage&&this._internalStorage.getItem(a)}catch(b){return null}};a.prototype.setItem=function(b,a){try{this._internalStorage&&this._internalStorage.setItem(b,a)}catch(c){}};a.prototype.clear=function(){try{this._internalStorage&&this._internalStorage.clear()}catch(a){}};a.prototype.removeItem=function(a){try{this._internalStorage&&this._internalStorage.removeItem(a)}catch(b){}};a.prototype.getKeysWithPrefix=function(d){var b=[];try{for(var e=this._internalStorage&&this._internalStorage.length||0,a=0;a<e;a++){var c=this._internalStorage.key(a);c.indexOf(d)===0&&b.push(c)}}catch(f){}return b};return a}();b.SafeStorage=a})(OfficeExt||(OfficeExt={}));OSF.XdmFieldName={ConversationUrl:"ConversationUrl",AppId:"AppId"};OSF.TestFlightStart=1e3;OSF.TestFlightEnd=1009;OSF.FlightNames={UseOriginNotUrl:0,CheckReceiverOrigin:1,AddinEnforceHttps:2,FirstPartyAnonymousProxyReadyCheckTimeout:6,AddinRibbonIdAllowUnknown:9,ManifestParserDevConsoleLog:15,AllowStorageAccessByUserActivationOnIFrame:16,AddInsInSupportedIrmDocsIsEnabled:17,AddinActionDefinitionHybridMode:18,UseActionIdForUILessCommand:20,RequirementSetRibbonApiOnePointTwo:21,SetFocusToTaskpaneIsEnabled:22,OSFTestFlight1000:OSF.TestFlightStart,OSFTestFlight1001:OSF.TestFlightStart+1,OSFTestFlight1002:OSF.TestFlightStart+2,OSFTestFlight1003:OSF.TestFlightStart+3,OSFTestFlight1004:OSF.TestFlightStart+4,OSFTestFlight1005:OSF.TestFlightStart+5,OSFTestFlight1006:OSF.TestFlightStart+6,OSFTestFlight1007:OSF.TestFlightStart+7,OSFTestFlight1008:OSF.TestFlightStart+8,OSFTestFlight1009:OSF.TestFlightEnd};OSF.Flights=[];OSF.Settings={};OSF.WindowNameItemKeys={BaseFrameName:"baseFrameName",HostInfo:"hostInfo",XdmInfo:"xdmInfo",SerializerVersion:"serializerVersion",AppContext:"appContext",Flights:"flights"};OSF.OUtil=function(){var k="focus",j="https:",i="on",q="configurable",p="writable",h="enumerable",e="",f="undefined",c=false,a=true,l="string",m=2147483647,b=null,g="#",d=-1,w=d,C="&_xdm_Info=",z="&_serializer_version=",B="&_flights=",A="_xdm_",F="_serializer_version=",G="_flights=",s=g,y="&",n="class",v={},E=3e4,r=b,u=b,o=(new Date).getTime();function D(){var a=m*Math.random();a^=o^(new Date).getMilliseconds()<<Math.floor(Math.random()*(31-10));return a.toString(16)}function t(){if(!r){try{var a=window.sessionStorage}catch(c){a=b}r=new OfficeExt.SafeStorage(a)}return r}function x(e){for(var c=[],b=[],f=e.length,a,d=0;d<f;d++){a=e[d];if(a.tabIndex)if(a.tabIndex>0)b.push(a);else a.tabIndex===0&&c.push(a);else c.push(a)}b=b.sort(function(d,c){var a=d.tabIndex-c.tabIndex;if(a===0)a=b.indexOf(d)-b.indexOf(c);return a});return [].concat(b,c)}return {set_entropy:function(a){if(typeof a==l)for(var b=0;b<a.length;b+=4){for(var d=0,c=0;c<4&&b+c<a.length;c++)d=(d<<8)+a.charCodeAt(b+c);o^=d}else if(typeof a=="number")o^=a;else o^=m*Math.random();o&=m},extend:function(b,a){var c=function(){};c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b;b.uber=a.prototype;if(a.prototype.constructor===Object.prototype.constructor)a.prototype.constructor=a},setNamespace:function(b,a){if(a&&b&&!a[b])a[b]={}},unsetNamespace:function(b,a){if(a&&b&&a[b])delete a[b]},serializeSettings:function(b){var d={};for(var c in b){var a=b[c];try{if(JSON)a=JSON.stringify(a,function(a,b){return OSF.OUtil.isDate(this[a])?OSF.DDA.SettingsManager.DateJSONPrefix+this[a].getTime()+OSF.DDA.SettingsManager.DataJSONSuffix:b});else a=Sys.Serialization.JavaScriptSerializer.serialize(a);d[c]=a}catch(e){}}return d},deserializeSettings:function(c){var f={};c=c||{};for(var e in c){var b=c[e];try{if(JSON)b=JSON.parse(b,function(c,a){var b;if(typeof a===l&&a&&a.length>6&&a.slice(0,5)===OSF.DDA.SettingsManager.DateJSONPrefix&&a.slice(d)===OSF.DDA.SettingsManager.DataJSONSuffix){b=new Date(parseInt(a.slice(5,d)));if(b)return b}return a});else b=Sys.Serialization.JavaScriptSerializer.deserialize(b,a);f[e]=b}catch(g){}}return f},loadScript:function(f,g,h){if(f&&g){var k=window.document,d=v[f];if(!d){var e=k.createElement("script");e.type="text/javascript";d={loaded:c,pendingCallbacks:[g],timer:b};v[f]=d;var i=function(){if(d.timer!=b){clearTimeout(d.timer);delete d.timer}d.loaded=a;for(var e=d.pendingCallbacks.length,c=0;c<e;c++){var f=d.pendingCallbacks.shift();f()}},j=function(){delete v[f];if(d.timer!=b){clearTimeout(d.timer);delete d.timer}for(var c=d.pendingCallbacks.length,a=0;a<c;a++){var e=d.pendingCallbacks.shift();e()}};if(e.readyState)e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){e.onreadystatechange=b;i()}};else e.onload=i;e.onerror=j;h=h||E;d.timer=setTimeout(j,h);e.setAttribute("crossOrigin","anonymous");e.src=f;k.getElementsByTagName("head")[0].appendChild(e)}else if(d.loaded)g();else d.pendingCallbacks.push(g)}},loadCSS:function(c){if(c){var b=window.document,a=b.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=c;b.getElementsByTagName("head")[0].appendChild(a)}},parseEnum:function(b,c){var a=c[b.trim()];if(typeof a==f){OsfMsAjaxFactory.msAjaxDebug.trace("invalid enumeration string:"+b);throw OsfMsAjaxFactory.msAjaxError.argument("str")}return a},delayExecutionAndCache:function(){var a={calc:arguments[0]};return function(){if(a.calc){a.val=a.calc.apply(this,arguments);delete a.calc}return a.val}},getUniqueId:function(){w=w+1;return w.toString()},formatString:function(){var a=arguments,b=a[0];return b.replace(/{(\d+)}/gm,function(d,b){var c=parseInt(b,10)+1;return a[c]===undefined?"{"+b+"}":a[c]})},generateConversationId:function(){return [D(),D(),(new Date).getTime().toString()].join("_")},getFrameName:function(a){return A+a+this.generateConversationId()},addXdmInfoAsHash:function(b,a){return OSF.OUtil.addInfoAsHash(b,C,a,c)},addSerializerVersionAsHash:function(c,b){return OSF.OUtil.addInfoAsHash(c,z,b,a)},addFlightsAsHash:function(c,b){return OSF.OUtil.addInfoAsHash(c,B,b,a)},addInfoAsHash:function(b,g,c,i){b=b.trim()||e;var f=b.split(s),h=f.shift(),d=f.join(s),a;if(i)a=[g,encodeURIComponent(c),d].join(e);else a=[d,g,c].join(e);return [h,s,a].join(e)},parseHostInfoFromWindowName:function(a,b){return OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.HostInfo)},parseXdmInfo:function(b){var a=OSF.OUtil.parseXdmInfoWithGivenFragment(b,window.location.hash);if(!a)a=OSF.OUtil.parseXdmInfoFromWindowName(b,window.name);return a},parseXdmInfoFromWindowName:function(a,b){return OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.XdmInfo)},parseXdmInfoWithGivenFragment:function(a,b){return OSF.OUtil.parseInfoWithGivenFragment(C,A,c,a,b)},parseSerializerVersion:function(b){var a=OSF.OUtil.parseSerializerVersionWithGivenFragment(b,window.location.hash);if(isNaN(a))a=OSF.OUtil.parseSerializerVersionFromWindowName(b,window.name);return a},parseSerializerVersionFromWindowName:function(a,b){return parseInt(OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.SerializerVersion))},parseSerializerVersionWithGivenFragment:function(b,c){return parseInt(OSF.OUtil.parseInfoWithGivenFragment(z,F,a,b,c))},parseFlights:function(b){var a=OSF.OUtil.parseFlightsWithGivenFragment(b,window.location.hash);if(a.length==0)a=OSF.OUtil.parseFlightsFromWindowName(b,window.name);return a},checkFlight:function(a){return OSF.Flights&&OSF.Flights.indexOf(a)>=0},pushFlight:function(b){if(OSF.Flights.indexOf(b)<0){OSF.Flights.push(b);return a}return c},getBooleanSetting:function(a){return OSF.OUtil.getBooleanFromDictionary(OSF.Settings,a)},getBooleanFromDictionary:function(b,a){var d=b&&a&&b[a]!==undefined&&b[a]&&(typeof b[a]===l&&b[a].toUpperCase()==="TRUE"||typeof b[a]==="boolean"&&b[a]);return d!==undefined?d:c},parseFlightsFromWindowName:function(a,b){return OSF.OUtil.parseArrayWithDefault(OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.Flights))},parseFlightsWithGivenFragment:function(b,c){return OSF.OUtil.parseArrayWithDefault(OSF.OUtil.parseInfoWithGivenFragment(B,G,a,b,c))},parseArrayWithDefault:function(b){var a=[];try{a=JSON.parse(b)}catch(c){}if(!Array.isArray(a))a=[];return a},parseInfoFromWindowName:function(g,h,f){try{var a=JSON.parse(h),c=a!=b?a[f]:b,d=t();if(!g&&d&&a!=b){var e=a[OSF.WindowNameItemKeys.BaseFrameName]+f;if(c)d.setItem(e,c);else c=d.getItem(e)}return c}catch(i){return b}},parseInfoWithGivenFragment:function(m,j,k,i,l){var f=l.split(m),a=f.length>1?f[f.length-1]:b;if(k&&a!=b){if(a.indexOf(y)>=0)a=a.split(y)[0];a=decodeURIComponent(a)}var c=t();if(!i&&c){var e=window.name.indexOf(j);if(e>d){var g=window.name.indexOf(";",e);if(g==d)g=window.name.length;var h=window.name.substring(e,g);if(a)c.setItem(h,a);else a=c.getItem(h)}}return a},getConversationId:function(){var c=window.location.search,a=b;if(c){var d=c.indexOf("&");a=d>0?c.substring(1,d):c.substr(1);if(a&&a.charAt(a.length-1)==="="){a=a.substring(0,a.length-1);if(a)a=decodeURIComponent(a)}}return a},getInfoItems:function(b){var a=b.split("$");if(typeof a[1]==f)a=b.split("|");if(typeof a[1]==f)a=b.split("%7C");return a},getXdmFieldValue:function(f,d){var b=e,c=OSF.OUtil.parseXdmInfo(d);if(c){var a=OSF.OUtil.getInfoItems(c);if(a!=undefined&&a.length>=3)switch(f){case OSF.XdmFieldName.ConversationUrl:b=a[2];break;case OSF.XdmFieldName.AppId:b=a[1]}}return b},validateParamObject:function(f,e){var b=Function._validateParams(arguments,[{name:"params",type:Object,mayBeNull:c},{name:"expectedProperties",type:Object,mayBeNull:c},{name:"callback",type:Function,mayBeNull:a}]);if(b)throw b;for(var d in e){b=Function._validateParameter(f[d],e[d],d);if(b)throw b}},writeProfilerMark:function(a){if(window.msWriteProfilerMark){window.msWriteProfilerMark(a);OsfMsAjaxFactory.msAjaxDebug.trace(a)}},outputDebug:function(a){typeof OsfMsAjaxFactory!==f&&OsfMsAjaxFactory.msAjaxDebug&&OsfMsAjaxFactory.msAjaxDebug.trace&&OsfMsAjaxFactory.msAjaxDebug.trace(a)},defineNondefaultProperty:function(e,f,b,c){b=b||{};for(var g in c){var d=c[g];if(b[d]==undefined)b[d]=a}Object.defineProperty(e,f,b);return e},defineNondefaultProperties:function(c,a,d){a=a||{};for(var b in a)OSF.OUtil.defineNondefaultProperty(c,b,a[b],d);return c},defineEnumerableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[h])},defineEnumerableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[h])},defineMutableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[p,h,q])},defineMutableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[p,h,q])},finalizeProperties:function(e,d){d=d||{};for(var g=Object.getOwnPropertyNames(e),i=g.length,f=0;f<i;f++){var h=g[f],b=Object.getOwnPropertyDescriptor(e,h);if(!b.get&&!b.set)b.writable=d.writable||c;b.configurable=d.configurable||c;b.enumerable=d.enumerable||a;Object.defineProperty(e,h,b)}return e},mapList:function(a,c){var b=[];if(a)for(var d in a)b.push(c(a[d]));return b},listContainsKey:function(d,e){for(var b in d)if(e==b)return a;return c},listContainsValue:function(b,d){for(var e in b)if(d==b[e])return a;return c},augmentList:function(a,b){var d=a.push?function(c,b){a.push(b)}:function(c,b){a[c]=b};for(var c in b)d(c,b[c])},redefineList:function(a,b){for(var d in a)delete a[d];for(var c in b)a[c]=b[c]},isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},isFunction:function(a){return Object.prototype.toString.apply(a)==="[object Function]"},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},addEventListener:function(a,b,d){if(a.addEventListener)a.addEventListener(b,d,c);else if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&a.attachEvent)a.attachEvent(i+b,d);else a[i+b]=d},removeEventListener:function(a,d,e){if(a.removeEventListener)a.removeEventListener(d,e,c);else if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&a.detachEvent)a.detachEvent(i+d,e);else a[i+d]=b},getCookieValue:function(b){var a=RegExp(b+"[^;]+").exec(document.cookie);return a.toString().replace(/^[^=]+./,e)},xhrGet:function(f,e,c){var b;try{b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4)if(b.status==200)e(b.responseText);else c(b.status)};b.open("GET",f,a);b.send()}catch(d){c(d)}},xhrGetFull:function(h,f,g,c){var b,e=f;try{b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4)if(b.status==200)g(b,e);else c(b.status)};b.open("GET",h,a);b.send()}catch(d){c(d)}},encodeBase64:function(c){if(!c)return c;var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",m=[],b=[],i=0,k,h,j,d,f,g,a,n=c.length;do{k=c.charCodeAt(i++);h=c.charCodeAt(i++);j=c.charCodeAt(i++);a=0;d=k&255;f=k>>8;g=h&255;b[a++]=d>>2;b[a++]=(d&3)<<4|f>>4;b[a++]=(f&15)<<2|g>>6;b[a++]=g&63;if(!isNaN(h)){d=h>>8;f=j&255;g=j>>8;b[a++]=d>>2;b[a++]=(d&3)<<4|f>>4;b[a++]=(f&15)<<2|g>>6;b[a++]=g&63}if(isNaN(h))b[a-1]=64;else if(isNaN(j)){b[a-2]=64;b[a-1]=64}for(var l=0;l<a;l++)m.push(o.charAt(b[l]))}while(i<n);return m.join(e)},getSessionStorage:function(){return t()},getLocalStorage:function(){if(!u){try{var a=window.localStorage}catch(c){a=b}u=new OfficeExt.SafeStorage(a)}return u},convertIntToCssHexColor:function(b){var a=g+(Number(b)+16777216).toString(16).slice(-6);return a},attachClickHandler:function(a,b){a.onclick=function(){b()};a.ontouchend=function(a){b();a.preventDefault()}},getQueryStringParamValue:function(a,d){var f=Function._validateParams(arguments,[{name:"queryString",type:String,mayBeNull:c},{name:"paramName",type:String,mayBeNull:c}]);if(f){OsfMsAjaxFactory.msAjaxDebug.trace("OSF_Outil_getQueryStringParamValue: Parameters cannot be null.");return e}var b=new RegExp("[\\?&]"+d+"=([^&#]*)","i");if(!b.test(a)){OsfMsAjaxFactory.msAjaxDebug.trace("OSF_Outil_getQueryStringParamValue: The parameter is not found.");return e}return b.exec(a)[1]},getHostnamePortionForLogging:function(d){var f=Function._validateParams(arguments,[{name:"hostname",type:String,mayBeNull:c}]);if(f)return e;var a=d.split("."),b=a.length;if(b>=2)return a[b-2]+"."+a[b-1];else if(b==1)return a[0]},isiOS:function(){return window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?a:c},isChrome:function(){return window.navigator.userAgent.indexOf("Chrome")>0&&!OSF.OUtil.isEdge()},isEdge:function(){return window.navigator.userAgent.indexOf("Edge")>0},isIE:function(){return window.navigator.userAgent.indexOf("Trident")>0},isFirefox:function(){return window.navigator.userAgent.indexOf("Firefox")>0},startsWith:function(b,a,c){if(c)return b.substr(0,a.length)===a;else return b.startsWith(a)},containsPort:function(d,e,c,b){return this.startsWith(d,e+"//"+c+":"+b,a)||this.startsWith(d,c+":"+b,a)},getRedundandPortString:function(b,a){if(!b||!a)return e;if(a.protocol==j&&this.containsPort(b,j,a.hostname,"443"))return ":443";else if(a.protocol=="http:"&&this.containsPort(b,"http:",a.hostname,"80"))return ":80";return e},removeChar:function(a,b){if(b<a.length-1)return a.substring(0,b)+a.substring(b+1);else if(b==a.length-1)return a.substring(0,a.length-1);else return a},cleanUrlOfChar:function(a,c){for(var b=0;b<a.length;b++)if(a.charAt(b)===c)if(b+1>=a.length)return this.removeChar(a,b);else if(c==="/"){if(a.charAt(b+1)==="?"||a.charAt(b+1)===g)return this.removeChar(a,b)}else if(c==="?")if(a.charAt(b+1)===g)return this.removeChar(a,b);return a},cleanUrl:function(a){a=this.cleanUrlOfChar(a,"/");a=this.cleanUrlOfChar(a,"?");a=this.cleanUrlOfChar(a,g);if(a.substr(0,8)=="https://"){var b=a.indexOf(":443");if(b!=d)if(b==a.length-4||a.charAt(b+4)=="/"||a.charAt(b+4)=="?"||a.charAt(b+4)==g)a=a.substring(0,b)+a.substring(b+4)}else if(a.substr(0,7)=="http://"){var b=a.indexOf(":80");if(b!=d)if(b==a.length-3||a.charAt(b+3)=="/"||a.charAt(b+3)=="?"||a.charAt(b+3)==g)a=a.substring(0,b)+a.substring(b+3)}return a},parseUrl:function(g,i){var h=this;if(i===void 0)i=c;if(typeof g===f||!g)return undefined;var k="NotHttps",o="InvalidUrl",n=h.isIE(),b={protocol:undefined,hostname:undefined,host:undefined,port:undefined,pathname:undefined,search:undefined,hash:undefined,isPortPartOfUrl:undefined};try{if(n){var a=document.createElement("a");a.href=g;if(!a||!a.protocol||!a.host||!a.hostname||!a.href||h.cleanUrl(a.href).toLowerCase()!==h.cleanUrl(g).toLowerCase())throw o;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))if(i&&a.protocol!=j)throw new Error(k);var m=h.getRedundandPortString(g,a);b.protocol=a.protocol;b.hostname=a.hostname;b.port=m==e?a.port:e;b.host=m!=e?a.hostname:a.host;b.pathname=(n?"/":e)+a.pathname;b.search=a.search;b.hash=a.hash;b.isPortPartOfUrl=h.containsPort(g,a.protocol,a.hostname,a.port)}else{var d=new URL(g);if(d&&d.protocol&&d.host&&d.hostname){if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))if(i&&d.protocol!=j)throw new Error(k);b.protocol=d.protocol;b.hostname=d.hostname;b.port=d.port;b.host=d.host;b.pathname=d.pathname;b.search=d.search;b.hash=d.hash;b.isPortPartOfUrl=d.host.lastIndexOf(":"+d.port)==d.host.length-d.port.length-1}}}catch(l){if(l.message===k)throw l}return b},shallowCopy:function(a){if(a==b)return b;else if(!(a instanceof Object))return a;else if(Array.isArray(a)){for(var e=[],d=0;d<a.length;d++)e.push(a[d]);return e}else{var f=a.constructor();for(var c in a)if(a.hasOwnProperty(c))f[c]=a[c];return f}},createObject:function(a){var d=b;if(a){d={};for(var e=a.length,c=0;c<e;c++)d[a[c].name]=a[c].value}return d},addClass:function(a,b){if(!OSF.OUtil.hasClass(a,b)){var c=a.getAttribute(n);if(c)a.setAttribute(n,c+" "+b);else a.setAttribute(n,b)}},removeClass:function(b,c){if(OSF.OUtil.hasClass(b,c)){var a=b.getAttribute(n),d=new RegExp("(\\s|^)"+c+"(\\s|$)");a=a.replace(d,e);b.setAttribute(n,a)}},hasClass:function(c,b){var a=c.getAttribute(n);return a&&a.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},focusToFirstTabbable:function(e,i){var g,h=c,f,j=function(){h=a},l=function(c,a,b){if(a<0||a>c)return d;else if(a===0&&b)return d;else if(a===c-1&&!b)return d;if(b)return a-1;else return a+1};e=x(e);g=i?e.length-1:0;if(e.length===0)return b;while(!h&&g>=0&&g<e.length){f=e[g];window.focus();f.addEventListener(k,j);f.focus();f.removeEventListener(k,j);g=l(e.length,g,i);if(!h&&f===document.activeElement)h=a}if(h)return f;else return b},focusToNextTabbable:function(f,o,m){var j,e,h=c,g,l=function(){h=a},n=function(b,c){for(var a=0;a<b.length;a++)if(b[a]===c)return a;return d},i=function(c,a,b){if(a<0||a>c)return d;else if(a===0&&b)return d;else if(a===c-1&&!b)return d;if(b)return a-1;else return a+1};f=x(f);j=n(f,o);e=i(f.length,j,m);if(e<0)return b;while(!h&&e>=0&&e<f.length){g=f[e];g.addEventListener(k,l);g.focus();g.removeEventListener(k,l);e=i(f.length,e,m);if(!h&&g===document.activeElement)h=a}if(h)return g;else return b},isNullOrUndefined:function(d){if(typeof d===f)return a;if(d===b)return a;return c},stringEndsWith:function(d,b){if(!OSF.OUtil.isNullOrUndefined(d)&&!OSF.OUtil.isNullOrUndefined(b)){if(b.length>d.length)return c;if(d.substr(d.length-b.length)===b)return a}return c},hashCode:function(b){var a=0;if(!OSF.OUtil.isNullOrUndefined(b)){var c=0,d=b.length;while(c<d)a=(a<<5)-a+b.charCodeAt(c++)|0}return a},getValue:function(a,b){if(OSF.OUtil.isNullOrUndefined(a))return b;return a},externalNativeFunctionExists:function(a){return a==="unknown"||a!==f}}}();OSF.OUtil.Guid=function(){var a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return {generateNewGuid:function(){for(var c="",d=(new Date).getTime(),b=0;b<32&&d>0;b++){if(b==8||b==12||b==16||b==20)c+="-";c+=a[d%16];d=Math.floor(d/16)}for(;b<32;b++){if(b==8||b==12||b==16||b==20)c+="-";c+=a[Math.floor(Math.random()*16)]}return c}}}();try{(function(){OSF.Flights=OSF.OUtil.parseFlights(true)})()}catch(ex){}window.OSF=OSF;(function(g){var c="\n",d=true,a=null,b="undefined",j=function(){function c(){}c.isInstanceOfType=function(f,e){if(typeof e===b||e===a)return false;if(e instanceof f)return d;var c=e.constructor;if(!c||typeof c!=="function"||!c.__typeName||c.__typeName==="Object")c=Object;return !!(c===f)||c.__typeName&&f.__typeName&&c.__typeName===f.__typeName};return c}();g.MsAjaxTypeHelper=j;var h=function(){var e="Parameter name: {0}";function d(){}d.create=function(c,b){var a=new Error(c);a.message=c;if(b)for(var d in b)a[d]=b[d];a.popStackFrame();return a};d.parameterCount=function(a){var c="Sys.ParameterCountException: "+(a?a:"Parameter count mismatch."),b=d.create(c,{name:"Sys.ParameterCountException"});b.popStackFrame();return b};d.argument=function(a,g){var b="Sys.ArgumentException: "+(g?g:"Value does not fall within the expected range.");if(a)b+=c+f.format(e,a);var h=d.create(b,{name:"Sys.ArgumentException",paramName:a});h.popStackFrame();return h};d.argumentNull=function(a,g){var b="Sys.ArgumentNullException: "+(g?g:"Value cannot be null.");if(a)b+=c+f.format(e,a);var h=d.create(b,{name:"Sys.ArgumentNullException",paramName:a});h.popStackFrame();return h};d.argumentOutOfRange=function(i,g,j){var h="Sys.ArgumentOutOfRangeException: "+(j?j:"Specified argument was out of the range of valid values.");if(i)h+=c+f.format(e,i);if(typeof g!==b&&g!==a)h+=c+f.format("Actual value was {0}.",g);var k=d.create(h,{name:"Sys.ArgumentOutOfRangeException",paramName:i,actualValue:g});k.popStackFrame();return k};d.argumentType=function(h,g,b,i){var a="Sys.ArgumentTypeException: ";if(i)a+=i;else if(g&&b)a+=f.format("Object of type '{0}' cannot be converted to type '{1}'.",g.getName?g.getName():g,b.getName?b.getName():b);else a+="Object cannot be converted to the required type.";if(h)a+=c+f.format(e,h);var j=d.create(a,{name:"Sys.ArgumentTypeException",paramName:h,actualType:g,expectedType:b});j.popStackFrame();return j};d.argumentUndefined=function(a,g){var b="Sys.ArgumentUndefinedException: "+(g?g:"Value cannot be undefined.");if(a)b+=c+f.format(e,a);var h=d.create(b,{name:"Sys.ArgumentUndefinedException",paramName:a});h.popStackFrame();return h};d.invalidOperation=function(a){var c="Sys.InvalidOperationException: "+(a?a:"Operation is not valid due to the current state of the object."),b=d.create(c,{name:"Sys.InvalidOperationException"});b.popStackFrame();return b};return d}();g.MsAjaxError=h;var f=function(){function a(){}a.format=function(c){for(var b=[],a=1;a<arguments.length;a++)b[a-1]=arguments[a];var d=c;return d.replace(/{(\d+)}/gm,function(d,a){var c=parseInt(a,10);return b[c]===undefined?"{"+a+"}":b[c]})};a.startsWith=function(b,a){return b.substr(0,a.length)===a};return a}();g.MsAjaxString=f;var i=function(){function a(){}a.trace=function(){};return a}();g.MsAjaxDebug=i;if(!OsfMsAjaxFactory.isMsAjaxLoaded()){var e=function(b,d,c){if(b.__typeName===undefined||b.__typeName===a)b.__typeName=d;if(b.__class===undefined||b.__class===a)b.__class=c};e(Function,"Function",d);e(Error,"Error",d);e(Object,"Object",d);e(String,"String",d);e(Boolean,"Boolean",d);e(Date,"Date",d);e(Number,"Number",d);e(RegExp,"RegExp",d);e(Array,"Array",d);if(!Function.createCallback)Function.createCallback=function(b,a){var c=Function._validateParams(arguments,[{name:"method",type:Function},{name:"context",mayBeNull:d}]);if(c)throw c;return function(){var e=arguments.length;if(e>0){for(var d=[],c=0;c<e;c++)d[c]=arguments[c];d[e]=a;return b.apply(this,d)}return b.call(this,a)}};if(!Function.createDelegate)Function.createDelegate=function(b,c){var a=Function._validateParams(arguments,[{name:"instance",mayBeNull:d},{name:"method",type:Function}]);if(a)throw a;return function(){return c.apply(b,arguments)}};if(!Function._validateParams)Function._validateParams=function(i,g,e){var c,f=g.length;e=e||typeof e===b;c=Function._validateParameterCount(i,g,e);if(c){c.popStackFrame();return c}for(var d=0,k=i.length;d<k;d++){var h=g[Math.min(d,f-1)],j=h.name;if(h.parameterArray)j+="["+(d-f+1)+"]";else if(!e&&d>=f)break;c=Function._validateParameter(i[d],h,j);if(c){c.popStackFrame();return c}}return a};if(!Function._validateParameterCount)Function._validateParameterCount=function(m,f,l){var b,e,c=f.length,g=m.length;if(g<c){var i=c;for(b=0;b<c;b++){var j=f[b];if(j.optional||j.parameterArray)i--}if(g<i)e=d}else if(l&&g>c){e=d;for(b=0;b<c;b++)if(f[b].parameterArray){e=false;break}}if(e){var k=h.parameterCount();k.popStackFrame();return k}return a};if(!Function._validateParameter)Function._validateParameter=function(e,c,j){var d,i=c.type,n=!!c.integer,m=!!c.domElement,o=!!c.mayBeNull;d=Function._validateParameterType(e,i,n,m,o,j);if(d){d.popStackFrame();return d}var g=c.elementType,h=!!c.elementMayBeNull;if(i===Array&&typeof e!==b&&e!==a&&(g||!h))for(var l=!!c.elementInteger,k=!!c.elementDomElement,f=0;f<e.length;f++){var p=e[f];d=Function._validateParameterType(p,g,l,k,h,j+"["+f+"]");if(d){d.popStackFrame();return d}}return a};if(!Function._validateParameterType)Function._validateParameterType=function(d,e,j,i,h,f){var c,k;if(typeof d===b)if(h)return a;else{c=g.MsAjaxError.argumentUndefined(f);c.popStackFrame();return c}if(d===a)if(h)return a;else{c=g.MsAjaxError.argumentNull(f);c.popStackFrame();return c}if(e&&!g.MsAjaxTypeHelper.isInstanceOfType(e,d)){c=g.MsAjaxError.argumentType(f,typeof d,e);c.popStackFrame();return c}return a};if(!window.Type)window.Type=Function;if(!Type.registerNamespace)Type.registerNamespace=function(d){for(var c=d.split("."),b=window,a=0;a<c.length;a++){b[c[a]]=b[c[a]]||{};b=b[c[a]]}};if(!Type.prototype.registerClass)Type.prototype.registerClass=function(a){a={}};typeof Sys===b&&Type.registerNamespace("Sys");if(!Error.prototype.popStackFrame)Error.prototype.popStackFrame=function(){var d=this;if(arguments.length!==0)throw h.parameterCount();if(typeof d.stack===b||d.stack===a||typeof d.fileName===b||d.fileName===a||typeof d.lineNumber===b||d.lineNumber===a)return;var e=d.stack.split(c),g=e[0],j=d.fileName+":"+d.lineNumber;while(typeof g!==b&&g!==a&&g.indexOf(j)===-1){e.shift();g=e[0]}var i=e[1];if(typeof i===b||i===a)return;var f=i.match(/@(.*):(\d+)$/);if(typeof f===b||f===a)return;d.fileName=f[1];d.lineNumber=parseInt(f[2]);e.shift();d.stack=e.join(c)};OsfMsAjaxFactory.msAjaxError=h;OsfMsAjaxFactory.msAjaxString=f;OsfMsAjaxFactory.msAjaxDebug=i}})(OfficeExt||(OfficeExt={}));OSF.OUtil.setNamespace("Microsoft",window);OSF.OUtil.setNamespace("Office",Microsoft);OSF.OUtil.setNamespace("Common",Microsoft.Office);Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5};OSF.SerializerVersion={MsAjax:0,Browser:1};(function(b){function a(){return false}b.appSpecificCheckOrigin=a})(OfficeExt||(OfficeExt={}));Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5};Microsoft.Office.Common.InvokeResultCode={noError:0,errorInRequest:-1,errorHandlingRequest:-2,errorInResponse:-3,errorHandlingResponse:-4,errorHandlingRequestAccessDenied:-5,errorHandlingMethodCallTimedout:-6};Microsoft.Office.Common.MessageType={request:0,response:1};Microsoft.Office.Common.ActionType={invoke:0,registerEvent:1,unregisterEvent:2};Microsoft.Office.Common.ResponseType={forCalling:0,forEventing:1};Microsoft.Office.Common.HostTrustStatus={unknown:0,untrusted:1,nothttps:2,trusted:3};Microsoft.Office.Common.MethodObject=function(c,b,a){this._method=c;this._invokeType=b;this._blockingOthers=a};Microsoft.Office.Common.MethodObject.prototype={getMethod:function(){return this._method},getInvokeType:function(){return this._invokeType},getBlockingFlag:function(){return this._blockingOthers}};Microsoft.Office.Common.EventMethodObject=function(b,a){this._registerMethodObject=b;this._unregisterMethodObject=a};Microsoft.Office.Common.EventMethodObject.prototype={getRegisterMethodObject:function(){return this._registerMethodObject},getUnregisterMethodObject:function(){return this._unregisterMethodObject}};Microsoft.Office.Common.ServiceEndPoint=function(c){var a=this,b=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:false}]);if(b)throw b;a._methodObjectList={};a._eventHandlerProxyList={};a._Id=c;a._conversations={};a._policyManager=null;a._appDomains={};a._onHandleRequestError=null};Microsoft.Office.Common.ServiceEndPoint.prototype={registerMethod:function(g,h,b,e){var c="invokeType",a=false,d=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:a},{name:"method",type:Function,mayBeNull:a},{name:c,type:Number,mayBeNull:a},{name:"blockingOthers",type:Boolean,mayBeNull:a}]);if(d)throw d;if(b!==Microsoft.Office.Common.InvokeType.async&&b!==Microsoft.Office.Common.InvokeType.sync)throw OsfMsAjaxFactory.msAjaxError.argument(c);var f=new Microsoft.Office.Common.MethodObject(h,b,e);this._methodObjectList[g]=f},unregisterMethod:function(b){var a=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:false}]);if(a)throw a;delete this._methodObjectList[b]},registerEvent:function(f,d,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a}]);if(b)throw b;var e=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(d,Microsoft.Office.Common.InvokeType.syncRegisterEvent,a),new Microsoft.Office.Common.MethodObject(c,Microsoft.Office.Common.InvokeType.syncUnregisterEvent,a));this._methodObjectList[f]=e},registerEventEx:function(h,f,d,e,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"registerMethodInvokeType",type:Number,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a},{name:"unregisterMethodInvokeType",type:Number,mayBeNull:a}]);if(b)throw b;var g=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(f,d,a),new Microsoft.Office.Common.MethodObject(e,c,a));this._methodObjectList[h]=g},unregisterEvent:function(b){var a=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:false}]);if(a)throw a;this.unregisterMethod(b)},registerConversation:function(c,g,b,f){var d="appDomains",a=true,e=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false},{name:"conversationUrl",type:String,mayBeNull:false,optional:a},{name:d,type:Object,mayBeNull:a,optional:a},{name:"serializerVersion",type:Number,mayBeNull:a,optional:a}]);if(e)throw e;if(b){if(!(b instanceof Array))throw OsfMsAjaxFactory.msAjaxError.argument(d);this._appDomains[c]=b}this._conversations[c]={url:g,serializerVersion:f}},unregisterConversation:function(b){var a=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false}]);if(a)throw a;delete this._conversations[b]},setPolicyManager:function(a){var b="policyManager",c=Function._validateParams(arguments,[{name:b,type:Object,mayBeNull:false}]);if(c)throw c;if(!a.checkPermission)throw OsfMsAjaxFactory.msAjaxError.argument(b);this._policyManager=a},getPolicyManager:function(){return this._policyManager},dispose:function(){var a=null,b=this;b._methodObjectList=a;b._eventHandlerProxyList=a;b._Id=a;b._conversations=a;b._policyManager=a;b._appDomains=a;b._onHandleRequestError=a}};Microsoft.Office.Common.ClientEndPoint=function(g,c,h,e){var d="targetWindow",b=false,a=this,f=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:b},{name:d,mayBeNull:b},{name:"targetUrl",type:String,mayBeNull:b},{name:"serializerVersion",type:Number,mayBeNull:true,optional:true}]);if(f)throw f;try{if(!c.postMessage)throw OsfMsAjaxFactory.msAjaxError.argument(d)}catch(i){if(!Object.prototype.hasOwnProperty.call(c,"postMessage"))throw OsfMsAjaxFactory.msAjaxError.argument(d)}a._conversationId=g;a._targetWindow=c;a._targetUrl=h;a._callingIndex=0;a._callbackList={};a._eventHandlerList={};if(e!=null)a._serializerVersion=e;else a._serializerVersion=OSF.SerializerVersion.Browser;a._checkReceiverOriginAndRun=null;a._hostTrustCheckStatus=Microsoft.Office.Common.HostTrustStatus.unknown;a._checkStatusLogged=b};Microsoft.Office.Common.ClientEndPoint.prototype={invoke:function(d,c,b){var f=Function._validateParams(arguments,[{name:"targetMethodName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"param",mayBeNull:true}]);if(f)throw f;var a=this,e=function(){var e=a._callingIndex++,j=new Date,f={callback:c,createdOn:j.getTime()};if(b&&typeof b==="object"&&typeof b.__timeout__==="number"){f.timeout=b.__timeout__;delete b.__timeout__}a._callbackList[e]=f;try{if(a._hostTrustCheckStatus!==Microsoft.Office.Common.HostTrustStatus.trusted)if(d!=="ContextActivationManager_getAppContextAsync")throw"Access Denied";var h=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.invoke,a._conversationId,e,b),i=Microsoft.Office.Common.MessagePackager.envelope(h,a._serializerVersion);a._targetWindow.postMessage(i,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(g){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,g)}finally{delete a._callbackList[e]}}};if(a._checkReceiverOriginAndRun)a._checkReceiverOriginAndRun(e);else{a._hostTrustCheckStatus=Microsoft.Office.Common.HostTrustStatus.trusted;e()}},registerForEvent:function(d,g,c,i){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"eventHandler",type:Function,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,k=new Date;a._callbackList[b]={callback:c,createdOn:k.getTime()};try{var h=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.registerEvent,a._conversationId,b,i),j=Microsoft.Office.Common.MessagePackager.envelope(h,a._serializerVersion);a._targetWindow.postMessage(j,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer();a._eventHandlerList[d]=g}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}},unregisterForEvent:function(d,c,h){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,j=new Date;a._callbackList[b]={callback:c,createdOn:j.getTime()};try{var g=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.unregisterEvent,a._conversationId,b,h),i=Microsoft.Office.Common.MessagePackager.envelope(g,a._serializerVersion);a._targetWindow.postMessage(i,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}finally{delete a._eventHandlerList[d]}}};Microsoft.Office.Common.XdmCommunicationManager=function(){var n="serviceEndPointId",d=true,e="a",c="null",m="channel is not ready.",h="conversationId",l="Unknown conversation Id.",a=false,b=null,s=[],r=b,i=b,w=10,k=a,j=b,C=2e3,v=65000,y=v,g={},f={},A=a;function D(b){for(var a in g)if(g[a]._conversations[b])return g[a];OsfMsAjaxFactory.msAjaxDebug.trace(l);throw OsfMsAjaxFactory.msAjaxError.argument(h)}function E(b){var a=f[b];!a&&OsfMsAjaxFactory.msAjaxDebug.trace(l);return a}function H(e,c){var a=e._methodObjectList[c._actionName];if(!a){OsfMsAjaxFactory.msAjaxDebug.trace("The specified method is not registered on service endpoint:"+c._actionName);throw OsfMsAjaxFactory.msAjaxError.argument("messageObject")}var d=b;if(c._actionType===Microsoft.Office.Common.ActionType.invoke)d=a;else if(c._actionType===Microsoft.Office.Common.ActionType.registerEvent)d=a.getRegisterMethodObject();else d=a.getUnregisterMethodObject();return d}function K(a){s.push(a)}function J(){if(i!==b){if(!k)if(s.length>0){var a=s.shift();x(a)}else{clearInterval(i);i=b}}else OsfMsAjaxFactory.msAjaxDebug.trace(m)}function x(a){k=a.getInvokeBlockingFlag();a.invoke();r=(new Date).getTime()}function G(){if(j){var c,e=0,i=new Date,d;for(var h in f){c=f[h];for(var g in c._callbackList){var a=c._callbackList[g];d=a.timeout?a.timeout:y;if(d>=0&&Math.abs(i.getTime()-a.createdOn)>=d)try{a.callback&&a.callback(Microsoft.Office.Common.InvokeResultCode.errorHandlingMethodCallTimedout,b)}finally{delete c._callbackList[g]}else e++}}if(e===0){clearInterval(j);j=b}}else OsfMsAjaxFactory.msAjaxDebug.trace(m)}function F(){k=a}function I(b){if(window.addEventListener)window.addEventListener("message",b,a);else if(navigator.userAgent.indexOf("MSIE")>-1&&window.attachEvent)window.attachEvent("onmessage",b);else{OsfMsAjaxFactory.msAjaxDebug.trace("Browser doesn't support the required API.");throw OsfMsAjaxFactory.msAjaxError.argument("Browser")}}function L(d,b){var f=a;if(!d||!b||d===c||b===c||!d.length||!b.length)return f;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))f=u(d,b);else{var h,g;h=document.createElement(e);g=document.createElement(e);h.href=d;g.href=b;f=t(h,g)}return f}function p(b,d){var f=a;if(!d||d===c||!d.length||!b||!(b instanceof Array)||!b.length)return f;var i=document.createElement(e),h=document.createElement(e);i.href=d;for(var g=0;g<b.length&&!f;g++)if(b[g].indexOf("://")!==-1)if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))f=u(d,b[g]);else{h.href=b[g];f=t(i,h)}return f}function q(b){if(!b||b===c)return a;var d=["^office-int\\.com$","^officeapps\\.live-int\\.com$","^.*\\.dod\\.online\\.office365\\.us$","^.*\\.gov\\.online\\.office365\\.us$","^.*\\.officeapps\\.live\\.com$","^.*\\.officeapps\\.live-int\\.com$","^.*\\.officeapps-df\\.live\\.com$","^.*\\.online\\.office\\.de$","^.*\\.partner\\.officewebapps\\.cn$","^.*\\.office\\.net$","^"+document.domain.replace(new RegExp("\\.","g"),"\\.")+"$"],e=new RegExp(d.join("|"));return e.test(b)}function o(h,i){if(!h||!i||h===c||i===c)return a;var b,f;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps)){b=OSF.OUtil.parseUrl(h,d);f=OSF.OUtil.parseUrl(i,d)}else{b=document.createElement(e);b.href=h;f=document.createElement(e);f.href=i}var n=b.protocol===f.protocol,o=b.port===f.port,j=f.hostname,g=b.hostname,k=j===g,l=a;if(!k&&j.length>g.length+1)l=j.slice(-(g.length+1))==="."+g;var m=k||l;return o&&n&&m}function u(c,e){var a=OSF.OUtil.parseUrl(c,d),b=OSF.OUtil.parseUrl(e,d);return t(a,b)}function t(a,b){return a.hostname==b.hostname&&a.protocol==b.protocol&&z(a,b)}function z(a,b){var d="80",c="443";return a.port==b.port||a.port==""&&a.protocol=="http:"&&b.port==d||a.port==""&&a.protocol=="https:"&&b.port==c||b.port==""&&b.protocol=="http:"&&a.port==d||b.port==""&&b.protocol=="https:"&&a.port==c}function M(g){var t="Access Denied";if(!OSF)return;if(g.data!=""){var f,h=OSF.SerializerVersion.Browser,Q=g.data;try{f=Microsoft.Office.Common.MessagePackager.unenvelope(Q,OSF.SerializerVersion.Browser);h=f._serializerVersion!=b?f._serializerVersion:h}catch(m){return}if(f._messageType===Microsoft.Office.Common.MessageType.request){var C=g.origin==b||g.origin===c?f._origin:g.origin;try{var j=D(f._conversationId),s=j._conversations[f._conversationId];h=s.serializerVersion!=b?s.serializerVersion:h;var z=[s.url].concat(j._appDomains[f._conversationId]);if(!p(z,g.origin))if(!OfficeExt.appSpecificCheckOrigin(z,g,f._origin,p)){var P=o(s.url,g.origin);if(!P)throw"Failed origin check"}var u=f._data!=b?f._data:{};u.SecurityOrigin=g.origin;var B=j.getPolicyManager();if(B&&!B.checkPermission(f._conversationId,f._actionName,u))throw t;var T=H(j,f),O=new Microsoft.Office.Common.InvokeCompleteCallback(g.source,C,f._actionName,f._conversationId,f._correlationId,F,h),M=new Microsoft.Office.Common.Invoker(T,u,O,j._eventHandlerProxyList,f._conversationId,f._actionName,h),G=d;if(i==b)if((r==b||(new Date).getTime()-r>w)&&!k){x(M);G=a}else i=setInterval(J,w);G&&K(M)}catch(m){j&&j._onHandleRequestError&&j._onHandleRequestError(f,m);var I=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequest;if(m==t)I=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequestAccessDenied;var S=new Microsoft.Office.Common.Response(f._actionName,f._conversationId,f._correlationId,I,Microsoft.Office.Common.ResponseType.forCalling,m),R=Microsoft.Office.Common.MessagePackager.envelope(S,h),A=a;try{A=!!(g.source&&g.source.postMessage)}catch(m){}var n=a;if(window.location.href&&g.origin&&g.origin!==c&&o(window.location.href,g.origin))n=d;else if(g.origin&&g.origin!==c)if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps)){var U=OSF.OUtil.parseUrl(g.origin,d).hostname;n=q(U)}else{var N=document.createElement(e);N.href=g.origin;n=q(N.hostname)}A&&n&&g.source.postMessage(R,C)}}else if(f._messageType===Microsoft.Office.Common.MessageType.response){var l=E(f._conversationId);if(!l)return;l._serializerVersion=h;if(!L(l._targetUrl,g.origin))throw"Failed orgin check";if(f._responseType===Microsoft.Office.Common.ResponseType.forCalling){var v=l._callbackList[f._correlationId];if(v)try{v.callback&&v.callback(f._errorCode,f._data)}finally{delete l._callbackList[f._correlationId]}}else{var y=l._eventHandlerList[f._actionName];y!==undefined&&y!==b&&y(f._data)}}else return}}function B(){if(!A){I(M);A=d}}return {connect:function(b,d,e,c){var a=f[b];if(!a){B();a=new Microsoft.Office.Common.ClientEndPoint(b,d,e,c);f[b]=a}return a},getClientEndPoint:function(c){var b=Function._validateParams(arguments,[{name:h,type:String,mayBeNull:a}]);if(b)throw b;return f[c]},createServiceEndPoint:function(a){B();var b=new Microsoft.Office.Common.ServiceEndPoint(a);g[a]=b;return b},getServiceEndPoint:function(c){var b=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a}]);if(b)throw b;return g[c]},deleteClientEndPoint:function(c){var b=Function._validateParams(arguments,[{name:h,type:String,mayBeNull:a}]);if(b)throw b;delete f[c]},deleteServiceEndPoint:function(c){var b=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a}]);if(b)throw b;delete g[c]},checkUrlWithAppDomains:function(a,b){return p(a,b)},isTargetSubdomainOfSourceLocation:function(a,b){return o(a,b)},_setMethodTimeout:function(b){var c=Function._validateParams(arguments,[{name:"methodTimeout",type:Number,mayBeNull:a}]);if(c)throw c;y=b<=0?v:b},_startMethodTimeoutTimer:function(){if(!j)j=setInterval(G,C)},isHostNameValidWacDomain:function(a){return q(a)},_hasSamePort:function(a,b){return z(a,b)}}}();Microsoft.Office.Common.Message=function(g,h,e,f,c){var b=false,a=this,d=Function._validateParams(arguments,[{name:"messageType",type:Number,mayBeNull:b},{name:"actionName",type:String,mayBeNull:b},{name:"conversationId",type:String,mayBeNull:b},{name:"correlationId",mayBeNull:b},{name:"data",mayBeNull:true,optional:true}]);if(d)throw d;a._messageType=g;a._actionName=h;a._conversationId=e;a._correlationId=f;a._origin=window.location.origin;if(typeof c=="undefined")a._data=null;else a._data=c};Microsoft.Office.Common.Message.prototype={getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getOrigin:function(){return this._origin},getData:function(){return this._data},getMessageType:function(){return this._messageType}};Microsoft.Office.Common.Request=function(c,d,a,b,e){Microsoft.Office.Common.Request.uber.constructor.call(this,Microsoft.Office.Common.MessageType.request,c,a,b,e);this._actionType=d};OSF.OUtil.extend(Microsoft.Office.Common.Request,Microsoft.Office.Common.Message);Microsoft.Office.Common.Request.prototype.getActionType=function(){return this._actionType};Microsoft.Office.Common.Response=function(d,a,b,e,c,f){Microsoft.Office.Common.Response.uber.constructor.call(this,Microsoft.Office.Common.MessageType.response,d,a,b,f);this._errorCode=e;this._responseType=c};OSF.OUtil.extend(Microsoft.Office.Common.Response,Microsoft.Office.Common.Message);Microsoft.Office.Common.Response.prototype.getErrorCode=function(){return this._errorCode};Microsoft.Office.Common.Response.prototype.getResponseType=function(){return this._responseType};Microsoft.Office.Common.MessagePackager={envelope:function(a){if(typeof a==="object")a._serializerVersion=OSF.SerializerVersion.Browser;return JSON.stringify(a)},unenvelope:function(a){return JSON.parse(a)}};Microsoft.Office.Common.ResponseSender=function(f,i,k,g,h,j,e){var c=false,a=this,d=Function._validateParams(arguments,[{name:"requesterWindow",mayBeNull:c},{name:"requesterUrl",type:String,mayBeNull:c},{name:"actionName",type:String,mayBeNull:c},{name:"conversationId",type:String,mayBeNull:c},{name:"correlationId",mayBeNull:c},{name:"responsetype",type:Number,maybeNull:c},{name:"serializerVersion",type:Number,maybeNull:true,optional:true}]);if(d)throw d;a._requesterWindow=f;a._requesterUrl=i;a._actionName=k;a._conversationId=g;a._correlationId=h;a._invokeResultCode=Microsoft.Office.Common.InvokeResultCode.noError;a._responseType=j;var b=a;a._send=function(f){try{var d=new Microsoft.Office.Common.Response(b._actionName,b._conversationId,b._correlationId,b._invokeResultCode,b._responseType,f),c=Microsoft.Office.Common.MessagePackager.envelope(d,e);b._requesterWindow.postMessage(c,b._requesterUrl)}catch(a){OsfMsAjaxFactory.msAjaxDebug.trace("ResponseSender._send error:"+a.message)}}};Microsoft.Office.Common.ResponseSender.prototype={getRequesterWindow:function(){return this._requesterWindow},getRequesterUrl:function(){return this._requesterUrl},getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getSend:function(){return this._send},setResultCode:function(a){this._invokeResultCode=a}};Microsoft.Office.Common.InvokeCompleteCallback=function(e,h,i,f,g,d,c){var b=this;Microsoft.Office.Common.InvokeCompleteCallback.uber.constructor.call(b,e,h,i,f,g,Microsoft.Office.Common.ResponseType.forCalling,c);b._postCallbackHandler=d;var a=b;b._send=function(g,b){if(b!=undefined)a._invokeResultCode=b;try{var f=new Microsoft.Office.Common.Response(a._actionName,a._conversationId,a._correlationId,a._invokeResultCode,a._responseType,g),e=Microsoft.Office.Common.MessagePackager.envelope(f,c);a._requesterWindow.postMessage(e,a._requesterUrl);a._postCallbackHandler()}catch(d){OsfMsAjaxFactory.msAjaxDebug.trace("InvokeCompleteCallback._send error:"+d.message)}}};OSF.OUtil.extend(Microsoft.Office.Common.InvokeCompleteCallback,Microsoft.Office.Common.ResponseSender);Microsoft.Office.Common.Invoker=function(i,j,e,f,h,k,g){var c=true,b=false,a=this,d=Function._validateParams(arguments,[{name:"methodObject",mayBeNull:b},{name:"paramValue",mayBeNull:c},{name:"invokeCompleteCallback",mayBeNull:b},{name:"eventHandlerProxyList",mayBeNull:c},{name:"conversationId",type:String,mayBeNull:b},{name:"eventName",type:String,mayBeNull:b},{name:"serializerVersion",type:Number,mayBeNull:c,optional:c}]);if(d)throw d;a._methodObject=i;a._param=j;a._invokeCompleteCallback=e;a._eventHandlerProxyList=f;a._conversationId=h;a._eventName=k;a._serializerVersion=g};Microsoft.Office.Common.Invoker.prototype={invoke:function(){var a=this;try{var b;switch(a._methodObject.getInvokeType()){case Microsoft.Office.Common.InvokeType.async:a._methodObject.getMethod()(a._param,a._invokeCompleteCallback.getSend());break;case Microsoft.Office.Common.InvokeType.sync:b=a._methodObject.getMethod()(a._param);a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncRegisterEvent:var d=a._createEventHandlerProxyObject(a._invokeCompleteCallback);b=a._methodObject.getMethod()(d.getSend(),a._param);a._eventHandlerProxyList[a._conversationId+a._eventName]=d.getSend();a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncUnregisterEvent:var g=a._eventHandlerProxyList[a._conversationId+a._eventName];b=a._methodObject.getMethod()(g,a._param);delete a._eventHandlerProxyList[a._conversationId+a._eventName];a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.asyncRegisterEvent:var c=a._createEventHandlerProxyObject(a._invokeCompleteCallback);a._methodObject.getMethod()(c.getSend(),a._invokeCompleteCallback.getSend(),a._param);a._eventHandlerProxyList[a._callerId+a._eventName]=c.getSend();break;case Microsoft.Office.Common.InvokeType.asyncUnregisterEvent:var f=a._eventHandlerProxyList[a._callerId+a._eventName];a._methodObject.getMethod()(f,a._invokeCompleteCallback.getSend(),a._param);delete a._eventHandlerProxyList[a._callerId+a._eventName]}}catch(e){a._invokeCompleteCallback.setResultCode(Microsoft.Office.Common.InvokeResultCode.errorInResponse);a._invokeCompleteCallback.getSend()(e)}},getInvokeBlockingFlag:function(){return this._methodObject.getBlockingFlag()},_createEventHandlerProxyObject:function(a){return new Microsoft.Office.Common.ResponseSender(a.getRequesterWindow(),a.getRequesterUrl(),a.getActionName(),a.getConversationId(),a.getCorrelationId(),Microsoft.Office.Common.ResponseType.forEventing,this._serializerVersion)}};OSF.OneDriveOAuth=function(){var c="We had a problem connecting to OneDrive. Please try again.",a=null,l="000000004C16753E",j="https://login.live.com/oauth20_authorize.srf";if(window.location.href.indexOf("live-int.com")!=-1){l="00000000604C4E61";j="https://login.live-int.com/oauth20_authorize.srf"}var s="onedrive.readonly wl.signin",i="onedrive_appcatalog_access_token",r="http://datatest1.azurewebsites.net/odauth/callback-redirect.html",g=["http://datatest1.azurewebsites.net"],h=a,k=a,b=a,d=a,e=false;function f(){for(var e=i+"=",d=document.cookie.split(";"),c=0;c<d.length;++c){var b=d[c];while(b.charAt(0)==" ")b=b.substring(1);if(b.indexOf(e)==0)return b.substring(e.length,b.length)}return a}function m(b){var a=document.createElement("iframe");a.setAttribute("src",b);a.setAttribute("height","0");a.setAttribute("width","0");document.body.appendChild(a)}function p(){var a=document.createElement("script");a.setAttribute("type","text/javascript");a.text="OSF.OUtil.addEventListener(window, 'message', OSF.OneDriveOAuth.receiveToken)";document.getElementsByTagName("head")[0].appendChild(a)}function n(){d=window.setTimeout(function(){OSF.OneDriveOAuth.getAccessTokenFromCookie()==a&&b()},1e4);p();var c=j+"?client_id="+l+"&scope="+encodeURIComponent(s)+"&response_type=token&redirect_uri="+encodeURIComponent(r+"?host_callback_uri="+h);m(c)}function o(h){var g=a;try{g=JSON.parse('{"'+h.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(b,a){return b===""?a:decodeURIComponent(a)})}catch(j){b("We encountered a problem getting auth response from live.com.");return}var f=g["access_token"];if(f===""||f==a){b(c);return}clearTimeout(d);var i=parseInt(g["expires_in"]);q(f,i);e=false;k(f)}function q(d,c){var a=new Date;a.setTime(a.getTime()+c*1e3);var b=i+"="+d+"; path=/; expires="+a.toUTCString();if(document.location.protocol.toLowerCase()=="https")b=b+";secure";document.cookie=b}return {setHostCallbackUri:function(a){h=a},getAccessTokenFromCookie:function(){return f()},getAccessToken:function(c,h){k=c;b=h;var g=f();if(g!=a){c(g);return}if(e==false){e=true;n()}else d=window.setTimeout(function(){if(OSF.OneDriveOAuth.getAccessTokenFromCookie()==a)b();else c()},1e4)},receiveToken:function(f){for(var e=0;e<g.length;++e)if(f.origin==g[e]){var d=f.data;if(d===""||d==a||d===undefined){b(c);return}o(d);break}}}}();OSF.DataPointNames={AppManagementMenu:"appmanagementmenu",InsertionDialogSession:"insertiondialogsession",UploadFileDevCatelog:"uploadfiledevcatelog",UploadFileDevCatalogUsage:"uploadfiledevcatalogusage"};OSF.AppManagementAction={Cancel:0,AppDetails:1,RateReview:2,Remove:3};OSF.RLID={Recommend:"rlidMktplcOSFRecs",Landing:"rlidMktplcOSFRedirect",ManageApps:"rlidMktplcBillingMgmt"};OSF.UploadFileDevCatelogAction={OpenUploadFileDialog:0,Install:1,Cancel:2};OSF.OUtil.normalizeAppVersion=function(b){for(var d=b.split("."),a=b,c=0;c<4-d.length;c++)a+=".0";return a};var WEF;(function(b){var a="";b.AGAVE_DEFAULT_ICON=a;b.PageTypeEnum={ManageApps:0,Recommendation:2,Landing:3,EndNode:4,Takedown:5,TermsAndConditions:6,RateAndReview:7,AppSourceLandingPage:8};b.PageStoreId={Recommendation:"{98143890-AC66-440E-A448-ED8771A02D52}"};b.StoreTypeEnum={MarketPlace:0,Catalog:1,Exchange:3,FileShare:4,Developer:5,Recommendation:6,ThisDocument:8,OneDrive:9,ExchangeCorporateCatalog:10};b.OmexCatalogStoreId="Omex";b.SPCatalogStoreId="SPCatalog";b.LegacyExchangeCatalogStoreId="Exchange";b.FileSystemStoreId="Filesystem";b.RegistryStoreId="Registry";b.ExchangeCatalogStoreId="EXCatalog";function c(c){if(c!=null&&c!=a)switch(c){case b.OmexCatalogStoreId:return b.StoreTypeEnum.MarketPlace;case b.SPCatalogStoreId:return b.StoreTypeEnum.Catalog;case b.LegacyExchangeCatalogStoreId:return b.StoreTypeEnum.Exchange;case b.FileSystemStoreId:return b.StoreTypeEnum.FileShare;case b.ExchangeCatalogStoreId:return b.StoreTypeEnum.ExchangeCorporateCatalog}return null}b.getStoreTypeFromStoreId=c;b.AuthType={Anonymous:"0",MSA:"1",OrgId:"2",ADAL:"3"};b.storeTypes={};b.InvokeResultCode={S_OK:0,E_REQUEST_TIME_OUT:-2147471590,E_USER_NOT_SIGNED_IN:-2147208619,E_CATALOG_ACCESS_DENIED:-2147471591,E_CATALOG_REQUEST_FAILED:-2147471589,E_OEM_NO_NETWORK_CONNECTION:-2147208640,E_PROVIDER_NOT_REGISTERED:-2147208617,E_OEM_CACHE_SHUTDOWN:-2147208637,E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR:-2147209295,E_EXCHANGE_TOO_MANY_REQUESTS:-2147208849,E_CATALOG_NO_APPS:-1,S_HIDE_PROVIDER:10,E_OEM_REMOVED_FAILED:-2147209421};b.OemStoreStatus={ossNotReady:0,ossSignInRequired:1,ossRegisteredButNotReady:2,ossRegisteredReady:3,ossUnregistered:4};b.ActionButtonGroups={InsertCancel:0,ThisDocument:1,None:2};b.OmexMessage={CancelDialog:"ESC_KEY",PreloadManifest:"PRELOAD_MANIFEST",RefreshRequired:"REFRESH_REQUIRED",WindowOpen:"WINDOW_OPEN"};var e;(function(a){var b="ATTRIBUTE";a[a["ELEMENT"]=1]="ELEMENT";a[a[b]=2]=b;a[a["TEXT"]=3]="TEXT"})(e=b.NodeType||(b.NodeType={}));var d=function(){function b(){var c=false,b=this;b.displayName=a;b.description=a;b.providerName=a;b.id=a;b.width=0;b.height=0;b.iconUrl=a;b.targetType=1;b.appVersion=a;b.assetId=a;b.assetStoreId=a;b.storeId=a;b.appEndNodeUrl=a;b.rateReviewUrl=a;b.authType=a;b.isAppCommandAddin=c;b.hasLoadingError=c;b.webApplicationId=a;b.cpuUsage=0;b.memoryUsage=0;b.activeStatus=c;b.isSharedRuntime=c}b.cmpDisplayName=function(a,b){if(a.displayName&&b.displayName)if(a.displayName.localeCompare(b.displayName)>0)return 1;else return -1;else return -1};return b}();b.AgaveInfo=d;var g;(function(a){a.SelectedItemDesciptionWidthAdjustment=75;a.DefaultGalleryWidth=695;a.DefaultTabMaxWidth=113;a.DefaultDialogBtnMaxWidth=150;a.DefaultNotificationHeight=30;a.DefaultSelectedItemHeight=42;a.DefaultSelectedDescriptionTextMaxWidth=380;a.DefaultLeftMargin=26;a.DefaultRightMargin=25;a.DefaultDPI=96;a.DefaultFooterHeight=70;a.HiddenFooterHeight=0;a.HeroMessageMarginTop=70;a.HeroBtnWidth=100;a.HeroBtnWidthAppsource=150;a.HeroBtnHeight=32;a.MenuButtonSide=25;a.MenuButtonBackgroundSize=16;a.OptionsMenuWidth=120;a.DismissButtonSide=16;a.ConfirmDialogWidth=300;a.DefaultSeparatorWidth=5;a.OptionBarElementMargin=7;a.OptionBarMenuGap=20})(g=b.UI||(b.UI={}));var f;(function(a){var c="Universal",b="OfficeOnline";a[a["None"]=0]="None";a[a["Win32"]=1]="Win32";a[a[b]=2]=b;a[a["Mac"]=3]="Mac";a[a["IOS"]=4]="IOS";a[a["Android"]=5]="Android";a[a[c]=6]=c})(f=b.Platform||(b.Platform={}))})(WEF||(WEF={}));(function(a){var b;(function(b){var i="refreshRequired",f="px",c=false,d=true,g="true",e=null,j="class",l;function h(){return (window.screen.logicalXDPI?window.screen.logicalXDPI:a.UI.DefaultDPI)/a.UI.DefaultDPI}function o(){return (window.screen.logicalYDPI?window.screen.logicalYDPI:a.UI.DefaultDPI)/a.UI.DefaultDPI}function m(c){var b=Strings.wefgallery.L_SignInPrompt;switch(c){case a.StoreTypeEnum.MarketPlace:if(a.CurrentPlatform==a.Platform.IOS)b=Strings.wefgallery.L_SignInPromptLiveId_ios;else b=Strings.wefgallery.L_SignInPromptLiveId;break;case a.StoreTypeEnum.ExchangeCorporateCatalog:b=Strings.wefgallery.L_SignInPromptExchangeCatalog}return b}function n(a){var c=document.documentElement,b=0;if(c!=e)b=Math.max(c["offset"+a],c["scroll"+a]);b=Math.max(b,document.body["offset"+a],document.body["scroll"+a]);return b}function r(a,b){if(!k(a,b)){var c=a.getAttribute(j);if(c)a.setAttribute(j,c+" "+b);else a.setAttribute(j,b)}}b.addClass=r;function t(d,c,e){var a=document.createElement("div");d.appendChild(a);r(a,c);a.setAttribute("aria-hidden",g);var b=document.createTextNode(e);a.appendChild(b)}b.createHtmlEncodedTextNode=t;function D(f,g){for(var b=e,d=f.childNodes,h=d.length,c=0;c<h;c++)if(d[c].nodeType===a.NodeType.TEXT){b=d[c];break}if(!b){b=document.createTextNode(g);f.appendChild(b)}else b.nodeValue=g}b.setHtmlEncodedText=D;function k(c,b){var a=c.getAttribute(j);return a&&a.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}b.hasClass=k;function x(f,b){var a=f;while(a!=e){if(k(a,b))return d;a=a.parentElement}return c}b.hasClassAmongAncestors=x;function L(b,c){if(k(b,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)"),a=b.getAttribute(j);a=a.replace(d," ");b.setAttribute(j,a)}}b.removeClass=L;function K(){var b=0;if(a.fixedViewportWidth)b=a.fixedViewportWidth;else if(self.innerWidth)b=self.innerWidth;else if(document.documentElement&&document.documentElement.clientHeight)b=document.documentElement.clientWidth;else if(document.body)b=document.body.clientWidth;return b}b.getWinWidth=K;function J(){var b=0;if(a.fixedViewportHeight)b=a.fixedViewportHeight;else if(self.innerHeight)b=self.innerHeight;else if(document.documentElement&&document.documentElement.clientHeight)b=document.documentElement.clientHeight;else if(document.body)b=document.body.clientHeight;return b}b.getWinHeight=J;function O(a){var c=a.offsetWidth*h(),b=a.offsetHeight*o();a.style.width=c+f;a.style.height=b+f}b.dpiScale=O;function p(a){var b=a.offsetHeight*o();a.style.height=b+f}b.dpiScaleHeight=p;function q(a){var b=a.offsetWidth*h();a.style.width=b+f}b.dpiScaleWidth=q;function C(b){if(window.getComputedStyle)if(a.WefGalleryHelper.getHTMLDir()=="ltr"){var d=parseInt(window.getComputedStyle(b).marginLeft)*h();b.style.marginLeft=d+f}else{var c=parseInt(window.getComputedStyle(b).marginRight)*h();b.style.marginRight=c+f}}b.dpiScaleMarginLeft=C;function z(a){return a*h()}b.getDPIXScaledNumber=z;function A(a){return a*h()}b.getDPIYScaledNumber=A;function y(b){var a=document.getElementById(b);if(a)a.innerHTML=""}b.clearElementInnerHTML=y;function M(){if(!l)l=document.documentElement.getAttribute("dir");return l}b.getHTMLDir=M;function I(c){while(c.hasChildNodes())c.removeChild(c.firstChild);var b=document.createElement("div");a.WefGalleryHelper.addClass(b,"SpinWheel");b.style.width="100%";b.style.height="100%";c.appendChild(b);c.setAttribute("aria-busy",g);return b}b.addSpinWheel=I;function H(k,i,g,j){var b=e,f=c,h=c;if(g==e)g=a.getStoreTypeFromStoreId(i);if(j)switch(j){case a.OemStoreStatus.ossSignInRequired:b=m(g);h=d;f=c}if(b==e&&k<0)switch(k){case a.InvokeResultCode.E_REQUEST_TIME_OUT:b=Strings.wefgallery.L_TimeOutError;break;case a.InvokeResultCode.E_USER_NOT_SIGNED_IN:b=m(g);h=d;f=c;break;case a.InvokeResultCode.E_CATALOG_ACCESS_DENIED:b=Strings.wefgallery.L_AccessDeniedError;f=d;break;case a.InvokeResultCode.E_CATALOG_REQUEST_FAILED:b=Strings.wefgallery.L_RequestFailedError;break;case a.InvokeResultCode.E_CATALOG_NO_APPS:b=Strings.wefgallery.L_CatalogNoAppsInstalledError;f=d;break;case a.InvokeResultCode.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR:b=Strings.wefgallery.L_GetEntitlementsBlockForMinorError;f=d;break;case a.InvokeResultCode.E_EXCHANGE_TOO_MANY_REQUESTS:b=Strings.wefgallery.L_ExchangeCCThrottledError;f=c;break;default:b=Strings.wefgallery.L_GetEntitilementsGeneralError;f=d}if(b)if(h&&a.CurrentPlatform!=a.Platform.IOS)a.IMPage.showError(b,i,Strings.wefgallery.L_SignInLinkText,a.IMPage.invokeSignIn);else a.IMPage.showError(b,i);return f}b.handleErrorCode=H;function N(b){var a=document.createElement("a");a.href=b;return a.href.split("/")[0].toLowerCase()=="https:"}b.isHttpsUrl=N;function w(a){p(a);q(a)}b.dpiScaleHeightAndWidth=w;function E(){return n("Height")}b.getDocumentHeight=E;function G(){return n("Width")}b.getDocumentWidth=G;function v(){var a,b=c;try{if(window.localStorage){a=window.localStorage.getItem(i);if(a==g)b=d}}catch(e){}return b}b.retrieveRefreshRequired=v;function B(a){try{window.localStorage&&window.localStorage.setItem(i,a)}catch(b){}}b.saveRefreshRequired=B;function s(){var a=e;try{if(window.localStorage)a=decodeURI(window.localStorage.getItem("lastActiveStoreId"))}catch(b){}return a}b.retrieveStoreIdfromStorage=s;function F(a,b,d){if(a.attachEvent)a.attachEvent("on"+b,d);else if(a.addEventListener)a.addEventListener(b,d,c);else a["on"+b]=d}b.addEventListener=F;function u(a){if(!a||a==="null")return c;var b=["^office-int\\.com$","^officeapps\\.live-int\\.com$","^.*\\.dod\\.online\\.office365\\.us$","^.*\\.gov\\.online\\.office365\\.us$","^.*\\.officeapps\\.live\\.com$","^.*\\.officeapps\\.live-int\\.com$","^.*\\.officeapps-df\\.live\\.com$","^.*\\.online\\.office\\.de$","^.*\\.partner\\.officewebapps\\.cn$","^"+document.domain.replace(new RegExp("\\.","g"),"\\.")+"$"],d=new RegExp(b.join("|"));return d.test(a)}b.isHostNameValidWacDomain=u})(b=a.WefGalleryHelper||(a.WefGalleryHelper={}))})(WEF||(WEF={}));(function(a){var b=function(){var i="OptionsButton",g="NotFocused",d="presentation",c="role",e="div",b=null,f=false;function h(d,e,c){var a=this;a.refocused=f;a.result=d;a.index=e;a.galleryItem=b;a.moeInnerDiv=b;a.focusOnCallBack=c;a.appOptions=b;a.nonMarketAppOptions=b;a.itemCreated=f}h.prototype.displayAgave=function(l){var h="aria-selected",k=this,b=document.createElement(e);l.appendChild(b);a.WefGalleryHelper.addClass(b,"Moe");b.setAttribute("data-ri",k.index.toString());b.setAttribute(c,"option");var j=document.createElement(e);b.appendChild(j);a.WefGalleryHelper.addClass(j,"MoeInner");a.WefGalleryHelper.dpiScale(j);j.setAttribute("data-solutionid",k.result.id?k.result.id.toUpperCase():"");j.setAttribute("title",k.result.description);j.setAttribute(c,d);j.setAttribute("data-inner-moe",k.index.toString());k.moeInnerDiv=j;a.WefGalleryHelper.dpiScale(b);a.WefGalleryHelper.dpiScaleMarginLeft(b);b.onfocus=function(){b.setAttribute(h,"true");a.WefGalleryHelper.removeClass(b,g)};b.onblur=function(){b.setAttribute(h,"false");(a.WefGalleryHelper.hasClassAmongAncestors(document.activeElement,i)||!a.WefGalleryHelper.hasClassAmongAncestors(document.activeElement,"Moe"))&&a.WefGalleryHelper.addClass(b,g)};b.oncontextmenu=function(){return f};k.galleryItem=b};h.prototype.ShowRateReviewAtGalleryItem=function(){return f};h.prototype.updateImage=function(z){var r="moe_status_icons.png",o="aria-label",m="mouseover",l="selected",f=this,j=f;if(!f.galleryItem||!f.moeInnerDiv)return;if(!f.itemCreated){a.WefGalleryHelper.addEventListener(f.moeInnerDiv,"click",function(c){if(!c)c=event;var d=c.target||c.srcElement;if(d!=b&&a.WefGalleryHelper.hasClassAmongAncestors(d,i))return;if(j.refocused)j.galleryItem.focus();else a.IMPage.selectGalleryItems(j.index)});a.WefGalleryHelper.addEventListener(f.moeInnerDiv,"dblclick",function(){z(j)});a.WefGalleryHelper.addEventListener(f.moeInnerDiv,"mousedown",function(c){if(!c)c=event;if(c.which===3||c.button===2){j.appOptions&&j.appOptions.popupMenu();if(a.IMPage.flightAddinManagerFeatureEnabled)j.nonMarketAppOptions&&j.nonMarketAppOptions.popupMenu()}j.refocused=a.WefGalleryHelper.hasClass(j.galleryItem,g)!=b&&a.WefGalleryHelper.hasClass(j.galleryItem,l)!=b});a.WefGalleryHelper.addEventListener(f.moeInnerDiv,m,function(){a.WefGalleryHelper.addClass(j.galleryItem,m);if(!a.WefGalleryHelper.hasClass(j.galleryItem,l)){j.appOptions&&j.appOptions.showOptionsButtonOnMouseOver();if(a.IMPage.flightAddinManagerFeatureEnabled)j.nonMarketAppOptions&&j.nonMarketAppOptions.showOptionsButtonOnMouseOver()}});a.WefGalleryHelper.addEventListener(f.moeInnerDiv,"mouseout",function(){a.WefGalleryHelper.removeClass(j.galleryItem,m);if(!a.WefGalleryHelper.hasClass(j.galleryItem,l)){j.appOptions&&j.appOptions.hideOptionsButton();if(a.IMPage.flightAddinManagerFeatureEnabled)j.nonMarketAppOptions&&j.nonMarketAppOptions.showOptionsButtonOnMouseOver()}});var q=f.result.iconUrl,n=document.createElement(e);f.moeInnerDiv.appendChild(n);a.WefGalleryHelper.addClass(n,"Tn");n.setAttribute(c,d);var p=document.createElement(e);p.setAttribute(c,d);f.moeInnerDiv.appendChild(p);a.WefGalleryHelper.addClass(p,"Details");a.WefGalleryHelper.dpiScale(p);a.WefGalleryHelper.createHtmlEncodedTextNode(p,"Title",f.result.displayName);if(f.result.hasLoadingError){var u=document.createElement("a");u.textContent=Strings.wefgallery.L_Reload_Button_Text;u.onclick=function(){z(j)};p.appendChild(u);a.WefGalleryHelper.dpiScale(u)}else{a.WefGalleryHelper.createHtmlEncodedTextNode(p,"Description",f.result.providerName);f.result.activeStatus&&f.result.isSharedRuntime&&a.WefGalleryHelper.createHtmlEncodedTextNode(p,"SharedRuntime","Shared")}if(f.ShowRateReviewAtGalleryItem()){var A=document.createElement(e);p.appendChild(A);var s=document.createElement("a");A.appendChild(s);s.setAttribute("tabindex","0");s.setAttribute("id","rateReviewLink");s.setAttribute(c,"link");s.text=Strings.wefgallery.L_OptionsMenu_RateReview_Txt;a.WefGalleryHelper.addEventListener(s,"click",function(b){b.preventDefault();b.stopPropagation();a.IMPage.invokeWindowOpen(j.result.rateReviewUrl)})}var k=document.createElement("img");k.setAttribute(c,d);n.appendChild(k);a.WefGalleryHelper.addClass(k,"MoeIcon");a.WefGalleryHelper.removeClass(n,"Tn");a.WefGalleryHelper.addClass(n,"TnNoBackGround");if(!q||a.WefGalleryHelper.isHttpsUrl(window.location.href)&&!a.WefGalleryHelper.isHttpsUrl(q))q=a.AGAVE_DEFAULT_ICON;q=h.errorIconCache[q]?h.errorIconCache[q]:q;k.onload=function(){if(k.height>=k.width){k.style.height="100%";k.style.width="auto"}else{k.style.height="auto";k.style.width="100%"}};var y=function(){var b=k.getAttribute("src");h.errorIconCache[b]=a.AGAVE_DEFAULT_ICON;k.setAttribute("src",a.AGAVE_DEFAULT_ICON)};k.onerror=y;k.onabort=y;k.setAttribute("src",q);var t=b;if(a.IMPage.currentTabIndex===a.StoreTypeEnum.MarketPlace){f.appOptions=a.IMPage.menuHandler.createAppOptions(f.result);t=f.appOptions.createOptionsButton(f.index,n,k)}else if(a.IMPage.flightAddinManagerFeatureEnabled){f.nonMarketAppOptions=a.IMPage.nonMarketMenuHandler.createAppOptions(f.result);t=f.nonMarketAppOptions.createOptionsButton(f.index,n,k)}t&&f.moeInnerDiv.appendChild(t);if(a.CurrentPlatform!=a.Platform.IOS){var x=f.galleryItem;if(t)x.setAttribute(o,Strings.wefgallery.L_GalleryItem_Name_InsertAndOptions_Txt.replace("{0}",f.result.displayName));else if(a.IMPage.currentStoreType===a.StoreTypeEnum.ThisDocument)x.setAttribute(o,f.result.displayName);else x.setAttribute(o,Strings.wefgallery.L_GalleryItem_Name_InsertOnly_Txt.replace("{0}",f.result.displayName))}if(f.result.activeStatus){var v=document.createElement("img");v.setAttribute(c,d);v.className="MoeActiveStatusIcon";v.src=r;n.appendChild(v)}if(f.result.hasLoadingError){var w=document.createElement("img");w.setAttribute(c,d);w.className="MoeErrorStatusIcon";w.src=r;n.appendChild(w);k.style.opacity="0.5"}}f.itemCreated=true};h.prototype.setIndex=function(c){var b=this;b.index=c;b.galleryItem.setAttribute("data-ri",c.toString());b.appOptions&&b.appOptions.setAppIndex(c);if(a.IMPage.flightAddinManagerFeatureEnabled)b.nonMarketAppOptions&&b.nonMarketAppOptions.setAppIndex(c)};h.prototype.dispose=function(){this.galleryItem=b;this.result=b;this.index=b};h.errorIconCache={};return h}();a.GalleryItem=b})(WEF||(WEF={}));(function(b){var a=null,c;(function(a){a[a["Success"]=0]="Success";a[a["Error"]=1]="Error"})(c||(c={}));var d=function(){var N="Notification",M="SignInATag",J="hidden",I="Options",s="link",C="presentation",B="tabindex",h="role",l="title",L="data-storeType",i="0",v="aria-selected",A="-1",k="tabIndex",y="TabSelected",w="true",u="disabled",S="signOutLinkId",K="linkId",R="FooterLinkATag",Q="ManageInner",P="BtnCancel",O="BtnAction",F="data-storeId",t="inline-block",r="block",z="enableInsertDialogAccessibilityFix",E="ltr",x="false",G="aria-busy",g="px",d=true,f="none",H="RefreshInner",m="id",q="selected",p="TabATag",D="100%",o=-1,n="",e=false;function j(k){var j="Should be implemented by WefGalleryRich.ts or WefGalleryWac.ts.",i=this,h=i;i.providers={};i.currentStoreId=a;i.currentStoreType=a;i.omexStoreId=a;i.hasMarketPlace=e;i.currentPageUrl=a;i.landingPageUrl=n;i.appManagePageUrl=n;i.appSourceLandingPageUrl=n;i.delaying=e;i.delayLoad=200;i.delayTime=a;i.delayCallbacks=[];i.shiftTabFromFirstElement=e;i.btnAction=a;i.btnCancel=a;i.btnDone=a;i.btnTrustAll=a;i.documentAppsMsg=a;i.documentAppsMsgText=a;i.errorMessage=a;i.footer=a;i.footerLink=a;i.mainPage=a;i.gallery=a;i.galleryContainer=a;i.header=a;i.mainTitle=a;i.manageATag=a;i.manageMenuDiv=a;i.uploadATag=a;i.menuRight=a;i.noAppsMessage=a;i.noAppsMessageText=a;i.noAppsMessageTitle=a;i.signedInMessage=a;i.signedInDiv=a;i.notification=a;i.notificationDismiss=a;i.notificationDismissImg=a;i.officeStoreBtn=a;i.permissionATag=a;i.permissionTextAndLink=a;i.permissionTextTR=a;i.readMoreATag=a;i.selectedDescriptionReadMoreLink=a;i.selectedDescriptionText=a;i.selectedItem=a;i.tabs=a;i.tabLoopTerminalDiv=a;i.uploadMenuDiv=a;i.refreshMenuDiv=a;i.refreshATag=HTMLAnchorElement=a;i.menuRightSeparatorDiv=a;i.tabTitles=[];i.enterKeyTarget=a;i.menuSeparatorWidth=a;i.menuRightMaxPossibleWidth=a;i.galleryItems=a;i.uiState={Ready:e,StoreIdBeforeReady:n,ErrorBeforeReady:n,ErrorLinkTextBeforeReady:n,ErrorLinkHandlerBeforeReady:a};i.currentIndex=o;i.currentTabIndex=o;i.results=a;i.height=D;i.width=D;i.itemsPerRow=a;i.leftKeyHandler=a;i.rightKeyHandler=a;i.upKeyHandler=a;i.downKeyHandler=a;i.keyHandlers=a;i.keyCodePressed=o;i.menuHandler=a;i.nonMarketMenuHandler=a;i.modalDialog=a;i.storeTab=a;i.firstTabATag=a;i.totalSessionTime=0;i.trustPageSessionTime=0;i.envSetting={};i.isUploadFileDevCatalogEnabled=e;i.isAppCommandEnabled=e;i.isMacAppStoreBuild=e;i.removeStoreStrings=e;i.flightAddinManagerFeatureEnabled=e;i.moveLeft=function(d,e){if(b.WefGalleryHelper.hasClass(e,p)){var c=h.currentTabIndex-2;if(c<0)c=h.tabs.childNodes.length-1;if(c!=h.currentTabIndex){var f=h.tabs.childNodes[c];h.toggleTabSelection(f,a);d.preventDefault&&d.preventDefault()}}else if(h.isElementGalleryItem(e)){h.currentIndex--;if(h.currentIndex>=0){h.selectGalleryItems(h.currentIndex);d.preventDefault&&d.preventDefault()}else h.currentIndex=0}};i.moveRight=function(d,e,f){if(b.WefGalleryHelper.hasClass(e,p)){var c=h.currentTabIndex+2;if(c>h.tabs.childNodes.length-1)c=0;if(c!=h.currentTabIndex){var g=h.tabs.childNodes[c];h.toggleTabSelection(g,a);d.preventDefault&&d.preventDefault()}}else if(h.isElementGalleryItem(e)){h.currentIndex++;if(h.currentIndex<f){h.selectGalleryItems(h.currentIndex);d.preventDefault&&d.preventDefault()}else h.currentIndex=f-1}};i.moveUp=function(c,a){if(h.isElementGalleryItem(a)&&!b.WefGalleryHelper.hasClass(a,p)){h.currentIndex-=h.itemsPerRow;if(h.currentIndex>=0){h.selectGalleryItems(h.currentIndex);c.preventDefault&&c.preventDefault()}else h.currentIndex+=h.itemsPerRow}};i.moveDown=function(c,a,d){if(h.isElementGalleryItem(a)&&!b.WefGalleryHelper.hasClass(a,p)){if(h.currentIndex>=0)h.currentIndex+=h.itemsPerRow;else h.currentIndex=0;if(h.currentIndex<d){h.selectGalleryItems(h.currentIndex);c.preventDefault&&c.preventDefault()}else h.currentIndex-=h.itemsPerRow}};i.tabKeyHandler=function(c,g){if(!c.shiftKey&&(g==h.tabs.childNodes[h.currentTabIndex]||g==h.tabs.childNodes[h.currentTabIndex].firstChild)&&c.preventDefault&&h.galleryItems&&h.galleryItems.length>0){if(h.currentIndex>o)if(h.galleryItems.length<=h.currentIndex)h.currentIndex=o;else{var i=h.galleryItems[h.currentIndex];if(!b.WefGalleryHelper.hasClass(i.galleryItem,q))h.currentIndex=o}if(h.currentIndex<0){h.currentIndex=0;h.selectGalleryItems(h.currentIndex,e);c.preventDefault()}}if(!c.shiftKey&&g.getAttribute(m)==H&&c.preventDefault&&h.tabs&&h.currentTabIndex>=0&&h.currentTabIndex<h.tabs.childNodes.length){h.tabs.childNodes[h.currentTabIndex].firstChild.focus();c.preventDefault()}if(c.shiftKey&&h.tabs&&(g==h.tabs.childNodes[h.currentTabIndex]||g==h.tabs.childNodes[h.currentTabIndex].firstChild)&&c.preventDefault&&h.refreshATag)if(window.getComputedStyle&&window.getComputedStyle(h.refreshMenuDiv).display==f){h.shiftTabFromFirstElement=d;h.tabLoopTerminalDiv.focus()}else{h.refreshATag.focus();c.preventDefault()}if(g.parentElement!=a&&g.parentElement.parentElement!=a&&g.parentElement.parentElement.id=="ManageAddinMenu"){!c.shiftKey&&g.parentElement==g.parentElement.parentElement.lastChild&&c.preventDefault();c.shiftKey&&g.parentElement==g.parentElement.parentElement.firstChild&&c.preventDefault()}};i.galleryKeyDownHandler=function(a){var c=0;if(h.results)c=h.results.length;if(!a)a=event;for(var d=0;d<h.keyHandlers.length;d++){var e=h.keyHandlers[d];if(e.handleKeyDown(a)){a.stopPropagation();a.preventDefault();return}}var b=a.srcElement?a.srcElement:a.target;switch(a.keyCode){case 9:h.tabKeyHandler(a,b);break;case 13:h.enterKeyTarget=b;a.preventDefault();break;case 27:h.cancelDialog();break;case 32:if(h.currentIndex>o&&h.isElementGalleryItem(b)){a.stopPropagation();a.preventDefault()}return;case 37:h.leftKeyHandler(a,b,c);break;case 38:h.upKeyHandler(a,b);break;case 39:h.rightKeyHandler(a,b,c);break;case 40:h.downKeyHandler(a,b,c);break;default:return}};i.galleryKeyUpHandler=function(a){if(!a)a=event;for(var b=0;b<h.keyHandlers.length;b++){var d=h.keyHandlers[b];if(d.handleKeyUp(a)){a.stopPropagation();a.preventDefault();return}}var c=a.srcElement?a.srcElement:a.target;switch(a.keyCode){case 13:h.executeButtonCommand(c,a)}};i.resizeHandler=function(){h.uiState.Ready=e;var c=b.WefGalleryHelper.getWinHeight().toString(),f=b.WefGalleryHelper.getWinWidth().toString();if(h.height!=c||h.width!=f){h.height=c;h.width=f;h.setGalleryHeight();h.delayLoadVisibleImages();var a,i=h.width/b.UI.DefaultGalleryWidth;a=b.WefGalleryHelper.getDPIXScaledNumber(b.UI.DefaultDialogBtnMaxWidth)*i;h.btnAction.style.maxWidth=a+g;h.btnCancel.style.maxWidth=a+g;h.btnTrustAll.style.maxWidth=a+g;h.btnDone.style.maxWidth=a+g;h.setTabTitleElementMaxSize(h.tabTitles);h.setSelectedItemWidth()}h.menuHandler.hideMenu(d);h.flightAddinManagerFeatureEnabled&&h.nonMarketMenuHandler.hideMenu(d);h.modalDialog.positionDialog();h.uiState.Ready=d;if(h.uiState.ErrorLinkTextBeforeReady&&h.uiState.ErrorLinkHandlerBeforeReady)h.showError(h.uiState.ErrorBeforeReady,h.uiState.StoreIdBeforeReady,h.uiState.ErrorLinkTextBeforeReady,h.uiState.ErrorLinkHandlerBeforeReady);else h.showError(h.uiState.ErrorBeforeReady,h.uiState.StoreIdBeforeReady)};i.loadVisibleImages=function(){if((new Date).getTime()-h.delayTime<h.delayLoad&&h.delaying)setTimeout(h.loadVisibleImages,h.delayLoad);else{var g=h.gallery;if(g&&g.children.length>0){var j=e,k=e,f=h.getItemsPerRow();if(f>0){var n=h.galleryItems[0].galleryItem.offsetHeight;if(h.currentIndex<f&&h.keyCodePressed==40){h.gallery.scrollTop=0;h.keyCodePressed=o}for(var i=g.scrollTop+n,l=i+g.clientHeight*2,b,c=0;c<h.galleryItems.length;c+=f){for(var a=0;a<f&&c+a<h.galleryItems.length;a++){b=h.galleryItems[c+a].galleryItem;if(b&&(a>0||b.offsetTop+b.clientHeight>=i&&b.offsetTop<l))h.galleryItems&&h.galleryItems[c+a].updateImage(h.insertItem);else{if(j)k=d;break}j=d}if(k)break}}h.delaying=e;h.gallery.setAttribute(G,x)}if(h.delaying){setTimeout(h.loadVisibleImages,3e3);h.delaying=e}else while(h.delayCallbacks.length>0){var m=h.delayCallbacks.pop();m()}}};i.setNotificationStyle=function(e){var d="notificationSuccess",a="notificationError";b.WefGalleryHelper.removeClass(h.notification,a);b.WefGalleryHelper.removeClass(h.notification,d);switch(e){case c.Success:b.WefGalleryHelper.addClass(h.notification,d);break;case c.Error:default:b.WefGalleryHelper.addClass(h.notification,a)}};i.insertItem=function(){throw j};i.showEntitlements=function(){throw j};i.invokeSignIn=function(){throw j};i.invokeSignOut=function(){throw"Should be implemented by WefGalleryWac.ts."};if(b.WefGalleryHelper.getHTMLDir()==E){i.leftKeyHandler=i.moveLeft;i.rightKeyHandler=i.moveRight}else{i.leftKeyHandler=i.moveRight;i.rightKeyHandler=i.moveLeft}i.upKeyHandler=i.moveUp;i.downKeyHandler=i.moveDown;i.clientFacadeCommon=k;i.envSetting=i.clientFacadeCommon.getEnvSetting();i.isMacAppStoreBuild=i.envSetting["IsMacAppStoreBuild"]===d;i.removeStoreStrings=i.isMacAppStoreBuild;i.flightAddinManagerFeatureEnabled=i.envSetting&&i.envSetting["AddinManagerFeatureEnabled"]?d:e;if(i.envSetting&&i.envSetting[z]===d)document.getElementById("DialogButtons").innerHTML='<button id="BtnAction" class="disabled primaryButton" disabled="disabled" type="button" ><span>'+Strings.wefgallery.L_Action_Button_Text+'</span></button>\n\t\t\t\t\t<button id="BtnCancel" class="defaultButton" type="button" ><span>'+Strings.wefgallery.L_Cancel_Button_Text+'</span></button>\n\t\t\t\t\t<button id="BtnTrustAll" class="primaryButton" type="button" ><span>'+Strings.wefgallery.L_TrustAll_Button_Text+'</span></button>\n\t\t\t\t\t<button id="BtnDone" class="defaultButton" type="button" ><span>'+Strings.wefgallery.L_Done_Button_Text+"</span></button>"}j.prototype.showHideRightMenuButtons=function(b,c){var a=this;a.menuRight.style.display=r;var e=!b&&!c,d=a.envSetting["agaveAddinUploadEnabled"]||!e&&!b&&a.isUploadFileDevCatalogEnabled;if(d)a.menuRight.children[0].style.display=t;else a.menuRight.children[0].style.display=f;if(b)a.menuRight.children[1].style.display=t;else a.menuRight.children[1].style.display=f;if(c)a.menuRight.children[3].style.display=t;else a.menuRight.children[3].style.display=f;if((d||b)&&c)a.menuRight.children[2].style.display=t;else a.menuRight.children[2].style.display=f};j.prototype.showFooter=function(){this.footer.style.visibility="visible";this.footer.style.height=b.WefGalleryHelper.getDPIYScaledNumber(b.UI.DefaultFooterHeight)+g};j.prototype.showActionButtons=function(d){var c="inline",a=this;if(d==b.ActionButtonGroups.InsertCancel){a.btnAction.style.display=c;a.btnCancel.style.display=c;a.btnTrustAll.style.display=f;a.btnDone.style.display=f;a.selectedDescriptionReadMoreLink.style.display=f;a.permissionTextAndLink.style.display=f;a.disableNarratorOnControl(a.permissionTextTR)}else if(d==b.ActionButtonGroups.ThisDocument){a.btnAction.style.display=f;a.btnCancel.style.display=f;a.btnTrustAll.style.display=c;a.btnDone.style.display=c;a.selectedDescriptionReadMoreLink.style.display=t;a.permissionTextAndLink.style.display=t;a.footerLink.style.display=f}else{a.btnAction.style.display=f;a.btnCancel.style.display=f;a.btnTrustAll.style.display=f;a.btnDone.style.display=c;a.selectedDescriptionReadMoreLink.style.display=f;a.permissionTextAndLink.style.display=f;a.footerLink.style.display=f;a.documentAppsMsg.style.display=f}};j.prototype.getTabTooltip=function(c){var a=n;switch(c){case b.StoreTypeEnum.MarketPlace:a=this.removeStoreStrings?Strings.wefgallery.L_MarketPlaceTab_Tooltip_Appsource:Strings.wefgallery.L_MarketPlaceTab_Tooltip;break;case b.StoreTypeEnum.Catalog:a=Strings.wefgallery.L_CatalogTab_Tooltip;break;case b.StoreTypeEnum.FileShare:a=Strings.wefgallery.L_FileShareTab_Tooltip;break;case b.StoreTypeEnum.Recommendation:a=this.removeStoreStrings?Strings.wefgallery.L_RecommendationTab_Tooltip_Appsource:Strings.wefgallery.L_RecommendationTab_Tooltip;break;case b.StoreTypeEnum.ThisDocument:a=this.removeStoreStrings?Strings.wefgallery.L_ThisDocumentTab_Tooltip_Appsource:Strings.wefgallery.L_ThisDocumentTab_Tooltip;break;case b.StoreTypeEnum.ExchangeCorporateCatalog:a=Strings.wefgallery.L_ExchangeCCTab_Tooltip}return a+" "+Strings.wefgallery.L_TabItemNavigation_Tooltip};j.prototype.getCurrentProviderHResult=function(){var a=0;if(this.currentStoreId)a=this.providers[this.currentStoreId][2];return a};j.prototype.getCurrentProviderStatus=function(){var a=0;if(this.currentStoreId)a=this.providers[this.currentStoreId][1];return a};j.prototype.getFeaturedPageUrl=function(){var a=this;if(!a.currentPageUrl)a.currentPageUrl=a.getPageUrl(b.PageTypeEnum.Recommendation);return a.currentPageUrl};j.prototype.getLandingPageUrl=function(){var a=this;if(!a.landingPageUrl)a.landingPageUrl=a.getPageUrl(b.PageTypeEnum.Landing);return a.landingPageUrl};j.prototype.getAppManagePageUrl=function(){var a=this;if(!a.appManagePageUrl)a.appManagePageUrl=a.getPageUrl(b.PageTypeEnum.ManageApps);return a.appManagePageUrl};j.prototype.getAppSourceLandingPageUrl=function(){var a=this;if(!a.appSourceLandingPageUrl)a.appSourceLandingPageUrl=a.getPageUrl(b.PageTypeEnum.AppSourceLandingPage);return a.appSourceLandingPageUrl};j.prototype.executeButtonCommand=function(f){var c=this,j=c;c.menuHandler.hideMenu(d);c.flightAddinManagerFeatureEnabled&&c.nonMarketMenuHandler.hideMenu(d);if(f!=c.enterKeyTarget)return;if(c.isElementGalleryItem(f))c.insertSelectedItem();else if(b.WefGalleryHelper.hasClass(f,p)){var i=f.parentElement.getAttribute(F);if(i)c.toggleTabSelection(f.parentElement,a);else c.showEntitlements(c.currentStoreId,d,a)}else if(f.getAttribute(m)==O)c.insertSelectedItem();else if(f.getAttribute(m)==P||f.getAttribute(m)=="BtnDone")c.cancelDialog();else if(f.getAttribute(m)==Q)c.launchAppManagePage();else if(f.getAttribute(m)==H){var g=undefined,h=c.envSetting&&c.envSetting[z]?d:e;if(h)g=function(){j.showSuccess(Strings.wefgallery.L_RefreshSuccess_Text_Status,d)};c.showEntitlements(c.currentStoreId,d,g)}else if(f.getAttribute(m)==R)c.gotoStore();else if(f.getAttribute(m)==K)c.invokeSignIn();else if(f.getAttribute(m)==S)c.invokeSignOut();else if(f.getAttribute(m)=="rateReviewLink")c.results!=a&&c.results.length>0&&b.IMPage.invokeWindowOpen(c.results[0].rateReviewUrl);else b.WefGalleryHelper.hasClass(f,"OptionsButton")&&f.click()};j.prototype.restoreFooterLink=function(){var a=this;b.WefGalleryHelper.clearElementInnerHTML("SelectedItemTitle");b.WefGalleryHelper.clearElementInnerHTML("SelectedItemDescription");if(a.currentStoreType!=b.StoreTypeEnum.ThisDocument){if(a.hasMarketPlace)a.footerLink.style.display=r;a.selectedItem.style.display=f;!b.WefGalleryHelper.hasClass(a.btnAction,u)&&b.WefGalleryHelper.addClass(a.btnAction,u);a.btnAction.setAttribute(u,w)}};j.prototype.toggleTabSelection=function(p,r){var c=this;c.cleanUpGallery();c.signedInDiv.style.display=f;for(var q=p.getAttribute(m),t=c.tabs.childNodes.length,d,n,h=0;h<t;h++){d=c.tabs.childNodes[h];if(d.attributes&&b.WefGalleryHelper.hasClass(d,"TextNav")){b.WefGalleryHelper.removeClass(d.firstChild,y);d.firstChild.setAttribute(k,A);d.firstChild.setAttribute(v,x);n=d.getAttribute(m);if(n==q){c.currentTabIndex=h;d.firstChild.setAttribute(k,i);c.tabLoopTerminalDiv!=a&&c.tabLoopTerminalDiv.focus();b.WefGalleryHelper.addClass(d.firstChild,y);d.firstChild.setAttribute(v,w);var g=d.getAttribute(F),j=parseInt(d.getAttribute(L));if(c.currentStoreId!=g)c.currentIndex=o;c.currentStoreId=g;c.currentStoreType=j;c.saveStoreId(c.currentStoreId);if(g&&j!=b.StoreTypeEnum.Recommendation){c.restoreFooterLink();c.showFooter();c.showEntitlements(g,e,r);c.setGalleryHeight()}else{var s=d.getAttribute("data-PageUrl");c.showContentPage(s)}c.refreshATag.setAttribute(l,Strings.wefgallery.L_WefDialog_RefreshButton_Tooltip.replace("{0}",d.firstChild.textContent))}}}};j.prototype.initializeGalleryUI=function(x,U){var c=this,A=c;if(x==undefined||x.length===0)return e;c.clientFacadeCommon.initializeProviderTabStrings();for(var n,o=[],E=x.length,p,m,K,D,Q=e,S=e,j=0;j<E;j++){n=x[j].toArray?x[j].toArray():x[j];p=n[0];m=n[1];K=n[2];D=n[3];if(m===b.StoreTypeEnum.Developer)continue;if(D!=b.InvokeResultCode.S_HIDE_PROVIDER)if(m===b.StoreTypeEnum.OneDrive)Q=d;else o.push([p.toString(),m,K,D]);if(m===b.StoreTypeEnum.MarketPlace){if(!c.isMacAppStoreBuild){c.hasMarketPlace=d;c.omexStoreId=p}S=d}}c.hasMarketPlace&&o.push([b.PageStoreId.Recommendation,b.StoreTypeEnum.Recommendation,0,0]);c.footerLink.style.display=S?r:f;Q&&o.push([b.StoreTypeEnum.OneDrive,b.StoreTypeEnum.OneDrive,0,0]);E=o.length;if(E===0)return e;var M=e,u;if(U&&c.hasMarketPlace)u=c.omexStoreId;else u=c.retrieveStoreId();if(c.hasMarketPlace&&u&&m!==b.StoreTypeEnum.ThisDocument)if(b.PageStoreId.Recommendation===u){c.currentStoreId=u;c.currentStoreType=b.StoreTypeEnum.Recommendation;c.currentPageUrl=c.getPageUrl(b.PageTypeEnum.Recommendation);M=d}else for(var j=0;j<E;j++)if(o[j][0]===u){c.currentStoreId=u;c.currentStoreType=o[j][1];M=d;break}c.tabs.setAttribute(h,"tablist");while(c.tabs.hasChildNodes())c.tabs.removeChild(c.tabs.firstChild);if(!M){c.currentStoreId=o[0][0];c.currentStoreType=o[0][1]}var N=0,t=a,J=a;c.tabTitles=[];for(var j=0;j<E;j++){n=o[j];p=n[0];m=n[1];K=n[2];D=n[3];c.providers[p]=[m,K,D];var O=b.storeTypes[m];if(O){delete b.storeTypes[m];N++;if(p===b.StoreTypeEnum.OneDrive)c.checkAndCreateOneDriveProviderTab(c.tabs,N,O,p,m);else{J=c.createTab(c.tabs,N,O,p,m);c.tabTitles.push(J)}if(p===c.currentStoreId){t=J;b.WefGalleryHelper.addClass(t.firstChild,y);t.firstChild.setAttribute(v,w)}if(m==b.StoreTypeEnum.Recommendation)c.storeTab=J}}c.setTabTitleElementMaxSize(c.tabTitles);var L=a;if(c.tabs.childNodes.length>0)if(t){b.WefGalleryHelper.addClass(t.childNodes[0],q);t.childNodes[0].focus();t.childNodes[0].setAttribute(B,i);L=t.childNodes[0].textContent}else if(c.tabs.childNodes[0].childNodes.length>0){b.WefGalleryHelper.addClass(c.tabs.childNodes[0].childNodes[0],q);L=c.tabs.childNodes[0].childNodes[0].textContent}for(var P=a,j=0;j<c.tabs.childNodes.length;j++){P=c.tabs.childNodes[j];if(P.getAttribute(F)===c.currentStoreId){c.currentTabIndex=j;P.firstChild.setAttribute(k,i);break}}if(c.isUploadFileDevCatalogEnabled){var I=document.createElement("img");I.setAttribute("src","./DropDownArrow_16x16x32.png");I.id="DropDownArrow";I.setAttribute(h,C);c.manageATag.appendChild(I);c.manageATag.setAttribute(h,"button")}else c.manageATag.setAttribute(h,s);c.manageATag.setAttribute(k,i);c.manageATag.setAttribute(l,Strings.wefgallery.L_WefDialog_ManageButton_Tooltip);c.uploadATag.setAttribute(k,i);c.uploadATag.setAttribute(l,Strings.wefgallery.L_AddinCommands_UploadMyAddin_Txt);c.uploadATag.setAttribute(h,s);var V=function(){A.cleanUpGallery();A.restoreFooterLink();var a=undefined,b=A.envSetting&&A.envSetting[z]?d:e;if(b)a=function(){A.showSuccess(Strings.wefgallery.L_RefreshSuccess_Text_Status,d)};A.showContent(d,a)};c.refreshATag=document.getElementById(H);c.refreshATag.setAttribute(l,Strings.wefgallery.L_WefDialog_RefreshButton_Tooltip.replace("{0}",L));c.refreshATag.onclick=function(){V()};c.refreshATag.setAttribute(k,i);c.refreshATag.setAttribute(h,"button");var G=document.getElementById(R);G.setAttribute(k,i);G.setAttribute(l,c.removeStoreStrings?Strings.wefgallery.L_Footer_Link_Text_Tooltip_Appsource:Strings.wefgallery.L_Footer_Link_Text_Tooltip);G.setAttribute(h,s);G.textContent=c.removeStoreStrings?Strings.wefgallery.L_Footer_Link_Text_Appsource:Strings.wefgallery.L_Footer_Link_Text;var W=document.getElementById("FooterLinkImgTag");W.setAttribute("alt",c.removeStoreStrings?Strings.wefgallery.L_Footer_Link_Text_Appsource:Strings.wefgallery.L_Footer_Link_Text);var T=c.removeStoreStrings?Strings.wefgallery.L_TrustUx_AppsMessage_Appsource:Strings.wefgallery.L_TrustUx_AppsMessage;c.documentAppsMsg.setAttribute(l,T);c.documentAppsMsgText.innerText=T;c.readMoreATag.setAttribute(k,i);c.readMoreATag.setAttribute(l,Strings.wefgallery.L_TrustUx_ReadMoreLink_Txt_Tooltip);c.readMoreATag.setAttribute(h,s);c.permissionATag.setAttribute(k,i);c.permissionATag.setAttribute(l,Strings.wefgallery.L_Permission_Link_Txt_Tooltip);c.permissionATag.setAttribute(h,s);c.permissionTextAndLink.setAttribute(l,Strings.wefgallery.L_Permission_Link_Txt_Tooltip);c.btnAction.setAttribute(k,i);c.btnAction.title=Strings.wefgallery.L_Action_Button_Txt_Tooltip;c.btnCancel.setAttribute(k,i);c.btnCancel.setAttribute(l,Strings.wefgallery.L_Cancel_Button_Text_Tooltip);c.btnTrustAll.setAttribute(k,i);c.btnTrustAll.setAttribute(l,Strings.wefgallery.L_TrustAll_Button_Txt_Tooltip);c.btnDone.setAttribute(k,i);c.btnDone.setAttribute(l,Strings.wefgallery.L_Done_Button_Txt_Tooltip);c.officeStoreBtn.value=c.removeStoreStrings?Strings.wefgallery.L_NoAppsMessageButton_Appsource:Strings.wefgallery.L_NoAppsMessageButton;c.noAppsMessage.setAttribute(l,(c.removeStoreStrings?Strings.wefgallery.L_OfficeStore_Button_Tooltip_Appsource:Strings.wefgallery.L_OfficeStore_Button_Tooltip).replace("{0}",c.officeStoreBtn.value));c.noAppsMessage.style.marginTop=b.WefGalleryHelper.getDPIXScaledNumber(b.UI.HeroMessageMarginTop)+g;c.noAppsMessageTitle.innerHTML=Strings.wefgallery.L_NoAppsMessageTitle;c.noAppsMessageText.innerHTML=c.removeStoreStrings?Strings.wefgallery.L_NoAppsMessageText_Appsource:Strings.wefgallery.L_NoAppsMessageText;c.officeStoreBtn.style.width=b.WefGalleryHelper.getDPIXScaledNumber(c.removeStoreStrings?b.UI.HeroBtnWidthAppsource:b.UI.HeroBtnWidth)+g;c.officeStoreBtn.style.height=b.WefGalleryHelper.getDPIXScaledNumber(b.UI.HeroBtnHeight)+g;var X=document.getElementById("ImgStore");X.setAttribute("alt",c.removeStoreStrings?Strings.wefgallery.L_NoAppsMessageButton_Appsource:Strings.wefgallery.L_NoAppsMessageButton);c.overrideButtonTooltip();return d};j.prototype.showContent=function(c,d){var a=this;if(a.currentStoreId==b.PageStoreId.Recommendation)a.showContentPage(a.currentPageUrl);else a.showEntitlements(a.currentStoreId,c,d)};j.prototype.saveStoreId=function(a){try{window.localStorage&&window.localStorage.setItem("lastActiveStoreId",encodeURI(a))}catch(b){}};j.prototype.disableNarratorOnControl=function(b){if(b!=a){b.setAttribute(h,C);b.setAttribute("aria-hidden",w);b.setAttribute(B,A)}};j.prototype.createTab=function(g,o,n,k,i){var e=this,q=e;if(g.childNodes.length!=0){var f=document.createElement("div");b.WefGalleryHelper.addClass(f,"separator");f.innerHTML="|";e.disableNarratorOnControl(f);g.appendChild(f)}var j=b.PageStoreId.Recommendation===k?e.getFeaturedPageUrl():a,c=document.createElement("div");b.WefGalleryHelper.addClass(c,"TextNav");g.appendChild(c);var d=document.createElement("a");d.className="TabATag NoTextSelect";b.WefGalleryHelper.setHtmlEncodedText(d,n);var p=e.getTabTooltip(i);d.setAttribute(l,p);d.setAttribute(h,"tab");d.setAttribute(B,A);c.appendChild(d);if(o==1)e.firstTabATag=d;c.setAttribute(m,n);c.setAttribute(F,k);c.setAttribute(L,i.toString());c.setAttribute(h,C);j&&c.setAttribute("data-pageUrl",j);c.onclick=function(){q.toggleTabSelection(this,a)};c.onfocus=function(){d.focus()};return c};j.prototype.galleryScrollHandler=function(){var a=this;a.menuHandler.hideMenu(d);a.flightAddinManagerFeatureEnabled&&a.nonMarketMenuHandler.hideMenu(d);a.delayLoadVisibleImages()};j.prototype.setRightMenuPosition=function(){var a=this,c=b.WefGalleryHelper.getDPIYScaledNumber(b.UI.DefaultHeaderHeight);if(a.errorMessage.scrollHeight>0)c=c+a.errorMessage.scrollHeight+b.UI.AdjustNotificationHeight;if(b.WefGalleryHelper.getHTMLDir()==E&&a.menuRight.offsetLeft<a.mainTitle.offsetLeft+a.mainTitle.offsetWidth||b.WefGalleryHelper.getHTMLDir()=="rtl"&&a.mainTitle.offsetLeft<a.menuRight.offsetLeft+a.menuRight.offsetWidth){a.header.style.height=c+20+g;document.getElementById(I).style.marginTop="24px";a.menuRight.style.marginTop="30px"}else{a.header.style.height=c+g;document.getElementById(I).style.marginTop="4px";a.menuRight.style.marginTop="0px"}};j.prototype.storeStaticElementRealSize=function(){var a=this;a.menuSeparatorWidth=b.UI.DefaultSeparatorWidth;if(a.menuRightSeparatorDiv.offsetWidth!=0)a.menuSeparatorWidth=a.menuRightSeparatorDiv.offsetWidth;var c=0;if(a.isUploadFileDevCatalogEnabled)c=a.uploadMenuDiv.offsetWidth;a.menuRightMaxPossibleWidth=Math.max(c,a.manageMenuDiv.offsetWidth)+a.menuSeparatorWidth+a.refreshMenuDiv.offsetWidth+b.WefGalleryHelper.getDPIXScaledNumber(b.UI.OptionBarElementMargin)*3};j.prototype.setTabTitleElementMaxSize=function(c){if(c==a||c.length==0)return;for(var d=0;d<c.length;d++){c[d].style.maxWidth=f;var e=c[d].getElementsByClassName(p);if(e&&e.length>0)e[0].style.maxWidth=f}var l=b.WefGalleryHelper.getDPIXScaledNumber(b.UI.DefaultLeftMargin)+this.tabs.offsetWidth+b.UI.DefaultRightMargin;if(l>b.WefGalleryHelper.getWinWidth()){for(var j=[],i=0,d=0;d<c.length;d++){j.push(c[d].offsetWidth);i+=c[d].offsetWidth}var h=b.WefGalleryHelper.getWinWidth()-b.WefGalleryHelper.getDPIXScaledNumber(b.UI.DefaultLeftMargin)-b.UI.DefaultRightMargin;h-=this.menuSeparatorWidth*(c.length-1);h-=b.WefGalleryHelper.getDPIXScaledNumber(b.UI.OptionBarElementMargin)*(c.length*2-2);for(var d=0;d<c.length;d++){var k=Math.floor(j[d]/i*h)-1;c[d].style.maxWidth=k+g;var e=c[d].getElementsByClassName(p);if(e&&e.length>0)e[0].style.maxWidth=k+g}}};j.prototype.setGalleryHeight=function(){var a=this;a.setRightMenuPosition();var c=b.WefGalleryHelper.getWinHeight()-a.header.offsetHeight-a.footer.offsetHeight;if(a.galleryContainer&&c>0&&(c!=a.galleryContainer.offsetHeight||a.footer&&a.footer.style.top===n)){a.galleryContainer.style.height=c+g;a.galleryContainer.style.top=a.header.offsetHeight+g;var d=c;if(a.currentStoreType==b.StoreTypeEnum.ThisDocument)d=d-a.documentAppsMsg.offsetHeight*2;a.gallery.style.height=d+g;var e=c+a.header.offsetHeight;a.footer.style.top=e+g}};j.prototype.setSelectedItemWidth=function(){var a=this,c=b.WefGalleryHelper.getWinWidth()-b.WefGalleryHelper.getDPIXScaledNumber(b.UI.SelectedItemDesciptionWidthAdjustment);if(a.currentStoreType==b.StoreTypeEnum.ThisDocument)c=c-a.btnTrustAll.offsetWidth-a.btnDone.offsetWidth;else c=c-a.btnAction.offsetWidth-a.btnCancel.offsetWidth;a.selectedItem.style.width=c+g;a.selectedItem.style.height=b.WefGalleryHelper.getDPIYScaledNumber(b.UI.DefaultSelectedItemHeight)+g;var d=parseInt(window.getComputedStyle?window.getComputedStyle(a.selectedItem).marginLeft:a.selectedItem.style.marginLeft);a.selectedDescriptionText.style.maxWidth=c-d-a.selectedDescriptionReadMoreLink.offsetWidth+g;a.footerLink.style.width=c+g};j.prototype.deSelectBtnAction=function(){var a=this;a.selectedItem.style.display=f;if(a.currentStoreType!=b.StoreTypeEnum.ThisDocument){if(a.hasMarketPlace)a.footerLink.style.display=r;b.WefGalleryHelper.addClass(a.btnAction,u);a.btnAction.disabled=d}};j.prototype.cleanUpGallery=function(){var c=this;c.menuHandler.hideMenu(d);c.flightAddinManagerFeatureEnabled&&c.nonMarketMenuHandler.hideMenu(d);c.noAppsMessage.style.display=f;c.notification.style.display=f;c.errorMessage.innerHTML=n;c.deSelectBtnAction();if(c.galleryItems!=a)for(var e=0;e<c.galleryItems.length;e++){c.galleryItems[e].dispose();delete c.galleryItems[e]}c.galleryItems=a;while(c.gallery.hasChildNodes())c.gallery.removeChild(c.gallery.firstChild);c.header.style.height=b.WefGalleryHelper.getDPIYScaledNumber(b.UI.DefaultHeaderHeight)+g;c.setGalleryHeight();c.trustPageSessionTime=0};j.prototype.processResults=function(e){var c=this;c.results=a;if(e==a)return;c.results=e;c.galleryItems=new Array(e.length);for(var d=0;d<e.length;d++){c.galleryItems[d]=new b.GalleryItem(e[d],d);c.galleryItems[d].displayAgave(c.gallery)}c.delayLoadVisibleImages()};j.prototype.processAddinLoadingErrors=function(b){for(var a=0;a<b.length;a++)if(b[a].hasLoadingError){this.showError(Strings.wefgallery.L_AddinsHasLoadingErrors,this.currentStoreId);break}};j.prototype.delayLoadVisibleImages=function(c){var b=this;c!=a&&b.delayCallbacks.push(c);if(!b.delayTime||b.delaying==e||(new Date).getTime()-b.delayTime>1e3){b.delayTime=(new Date).getTime();b.delaying=d;setTimeout(b.loadVisibleImages,b.delayLoad)}else b.delayTime=(new Date).getTime()};j.prototype.getItemsPerRow=function(){var c=this;if(!c.gallery||!c.galleryItems||c.galleryItems.length==0)return e;var d=0;if(b.WefGalleryHelper.getHTMLDir()!=E)d=c.gallery.offsetLeft+c.gallery.offsetWidth;for(var f=0,g=0;g<c.galleryItems.length;g++){var a=c.galleryItems[g].galleryItem;if(a.offsetLeft==0){f=3;break}if(b.WefGalleryHelper.getHTMLDir()==E){var j=window.getComputedStyle?parseInt(window.getComputedStyle(a).marginLeft):b.WefGalleryHelper.getDPIXScaledNumber(b.UI.DefaultLeftMargin),k=Math.abs(a.offsetLeft-j);if(k>=d){d=a.offsetLeft+a.offsetWidth;f++}else break}else{var i=window.getComputedStyle?parseInt(window.getComputedStyle(a).marginRight):b.WefGalleryHelper.getDPIXScaledNumber(b.UI.DefaultRightMargin),h=a.offsetLeft+a.offsetWidth+i;if(h<=d||Math.abs(h-d)<1){d=a.offsetLeft;f++}else break}}c.itemsPerRow=f;return f};j.prototype.showContentPage=function(j){var c=this,k=c;c.footer.style.visibility=J;c.documentAppsMsg.style.display=f;c.footer.style.height=b.WefGalleryHelper.getDPIYScaledNumber(b.UI.HiddenFooterHeight)+g;c.showHideRightMenuButtons(e,e);c.setGalleryHeight();if(j&&j!=n){c.gallery.style.overflowY=J;var h=b.WefGalleryHelper.addSpinWheel(c.gallery),d=document.createElement("iframe");d.setAttribute(m,"OMEXSTORE");d.setAttribute("width",D);d.setAttribute("height",D);d.setAttribute("frameBorder",i);d.setAttribute("scrolling","no");d.setAttribute(l,c.removeStoreStrings?Strings.wefgallery.L_RecommendationTabIframeTitleTxt_Appsource:Strings.wefgallery.L_RecommendationTabIframeTitleTxt);var o=function(){if(h){h.parentNode==k.gallery&&k.gallery.removeChild(h);h=a}k.gallery.setAttribute(G,x);k.onPageLoad()};b.WefGalleryHelper.addEventListener(d,"load",o);j+="#"+window.location.href;d.setAttribute("src",j);c.gallery.appendChild(d);window.addEventListener("message",function(a){a.data==="lastelement"&&document.getElementsByClassName(y)[0].focus()})}else c.showError(Strings.wefgallery.L_NoFeaturedItemsError,b.PageStoreId.Recommendation)};j.prototype.removeGalleryItem=function(b){var a=this;if(a.galleryItems){if(a.galleryItems.length==1&&b==0){a.showNoAppsError();a.officeStoreBtn.focus()}else if(a.galleryItems[b]){var f=a.galleryItems[b].galleryItem;a.gallery.removeChild(f);a.galleryItems.splice(b,1);a.results.splice(b,1);for(var g=a.galleryItems.length,c=b;c<g;c++)a.galleryItems[c].setIndex(c);if(a.galleryItems.length>=1){var e=b;if(b>=a.galleryItems.length)e=0;a.selectGalleryItems(e,d)}}a.currentIndex=o;a.deSelectBtnAction()}};j.prototype.refreshGalleryItem=function(h,k){var a=this;if(a.galleryItems&&a.galleryItems[h]){var g=a.galleryItems[h].galleryItem.firstElementChild,i=g.firstElementChild.lastChild;g.firstElementChild.removeChild(i);for(var d=g.firstElementChild.nextElementSibling,j=d.childElementCount,f=0;f<j;f++)if(d.childNodes[f].textContent==="Shared"){d.removeChild(d.childNodes[f]);break}if(k===b.StoreTypeEnum.MarketPlace){for(var e=a.galleryContainer.lastElementChild,c=0;c<e.childNodes.length;c++)if(e.childNodes[c].textContent==="Stop"){e.removeChild(e.childNodes[c]);break}}else{for(var c=0;c<a.galleryContainer.childNodes.length;c++)a.galleryContainer.childNodes[c].textContent==="Stop"&&a.galleryContainer.removeChild(a.galleryContainer.childNodes[c]);a.galleryItems[h].nonMarketAppOptions.hideOptionsButton()}}};j.prototype.selectGalleryItems=function(h,g){var a=this;if(g===void 0)g=e;var j=a.results[h],m=a.galleryItems?a.galleryItems.length:0;a.currentIndex=o;for(var d=0;d<m;d++){var c=a.galleryItems[d];if(h==d){a.currentIndex=h;if(b.WefGalleryHelper.hasClass(c.galleryItem,q)){if(g==e){a.unselectGalleryItems(c);a.deSelectBtnAction()}}else{b.WefGalleryHelper.addClass(c.galleryItem,q);b.WefGalleryHelper.setHtmlEncodedText(a.selectedDescriptionText,j.description);a.selectedDescriptionText.setAttribute(l,j.description);a.selectedItem.style.display=r;a.footerLink.style.display=f;if(a.currentStoreType!=b.StoreTypeEnum.ThisDocument){b.WefGalleryHelper.removeClass(a.btnAction,u);a.btnAction.removeAttribute(u)}c.galleryItem.setAttribute(k,i);c.galleryItem.focus();c.galleryItem.setAttribute(v,w);a.setSelectedItemWidth();if(b.IMPage.currentStoreType===b.StoreTypeEnum.MarketPlace)c.appOptions&&c.appOptions.showOptionsButton();else if(a.flightAddinManagerFeatureEnabled)c.nonMarketAppOptions&&c.nonMarketAppOptions.showOptionsButton();a.onItemSelect(c)}}else a.unselectGalleryItems(c)}};j.prototype.unselectGalleryItems=function(c){if(c&&c.galleryItem){b.WefGalleryHelper.removeClass(c.galleryItem,q);c.galleryItem.removeAttribute(v);c.galleryItem.setAttribute(k,A);c.appOptions&&c.galleryItem.querySelector(":hover")==a&&c.appOptions.hideOptionsButton()}};j.prototype.focusSelectedGalleryItems=function(){var c=this;if(c.currentIndex>=0&&c.galleryItems!=a&&c.galleryItems.length>0){var d=c.galleryItems[c.currentIndex];b.WefGalleryHelper.hasClass(d.galleryItem,q)&&d.galleryItem.focus()}};j.prototype.isElementGalleryItem=function(a){if(b.WefGalleryHelper.hasClass(a,"Moe")||b.WefGalleryHelper.hasClass(a,"MoeInner"))return d;else return e};j.prototype.showNoAppsError=function(){var a=this;a.gallery.innerHTML=n;if(a.currentStoreType===b.StoreTypeEnum.MarketPlace){a.noAppsMessage.style.display=r;a.gallery.appendChild(a.noAppsMessage);a.footer.style.visibility=J;a.showHideRightMenuButtons(e,d)}else a.showError(Strings.wefgallery.L_NoAgavePrompt,a.currentStoreId)};j.prototype.showNotificationInternal=function(l,d,e,n){var a=this,j=a;if(a.uiState.Ready){a.notification.style.display=r;if(d&&e){var c=document.getElementById(K);if(!c){a.errorMessage.innerHTML=l+" <a id='linkId'>"+d+"</a>";c=document.getElementById(K);c.setAttribute(k,i);c.setAttribute(h,s);c.onclick=function(){e()};b.WefGalleryHelper.addClass(c,M)}}else a.errorMessage.innerHTML=l;var m=a.errorMessage.scrollHeight+b.UI.AdjustNotificationHeight;document.getElementById(N).style.height=m+g;var o=b.WefGalleryHelper.getDPIYScaledNumber(b.UI.DefaultHeaderHeight)+m;document.getElementById("Header").style.height=o+g;a.setGalleryHeight()}else{if(arguments.length>=3&&d&&e){a.uiState.ErrorLinkTextBeforeReady=d;a.uiState.ErrorLinkHandlerBeforeReady=e}a.uiState.StoreIdBeforeReady=a.currentStoreId;a.uiState.ErrorBeforeReady=l}if(n){a.notificationDismissImg.style.width=b.WefGalleryHelper.getDPIXScaledNumber(b.UI.DismissButtonSide)+g;a.notificationDismissImg.style.height=b.WefGalleryHelper.getDPIYScaledNumber(b.UI.DismissButtonSide)+g;a.notificationDismiss.style.display="table-cell";a.notificationDismiss.onclick=function(){j.notification.style.display=f;j.notificationDismiss.style.display=f;j.header.style.height=b.WefGalleryHelper.getDPIYScaledNumber(b.UI.DefaultHeaderHeight)+g;j.setGalleryHeight()}}else a.notificationDismiss.style.display=f};j.prototype.showSignedInMessage=function(){var a=this,e=a,d=S,g=Strings.wefgallery.L_SignOutLinkText,j=Strings.wefgallery.L_SignOutPrompt;if(a.uiState.Ready){a.signedInDiv.style.display=r;var c=document.getElementById(d);if(!c){a.signedInMessage.innerHTML=j+" <a id='"+d+"'>"+g+"</a>";c=document.getElementById(d);c.setAttribute(k,i);c.setAttribute(h,s);c.onclick=function(){e.signedInDiv.style.display=f;e.cleanUpGallery();e.invokeSignOut()};b.WefGalleryHelper.addClass(c,M)}}else{a.uiState.ErrorLinkTextBeforeReady=g;a.uiState.ErrorLinkHandlerBeforeReady=a.showSignedInMessage;a.uiState.StoreIdBeforeReady=a.currentStoreId;a.uiState.ErrorBeforeReady=j}};j.prototype.showSuccess=function(d,b){this.showNotification(c.Success,d,a,a,a,b)};j.prototype.showError=function(e,f,a,d,b){this.showNotification(c.Error,e,f,a,d,b)};j.prototype.showNotification=function(k,c,f,h,j,i){var a=this;if((f||f===n)&&f!=a.currentStoreId||!c)return;a.gallery&&a.gallery.firstChild&&b.WefGalleryHelper.hasClass(a.gallery.firstChild,"SpinWheel")&&a.gallery.removeChild(a.gallery.firstChild);a.gallery.setAttribute(G,x);var g=a.envSetting&&a.envSetting[z]?d:e;g&&a.setNotificationStyle(k);if(arguments.length<4)a.showNotificationInternal(c);else a.showNotificationInternal(c,h,j,i)};j.prototype.gotoStore=function(){var b=this;if(b.isMacAppStoreBuild){var c=b.getAppSourceLandingPageUrl();c&&b.invokeWindowOpen(c)}else b.toggleTabSelection(b.storeTab,a)};j.prototype.overrideButtonTooltip=function(){};j.prototype.getPageUrl=function(a){var c=this.clientFacadeCommon.getPageUrl(a);c==n&&a==b.PageTypeEnum.Recommendation&&this.showError(Strings.wefgallery.L_NoFeaturedItemsError,b.PageStoreId.Recommendation);return c};j.prototype.insertSelectedItem=function(){var a=this;if(a.allowInsertion()&&a.galleryItems)for(var c=0;c<a.galleryItems.length;c++){var d=a.galleryItems[c];if(b.WefGalleryHelper.hasClass(d.galleryItem,q)){a.insertItem(d);break}}};j.prototype.allowInsertion=function(){return d};j.prototype.checkAndCreateOneDriveProviderTab=function(){};j.prototype.wefGalleryAppOnLoad=function(){var g="alert",c=this,j=c;c.galleryContainer=document.getElementById("GalleryContainer");c.galleryContainer.setAttribute(h,C);c.mainPage=document.getElementById("MainPage");c.gallery=document.getElementById("InsertGallery");c.header=document.getElementById("Header");c.tabs=document.getElementById("Tabs");c.footer=document.getElementById("Footer");c.footerLink=document.getElementById("FooterLink");c.mainTitle=document.getElementById("MainTitle");c.selectedItem=document.getElementById("SelectedItem");c.selectedDescriptionText=document.getElementById("SelectedDescriptionText");c.selectedDescriptionReadMoreLink=document.getElementById("SelectedDescriptionReadMoreLink");c.permissionTextAndLink=document.getElementById("PermissionTextAndLink");c.permissionTextTR=document.getElementById("PermissionTextTR");c.readMoreATag=document.getElementById("ReadMoreLink");c.permissionATag=document.getElementById("PermissionLink");c.documentAppsMsg=document.getElementById("DocumentAppsMessageId");c.documentAppsMsgText=document.getElementById("DocumentAppsMessageText");c.btnAction=document.getElementById(O);c.btnCancel=document.getElementById(P);c.btnTrustAll=document.getElementById("BtnTrustAll");c.btnDone=document.getElementById("BtnDone");c.notification=document.getElementById(N);c.notification.setAttribute(h,g);c.errorMessage=document.getElementById("ErrorMessage");c.errorMessage.setAttribute(h,g);c.notificationDismiss=document.getElementById("NotificationDismiss");c.notificationDismissImg=document.getElementById("DismissImg");c.menuRight=document.getElementById("MenuRight");c.noAppsMessage=document.getElementById("NoAppsMessage");c.noAppsMessage.setAttribute(h,g);c.noAppsMessageTitle=document.getElementById("NoAppsMessageTitle");c.noAppsMessageTitle.setAttribute(h,g);c.noAppsMessageText=document.getElementById("NoAppsMessageText");c.noAppsMessageText.setAttribute(h,g);c.signedInDiv=document.getElementById("SignedInDiv");c.signedInDiv.setAttribute(h,g);c.signedInMessage=document.getElementById("SignedInMessage");c.signedInMessage.setAttribute(h,g);c.officeStoreBtn=document.getElementById("BtnStore");c.officeStoreBtn.title=c.removeStoreStrings?Strings.wefgallery.L_OfficeStore_Button_NoAddIns_Tooltip_Appsource:Strings.wefgallery.L_OfficeStore_Button_NoAddIns_Tooltip;c.manageATag=document.getElementById(Q);c.uploadATag=document.getElementById("UploadMenuInner");c.uploadMenuDiv=document.getElementById("UploadMenu");c.manageMenuDiv=document.getElementById("Manage");c.refreshMenuDiv=document.getElementById("Refresh");c.menuRightSeparatorDiv=document.getElementById("MenuRightSeparator");var k=document.getElementById(I);c.storeStaticElementRealSize();b.WefGalleryHelper.dpiScaleHeight(c.header);b.WefGalleryHelper.dpiScaleMarginLeft(c.mainTitle);b.WefGalleryHelper.dpiScaleHeight(c.mainTitle);b.WefGalleryHelper.dpiScaleHeight(k);b.WefGalleryHelper.dpiScaleMarginLeft(c.errorMessage);b.WefGalleryHelper.dpiScaleMarginLeft(c.tabs);b.WefGalleryHelper.dpiScaleMarginLeft(c.documentAppsMsgText);b.WefGalleryHelper.dpiScaleHeight(c.footer);b.WefGalleryHelper.dpiScaleWidth(c.footerLink);b.WefGalleryHelper.dpiScaleMarginLeft(c.footerLink);b.WefGalleryHelper.dpiScaleMarginLeft(c.selectedItem);b.WefGalleryHelper.dpiScaleHeightAndWidth(c.btnAction);b.WefGalleryHelper.dpiScaleHeightAndWidth(c.btnCancel);b.WefGalleryHelper.dpiScaleHeightAndWidth(c.btnTrustAll);b.WefGalleryHelper.dpiScaleHeightAndWidth(c.btnDone);b.WefGalleryHelper.dpiScaleHeight(c.notification);b.WefGalleryHelper.dpiScaleHeight(c.uploadMenuDiv);b.WefGalleryHelper.dpiScaleHeight(c.menuRight);b.WefGalleryHelper.dpiScaleHeight(c.manageMenuDiv);b.WefGalleryHelper.dpiScaleHeight(c.menuRightSeparatorDiv);b.WefGalleryHelper.dpiScaleHeight(c.refreshMenuDiv);c.menuRight.style.display=f;c.gallery.onscroll=function(){j.galleryScrollHandler()};c.btnAction.onclick=function(){j.insertSelectedItem()};c.btnCancel.onclick=function(){j.cancelDialog()};c.btnDone.onclick=function(){j.cancelDialog()};c.officeStoreBtn.onclick=function(){j.gotoStore()};c.footerLink.onclick=function(){j.gotoStore()};c.manageATag.onclick=function(){j.launchAppManagePage()};c.showActionButtons(b.ActionButtonGroups.None);c.modalDialog=new b.AppManagement.ModalDialog(c.mainPage);if(c.flightAddinManagerFeatureEnabled)c.nonMarketMenuHandler=new b.AppManagement.MenuHandler(c.galleryContainer,a,c.modalDialog);c.menuHandler=new b.AppManagement.MenuHandler(c.galleryContainer,c.modalDialog,c.modalDialog);c.tabLoopTerminalDiv=document.createElement("div");c.tabLoopTerminalDiv.setAttribute(m,"TabLoopTerminal");c.tabLoopTerminalDiv.setAttribute(B,i);c.menuRight.appendChild(c.tabLoopTerminalDiv);c.tabLoopTerminalDiv.onfocus=function(){if(j.shiftTabFromFirstElement)j.shiftTabFromFirstElement=e;else j.tabs.childNodes[j.currentTabIndex].firstChild.focus()};c.keyHandlers=[c.menuHandler,c.modalDialog];window.document.onkeydown=function(a){j.keyCodePressed=a.keyCode;j.galleryKeyDownHandler(a)};window.document.onkeyup=function(a){j.keyCodePressed=a.keyCode;j.galleryKeyUpHandler(a)};window.onresize=c.resizeHandler;c.uiState.Ready=d};return j}();b.WefGalleryPage=d;b.setupClientSpecificWefGalleryPage=a;b.showIt=function(){if(b.setupClientSpecificWefGalleryPage){b.setupClientSpecificWefGalleryPage();b.IMPage.showItInternal()}}})(WEF||(WEF={}));(function(a){var b;(function(u){var i="0",n="title",l="button",g="block",h="none",f="tabindex",d=true,c=false,e="px",k="id",j="role",b=null,m="Stop",p="RateReview",o="AppDetails",q;(function(a){a[a["Cancel"]=0]="Cancel";a[a[o]=1]=o;a[a[p]=2]=p;a[a["Remove"]=3]="Remove";a[a[m]=4]=m})(q||(q={}));var s;(function(c){var b="IsAnonymous",a="ConfirmationDialogCancel";c[c[a]=256]=a;c[c[b]=1024]=b})(s||(s={}));var r;(function(a){a[a["Up"]=0]="Up";a[a["Down"]=1]="Down";a[a["Left"]=2]="Left";a[a["Right"]=3]="Right"})(r||(r={}));var x=function(){var q="data-buttonIndex",p="aria-hidden",o="data-previous-disabled",m="data-previous-tab";function i(g){var f="dialogConfirmMessage",d="div",c=this;c.modalDisabledDiv=b;c.overlayDiv=b;c.dialogDiv=b;c.buttonDiv=b;c.confirmMessageDiv=b;c.buttonElements=[];c.enterKeyTarget=b;c.dialogId="appManagementModalDialog";c.modalDisabledDiv=g;c.overlayDiv=document.createElement(d);a.WefGalleryHelper.addClass(c.overlayDiv,"Overlay");document.body.appendChild(c.overlayDiv);c.dialogDiv=document.createElement(d);c.dialogDiv.setAttribute(j,"dialog");c.dialogDiv.setAttribute("aria-labelledby",f);a.WefGalleryHelper.addClass(c.dialogDiv,"ConfirmDialog");document.body.appendChild(c.dialogDiv);c.confirmMessageDiv=document.createElement(d);c.confirmMessageDiv.setAttribute(k,f);a.WefGalleryHelper.addClass(c.confirmMessageDiv,"ConfirmMessage");c.dialogDiv.appendChild(c.confirmMessageDiv);c.buttonDiv=document.createElement(d);a.WefGalleryHelper.addClass(c.buttonDiv,"ConfirmButtons");c.dialogDiv.appendChild(c.buttonDiv);c.dialogDiv.style.width=a.WefGalleryHelper.getDPIXScaledNumber(a.UI.ConfirmDialogWidth)+e}i.prototype.handleKeyDown=function(e){var b=this;if(!b.isDialogVisible())return c;var a=c;switch(e.keyCode){case 9:b.onTab(e);a=d;break;case 13:a=b.onEnterKeyDown(e);break;case 27:b.hideDialog();a=d}return a};i.prototype.handleKeyUp=function(a){var b=c;if(!this.isDialogVisible())return b;switch(a.keyCode){case 13:var e=a.srcElement?a.srcElement:a.target;if(e==this.enterKeyTarget){this.enterKeyTarget.click();b=d}}return b};i.prototype.hideDialog=function(){var e=this;if(!e.isDialogVisible())return;for(var k=e.getTabbableElements(),l=c,g=0;g<k.length;g++){var a=k[g],j=a.getAttribute(m),i=a.getAttribute(o);if(j!==b)a.setAttribute(f,j);else a.removeAttribute("tabIndex");if(i!==b){a.disabled=i.toLowerCase()=="true";if(!l&&!a.disabled){l=d;a.focus()}}}e.dialogDiv.style.display=h;e.overlayDiv.style.display=h;e.modalDisabledDiv.removeAttribute(p)};i.prototype.showDialog=function(u,r){var b=this;if(!b.isDialogVisible()){for(var t=b.getTabbableElements(),h=0;h<t.length;h++){var i=t[h];i.setAttribute(m,i.getAttribute(f));var s=c;if(i.disabled)s=d;i.setAttribute(o,s.toString());i.setAttribute(f,"-1");i.disabled=d}b.modalDisabledDiv.setAttribute(p,"true")}b.dialogDiv.style.display=g;b.overlayDiv.style.display=g;b.confirmMessageDiv.innerHTML=u;b.buttonDiv.innerHTML="";b.buttonElements=[];for(h=0;h<r.length;h++){var j=r[h],e=document.createElement("input");e.setAttribute(k,j.id);e.setAttribute("type",l);e.setAttribute("value",j.text);e.setAttribute(n,j.text);e.setAttribute(q,h.toString());e.onclick=j.onclick;b.buttonDiv.appendChild(e);b.buttonElements.push(e);a.WefGalleryHelper.dpiScaleHeightAndWidth(e);j.hasFocus&&e.focus()}b.positionDialog()};i.prototype.positionDialog=function(){if(!this.isDialogVisible())return;var b=this.dialogDiv,d=a.WefGalleryHelper.getDocumentHeight()/2-b.offsetHeight/2,c=a.WefGalleryHelper.getDocumentWidth()/2-b.offsetWidth/2;b.style.top=d+e;b.style.left=c+e};i.prototype.getTabbableElements=function(){return document.querySelectorAll("input,a,button,[tabindex]")};i.prototype.isDialogVisible=function(){return this.dialogDiv.style.display!=h&&this.dialogDiv.offsetWidth>0};i.prototype.onTab=function(c){var a=this,e=c.srcElement?c.srcElement:c.target,d=parseInt(e.getAttribute(q)),b=0;if(isFinite(d))b=d;if(c.shiftKey)if(b<=0)a.buttonElements[a.buttonElements.length-1].focus();else a.buttonElements[b-1].focus();else if(b>=a.buttonElements.length-1)a.buttonElements[0].focus();else a.buttonElements[b+1].focus()};i.prototype.onEnterKeyDown=function(g){var a=this,f=c,h=g.srcElement?g.srcElement:g.target;if(h==b)return f;for(var e=0;e<a.buttonElements.length;e++)if(a.buttonElements[e]==h){a.enterKeyTarget=a.buttonElements[e];f=d;break}return f};return i}();u.ModalDialog=x;var w=function(){function l(q,i,l){var e=this,g=e;e.menuDiv=b;e.appDetailsButton=b;e.rateReviewButton=b;e.removeAppButton=b;e.stopAppButton=b;e.menuItems=b;e.currentMenuItemIndex=0;e.currentResult=b;e.removalConfirmationDialog=b;e.stopConfirmationDialog=b;e.enterKeyTarget=b;e.dialogId="appManagementMenuDialog";e.menuDiv=document.createElement("ul");e.menuDiv.setAttribute(j,"menu");e.menuDiv.setAttribute(f,"-1");e.menuDiv.setAttribute(k,"OptionsMenu");e.removalConfirmationDialog=i;e.stopConfirmationDialog=l;e.menuDiv.oncontextmenu=function(){return c};q.appendChild(e.menuDiv);e.menuItems=[];if(i){e.appDetailsButton=new t(e.menuDiv,o,Strings.wefgallery.L_OptionsMenu_AppDetails_Txt,Strings.wefgallery.L_OptionsMenu_AppDetails_Txt_Tooltip);e.menuItems.push(e.appDetailsButton);if(!a.IMPage.isMacAppStoreBuild){e.rateReviewButton=new t(e.menuDiv,p,Strings.wefgallery.L_OptionsMenu_RateReview_Txt,a.IMPage.removeStoreStrings?Strings.wefgallery.L_OptionsMenu_RateReview_Txt_Tooltip_Appsource:Strings.wefgallery.L_OptionsMenu_RateReview_Txt_Tooltip);e.menuItems.push(e.rateReviewButton)}e.removeAppButton=new t(e.menuDiv,"RemoveApp",Strings.wefgallery.L_OptionsMenu_Remove_Txt,Strings.wefgallery.L_OptionsMenu_Remove_Txt_Tooltip);e.menuItems.push(e.removeAppButton)}if(a.IMPage.flightAddinManagerFeatureEnabled){e.stopAppButton=new t(e.menuDiv,"StopApp",Strings.wefgallery.L_OptionsMenu_Stop_Txt,Strings.wefgallery.L_OptionsMenu_Stop_Txt_Tooltip);e.menuItems.push(e.stopAppButton)}for(var m=function(b){a.WefGalleryHelper.addEventListener(g.menuItems[b].element,"focus",function(){g.selectMenuItemAtIndex(b)})},h=0;h<e.menuItems.length;h++)m(h);var n=function(a){g.menuDiv.contains(a.target)==c&&g.hideMenu(d)};a.WefGalleryHelper.addEventListener(document,"click",n)}l.prototype.createAppOptions=function(a){return new v(a,this)};l.prototype.handleKeyDown=function(f){var e=this;if(e.isMenuVisible()==c)return c;var b=c;switch(f.keyCode){case 9:e.selectNextMenuItem(f.shiftKey?r.Up:r.Down);b=d;break;case 13:b=e.onEnterKeyDown(f);break;case 27:e.hideMenu(d);a.IMPage.focusSelectedGalleryItems();b=d;break;case 38:e.selectNextMenuItem(r.Up);b=d;break;case 40:e.selectNextMenuItem(r.Down);b=d;break;case 37:case 39:b=d;break;default:b=c}return b};l.prototype.handleKeyUp=function(a){var b=c;if(this.isMenuVisible()==c)return b;switch(a.keyCode){case 13:var e=a.srcElement?a.srcElement:a.target;if(e==this.enterKeyTarget){this.enterKeyTarget.click();b=d}}return b};l.prototype.hideMenu=function(g){var a=this;if(a.isMenuVisible()){var f=a.menuDiv.contains(document.activeElement);a.menuDiv.style.display=h;g&&a.logData(a.currentResult,q.Cancel,0);if(f&&a.removalConfirmationDialog!=b)for(var d=a.removalConfirmationDialog.getTabbableElements(),c=0;c<d.length;c++){var e=d[c];if(!e.disabled){e.focus();break}}}};l.prototype.isMenuVisible=function(){return this.menuDiv.style.display!=h&&this.menuDiv.offsetWidth>0};l.prototype.popupMenuForApp=function(f,k,h,i,j){var g=this,e=g;g.currentResult=f;if(a.IMPage.currentStoreType===a.StoreTypeEnum.MarketPlace){g.appDetailsButton.setOnClick(function(){e.hideMenu(c);a.IMPage.invokeWindowOpen(e.currentResult.appEndNodeUrl);e.logData(f,q.AppDetails,0)});g.rateReviewButton&&g.rateReviewButton.setOnClick(function(){e.hideMenu(c);a.IMPage.invokeWindowOpen(f.rateReviewUrl);e.logData(f,q.RateReview,0)});g.removeAppButton.setOnClick(function(){e.hideMenu(c);e.showConfirmationDialog(f.authType,function(){e.removeAppHandler(f,h,i,j)},b,function(){e.logData(f,q.Remove|s.ConfirmationDialogCancel,0)})})}a.IMPage.flightAddinManagerFeatureEnabled&&g.stopAppButton.setOnClick(function(){e.hideMenu(c);e.showConfirmationDialog(f.authType,b,function(){e.stopAppHandler(f,h,i,j)},function(){e.logData(f,q.Stop|s.ConfirmationDialogCancel,0)})});setTimeout(function(){a.IMPage.selectGalleryItems(h,d);e.positionMenu(k);e.clearMenuSelection();e.menuDiv.focus()},0)};l.prototype.onEnterKeyDown=function(g){var a=this,f=c,h=g.srcElement?g.srcElement:g.target;if(h==b)return f;for(var e=0;e<a.menuItems.length;e++)if(a.menuItems[e].element==h){a.enterKeyTarget=a.menuItems[e].element;f=d;break}return f};l.prototype.positionMenu=function(h){var b=this;b.menuDiv.style.display=g;var k=a.WefGalleryHelper.getDocumentHeight(),l=a.WefGalleryHelper.getDocumentWidth(),n=b.menuDiv.getBoundingClientRect(),c=h.getBoundingClientRect(),j=b.menuDiv.offsetHeight,d=b.menuDiv.offsetWidth,m=h.offsetHeight,f=1,i=parseInt(b.menuDiv.parentElement.style.zIndex);if(isFinite(i))f=i+1;b.menuDiv.style.zIndex=f.toString();if(c.top+j<=k)b.menuDiv.style.top=c.top+e;else b.menuDiv.style.top=c.top+m-j+e;if(a.WefGalleryHelper.getHTMLDir()=="ltr")if(c.left+d<=l)b.menuDiv.style.left=c.left+e;else b.menuDiv.style.left=c.right-d+e;else if(c.left-d>0)b.menuDiv.style.left=c.right-d+e;else b.menuDiv.style.left=c.left+e};l.prototype.removeAppHandler=function(f,l,i,j){var e="SpinWheel",m=this,k=function(n){m.removeAppButton.setDisabled(c);a.WefGalleryHelper.removeClass(i,e);j.style.display=g;var h="";switch(n){case a.InvokeResultCode.S_OK:a.IMPage.removeGalleryItem(l);break;case a.InvokeResultCode.E_CATALOG_REQUEST_FAILED:h=Strings.wefgallery.L_RequestFailedError;break;case a.InvokeResultCode.E_OEM_NO_NETWORK_CONNECTION:h=Strings.wefgallery.L_RemoveAppOfflineError;break;case a.InvokeResultCode.E_USER_NOT_SIGNED_IN:var k=Strings.wefgallery.L_RemoveAppWithSignInError.replace("{0}",f.displayName);a.IMPage.showError(k,a.StoreTypeEnum.MarketPlace,Strings.wefgallery.L_SignInLinkText,a.IMPage.invokeSignIn);break;default:h=Strings.wefgallery.L_RemoveAppGeneralError.replace("{0}",f.displayName)}h&&a.IMPage.showError(h,a.StoreTypeEnum.MarketPlace,b,b,d)};this.removeAppButton.setDisabled(d);a.WefGalleryHelper.addClass(i,e);j.style.display=h;a.IMPage.removeAgave(this.currentResult,k)};l.prototype.stopAppHandler=function(k,j,l,f){var e=this,i=function(i){var h="";e.stopAppButton.setDisabled(c);f.style.display=g;switch(i){case a.InvokeResultCode.S_OK:e.currentResult.activeStatus=c;a.IMPage.refreshGalleryItem(j,a.IMPage.currentStoreType);break;case a.InvokeResultCode.E_CATALOG_REQUEST_FAILED:h=Strings.wefgallery.L_RequestFailedError;break;default:h=Strings.wefgallery.L_StopAppGeneralError.replace("{0}",k.displayName)}h&&a.IMPage.showError(h,a.StoreTypeEnum.MarketPlace,b,b,d)};this.stopAppButton.setDisabled(d);f.style.display=h;a.IMPage.stopActiveAddin(this.currentResult,i)};l.prototype.showConfirmationDialog=function(m,j,l,k){var b="ConfirmCancel",f=this;if(j){var e=Strings.wefgallery.L_Confirmation_RemoveAppAuthenticated_Message;if(m==a.AuthType.Anonymous)e=Strings.wefgallery.L_Confirmation_RemoveAppAnonymous_Message;e=e.replace(/\\n/g,"<br />");var i=[];i.push({id:"ConfirmRemove",text:Strings.wefgallery.L_OptionsMenu_Remove_Txt,hasFocus:d,onclick:function(){f.removalConfirmationDialog.hideDialog();a.IMPage.focusSelectedGalleryItems();j()}});i.push({id:b,text:Strings.wefgallery.L_Confirmation_Cancel_Button_Txt,hasFocus:c,onclick:function(){f.removalConfirmationDialog.hideDialog();a.IMPage.focusSelectedGalleryItems();k()}});this.removalConfirmationDialog.showDialog(e,i)}else{var h=Strings.wefgallery.L_Confirmation_StopApp_Message;h=h.replace(/\\n/g,"<br />");var g=[];g.push({id:"ConfirmStop",text:Strings.wefgallery.L_OptionsMenu_Stop_Txt,hasFocus:d,onclick:function(){f.stopConfirmationDialog.hideDialog();a.IMPage.focusSelectedGalleryItems();l()}});g.push({id:b,text:Strings.wefgallery.L_Confirmation_Cancel_Button_Txt,hasFocus:c,onclick:function(){f.stopConfirmationDialog.hideDialog();a.IMPage.focusSelectedGalleryItems();k()}});this.stopConfirmationDialog.showDialog(h,g)}};l.prototype.selectMenuItemAtIndex=function(b){var a=this;if(a.menuItems[b]&&a.menuItems[b].disabled==c){a.currentMenuItemIndex>=0&&a.menuItems[a.currentMenuItemIndex].setSelected(c);a.menuItems[b].setSelected(d);a.currentMenuItemIndex=b;return d}return c};l.prototype.clearMenuSelection=function(){var a=this;if(a.currentMenuItemIndex>=0){a.menuItems[a.currentMenuItemIndex].setSelected(c);a.currentMenuItemIndex=-1}};l.prototype.selectNextMenuItem=function(c){var a=this;if(a.currentMenuItemIndex<0&&a.selectMenuItemAtIndex(0))return;else if(a.currentMenuItemIndex>=a.menuItems.length&&a.selectMenuItemAtIndex(a.menuItems.length-1))return;var b=a.currentMenuItemIndex;while(b>=0&&b<a.menuItems.length){if(c==r.Up)b--;else b++;b=(b+a.menuItems.length)%a.menuItems.length;if(a.selectMenuItemAtIndex(b))return}};l.prototype.logData=function(b,e,f){var d=i;if(b)d=b.id;var c=0;if(b.authType==a.AuthType.Anonymous)c=s.IsAnonymous;a.IMPage.clientFacadeCommon.logAppManagementAction(d,e|c,f)};return l}();u.MenuHandler=w;var t=function(){function d(g,o,m,h){var d=this;d.disabled=c;d.element=b;var e=document.createElement("li");e.setAttribute(j,"presentation");d.element=document.createElement(l);a.WefGalleryHelper.setHtmlEncodedText(d.element,m);d.element.setAttribute(n,h);d.element.setAttribute(f,i);d.element.setAttribute(j,"menuitem");d.element.setAttribute(k,o);a.WefGalleryHelper.addClass(d.element,"menuOption");g.appendChild(e);e.appendChild(d.element);d.setSelected(c);d.setDisabled(c)}d.prototype.setOnClick=function(a){var b=this;this.element.onclick=function(){if(b.disabled)return;a()}};d.prototype.setSelected=function(a){this.element.setAttribute("aria-selected",a.toString());a&&this.element.focus()};d.prototype.setDisabled=function(d){var b="disabled",c=this;c.element.setAttribute("aria-disabled",d.toString());c.element.disabled=d;c.disabled=d;if(d)a.WefGalleryHelper.addClass(c.element,b);else a.WefGalleryHelper.removeClass(c.element,b)};return d}();u.OptionsMenuItem=t;var v=function(){function k(d,c){var a=this;a.result=b;a.appIndex=b;a.menuHandler=b;a.tnDiv=b;a.img=b;a.optionsButton=b;a.result=d;a.menuHandler=c}k.prototype.createOptionsButton=function(g,h,m){var d=this,k=d,c=b;if(a.IMPage.canShowAppManagementMenu()){c=document.createElement("input");a.WefGalleryHelper.addClass(c,"OptionsButton");c.setAttribute("type",l);c.setAttribute(j,l);c.setAttribute("value","\u22ef");c.setAttribute("aria-label",Strings.wefgallery.L_OptionsMenu_Tooltip);c.setAttribute(n,Strings.wefgallery.L_OptionsMenu_Tooltip);c.setAttribute(f,i);c.style.width=a.WefGalleryHelper.getDPIXScaledNumber(a.UI.MenuButtonSide)+e;c.style.height=a.WefGalleryHelper.getDPIYScaledNumber(a.UI.MenuButtonSide)+e;c.style.backgroundSize=a.WefGalleryHelper.getDPIYScaledNumber(a.UI.MenuButtonBackgroundSize)+e;d.optionsButton=c;a.WefGalleryHelper.addEventListener(c,"click",function(){k.popupMenu()});d.appIndex=g;d.tnDiv=h;d.img=m}return c};k.prototype.showOptionsButton=function(){var e=this,k=e;if(e.optionsButton)if(a.IMPage.flightAddinManagerFeatureEnabled){if(a.IMPage.currentStoreType===a.StoreTypeEnum.MarketPlace){var h=a.IMPage.galleryContainer.lastElementChild,l=c;if(e.result.activeStatus){for(var j=0;j<h.childElementCount;j++)if(h.childNodes[j].textContent===m){l=d;break}if(!l){var o=h,n=new t(o,"StopApp",Strings.wefgallery.L_OptionsMenu_Stop_Txt,Strings.wefgallery.L_OptionsMenu_Stop_Txt_Tooltip);n.setOnClick(function(){a.IMPage.menuHandler.hideMenu(c);a.IMPage.menuHandler.showConfirmationDialog(k.result.authType,b,function(){a.IMPage.menuHandler.stopAppHandler(k.result,k.appIndex,k.tnDiv,k.img)},function(){a.IMPage.menuHandler.logData(k.result,q.Stop|s.ConfirmationDialogCancel,0)})});h.appendChild(n.element)}}else for(var j=0;j<h.childElementCount;j++)if(h.childNodes[j].textContent===m){l=d;h.removeChild(h.childNodes[j]);break}e.optionsButton.style.display=g;e.optionsButton.setAttribute(f,i)}else if(e.result.activeStatus){e.optionsButton.style.display=g;e.optionsButton.setAttribute(f,i)}}else{e.optionsButton.style.display=g;e.optionsButton.setAttribute(f,i)}};k.prototype.hideOptionsButton=function(){if(this.optionsButton)this.optionsButton.style.display=h};k.prototype.showOptionsButtonOnMouseOver=function(){var b=this;if(b.optionsButton&&!(a.IMPage.currentStoreType!==a.StoreTypeEnum.MarketPlace&&!b.result.activeStatus)){b.optionsButton.style.display=g;b.optionsButton.setAttribute(f,"-1")}};k.prototype.popupMenu=function(){var b=this;b.optionsButton&&!(a.IMPage.currentStoreType!==a.StoreTypeEnum.MarketPlace&&!b.result.activeStatus)&&b.menuHandler.popupMenuForApp(b.result,b.optionsButton,b.appIndex,b.tnDiv,b.img)};k.prototype.setAppIndex=function(a){if(a>=0)this.appIndex=a};return k}();u.AppOptions=v})(b=a.AppManagement||(a.AppManagement={}))})(WEF||(WEF={}));(function(a){var b;(function(n){var k="none",h="block",f="px",c=false,j="title",i="button",d=true,e="tabindex",l="HostSpecificBorderColor",g="role",b=null,m;(function(a){a[a["Up"]=0]="Up";a[a["Down"]=1]="Down";a[a["Left"]=2]="Left";a[a["Right"]=3]="Right"})(m||(m={}));var p=function(){var t="data-previous-disabled",s="data-previous-tab",n="value",r="true",q="type",p="input",o="div";function m(e,d,f){var c=this;c.dialogId="uploadFileModalDialog";c.overlayDiv=b;c.dialogDiv=b;c.title=b;c.uploadAddinDialogTextDiv=b;c.developerTestText=b;c.chooseManifestText=b;c.fileBrowseDiv=b;c.displayFilePathInput=b;c.browseButton=b;c.fileBrowseInput=b;c.buttonDiv=b;c.buttonElements=[];c.reader=new FileReader;c.selectedManifestFile=b;c.enterKeyTarget=b;c.prevFocusElement=b;c.containerDiv=b;c.clientFacade=e;c.prevFocusElement=d;c.containerDiv=f;c.overlayDiv=document.createElement(o);a.WefGalleryHelper.addClass(c.overlayDiv,"Overlay");document.body.appendChild(c.overlayDiv);c.dialogDiv=document.createElement(o);c.dialogDiv.setAttribute(g,"dialog");a.WefGalleryHelper.addClass(c.dialogDiv,"ConfirmDialog");a.WefGalleryHelper.addClass(c.dialogDiv,l);c.dialogDiv.id="UploadFileDialog";document.body.appendChild(c.dialogDiv)}m.prototype.init=function(){var a=this,b=a;a.title=document.createElement("label");a.title.textContent=Strings.wefgallery.L_AddinCommands_UploadAddin_Txt;a.title.id="UploadFileDialogTitle";a.dialogDiv.appendChild(a.title);a.dialogDiv.setAttribute("aria-labelledby",a.title.id);a.uploadAddinDialogTextDiv=document.createElement("label");a.uploadAddinDialogTextDiv.id="uploadAddinDialogTextDiv";a.dialogDiv.appendChild(a.uploadAddinDialogTextDiv);a.developerTestText=document.createElement("span");a.developerTestText.textContent=Strings.wefgallery.L_AddinCommands_DeveloperFeature_Txt;a.developerTestText.id="DeveloperTestPurpose";a.uploadAddinDialogTextDiv.appendChild(a.developerTestText);a.chooseManifestText=document.createElement("span");a.chooseManifestText.textContent=Strings.wefgallery.L_AddinCommands_ChooseManifest_Txt;a.chooseManifestText.id="ChooseManifest";a.uploadAddinDialogTextDiv.appendChild(a.chooseManifestText);a.fileBrowseDiv=document.createElement(o);a.fileBrowseDiv.id="FileBrowseDiv";a.dialogDiv.appendChild(a.fileBrowseDiv);a.fileBrowseInput=document.createElement(p);a.fileBrowseInput.setAttribute(q,"file");a.fileBrowseInput.setAttribute("accept","text/xml,application/xml");a.fileBrowseInput.setAttribute(e,"-1");a.fileBrowseInput.setAttribute("aria-hidden",r);a.fileBrowseInput.id="BrowserFile";a.fileBrowseInput.onchange=function(){b.selectedManifestFile=b.getSelectFile();if(b.selectedManifestFile)b.displayFilePathInput.setAttribute(n,b.fileBrowseInput.value.replace(/^.*(\\|\/|\:)/,""));else b.displayFilePathInput.setAttribute(n,"")};a.fileBrowseDiv.appendChild(a.fileBrowseInput);a.displayFilePathInput=document.createElement(p);a.displayFilePathInput.setAttribute(q,"text");a.displayFilePathInput.setAttribute("data-lpignore",r);a.displayFilePathInput.id="DisplayFilePathInput";a.fileBrowseDiv.appendChild(a.displayFilePathInput);a.displayFilePathInput.disabled=d;a.browseButton=document.createElement(p);a.browseButton.setAttribute(q,i);a.browseButton.setAttribute(n,Strings.wefgallery.L_Browse_Button_Txt);a.browseButton.setAttribute(j,Strings.wefgallery.L_Browse_Button_Txt);a.browseButton.setAttribute("aria-describedby",a.uploadAddinDialogTextDiv.id);a.browseButton.id="BrowseButton";a.browseButton.onclick=function(){b.fileBrowseInput.click()};a.fileBrowseDiv.appendChild(a.browseButton);a.buttonDiv=document.createElement(o);a.buttonDiv.id="UploadDialogConfirmButtons";a.dialogDiv.appendChild(a.buttonDiv)};m.prototype.handleKeyDown=function(a){var e=this,b=c;if(!e.isDialogVisible())return b;var g=a.srcElement?a.srcElement:a.target;switch(a.keyCode){case 9:e.onTab(a);b=d;break;case 13:var f=a.srcElement?a.srcElement:a.target;e.enterKeyTarget=f;b=d;break;case 27:e.hideDialog();b=d}return b};m.prototype.handleKeyUp=function(b){var a=this,e=c;if(!a.isDialogVisible())return e;var f=b.srcElement?b.srcElement:b.target;switch(b.keyCode){case 13:if(f==a.enterKeyTarget)switch(f.getAttribute("id")){case a.browseButton.id:a.fileBrowseInput&&a.fileBrowseInput.click();break;case m.DialogCancelButtonId:a.cancelUploadDialog();break;case m.DialogInstallButtonId:a.submitUploadDialog()}e=d}return e};m.prototype.hideDialog=function(){var a=this;if(!a.isDialogVisible())return;for(var i=a.getTabbableElements(),j=c,f=0;f<i.length;f++){var d=i[f],h=d.getAttribute(s),g=d.getAttribute(t);if(h!==b)d.setAttribute(e,h);else d.removeAttribute("tabIndex");if(g!==b)d.disabled=g.toLowerCase()==r}document.body.removeChild(a.dialogDiv);document.body.removeChild(a.overlayDiv);a.prevFocusElement&&a.prevFocusElement.focus()};m.prototype.showDialog=function(o){var b=this;if(!b.isDialogVisible())for(var u=b.getTabbableElements(),k=0;k<u.length;k++){var l=u[k];l.setAttribute(s,l.getAttribute(e));var r=c;if(l.disabled)r=d;l.setAttribute(t,r.toString());l.setAttribute(e,"-1");l.disabled=d}b.init();if(window.getComputedStyle)b.dialogDiv.style.maxWidth=parseInt(window.getComputedStyle(b.containerDiv).width)-47+f;b.dialogDiv.style.display=h;b.overlayDiv.style.display=h;b.buttonDiv.textContent="";b.buttonElements=[];for(var k=0;k<o.length;k++){var m=o[k],g=document.createElement(p);g.id=m.id;g.setAttribute(q,i);g.setAttribute(n,m.text);g.setAttribute(j,m.text);g.setAttribute("data-buttonIndex",k.toString());g.onclick=m.onclick;b.buttonDiv.appendChild(g);b.buttonElements.push(g);a.WefGalleryHelper.dpiScaleHeightAndWidth(g);m.hasFocus&&g.focus()}b.buttonElements[0].disabled=d;b.browseButton&&b.browseButton.focus();b.positionDialog()};m.prototype.positionDialog=function(){if(!this.isDialogVisible())return;var b=this.dialogDiv,d=a.WefGalleryHelper.getDocumentHeight()/2-b.offsetHeight/2,c=a.WefGalleryHelper.getDocumentWidth()/2-b.offsetWidth/2;b.style.top=d+f;b.style.left=c+f};m.prototype.submitUploadDialog=function(){this.logUploadFileDevCatelogAction(OSF.UploadFileDevCatelogAction.Install,0);this.installApp();this.hideDialog()};m.prototype.cancelUploadDialog=function(){this.logUploadFileDevCatelogAction(OSF.UploadFileDevCatelogAction.Cancel,0);this.hideDialog()};m.prototype.getTabbableElements=function(){return document.querySelectorAll("input,a,button,[tabindex]")};m.prototype.isDialogVisible=function(){return this.dialogDiv.style.display!=k&&this.dialogDiv.offsetWidth>0};m.prototype.onTab=function(f){for(var g=f.srcElement?f.srcElement:f.target,c=this.dialogDiv.querySelectorAll("input:not([tabindex='-1'])"),a=c.length,b=0;b<a;b++)if(c[b]==g){for(var e=1;e<a;e++){var d;if(f.shiftKey)d=c[(b+a-e)%a];else d=c[(b+e)%a];if(!d.disabled){d.focus();break}}break}};m.prototype.getSelectFile=function(){var e=this,g=e,a=e.fileBrowseInput.files[0];if(a!=b){var f=a.type.toString(),i=a.size,h=1048576;if(f!="text/xml"&&f!="application/xml"||i>h)a=b;else{e.buttonElements[0].disabled=c;e.buttonElements[0].focus();e.reader.onload=function(){var a=g.reader.result;g.clientFacade.installAddIn(a)}}}if(a==b)e.buttonElements[0].disabled=d;return a};m.prototype.installApp=function(){this.selectedManifestFile!=b&&this.reader.readAsText(this.selectedManifestFile)};m.prototype.logUploadFileDevCatelogAction=function(a,c){var b={datapointName:OSF.DataPointNames.UploadFileDevCatelog,operationMetadata:a,status:c};this.clientFacade.logTelemetryData(b,function(){})};m.DialogCancelButtonId="DialogCancel";m.DialogInstallButtonId="DialogInstall";return m}();n.ModalDialog=p;var q=function(){function i(n,s,r,k){var i="ManageAddinMenu",h=this,j=h;h.menuDiv=b;h.myAccount=b;h.uploadAddin=b;h.menuItems=b;h.currentMenuItemIndex=0;h.enterKeyTarget=b;h.uploadDialog=b;h.dialogId="uploadFileMenuDialog";h.prevFocusElement=b;h.menuDiv=document.createElement("ul");h.menuDiv.setAttribute(g,"menu");h.menuDiv.setAttribute(e,"-1");h.menuDiv.id=i;h.uploadDialog=s;h.prevFocusElement=r;h.menuDiv.oncontextmenu=function(){return c};n.appendChild(h.menuDiv);h.myAccount=new o(h.menuDiv,"MyAccount",Strings.wefgallery.L_AddinCommands_MyAccount_Txt,Strings.wefgallery.L_WefDialog_ManageButton_Tooltip);h.uploadAddin=new o(h.menuDiv,"UploadAddin",Strings.wefgallery.L_AddinCommands_UploadMyAddin_Txt,Strings.wefgallery.L_AddinCommands_UploadMyAddin_Txt);h.menuItems=[h.myAccount,h.uploadAddin];for(var p=function(a){j.menuItems[a].element.addEventListener("focus",function(){j.selectMenuItemAtIndex(a)})},m=0;m<h.menuItems.length;m++)p(m);var q=function(b){var a=c;if(b.relatedTarget!==undefined){if(j.menuDiv.contains(b.relatedTarget)==c)a=d}else if(!j.menuDiv.querySelector(":focus"))a=d;a&&j.hideMenu()};h.menuDiv.addEventListener("focusout",q);h.hideMenu();h.menuDiv.id=i;a.WefGalleryHelper.addClass(h.menuDiv,l);if(a.WefGalleryHelper.getHTMLDir()=="ltr")h.menuDiv.style.left=k.offsetLeft+f;else h.menuDiv.style.right=n.offsetWidth-k.offsetLeft-k.offsetWidth+f}i.prototype.handleKeyDown=function(e){var b=this;if(b.isMenuVisible()==c)return c;var a=c;switch(e.keyCode){case 9:b.selectNextMenuItem(e.shiftKey?m.Up:m.Down);a=d;break;case 13:a=b.onEnterKeyDown(e);break;case 27:b.hideMenu();a=d;break;case 38:b.selectNextMenuItem(m.Up);a=d;break;case 40:b.selectNextMenuItem(m.Down);a=d;break;case 37:case 39:a=d;break;default:a=c}return a};i.prototype.handleKeyUp=function(a){var b=c;if(this.isMenuVisible()==c)return b;switch(a.keyCode){case 13:var e=a.srcElement?a.srcElement:a.target;if(e==this.enterKeyTarget){this.enterKeyTarget.click();b=d}}return b};i.prototype.hideMenu=function(){var a=this;if(a.isMenuVisible()){a.menuDiv.style.display=k;a.prevFocusElement&&a.prevFocusElement.focus()}};i.prototype.isMenuVisible=function(){return this.menuDiv.style.display!=k&&this.menuDiv.offsetWidth>0};i.prototype.popupMenu=function(){var a=this;setTimeout(function(){a.menuDiv.style.display=h;a.clearMenuSelection();a.menuDiv.focus()},0)};i.prototype.showUploadAddinDialog=function(){var d=this,b=this.uploadDialog;b.logUploadFileDevCatelogAction(OSF.UploadFileDevCatelogAction.OpenUploadFileDialog,0);var a=[];a.push({id:p.DialogInstallButtonId,text:Strings.wefgallery.L_Upload_Button_Txt,hasFocus:c,onclick:function(){d.uploadDialog.submitUploadDialog()}});a.push({id:p.DialogCancelButtonId,text:Strings.wefgallery.L_Confirmation_Cancel_Button_Txt,hasFocus:c,onclick:function(){d.uploadDialog.cancelUploadDialog()}});b.showDialog(a)};i.prototype.selectMenuItemAtIndex=function(b){var a=this;if(a.menuItems[b]&&a.menuItems[b].disabled==c){a.currentMenuItemIndex>=0&&a.menuItems[a.currentMenuItemIndex].setSelected(c);a.menuItems[b].setSelected(d);a.currentMenuItemIndex=b;return d}return c};i.prototype.clearMenuSelection=function(){var a=this;if(a.currentMenuItemIndex>=0){a.menuItems[a.currentMenuItemIndex].setSelected(c);a.currentMenuItemIndex=-1}};i.prototype.selectNextMenuItem=function(c){var a=this;if(a.currentMenuItemIndex<0&&a.selectMenuItemAtIndex(0))return;else if(a.currentMenuItemIndex>=a.menuItems.length&&a.selectMenuItemAtIndex(a.menuItems.length-1))return;var b=a.currentMenuItemIndex;while(b>=0&&b<a.menuItems.length){if(c==m.Up)b--;else b++;b=(b+a.menuItems.length)%a.menuItems.length;if(a.selectMenuItemAtIndex(b))return}};i.prototype.onEnterKeyDown=function(g){var a=this,f=c,h=g.srcElement?g.srcElement:g.target;if(h==b)return f;for(var e=0;e<a.menuItems.length;e++)if(a.menuItems[e].element==h){a.enterKeyTarget=a.menuItems[e].element;f=d;break}return f};return i}();n.MenuHandler=q;var o=function(){function d(h,m,l,k){var d=this;d.disabled=c;d.element=b;var f=document.createElement("li");f.setAttribute(g,"presentation");d.element=document.createElement(i);a.WefGalleryHelper.setHtmlEncodedText(d.element,l);d.element.setAttribute(j,k);d.element.setAttribute(e,"0");d.element.setAttribute(g,"menuitem");d.element.id=m;a.WefGalleryHelper.addClass(d.element,"menuOption");h.appendChild(f);f.appendChild(d.element);d.setSelected(c);d.setDisabled(c)}d.prototype.setOnClick=function(a){var b=this;this.element.onclick=function(){if(b.disabled)return;a()}};d.prototype.setSelected=function(a){this.element.setAttribute("aria-selected",a.toString());a&&this.element.focus()};d.prototype.setDisabled=function(d){var b="disabled",c=this;c.element.setAttribute("aria-disabled",d.toString());c.element.disabled=d;c.disabled=d;if(d)a.WefGalleryHelper.addClass(c.element,b);else a.WefGalleryHelper.removeClass(c.element,b)};return d}();n.OptionsMenuItem=o})(b=a.FilePickerDialogUIHelper||(a.FilePickerDialogUIHelper={}))})(WEF||(WEF={}));(function(b){var f="category",e=false,d=true,a=null,c="";b.CurrentPlatform=b.Platform.OfficeOnline;var j;(function(a){a.DefaultHeaderHeight=62;a.AdjustNotificationHeight=9})(j=b.UI||(b.UI={}));var g;(function(a){var d="QueryResult",c="TrustPage",b="Category";a[a["Default"]=0]="Default";a[a[b]=1]=b;a[a[c]=2]=c;a[a[d]=3]=d})(g||(g={}));var i=function(){var k="&authtype=1",j="&IsFirstPage=true",h="&ClientSessionId=",i="ContextActivationManager_logTelemetryDataForInsertDialog";function g(){var e=this;e.webAppState={};e.p1="16";e.p2=0;e.p3="0";e.p4="0";e.p5="0";e.providers=[];e.providersTxt=c;e.providersFullInfo=a;e.envSettingTxt=c;e.envSetting=a;e.oRedir="https://o15.officeredir.microsoft.com/r/";e.blackForestHost=".de";e.blackForestFP="microsoftonline.de";e.navigationTxt=c;e.navigation={};e.contextMgrCorrelation=c;e.webAppState.webAppUrl=a;e.webAppState.conversationID=a;e.webAppState.clientEndPoint=a;e.webAppState.window=window.parent;e.webAppState.storeId=c;var g=OSF.OUtil.parseXdmInfo(d);if(g!=a){var f=OSF.OUtil.getInfoItems(g);if(f!=undefined&&f.length>=2){e.webAppState.conversationID=f[0];e.webAppState.webAppUrl=decodeURIComponent(f[1]);e.ver=f.length>2?f[2]:a;e.app=f.length>3?f[3]:a;e.clid=f.length>4?f[4]:1033;e.p1=f.length>5?f[5]:0;e.providersTxt=decodeURIComponent(f.length>6?f[6]:a);e.webAppState.storeId=f.length>7?f[7]:a;e.envSettingTxt=decodeURIComponent(f.length>8?f[8]:a);e.navigationTxt=decodeURIComponent(f.length>9?f[9]:a);e.contextMgrCorrelation=f.length>10?f[10]:a}}e.envSetting=JSON.parse(e.envSettingTxt);var h=e.parseDecodedHostName(e.webAppState.webAppUrl);if(!b.WefGalleryHelper.isHostNameValidWacDomain(h))e.webAppState.webAppUrl=document.location.origin;else e.webAppState.webAppUrl=e.reconstructUrl(e.webAppState.webAppUrl);e.webAppState.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(e.webAppState.conversationID,e.webAppState.window,e.webAppState.webAppUrl,OSF.SerializerVersion.Browser);e.providersFullInfo=JSON.parse(e.providersTxt);for(var i in e.providersFullInfo)e.providers.push(e.providersFullInfo[i].provValues);e.navigation=JSON.parse(e.navigationTxt)}g.prototype.logTelemetryDataForDialogSession=function(g){var f=b.IMPage.totalSessionTime<0?(b.IMPage.totalSessionTime+=(new Date).getTime()):0,e=b.IMPage.trustPageSessionTime<0?(b.IMPage.trustPageSessionTime+=(new Date).getTime()):0,c=0;if(b.IMPage.galleryItems!=a)c=b.IMPage.galleryItems.length;var h={datapointName:OSF.DataPointNames.InsertionDialogSession,assetId:g,totalSessionTime:f,trustPageSessionTime:e,appInserted:d,lastActiveTab:b.IMPage.currentStoreType,lastActiveTabCount:c};this.webAppState.clientEndPoint.invoke(i,function(){},h)};g.prototype.logCorrelation=function(a,b){var c={correlationId:a,messageInfo:b};this.webAppState.clientEndPoint.invoke("ContextActivationManager_logCorrelation",function(){},c)};g.prototype.getEntitlements=function(c,g,j,h){var f=this,i=function(j,i){b.IMPage.uiState.Ready=d;if(i){if(g==b.StoreTypeEnum.MarketPlace&&i.errorCode==b.InvokeResultCode.E_USER_NOT_SIGNED_IN){b.IMPage.providers[c]=a;delete b.IMPage.providers[c];f.providers.shift();f.providers.push([b.PageStoreId.Recommendation,b.StoreTypeEnum.Recommendation,0,0]);b.IMPage.initializeGalleryUI(f.providers,e);b.IMPage.showContent(e);f.logCorrelation(f.contextMgrCorrelation,"My Apps tab is removed.");return}else if(i.errorCode==b.InvokeResultCode.E_CATALOG_NO_APPS){b.IMPage.providers[c][1]=b.InvokeResultCode.E_CATALOG_NO_APPS;b.IMPage.providers[c][2]=i.errorCode}if(g==b.StoreTypeEnum.ExchangeCorporateCatalog&&i.errorCode!=b.InvokeResultCode.E_USER_NOT_SIGNED_IN)f.envSetting["showSignOutFromPrivateCatalogMessage"]&&b.IMPage.showSignedInMessage();if(b.WefGalleryHelper.handleErrorCode(i.errorCode,c,g,b.IMPage.providers[c][1])){b.IMPage.providers[c][1]=0;b.IMPage.providers[c][2]=0;return}h(i.value,i.errorCode)}else j==-6&&h(a,b.InvokeResultCode.E_REQUEST_TIME_OUT)},k={storeType:g,refresh:j};this.webAppState.clientEndPoint.invoke("ContextActivationManager_getEntitlementsForInsertDialog",i,k)};g.prototype.getProviders=function(){return this.providers};g.prototype.getEnvSetting=function(){return this.envSetting};g.prototype.getNavigationParams=function(){return this.navigation};g.prototype.getPageUrl=function(k,i,g){var c=this,e;if(c.envSetting["isStoreDisabled"])return "https://go.microsoft.com/fwlink/?LinkId=834786";var j=c.p5;if(i!==undefined&&g!==undefined)j=encodeURIComponent(g+"/"+i);switch(k){case b.PageTypeEnum.Recommendation:c.p2=6;e=c.oRedir+OSF.RLID.Recommend;break;case b.PageTypeEnum.Landing:c.p2=8;c.p4="HP";e=c.oRedir+OSF.RLID.Landing;break;case b.PageTypeEnum.EndNode:c.p2=8;c.p4="WA";e=c.oRedir+OSF.RLID.Landing;break;case b.PageTypeEnum.RateAndReview:c.p2=8;c.p4="WR";e=c.oRedir+OSF.RLID.Landing;break;case b.PageTypeEnum.ManageApps:e=c.oRedir+OSF.RLID.ManageApps}e+=c.getCommonQueryString(d);e+="&P5="+j;e+=h+c.contextMgrCorrelation;if(c.envSetting["isBlackForestRedirectEnabled"]){var f=c.parseDecodedHostName(c.webAppState.webAppUrl);if(f!=a&&f.indexOf(c.blackForestHost,f.length-c.blackForestHost.length)>=0)e+="&fp="+c.blackForestFP}return e};g.prototype.installAddIn=function(b){var c={manifest:b};this.webAppState.clientEndPoint.invoke("ContextActivationManager_onClickInstallOsfControl",a,c)};g.prototype.refreshAddinCommands=function(b){var c={storeType:b};this.webAppState.clientEndPoint.invoke("ContextActivationManager_onClickRefreshAddinCommands",a,c)};g.prototype.insertAgave=function(b){this.logTelemetryDataForDialogSession(b.assetId,d);this.webAppState.clientEndPoint.invoke("ContextActivationManager_onClickInsertOsfControl",a,b)};g.prototype.cancelDialog=function(){this.logTelemetryDataForDialogSession("0",e);this.webAppState.clientEndPoint.invoke("ContextActivationManager_onClickCancelDialog",a,{})};g.prototype.invokeSignIn=function(c,b){var d={storeId:c,storeType:b};this.webAppState.clientEndPoint.invoke("ContextActivationManager_invokeSignIn",a,d)};g.prototype.invokeSignOut=function(d,c){var e={storeType:c};this.webAppState.clientEndPoint.invoke("ContextActivationManager_invokeSignOut",a,e);b.WefGalleryHelper.handleErrorCode(b.InvokeResultCode.E_USER_NOT_SIGNED_IN,d,a,a)};g.prototype.invokeWindowOpen=function(b){var c={pageUrl:b};this.webAppState.clientEndPoint.invoke("ContextActivationManager_invokeWindowOpen",a,c)};g.prototype.getWebAppState=function(){return this.webAppState};g.prototype.removeAgave=function(b,c){this.webAppState.clientEndPoint.invoke("ContextActivationManager_removeAppForInsertDialog",c,b);this.webAppState.clientEndPoint.invoke("ContextActivationManager_removeAppCommandsAddin",a,b)};g.prototype.stopActiveAddin=function(b,c){this.webAppState.clientEndPoint.invoke("ContextActivationManager_stopAppForInsertDialog",c,b);this.webAppState.clientEndPoint.invoke("ContextActivationManager_stopAppCommandsAddin",a,b)};g.prototype.logTelemetryData=function(b,a){this.webAppState.clientEndPoint.invoke(i,a,b)};g.prototype.getOmexData=function(b){this.webAppState.clientEndPoint.invoke("ContextActivationManager_getOmexData",a,b)};g.prototype.getTrustPageUrl=function(b){var a="https://go.microsoft.com/fwlink/?LinkId=717814";a+="&assetid="+b;a+="&clid="+this.clid;a+=this.getClientCv();a+=j;a+=k;a+=h+this.contextMgrCorrelation;return a};g.prototype.getCategoryPageUrl=function(a){return this.getStorePageUrl(f,a)};g.prototype.getQueryResultPageUrl=function(a){return this.getStorePageUrl("qu",a)};g.prototype.getStorePageUrl=function(b,c){var a="https://go.microsoft.com/fwlink/?LinkId=717815";if(!b||!c)return a;a+=this.getCommonQueryString(e);a+=k;var d=encodeURIComponent(c).replace(/%20/g,"+");a+="&"+b+"="+encodeURIComponent(d);a+=h+this.contextMgrCorrelation;a+=j;return a};g.prototype.getCommonQueryString=function(c){var a=this,d=a.getClientCv(),b=c?"?":"&";b+="ver="+a.ver+"&app="+a.app+"&clid="+a.clid+"&P1="+a.p1+"&P2="+a.p2+"&P3="+a.p3+"&P4="+a.p4+d.replace("16.0.","17.0.");return b};g.prototype.getClientCv=function(){var a=this,b=c;if(a.providersFullInfo.myApp)b=a.providersFullInfo.myApp.client?"&client="+a.providersFullInfo.myApp.client+"&cv="+a.p1+"&authType="+a.providersFullInfo.myApp.authType:c;return b};g.prototype.logAppManagementAction=function(c,b,d){var e={datapointName:OSF.DataPointNames.AppManagementMenu,assetId:c,operationMetadata:b,hrStatus:d},a=function(){};this.logTelemetryData(e,a)};g.prototype.initializeProviderTabStrings=function(){b.storeTypes={0:Strings.wefgallery.L_MarketPlaceTabTxt,1:Strings.wefgallery.L_CatalogTabTxt,4:Strings.wefgallery.L_FileShareTabTxt,6:b.IMPage.removeStoreStrings?Strings.wefgallery.L_RecommendationTabTxt_Appsource:Strings.wefgallery.L_RecommendationTabTxt,10:Strings.wefgallery.L_ExchangeCCTabTxt};if(document.cookie.indexOf("OneDriveCatalog=true")!=-1)b.storeTypes[9]=Strings.wefgallery.L_OneDriveTabTxt};g.prototype.reconstructUrl=function(d){var a=OSF.OUtil.parseUrl(d),b=undefined;if(!d||!a||!a.protocol||!a.host||!a.hostname)return b;if(a.isPortPartOfUrl)b=a.protocol+"//"+a.host+(a.pathname?a.pathname:c);else b=a.protocol+"//"+a.hostname+(a.pathname?a.pathname:c);b=b+(a.search?a.search:c)+(a.hash?a.hash:c);return b};g.prototype.parseDecodedHostName=function(e,a){if(a===void 0)a=d;try{var b=OSF.OUtil.parseUrl(e,a);return !!b?b.hostname:undefined}catch(c){return undefined}};return g}();b.ClientFacade_Wac=i;var h=function(i){__extends(h,i);function h(g){var f=i.call(this,g)||this;f.insertItem=function(a){if(!f.allowInsertion())return;var b={id:a.result.id,targetType:a.result.targetType,appVersion:a.result.appVersion,currentStoreType:a.result.storeType,storeId:a.result.storeId,assetId:a.result.assetId,assetStoreId:a.result.assetStoreId,width:a.result.width,height:a.result.height,displayName:a.result.displayName};f.clientFacade.insertAgave(b)};f.showEntitlements=function(i,k,j){var g="hidden";if(f.currentStoreType==b.StoreTypeEnum.MarketPlace){f.showHideRightMenuButtons(f.footer.style.visibility!=g,d);f.showActionButtons(b.ActionButtonGroups.InsertCancel);f.documentAppsMsg.style.display="none"}else{f.showHideRightMenuButtons(e,d);f.showActionButtons(b.ActionButtonGroups.InsertCancel);f.documentAppsMsg.style.display="none"}f.setSelectedItemWidth();f.uiState.Ready=d;if(b.WefGalleryHelper.handleErrorCode(f.getCurrentProviderHResult(),f.currentStoreId,f.currentStoreType,f.getCurrentProviderStatus()))return;f.uiState.Ready=e;f.gallery.style.overflowY="auto";var m=b.WefGalleryHelper.addSpinWheel(f.gallery);if(i!=undefined){var h=i,l=function(m,p){if(h!=f.currentStoreId)return;f.cleanUpGallery();f.uiState.ErrorBeforeReady=c;f.providers[h][1]=0;f.providers[h][2]=0;if(b.WefGalleryHelper.handleErrorCode(p,h,a,a))return;var o=[],q={};if(m){for(var n=0;n<m.length;n++){var i=m[n].toArray?m[n].toArray():m[n],l=new b.AgaveInfo;l.authType=b.AuthType.MSA;l.displayName=i[0];l.id=i[1];l.description=i[2];l.targetType=i[3];l.appVersion=i.length>4?i[4]:c;l.assetId=i.length>5?i[5]:c;l.assetStoreId=i.length>6?i[6]:c;l.width=i.length>7?i[7]:0;l.height=i.length>8?i[8]:0;l.iconUrl=i.length>9?i[9]:b.AGAVE_DEFAULT_ICON;l.providerName=i.length>10&&i[10]?i[10]:c;l.storeId=i.length>11?i[11]:c;l.storeType=i.length>12?i[12]:c;l.webApplicationId=i.length>13?i[13]:c;if(f.currentStoreId==b.StoreTypeEnum.MarketPlace.toString()){l.appEndNodeUrl=f.clientFacade.getPageUrl(b.PageTypeEnum.EndNode,l.assetId,l.storeId);l.rateReviewUrl=f.clientFacade.getPageUrl(b.PageTypeEnum.RateAndReview,l.assetId,l.storeId)}if(q[l.id]==a){q[l.id]=d;o.push(l)}}o.sort(b.AgaveInfo.cmpDisplayName)}k&&f.clientFacade.refreshAddinCommands(f.currentStoreType);if(o.length==0){if(f.currentStoreType==b.StoreTypeEnum.MarketPlace){if(p==b.InvokeResultCode.S_OK){f.noAppsMessage.style.display="block";f.gallery.appendChild(f.noAppsMessage);f.footer.style.visibility=g;f.showHideRightMenuButtons(e,d)}}else if(p==b.InvokeResultCode.E_USER_NOT_SIGNED_IN)b.WefGalleryHelper.handleErrorCode(p,h,a,a);else f.showError(Strings.wefgallery.L_NoAgavePrompt,h);return}if(f.footer.style.visibility===g){f.showFooter();f.showHideRightMenuButtons(d,d);f.setGalleryHeight()}f.processResults(o);j&&j();f.gallery.setAttribute("aria-busy","false")};f.clientFacade.getEntitlements(i,f.currentStoreType,k,l)}};f.invokeSignIn=function(){f.clientFacade.invokeSignIn(f.currentStoreId,f.currentStoreType)};f.invokeSignOut=function(){f.clientFacade.invokeSignOut(f.currentStoreId,f.currentStoreType)};f.postMessageListener=function(g){var c=g.data?g.data.split("|"):a;if(c&&c.length>0)if(c[0]==b.OmexMessage.RefreshRequired||c[0]==b.OmexMessage.PreloadManifest){b.WefGalleryHelper.saveRefreshRequired(d);var h=function(b){var a=0;switch(b){case "1":a=0;break;case "2":a=1;break;default:OsfMsAjaxFactory.msAjaxDebug.trace("targetType value is invalid.")}return a},e={id:c[1],targetType:h(c[2]),appVersion:OSF.OUtil.normalizeAppVersion(c[3]),currentStoreType:c[4],storeId:c[5],assetId:c[6],assetStoreId:c[7],width:parseInt(c[8]),height:parseInt(c[9])};if(c[0]==b.OmexMessage.RefreshRequired)f.clientFacade.insertAgave(e);else if(c[0]==b.OmexMessage.PreloadManifest){f.trustPageSessionTime=-(new Date).getTime();f.clientFacade.getOmexData(e)}}else c[0]==b.OmexMessage.CancelDialog&&f.clientFacade.cancelDialog()};f.clientFacade=g;f.isUploadFileDevCatalogEnabled=f.envSetting["IsUploadFileDevCatalogEnabled"]&&typeof FileReader!=="undefined";return f}h.prototype.onPageLoad=function(){};h.prototype.onItemSelect=function(a){a&&a.result&&a.result.storeType=="omex"&&this.clientFacade.getOmexData(a.result)};h.prototype.cancelDialog=function(){this.clientFacade.cancelDialog()};h.prototype.canShowAppManagementMenu=function(){return d};h.prototype.removeAgave=function(c,f){var g={id:c.id,displayName:c.displayName,providerName:c.providerName,currentStoreType:c.storeType,storeId:c.storeId,iconUrl:c.iconUrl,webApplicationId:c.webApplicationId},e=function(g,e){var c=g;if(e.errorCode)c=e.errorCode;f(c);e.forceRefreshEntitlements&&c==b.InvokeResultCode.S_OK&&b.IMPage.showEntitlements(b.IMPage.currentStoreId,d,a)};this.clientFacade.removeAgave(g,e)};h.prototype.stopActiveAddin=function(c,f){var g={id:c.id,displayName:c.displayName,providerName:c.providerName,currentStoreType:c.storeType,storeId:c.storeId,iconUrl:c.iconUrl,webApplicationId:c.webApplicationId},e=function(g,e){var c=g;if(e.errorCode)c=e.errorCode;f(c);e.forceRefreshEntitlements&&c==b.InvokeResultCode.S_OK&&b.IMPage.showEntitlements(b.IMPage.currentStoreId,d,a)};this.clientFacade.stopActiveAddin(g,e)};h.prototype.invokeWindowOpen=function(a){this.clientFacade.invokeWindowOpen(a)};h.prototype.checkAndCreateOneDriveProviderTab=function(i,c,f,e,b){var a=this,d=window.location.protocol+"//"+window.location.host;OSF.OneDriveOAuth.setHostCallbackUri(d);var g=function(){a.createTab(a.tabs,c,f,e,b)},h=function(){};OSF.OneDriveOAuth.getAccessToken(g,h)};h.prototype.retrieveStoreId=function(){var a=this.clientFacade.getWebAppState();if(a&&a.storeId)return a.storeId;return b.WefGalleryHelper.retrieveStoreIdfromStorage()};h.prototype.launchUploadAddinDialog=function(){var a=this;if(a.isUploadFileDevCatalogEnabled){var d=new b.FilePickerDialogUIHelper.ModalDialog(a.clientFacade,a.uploadATag,a.galleryContainer),c=new b.FilePickerDialogUIHelper.MenuHandler(a.galleryContainer,d,a.uploadATag,a.manageMenuDiv);a.registerHandlers(d);a.registerHandlers(c);c.showUploadAddinDialog();a.galleryContainer.removeChild(c.menuDiv)}};h.prototype.registerHandlers=function(c){var a=this;for(var b=0;b<a.keyHandlers.length;b++)if(c.dialogId==a.keyHandlers[b].dialogId){a.keyHandlers.splice(b,1);break}a.keyHandlers.push(c)};h.prototype.launchAppManagePage=function(){var a=this,e=a;if(a.isUploadFileDevCatalogEnabled){var f=new b.FilePickerDialogUIHelper.ModalDialog(a.clientFacade,a.manageATag,a.galleryContainer),c=new b.FilePickerDialogUIHelper.MenuHandler(a.galleryContainer,f,a.manageATag,a.manageMenuDiv);a.registerHandlers(c);c.myAccount.setOnClick(function(){c.hideMenu();b.WefGalleryHelper.saveRefreshRequired(d);e.clientFacade.invokeWindowOpen(e.getAppManagePageUrl());e.galleryContainer.removeChild(c.menuDiv)});c.uploadAddin.setOnClick(function(){c.hideMenu();e.registerHandlers(f);c.showUploadAddinDialog();e.galleryContainer.removeChild(c.menuDiv)});c.popupMenu()}else{b.WefGalleryHelper.saveRefreshRequired(d);a.clientFacade.invokeWindowOpen(a.getAppManagePageUrl())}};h.prototype.executeButtonCommand=function(c,b){if(b===void 0)b=a;i.prototype.executeButtonCommand.call(this,c,b);if(c.getAttribute("id")=="UploadMenuInner"){this.launchUploadAddinDialog();b!=a&&b.preventDefault()}};h.prototype.wefGalleryAppOnLoad=function(){var a=this;i.prototype.wefGalleryAppOnLoad.call(this);this.uploadATag.onclick=function(){a.launchUploadAddinDialog()}};h.prototype.showItInternal=function(){var d="navigationModeParameter",i="navigationMode",c=this,j=c;c.wefGalleryAppOnLoad();c.setGalleryHeight();c.totalSessionTime=-(new Date).getTime();window.addEventListener("message",c.postMessageListener,e);b.WefGalleryHelper.addSpinWheel(c.gallery);var l=c.clientFacade.getProviders();if(!l){c.cleanUpGallery();c.showError(Strings.wefgallery.L_NoProviderError);return}var n=b.WefGalleryHelper.retrieveRefreshRequired();l.sort(function(a,b){return a[1]-b[1]});if(!c.initializeGalleryUI(l,n)){c.cleanUpGallery();c.showError(Strings.wefgallery.L_NoProviderError);return}var k=function(){var d="selected",c="TabSelected";if(j.storeTab){for(var e=a,f=0;f<j.tabs.childElementCount;f++)if(b.WefGalleryHelper.hasClass(j.tabs.childNodes[f],"TextNav")){e=j.tabs.childNodes[f].firstChild;b.WefGalleryHelper.removeClass(e,c);e.setAttribute("aria-selected","false");b.WefGalleryHelper.removeClass(e,d)}e=j.storeTab.firstChild;b.WefGalleryHelper.addClass(e,c);e.setAttribute("aria-selelcted","true");b.WefGalleryHelper.addClass(e,d)}},h=c.clientFacade.getNavigationParams();if(h!=a&&h[i]==g.TrustPage&&h[d]!=a&&h[d].length>0){k();var m=c.clientFacade.getTrustPageUrl(h[d]);c.showContentPage(m)}else if(h!=a&&h[i]==g.Category&&h[f]!=a&&h[f].length>0){k();var o=h[f],m=c.clientFacade.getCategoryPageUrl(o);c.showContentPage(m)}else if(h!=a&&h[i]==g.QueryResult&&h[d]!=a&&h[d].length>0){k();var m=c.clientFacade.getQueryResultPageUrl(h[d]);c.showContentPage(m)}else{b.WefGalleryHelper.saveRefreshRequired(e);c.showContent(n)}};return h}(b.WefGalleryPage);b.WefGalleryPage_Wac=h;b.setupClientSpecificWefGalleryPage=function(){var a=new i;b.IMPage=new h(a)}})(WEF||(WEF={}));WEF.AGAVE_DEFAULT_ICON="moe_default_icon.png"